(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/**
 * Created by qinning on 15/4/14.
 */
var VERSION_ASSET_ID = "@version";
var MANIFEST_ASSET_ID = "@manifest";
var AssetsManager = cc.Class.extend({
    /**
     * {jsb.AssetsManager}
     */
    _am : null,
    /**
     * {number}失败次数
     */
    _failCount : 0,
    /**
     * {number}最大错误重试次数
     */
    _maxFailCount : 1,
    ctor:function(){

    },
    purge:function() {
        if(this._am){
            this._am.release();
        }
        this._am = null;
    },

    retryDownAssets: function () {
        this._failCount = 0;
        this._maxFailCount = 5;
        if(this._am) {
            this._am.downloadFailedAssets();
        }
    },

    downLoadAssets : function(projectManifestPath,storagePath,updateCallBack,endCallBack) {
        this._failCount = 0;
        this._maxFailCount = 5;
        this._am = new jsb.AssetsManager(projectManifestPath, storagePath);
        this._am.retain();
        if (!this._am.getLocalManifest().isLoaded()) {
            endCallBack("error_local_manifest_not_loaded");
            return;
        }
        var that = this;
        var listener = new jsb.EventListenerAssetsManager(this._am, function (event) {
            switch (event.getEventCode()) {
                case jsb.EventAssetsManager.UPDATE_PROGRESSION:
                    var msg = event.getMessage();
                    cc.log("UPDATE_PROGRESSION:" + msg);
                    var assetId = event.getAssetId();
                    cc.log("assetId:"+assetId);
                    if(assetId == VERSION_ASSET_ID || assetId == MANIFEST_ASSET_ID) {
                        updateCallBack(1, "update manifest");
                    } else {
                        updateCallBack(event.getPercent(), msg);
                    }
                    break;
                case jsb.EventAssetsManager.UPDATE_FAILED:
                    cc.log("Update failed. " + event.getMessage());
                    that._failCount++;
                    if (that._failCount < that._maxFailCount) {
                        that._am.downloadFailedAssets();
                    }
                    else {
                        cc.log("Reach maximum fail count, exit update process");
                        that._failCount = 0;
                        endCallBack(event.getEventCode());
                    }
                    break;
                case jsb.EventAssetsManager.UPDATE_FINISHED:
                case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:
                    endCallBack(null);
                    break;

                case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:
                    cc.log("No local manifest file found, skip assets update.");
                    endCallBack(event.getEventCode());
                    break;
                case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:
                    endCallBack(event.getEventCode());
                    cc.log("Fail to download manifest file, update skipped.");
                    break;
                case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:
                    endCallBack(event.getEventCode());
                    cc.log("Fail to parse manifest file, update skipped.");
                    break;
                case jsb.EventAssetsManager.ERROR_UPDATING:
                    cc.log("Asset update error: " + event.getMessage());
                    endCallBack(event.getEventCode());
                    break;
                case jsb.EventAssetsManager.ERROR_DECOMPRESS:
                    cc.log(event.getMessage());
                    endCallBack(event.getEventCode());
                    break;
                default:
                    cc.log("default: " + event.getEventCode());
                    break;
            }
        });

        cc.eventManager.addListener(listener, 1);
        this._am.update();
    }
});

AssetsManager._instance = null;
AssetsManager._firstUseInstance = true;

/**
 *
 * @returns {AssetsManager}
 */
AssetsManager.getInstance = function () {
    if (AssetsManager._firstUseInstance) {
        AssetsManager._firstUseInstance = false;
        AssetsManager._instance = new AssetsManager();
    }
    return AssetsManager._instance;
};


module.exports = AssetsManager;
},{}],2:[function(require,module,exports){
/**
 * Created by qinning on 15/4/27.
 */

var ACTION_TYPE = {
    ACTION_NULL: 0,
    ACTION_PAUSE: 1,
    ACTION_RESUME: 2
};

var PLAY_TYPE = {
    PLAY_TYPE_NORMAL: 0,
    PLAY_TYPE_FADE_OUT_FADE_IN: 1
};

var AudioPlayer = cc.Class.extend({
    lastMusicVolume: 0,
    suffix: null,
    effectMap: null,
    playType: PLAY_TYPE.PLAY_TYPE_NORMAL,
    actionType: ACTION_TYPE.ACTION_NULL,
    musicName: null,
    loop: false,
    ctor: function () {
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            this.suffix = "res/audio_ogg/%s.ogg";
        } else {
            this.suffix = "res/audio_mp3/%s.mp3";
        }
        this.effectMap = {};
        var isMusicOn = this.isMusicOn();
        this.lastMusicVolume = 1;
        this.setMusicOn(isMusicOn);
    },

    beginSchedule: function () {
        cc.director.getScheduler().scheduleCallbackForTarget(this, this.update, 0.1, cc.REPEAT_FOREVER, 0, false);
    },

    stopSchedule: function () {
        cc.director.getScheduler().unscheduleCallbackForTarget(this, this.update);
    },

    update: function (dt) {
        dt *= 0.5;
        var isFinish = false;
        var volume = cc.audioEngine.getMusicVolume();
        if (this.playType == PLAY_TYPE.PLAY_TYPE_FADE_OUT_FADE_IN) {
            if (volume > 0.001) {
                if (this.actionType == ACTION_TYPE.ACTION_PAUSE) {
                    volume -= dt;
                    if (volume < 0.001) {
                        volume = 0.01;
                        this.playMusicByKey(this.musicName, this.loop);
                        this.actionType = ACTION_TYPE.ACTION_RESUME;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                } else if (this.actionType == ACTION_TYPE.ACTION_RESUME) {
                    volume += dt;
                    if (volume > 0.99) {
                        volume = 0.99;
                        isFinish = true;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                }
            } else {
                this.playMusicByKey(this.musicName, this.loop);
            }
            if (isFinish) {
                this.actionType = ACTION_TYPE.ACTION_NULL;
                this.playType = PLAY_TYPE.PLAY_TYPE_NORMAL;
                this.stopSchedule();
            }
        } else {
            if (volume > 0.001) {
                if (this.actionType == ACTION_TYPE.ACTION_PAUSE) {
                    volume -= dt;
                    if (volume < 0.001) {
                        volume = 0.01;
                        isFinish = true;
                        this.pauseMusic();
                    }
                    cc.audioEngine.setMusicVolume(volume);
                } else if (this.actionType == ACTION_TYPE.ACTION_RESUME) {
                    volume += dt;
                    if (volume > 0.99) {
                        volume = 0.99;
                        isFinish = true;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                }
            } else {
                isFinish = true;
            }
            if (isFinish) {
                this.actionType = ACTION_TYPE.ACTION_NULL;
                this.stopSchedule();
            }
        }
    },

    playEffectByKey: function (effectName, loop) {
        if (!this.isEffectOn()) {
            return;
        }
        var fileName = game.utils.sprintf(this.suffix, effectName);
        var key = "";
        if (cc.sys.isNative) {
            if (jsb.fileUtils.isFileExist(fileName)) {
                key = cc.audioEngine.playEffect(fileName, loop);
            } else {
                cc.log(game.utils.sprintf("effect file %s not found", fileName));
            }
        } else {
            if (cc.loader.getRes(fileName)) {
                key = cc.audioEngine.playEffect(fileName, loop);
            }
        }
        if (key) {
            this.effectMap[fileName] = key;
        }
    },

    playMusicByKey: function (musicName, loop) {
        this.actionType = ACTION_TYPE.ACTION_NULL;
        this.playType = PLAY_TYPE.PLAY_TYPE_NORMAL;
        if (this.isMusicOn()) {
            if (this.lastMusicVolume != 0) {
                cc.audioEngine.setMusicVolume(this.lastMusicVolume);
            } else {
                cc.audioEngine.setMusicVolume(1);
            }
        }
        var fileName = game.utils.sprintf(this.suffix, musicName);
        if (cc.sys.isNative) {
            if (jsb.fileUtils.isFileExist(fileName)) {
                cc.audioEngine.playMusic(fileName, loop);
            } else {
                cc.log(game.utils.sprintf("music file %s not found", fileName));
            }
        } else {
            if (cc.loader.getRes(fileName)) {
                cc.audioEngine.playMusic(fileName, loop);
            }
        }
    },

    isPlayingMusic: function () {
        return cc.audioEngine.isMusicPlaying();
    },

    resumeMusic: function () {
        cc.audioEngine.resumeMusic();
    },

    resumeMusicSlowly: function () {
        var volume = cc.audioEngine.getMusicVolume();
        if (volume < 0.0001 || volume >= 0.99) {
            return;
        }
        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        cc.audioEngine.setMusicVolume(0.01);
        this.resumeMusic();
        this.actionType = ACTION_TYPE.ACTION_RESUME;
    },

    stopMusic: function () {
        cc.audioEngine.stopMusic();
    },

    stopEffect: function (effectName) {
        var fileName = game.utils.sprintf(this.suffix, effectName);
        var effectKey = this.effectMap[fileName];
        if (effectKey) {
            cc.audioEngine.stopEffect(effectKey);
            delete this.effectMap[fileName];
        }
    },

    stopAllEffects: function () {
        cc.audioEngine.stopAllEffects();
    },

    isEffectOn: function () {
        var isOn = game.storageController.getItem("effect_on", "true");
        if (isOn == "true") {
            return true;
        }
        return false;
    },

    isMusicOn: function () {
        var isOn = game.storageController.getItem("music_on", "true");
        if (isOn == "true") {
            return true;
        }
        return false;
    },

    pauseMusic: function () {
        cc.audioEngine.pauseMusic();
    },

    pauseMusicSlowly: function () {
        if (!this.isPlayingMusic()) {
            return;
        }
        if (cc.audioEngine.getMusicVolume() < 0.0001) {
            return;
        }
        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        //cc.audioEngine.setMusicVolume(0.99);
        this.actionType = ACTION_TYPE.ACTION_PAUSE;
    },

    playMusicSlowlyByKey: function (musicName, loop) {
        if (!this.isPlayingMusic()) {
            this.playMusicByKey(musicName, loop);
            return;
        }

        this.playType = PLAY_TYPE.PLAY_TYPE_FADE_OUT_FADE_IN;
        this.musicName = musicName;
        this.loop = loop;

        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        this.actionType = ACTION_TYPE.ACTION_PAUSE;
    },
    
    setEffectOn: function (isOn) {
        game.storageController.setItem("effect_on", "" + isOn);
    },

    setMusicOn: function (isOn) {
        if (isOn) {
            if (this.lastMusicVolume != 0) {
                cc.audioEngine.setMusicVolume(this.lastMusicVolume);
            } else {
                cc.audioEngine.setMusicVolume(1);
            }
        } else {
            this.lastMusicVolume = cc.audioEngine.getMusicVolume();
            cc.audioEngine.setMusicVolume(0);
        }
        game.storageController.setItem("music_on", "" + isOn);
    },

    setMusicVolume: function (volume) {
        if (this.isMusicOn()) {
            cc.audioEngine.setMusicVolume(volume);
        }
    }
});

AudioPlayer._instance = null;
AudioPlayer._firstUseInstance = true;

/**
 *
 * @returns {AudioPlayer}
 */
AudioPlayer.getInstance = function () {
    if (AudioPlayer._firstUseInstance) {
        AudioPlayer._firstUseInstance = false;
        AudioPlayer._instance = new AudioPlayer();
    }
    return AudioPlayer._instance;
};

module.exports = AudioPlayer;
},{}],3:[function(require,module,exports){
var GameBridge = {
    getMenuScene: function () {
        var MenuScene = require("../../many_bricks/scene/MenuScene");
        return new MenuScene();
    },

    getConfig: function () {
        return require("../../many_bricks/config/Config");
    },

    getPopupMan: function () {
        return require("../../many_bricks/model/PopupMan");
    },

    getLoadingScene: function () {
        var LoadingScene = require("../../many_bricks/scene/LoadingScene");
        return new LoadingScene();
    },

    getGameMan: function () {
        var GameMan = require("../../many_bricks/model/GameMan");
        return GameMan.getInstance();
    }
};

module.exports = GameBridge;
},{"../../many_bricks/config/Config":35,"../../many_bricks/model/GameMan":99,"../../many_bricks/model/PopupMan":101,"../../many_bricks/scene/LoadingScene":106,"../../many_bricks/scene/MenuScene":107}],4:[function(require,module,exports){
/**
 * Created by qinning on 15/4/23.
 */
var Utils = require("../util/Utils");

var BaseCCBController = function() {
};

BaseCCBController.prototype.onDidLoadFromCCB = function() {
    var self = this;
    var oldOnEnter = this.rootNode["onEnter"];
    this.rootNode["onEnter"] = function() {
        if(cc.isFunction(oldOnEnter)){
            oldOnEnter.apply(self.rootNode, arguments);
        }
        self.onEnter();
    };
    var oldOnExit = this.rootNode["onExit"];
    this.rootNode["onExit"] = function() {
        if (cc.isFunction(oldOnExit)) {
            oldOnExit.apply(self.rootNode, arguments);
        }
        self.onExit();
    };
    this._visitNodes();
};

BaseCCBController.prototype.onEnter = function() {
};

BaseCCBController.prototype.onExit = function() {
};

function setScaleWithParentSize(label) {
    cc.log("setScaleWithParentSize");
    var parent = label.getParent();
    var parentSize = parent.getContentSize();
    var fontSize = label.getContentSize();

    if (!label.__origin_scale) {
        label.__origin_scale = {
            x: label.getScaleX(),
            y: label.getScaleY()
        };
    }

    var size = {
        width : fontSize.width * label.__origin_scale.x,
        height : fontSize.height * label.__origin_scale.y
    };

    // a clean hacking, save us to calc the label height manually. :]
    // parentSize.height *= label.__origin_scale.y;

    if (size.width > parentSize.width || size.height > parentSize.height) {
        var x = Math.min(parentSize.width / size.width, 1) * label.__origin_scale.x;
        var y = Math.min(parentSize.height / size.height, 1) * label.__origin_scale.y;

        var scale = Math.min(x, y);
        label.setScale(scale);
    } else {
        //maybe reused, reset origin size
        label.setScale(label.__origin_scale.x);
    }
}

BaseCCBController.prototype._visitNodes = function () {
    var TouchedNode = require("../ext/TouchedNode");
    Utils.walkNode(this.rootNode, function(nd) {
        if (nd.___visited) {
            return true;
        }
        nd.___visited = true;
        if (!game.config.menuNoScale) {
            var isMenuItem = Utils.isNodeMenuItem(nd);
            if (isMenuItem || (Utils.isNodeButton(nd) && nd.zoomOnTouchDown)) {
                if (nd.zoomOnTouchDown) {
                    nd.zoomOnTouchDown = false;
                }
                var node = new TouchedNode(isMenuItem);
                nd.addChild(node);
            }
        }

        if (nd.getString != null && nd.setString != null) {
            var parent = nd.getParent();
            //cc.log("_visitNodes tag:" + parent.getTag());
            if (parent && parent.getTag() === 79) {
                var isBMFont = false;
                if(Utils.isLabelBMFont(nd)) {
                    isBMFont = true;
                }
                //cc.log("_visitNodes nd._className:" + nd._className);
                //cc.log("_visitNodes isBMFont:" + isBMFont);
                if(isBMFont) {
                    if (cc.sys.isNative) {
                        //cc.log("_visitNodes 2");
                        // maybe repeat call in onEnter
                        if (!nd.__origin_setstring) {
                            nd.__origin_setstring = nd.setString;
                            nd.setString = function(newString) {
                                this.__origin_setstring(newString);
                                // here we start to hack
                                setScaleWithParentSize(this);
                            }.bind(nd);
                        }
                    } else {
                        nd.setString = function(newString, needUpdateLabel) {
                            // origin code copied from CCLabelBMFont.js setString

                            newString = String(newString);
                            if (needUpdateLabel == null)
                                needUpdateLabel = true;
                            if (newString == null || !cc.isString(newString))
                                newString = newString + "";

                            //this._initialString = newString;
                            this._setString(newString, needUpdateLabel);

                            // here we start to hack
                            // set the dimension according to it's parent who has a tag 79
                            // needUpdateLabel == true, it prevents the loop been called recursively.
                            if (needUpdateLabel == true) {
                                setScaleWithParentSize(this);
                            }

                        }.bind(nd);
                    }
                }
            }

            var str = nd.getString();
            var searchStr = "&key.";
            if (str.substr(0, searchStr.length) == searchStr) {
                var key = str.substr(searchStr.length);
                var value = _(key);
                nd.setString(value);
            }
        }

        return true;
    });
};

module.exports = BaseCCBController;
},{"../ext/TouchedNode":13,"../util/Utils":31}],5:[function(require,module,exports){
/**
 * Created by qinning on 2017/8/29.
 */


var CrossPromController = function () {
    BaseCCBController.call(this);
    this._crossPromPic = null;

    this._corssPromConfig = null;
};

game.utils.inherits(CrossPromController, BaseCCBController);

CrossPromController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    if (this._infoLabel) {
        if (game.local.isChinese()) {
            this._infoLabel.setString("马上玩");
        } else {
            this._infoLabel.setString("Play");
        }
    }
};

CrossPromController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

CrossPromController.prototype.downloadClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(this._corssPromConfig.downloadUrl);
    this.close();
};

CrossPromController.prototype.initWith = function (config, texture) {
    this._corssPromConfig = config;
    this._crossPromPic.setTexture(texture);
};

CrossPromController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

CrossPromController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

CrossPromController.createFromCCB = function(ccbName) {
    var node = game.utils.loadNodeFromCCB(ccbName, null, "CrossPromController", new CrossPromController());
    return node;
};

module.exports = CrossPromController;
},{}],6:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentInfo = function() {
    this.purchaseId = null;
    this.productId = null;
    this.receipt = null;
    this.signature = null;

    this.info = "";
};

PaymentInfo.prototype.unmarshal = function(jsonObj) {
    this.purchaseId = jsonObj["purchaseId"] || "";
    this.productId = jsonObj["productId"] || "";
    this.receipt = jsonObj["receipt"] || "";
    this.signature = jsonObj["signature"] || "";
    this.info = jsonObj["info"] || "";
};

module.exports = PaymentInfo;
},{}],7:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var PlayerInfo = function(){
    this.playerId = "";
    this.bestScore = 0;
    this.removedAds = false;
    this.level = 0;
    this.progress = 0;
    this.levelMap = null;
    this.rated = false;
};

PlayerInfo.prototype.unmarshall = function (json) {
    this.playerId = json["playerId"];
    this.bestScore = json["bestScore"] || 0;
    this.removedAds = json["removedAds"] || false;
    this.level = json["level"] || 1;
    this.progress = json["progress"] || 0;
    this.levelMap = json["levelMap"] || {};
    this.rated = json["rated"] || false;
};

PlayerInfo.createDefault = function () {
    var playerInfo = new PlayerInfo();
    playerInfo.hintsCount = 5;
    playerInfo.bestScore = 0;
    playerInfo.removedAds = false;
    playerInfo.level = 1;
    playerInfo.progress = 0;
    playerInfo.levelMap = {};
    playerInfo.rated = false;
    return playerInfo;
};

module.exports = PlayerInfo;

},{}],8:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var ProductInfo = function () {
    this.productId = 0;
    this.price = 0;
    this.description = null;
    this.title = null;
};

ProductInfo.prototype.unmarshal = function (jsonObj) {
    this.productId = jsonObj["productId"];
    this.price = jsonObj["price"];
    this.description = jsonObj["description"];
    this.title = jsonObj["title"];
};

module.exports = ProductInfo;
},{}],9:[function(require,module,exports){
var AdsPlace = {
    Pass: 1,
    Home: 2,
    BackGround: 3,
    Refresh: 4,
    Num: 4
};

module.exports = AdsPlace;
},{}],10:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentCode = {
    PAYMENT_CODE_SUCCESS: 0,
    PAYMENT_CODE_FAIL: 1
};

module.exports = PaymentCode;
},{}],11:[function(require,module,exports){
/**
 * Created by alanmars on 15/4/17.
 */
var EventPackage = cc.Class.extend({
    callback: null,
    target: null,
    listener: null,

    ctor: function (callback, target, listener) {
        this.callback = callback;
        this.target = target;
        this.listener = listener;
    }
});

var EventDispatcher = (function () {
    var instance;

    function createInstance() {
        var listenersMap = {};

        return {
            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             * @return {cc.EventListener} Return the listener. Needed in order to remove the event from the dispatcher.
             */
            addEventListener: function (eventName, callback, target) {
                var eventListener = cc.eventManager.addCustomListener(eventName, function (event) {
                    callback.call(target, event);
                });

                var shouldAdd = true;
                var eventPackages = listenersMap[eventName];
                if (cc.isUndefined(eventPackages)) {
                    eventPackages = [];
                    listenersMap[eventName] = eventPackages;
                }
                else {
                    for (var i = 0; i < eventPackages.length; ++i) {
                        var eventPackage = eventPackages[i];
                        if (eventPackage.callback === callback && eventPackage.target === target) {
                            shouldAdd = false;
                            break;
                        }
                    }
                }

                if (shouldAdd) {
                    eventPackages.push(new EventPackage(callback, target, eventListener));
                }
            },

            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             */
            removeEventListener: function (eventName, callback, target) {
                if (listenersMap[eventName]) {
                    /**
                     * @type {Array.<EventPackage>}
                     */
                    var eventPackages = listenersMap[eventName];
                    if (!cc.isUndefined(eventPackages) && eventPackages.length > 0) {
                        var newPackages = [];
                        for (var i = 0; i < eventPackages.length; ++i) {
                            /**
                             * @type {EventPackage}
                             */
                            var eventPackage = eventPackages[i];
                            if (eventPackage.callback === callback && eventPackage.target === target) {
                                cc.eventManager.removeListener(eventPackage.listener);
                            }
                            else {
                                newPackages.push(eventPackage);
                            }
                        }
                        listenersMap[eventName] = newPackages;
                    }
                }
            },

            /**
             * @param {string} eventName
             * @param {object} userData
             */
            dispatchEvent: function (eventName, userData) {
                cc.eventManager.dispatchCustomEvent(eventName, userData);
            }
        };
    }

    return {
        getInstance: function () {
            if (!instance) {
                instance = createInstance();
            }
            return instance;
        }
    };
})();

module.exports = EventDispatcher;
},{}],12:[function(require,module,exports){
/**
 * Created by qinning on 15/7/2.
 */
cc.TABLEVIEW_FILL_LEFT_RIGHT = 0;
cc.TABLEVIEW_FILL_RIGHT_LEFT = 0;

/**
 * Sole purpose of this delegate is to single touch event in this version.
 */
cc.MultiColTableViewDelegate = cc.Class.extend(/** @lends cc.MultiColTableViewDelegate# */{
    gridTouched:function(table,grid){
    }
});

/**
 * Data source that governs table backend data.
 */
cc.MultiColTableViewDataSource = cc.Class.extend(/** @lends cc.TableViewDataSource# */{
    gridAtIndex:function(table,idx){
       return null;
    },
    numberOfCellsInTableView:function(table){
        return 0;
    },
    numberOfGridsInCell:function(table, idx){
        return 0;
    },
    gridSizeForTable:function(table, idx){
        return cc.size(0,0);
    }
});

cc.MultiColTableView = cc.LayerColor.extend({
    _multiTableViewDataSource: null,
    _multiTableViewDelegate: null,
    _horizontalOrder: cc.TABLEVIEW_FILL_LEFT_RIGHT,
    _gridsFreed: null,
    _curTouchLocation: null,

    _tableView: null,
    _touchNode: null,
    _gridCells: null,

    /**
     * @param dataSource
     * @param {cc.Size} size
     * @param container
     */
    ctor: function (dataSource, size, container) {
        this._super(cc.color(0, 0, 255, 0), size.width, size.height);
        this._gridsFreed = [];
        this._gridCells = {};
        this.setMultiTableViewDataSource(dataSource);
        this._tableView = new cc.TableView(this, size, container);
        this._tableView.setDelegate(this);
        this.addChild(this._tableView);
        this._touchNode = new cc.Node();
        this._tableView.addChild(this._touchNode,1);
    },

    onEnter: function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: false,
            onTouchBegan: this.onTouchBegan.bind(this)
        }, this._touchNode);
    },

    dequeueGrid: function () {
        if (this._gridsFreed.length == 0) {
            return null;
        } else {
            var grid = this._gridsFreed.shift();
            this._autoRelease(grid);
            return grid;
        }
    },

    _releaseCB: function () {
        this.release();
    },

    _autoRelease: function (obj) {
        var running = obj._running === undefined ? false : !obj._running;
        cc.director.getScheduler().schedule(this._releaseCB, obj, 0, 0, 0, running, obj.__instanceId);
    },

    tableCellSizeForIndex: function (table, idx) {
        var size = this.getMultiTableViewDataSource().gridSizeForTable(this, idx);
        if (table.getDirection() === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {
            size.height *= this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        } else {
            size.width *= this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        }
        return size;
    },

    tableCellAtIndex: function (table, idx) {
        var grid;
        var numberOfGridsInCell = this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        var cell = table.dequeueCell();
        if (!cell) {
            cell = new cc.TableViewCell();
        } else {
            var children = cell.getChildren();
            for (var i = children.length - 1; i >= 0; --i) {
                grid = children[i];
                this._gridsFreed.push(grid);
                grid.setIdx(cc.INVALID_INDEX);
                grid.retain();
                grid.removeFromParent(false);
            }
        }
        var startIndex = 0;
        for (var localIdx = 0; localIdx < idx; ++localIdx) {
            startIndex += this.getMultiTableViewDataSource().numberOfGridsInCell(this, localIdx);
        }
        var gridSize = this.getMultiTableViewDataSource().gridSizeForTable(this, idx);
        for (var gridIdx = startIndex, colIdx = 0; gridIdx < (numberOfGridsInCell + startIndex); gridIdx++, colIdx++) {
            grid = this.getMultiTableViewDataSource().gridAtIndex(this, gridIdx);
            if (grid) {
                grid.setIdx(gridIdx);
                this._gridCells[gridIdx] = grid;
                grid.setAnchorPoint(cc.p(0, 0));
                if (table.getDirection() === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {
                    if (table.getVerticalFillOrder() === cc.TABLEVIEW_FILL_TOPDOWN) {
                        grid.setPosition(cc.p(0, gridSize.height * (numberOfGridsInCell - colIdx - 1)));
                    } else {
                        grid.setPosition(cc.p(0, gridSize.height * colIdx));
                    }
                } else {
                    grid.setPosition(cc.p(gridSize.width * colIdx, 0));
                }
                cell.addChild(grid);
            }
        }
        return cell;
    },

    numberOfCellsInTableView: function (table) {
        var numberOfCells = this.getMultiTableViewDataSource().numberOfCellsInTableView(this);
        return numberOfCells;
    },

    tableCellTouched: function (table, cell) {
        if (!this.getMultiTableViewDelegate()) {
            return;
        }
        for (var i = 0; i < cell.getChildren().length; i++) {
            var grid = cell.getChildren()[i];
            grid.setContentSize(this.getMultiTableViewDataSource().gridSizeForTable(this, cell.getIdx()));
            if (grid != null && this.isTouchInside(grid, this._curTouchLocation)) {
                this.getMultiTableViewDelegate().gridTouched(this, grid);
                break;
            }
        }
    },

    scrollViewDidScroll: function (view) {
        if (this._multiTableViewDelegate && this._multiTableViewDelegate.scrollViewDidScroll) {
            this._multiTableViewDelegate.scrollViewDidScroll(this);
        }
    },

    tableCellWillRecycle: function (table, cell) {
    },

    tableCellHighlight:function(table, cell){
    },

    tableCellUnhighlight:function(table, cell){
    },

    onTouchBegan: function (touch, event) {
        this._curTouchLocation = touch.getLocation();
        return false;
    },

    getMultiTableViewDataSource: function () {
        return this._multiTableViewDataSource;
    },
    setMultiTableViewDataSource: function (dataSource) {
        this._multiTableViewDataSource = dataSource;
    },

    getMultiTableViewDelegate: function () {
        return this._multiTableViewDelegate;
    },

    setMultiTableViewDelegate: function (delegate) {
        this._multiTableViewDelegate = delegate;
    },

    setHorizontalOrder: function (order) {
        this._horizontalOrder = order;
    },
    getHorizontalOrder: function () {
        return this._horizontalOrder;
    },

    isTouchInside: function (owner, touchLocation) {
        if (!owner || !owner.getParent()) {
            return false;
        }
        touchLocation = owner.getParent().convertToNodeSpace(touchLocation);
        return cc.rectContainsPoint(owner.getBoundingBox(), touchLocation);
    },

    reloadData: function () {
        this._tableView.reloadData();
    },

    setContentOffset: function (offset, animated) {
        return this._tableView.setContentOffset(offset, animated);
    },

    getContentOffset:function () {
        return this._tableView.getContentOffset();
    },

    minContainerOffset:function () {
        return this._tableView.minContainerOffset();
    },

    maxContainerOffset:function () {
        return this._tableView.maxContainerOffset();
    },

    setDirection:function (direction) {
        this._tableView.setDirection(direction);
    },

    /**
     * determines how cell is ordered and filled in the view.
     */
    setVerticalFillOrder: function (fillOrder) {
        this._tableView.setVerticalFillOrder(fillOrder);
    },

    setContentOffsetInDuration: function (offset, dt) {
        this._tableView.setContentOffsetInDuration(offset, dt);
    },

    getViewSize: function () {
        return this._tableView.getViewSize();
    },

    getContentSize: function () {
        return this._tableView.getContentSize();
    },

    getGridAtIndex:function (idx) {
        return this._gridCells[idx];
    },

    setViewSize: function (viewSize) {
        this.setContentSize(viewSize);
        this._tableView.setViewSize(viewSize);
    },

    setBounceable: function (bounceable) {
        this._tableView.setBounceable(bounceable);
    },

    setTouchEnabled: function (touchable) {
        this._tableView.setTouchEnabled(touchable);
    },

    isDragging: function () {
        return this._tableView.isDragging();
    },

    getContainer: function () {
        return this._tableView.getContainer();
    }
});

module.exports = cc.MultiColTableView;
},{}],13:[function(require,module,exports){
/**
 * Created by zhangmingxu on 29/11/2016.
 */

var TouchedNode = cc.Node.extend({
    offsetX: 10,
    offsetY: 5,

    ctor: function (isMenuItem) {
        this._isMenuItem = isMenuItem;
        this._isTouched = false;
        this._isHover = false;
        this._isHoverPlaying = false;

        this._buttonToucher = null;
        this._buttonMouser = null;
        this._super();
        this._name = "TouchedNode";
    },

    onEnter: function () {
        this._super();

        ///Touch Events
        this._buttonToucher = cc.EventListener.create({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: false,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this)
        }, this);
        cc.eventManager.addListener(this._buttonToucher, this);

        ///Mouse Events
        if(! cc.sys.isNative) {
            this._buttonMouser = cc.EventListener.create({
                event: cc.EventListener.MOUSE,
                swallowTouches: true,
                onMouseMove: this.onMouseMove.bind(this)
            });
            cc.eventManager.addListener(this._buttonMouser, this);
        }
    },

    onExit: function() {
        if(this._buttonToucher) {
            cc.eventManager.removeListener(this._buttonToucher);
            this._buttonToucher = null;
        }
        if(! cc.sys.isNative) {
            if(this._buttonMouser) {
                cc.eventManager.removeListener(this._buttonMouser);
                this._buttonMouser = null;
            }
        }

        this._super();
    },

    onTouchBegan:function (touch, event) {
        var pos = touch.getLocation();
        var target = this.parent;
        if (target && cc.rectContainsPoint(target.getBoundingBoxToWorld(), pos)) {
            if(target.enabled && target.visible) {
                this._isTouched = true;
                this._isHover = false;
                this._playBegin(target);
                return true;
            }
        }
        return false;
    },

    onTouchMoved:function (touch, event) {

    },

    onTouchEnded:function (touch, event) {
        if(this._isTouched) {
            this._isTouched = false;
            var target = this.parent;
            if (target) {
                this._playEnd(target);
            }
        }
    },

    onMouseMove: function(event) {
        var pos = event.getLocation();
        ///NOTE: target's parent is Button
        var target = this.parent;
        if (target) {
            if(cc.rectContainsPoint(target.getBoundingBoxToWorld(), pos)) {
                if(!this._isHover && !this._isTouched) {
                    if(target.enabled && target.visible) {
                        this._isHover = true;
                        this._playHover(target, true);
                    }
                }
            } else {
                if(this._isHover) {
                    this._isHover = false;
                    this._playHover(target, false);
                }
            }
        }
    },

    _onHoverEnded: function() {
        this._isHoverPlaying = false;
    },

    _playBeginEx: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.delayTime(0.01),
                cc.scaleTo(0.1, 1.1, 0.9),
                cc.delayTime(0.01)
            )
        );
    },

    _playEndEx: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.delayTime(0.01),
                cc.scaleTo(0.1, 1, 1),
                cc.delayTime(0.01)
            )
        );
    },

    _playBegin: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.scaleTo(0.20, 0.85, 0.85)
        );
    },

    _playEnd: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.scaleTo(0.20 ,1, 1)
        );
    },

    _playHoverEx: function(target) {
        var bounding = target.getBoundingBox();
        if(bounding.width < this.offsetX) {
            bounding.width = this.offsetX;
        }
        if(bounding.height < this.offsetY) {
            bounding.height = this.offsetY;
        }

        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.scaleTo(0.08, (bounding.width-this.offsetX)/bounding.width, (bounding.height+this.offsetY)/bounding.height),
                cc.scaleTo(0.1, (bounding.width+this.offsetX)/bounding.width, (bounding.height-this.offsetY)/bounding.height),
                cc.delayTime(0.04),
                cc.scaleTo(0.1, 1, 1),
                cc.callFunc(this._onHoverEnded, this)
            )
        );
    },

    _playHover: function(target, isHover) {
        //cc.error("hover: target = ", target, Date.now());
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();

        if(isHover) {
            target.runAction(
                cc.sequence(
                    cc.scaleTo(0.16, 1.08, 1.08),
                    cc.scaleTo(0.1, 1.06, 1.06)
                )
            );
        } else {
            target.setScale(1, 1);
        }

    }

});

module.exports = TouchedNode;
},{}],14:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var HttpClient = require("../../common/net/HttpClient");
var AdsPlace = require("../enum/AdsPlace");

var AD_CONFIG_URL = "https://qinning199.github.io/game.html";

//var ONE_MINUTE = 60 * 1000;
var AdListener = cc.Class.extend({
    onRewardedVideoFinished: function (isRewarded) {
    },

    onInterstitialAdEnd: function (channelName) {
    },

    onShowVideoAdBegin: function () {
    },

    onShowVideoAdEnd: function () {
    }
});

var AdPlaceInfo = function (interval) {
    this.interval = interval;
    this.lastShowTime = Date.now();
};


var AdsManager = cc.Class.extend({
    DEFAULT_AD_INTERVAL: 60 * 1000,

    intervalMap: {
        "0": 150,
        "1": 150,
        "2": 80,
        "3": 60
    },

    ONE_MINUTE_SECOND: 60 * 1000,

    adConfigUrl: "",

    rateTime: 0,
    ratedTime: 0,
    rateRemoveAds: false,

    isNewPlayer: true,

    adPlaceMap: {},

    /**
     * @type {AdListener}
     */
    adListener: null,

    showTopBanner: true,
    topBannerDay: 0,

    lastInterstitialTime: 0,
    enabledInterstitialAd: true,

    ctor: function () {
        if(cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onInterstitialAdFinished = this.onAdFinishedJsb.bind(this);
            jsb_dp.oneSdkBridge.onVideoAdFinished = this.onVideoAdFinishedJsb.bind(this);
            jsb_dp.oneSdkBridge.onShowVideoAdBegin = this.onShowVideoAdBeginJsb.bind(this);
            jsb_dp.oneSdkBridge.onShowVideoAdEnd = this.onShowVideoAdEndJsb.bind(this);
        }
        for (var i = 1; i <= AdsPlace.Num; ++i) {
            this.adPlaceMap[i] = new AdPlaceInfo(this.DEFAULT_AD_INTERVAL);
        }
    },

    init: function () {
        this.initInterval();
        this.logInterval("local");
    },

    initInterval: function () {
        cc.log("AdsManager initInterval");
        var day = game.playerMan.getRegisterDay();
        var interval = this.intervalMap[day];
        if (!interval) {
            var keys = Object.keys(this.intervalMap);
            var key = keys[keys.length - 1];
            cc.log("AdsManager init interval key:" + key);
            interval = this.intervalMap[key];
        }
        if (interval) {
            this.adPlaceMap[AdsPlace.Pass].interval = interval * 1000;
        }
    },

    loadRemoteData: function () {
        var adConfigUrl = game.config.getAdUrl() || AD_CONFIG_URL;
        cc.log("AdsManager loadRemoteData:" + adConfigUrl);
        var self = this;
        HttpClient.doGet(adConfigUrl, function (error, text) {
            cc.log("AdsManager remote response:" + error + ",text:" + text);
            if (!error) {
                try {
                    var adConfig = JSON.parse(text);

                    if (cc.sys.os === cc.sys.OS_ANDROID) {
                        if (adConfig && adConfig.androidConfig) {
                            adConfig = adConfig.androidConfig;
                        }
                    }

                    var intervalMap = adConfig.newIntervalMap;
                    cc.log("AdsManager intervalMap:" + JSON.stringify(intervalMap));
                    if (!cc.isUndefined(intervalMap)) {
                        self.intervalMap = intervalMap;
                        self.initInterval();
                    }

                    var showTopBanner = adConfig.showTopBanner;
                    if (!cc.isUndefined(showTopBanner)) {
                        self.showTopBanner = showTopBanner;
                    }

                    var topBannerDay = adConfig.topBannerDay;
                    if (!cc.isUndefined(topBannerDay)) {
                        self.topBannerDay = topBannerDay;
                    }

                    var backToGroundInterval = adConfig.backToGroundInterval;
                    if (!cc.isUndefined(backToGroundInterval)) {
                        self.adPlaceMap[AdsPlace.BackGround].interval = backToGroundInterval * 1000;
                    }

                    var backToHomeInterval = adConfig.backToHomeInterval;
                    if (!cc.isUndefined(backToHomeInterval)) {
                        self.adPlaceMap[AdsPlace.Home].interval = backToHomeInterval * 1000;
                    }

                    var refreshInterval = adConfig.refreshInterval;
                    if (!cc.isUndefined(refreshInterval)) {
                        self.adPlaceMap[AdsPlace.Refresh].interval = refreshInterval * 1000;
                    }

                    if (game.utils.isSelfGame()) {
                        var adsConfig = adConfig.adsConfig;
                        if (adsConfig) {
                            if (jsb_dp.oneSdkBridge.setInterstitialAdWeightConfig) {
                                jsb_dp.oneSdkBridge.setInterstitialAdWeightConfig(JSON.stringify(adsConfig));
                            }
                        }

                        var rewardAdsConfig = adConfig.rewardAdsConfig;
                        if (rewardAdsConfig) {
                            if (jsb_dp.oneSdkBridge.setRewardAdWeightConfig) {
                                jsb_dp.oneSdkBridge.setRewardAdWeightConfig(JSON.stringify(rewardAdsConfig));
                            }
                        }

                        var bannerAdsConfig = adConfig.bannerAdsConfig;
                        if (bannerAdsConfig) {
                            if (jsb_dp.oneSdkBridge.setBannerAdWeightConfig) {
                                jsb_dp.oneSdkBridge.setBannerAdWeightConfig(JSON.stringify(bannerAdsConfig));
                            }
                        }
                    }

                    self.logInterval("server");
                } catch (e) {
                    cc.log("AdsManager error:" + e.message);
                }
            }
        });
    },

    getRegisterDay: function () {
        return game.playerMan.getRegisterDay();
    },

    logInterval: function (tag) {
        cc.log("AdsManager " + tag + " adPlaceMap:" + JSON.stringify(this.adPlaceMap) +
            ",day:" + this.getRegisterDay());
    },

    setIsNewPlayer: function (isNew) {
        this.isNewPlayer = isNew;
    },

    onGameOnShow: function () {
    },

    setAdListener: function (adListener) {
        this.adListener = adListener;
    },

    isRemovedAds: function () {
        return game.playerMan.player.removedAds;
    },

    showBannerAds: function (placement) {
        cc.log("AdsManager showBannerAds:" + placement);
        if (this.isRemovedAds()) return;
        if (cc.sys.isNative) {
            if (!this.isShowBannerAds(placement)) {
                jsb_dp.oneSdkBridge.showBannerAd(placement);
            }
        }
    },

    removeBannerAds: function (placement) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.removeBannerAd(placement);
        }
    },

    isShowBannerAds: function (placement) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isShowBannerAd(placement);
        }
        return false;
    },

    showInterstitial: function (place) {
        if (!this.enabledInterstitialAd) {
            return;
        }
        if (this.isRemovedAds()) return;
        cc.log("AdsManager showInterstitial place:" + place + ", interval:" + this.adPlaceMap[place].interval + ",current interval:" +
            (Date.now() - this.adPlaceMap[place].lastShowTime));
        if (Date.now() - this.adPlaceMap[place].lastShowTime < this.adPlaceMap[place].interval) {
            return;
        }
        this.adPlaceMap[place].lastShowTime = Date.now();

        if (Date.now() - this.lastInterstitialTime < 5 * 1000) {
            cc.log("AdsManager showInterstitial interval less than 5 seconds");
            return;
        }
        cc.log("AdsManager showInterstitial place:" + place + " showed");
        this.lastInterstitialTime = Date.now();

        var placement = "default";
        if (place === AdsPlace.Home) {
            placement = "home";
        } else if (place === AdsPlace.Refresh) {
            placement = "refresh";
        }
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showInterstitalAd(placement);
        }
    },

    showNativeAd: function (place, posX, posY) {
        if (this.isRemovedAds()) return;
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showNativeAd(place, posX, posY);
        }
    },

    removeNativeAd: function (place) {
        if (this.isRemovedAds()) return;
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.removeNativeAd(place);
        }
    },

    setInterstitialShowed: function (place) {
        this.adPlaceMap[place].lastShowTime = Date.now();
    },

    showCrossPromotion: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showCrossPromoteAd();
        }
    },

    isRewardVideoReady: function () {
        //if (game.playerMan.getRewardAdPlaceCountPerDay() > game.config.rewardAdMaxCountPerDay) {
        //    cc.log("AdsManager isRewardVideoReady has reached max count:" + game.playerMan.getRewardAdPlaceCountPerDay());
        //    return false;
        //}
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isRewardVideoReady();
        }
        return false;
    },

    showRewardVideoAd: function (name) {
        if (!this.isRewardVideoReady()) {
            return;
        }
        this.enabledInterstitial(false);
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showRewardVideoAd(name);
        }
    },

    enabledInterstitial: function (enabled) {
        this.enabledInterstitialAd = enabled;
    },

    onAdFinishedJsb: function (str) {
        cc.log("onAdFinishedJsb:" + str);
        var adsFinishedObj = JSON.parse(str);
        var channelName = adsFinishedObj["channelName"];
        cc.log("channel :" + channelName + " show interstitial ads finished");

        if (this.adListener && this.adListener.onInterstitialAdEnd) {
            this.adListener.onInterstitialAdEnd(channelName);
        }
        game.playerMan.addInterstitialAdCount();
    },

    onVideoAdFinishedJsb: function (str) {
        cc.log("onVideoAdFinishedJsb:" + str);
        var adsFinishedObj = JSON.parse(str);
        var isSkipped = adsFinishedObj.isSkipped;
        if (!isSkipped) {
            cc.log("reward video ads show success");
        } else {
            cc.log("reward video ads skipped");
        }

        if (this.adListener && this.adListener.onRewardedVideoFinished) {
            this.adListener.onRewardedVideoFinished(!isSkipped);
        }
        if (!isSkipped) {
            game.playerMan.addRewardedAdCount();
        }
    },

    onShowVideoAdBeginJsb: function () {
        if (this.adListener && this.adListener.onShowVideoAdBegin) {
            this.adListener.onShowVideoAdBegin();
        }
    },

    onShowVideoAdEndJsb: function () {
        if (this.adListener && this.adListener.onShowVideoAdEnd) {
            this.adListener.onShowVideoAdEnd();
        }
        this.enabledInterstitial(true);
    }
});

AdsManager.sharedDirector = null;
AdsManager.firstUseDirector = true;

AdsManager.getInstance = function () {
    if (AdsManager.firstUseDirector) {
        AdsManager.firstUseDirector = false;
        AdsManager.sharedDirector = new AdsManager();
    }
    return AdsManager.sharedDirector;
};

module.exports = AdsManager;
},{"../../common/net/HttpClient":26,"../enum/AdsPlace":9}],15:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */

var AnalyseManager = cc.Class.extend({
    g_pAnalytics: null,
    ctor: function () {
    },

    initAnalytics: function () {
    },

    trackLoginEvent: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackLogin();
        }
    },

    /**
     * @param {number} amountNum
     * @param {string} itemType
     * @param {string} itemId
     * @param {string} receipt
     */
    trackPurchaseEvent: function (amountNum, itemType, itemId, receipt) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackPurchase(amountNum, itemType, itemId, receipt);
        }
    },

    trackStartProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackStartProgression(name, value);
        }
    },

    trackCompletedProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackCompletedProgression(name, value);
        }
    },

    trackFailedProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackFailProgression(name, value);
        }
    },

    /**
     * track error event
     * @param {string} errorMsg
     */
    trackErrorEvent: function (errorMsg) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackError(errorMsg);
        }
    },

    trackEvent: function (name, obj) {
        if (cc.sys.isNative) {
            var info = "";
            if (obj) {
                info = JSON.stringify(obj);
            }
            jsb_dp.oneSdkBridge.trackEvent(name, info);
        }
    }
});

AnalyseManager.sharedDirector = null;
AnalyseManager.firstUseDirector = true;

AnalyseManager.getInstance = function () {
    if (AnalyseManager.firstUseDirector) {
        AnalyseManager.firstUseDirector = false;
        AnalyseManager.sharedDirector = new AnalyseManager();
    }
    return AnalyseManager.sharedDirector;
};

module.exports = AnalyseManager;
},{}],16:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var CaptureListener = cc.Class.extend({
    onCaptureAudio: function (audioDecible) {
    }
});


var CaptureManager = cc.Class.extend({

    ctor: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onCaptureAudio = this.onCaptureAudio.bind(this);
        }
    },

    setCaptureListener: function (listener) {
        this.listener = listener;
    },

    captureAudio: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.captureAudio();
        }
    },

    getAudioDecible: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.getAudioDecible();
        }
        return 0;
    },

    onCaptureAudio: function (audioDecibleString) {
        var audioObj = JSON.parse(audioDecibleString);
        var audioDecible = audioObj["audioDecible"];
        if (this.listener) {
            this.listener.onCaptureAudio(audioDecible);
        }
    }
});

CaptureManager.sharedDirector = null;
CaptureManager.firstUseDirector = true;

CaptureManager.getInstance = function () {
    if (CaptureManager.firstUseDirector) {
        CaptureManager.firstUseDirector = false;
        CaptureManager.sharedDirector = new CaptureManager();
    }
    return CaptureManager.sharedDirector;
};

module.exports = CaptureManager;
},{}],17:[function(require,module,exports){
/**
 * Created by qinning on 2017/8/29.
 */

var HttpClient = require("../../common/net/HttpClient");

var CrossPromData = function () {
    this.scoreLimit = 0;
    this.imageUrl = "";
    this.downloadUrl = "";
    this.weight = 0;
    this.appId = "";
};

var CrossPromManager = cc.Class.extend({
    cachedTexture: null,
    cachedConfig: null,
    crossProms: null,
    ctor: function () {
    },

    tryToLoadFromRemote: function () {
        var crossPromUrl = game.config.getCrossPromUrl();

        var self = this;
        HttpClient.doGet(crossPromUrl, function (error, text) {
            if (!error) {
                try {
                    cc.log("cross promotion tryToLoadFromRemote downloaded");
                    var data = JSON.parse(text);
                    var open = data.open || false;
                    if (!open) {
                        return;
                    }
                    var scoreLimit = data.scoreLimit || 0;
                    //if (!cc.isUndefined(game.playerMan.player.bestScore)) {
                    //    if (game.playerMan.player.bestScore < scoreLimit) {
                    //        cc.log("cross promotion tryToLoadFromRemote game.playerMan.player.bestScore:" + game.playerMan.player.bestScore);
                    //        return;
                    //    }
                    //}
                    if (!cc.isUndefined(game.playerMan.player.level)) {
                        if (game.playerMan.player.level < scoreLimit) {
                            return;
                        }
                    }
                    var maxPopCount = data.maxPopCount || 3;
                    self.downloadedShow = data.downloadedShow || false;
                    self.crossProms = data["crossProms"];
                    self.maxPopCount = maxPopCount;
                    self.tryToDownloadPromoImg();
                } catch (e) {
                }
            }
        });
    },

    tryToDownloadPromoImg: function () {
        if (this.maxPopCount <= 0) {
            return;
        }
        if (this.cachedConfig || this.cachedTexture) {
            return;
        }
        this.maxPopCount--;
        cc.log("cross promotion tryToDownloadPromoImg check");
        var self = this;
        if (!cc.isUndefined(this.crossProms) && cc.isArray(this.crossProms) && this.crossProms.length > 0) {
            var randomConfig = this.getRandomConfig(this.crossProms);
            this.removeCrossPromoCfg(randomConfig);
            //game.utils.download
            cc.log("cross promotion tryToDownloadPromoImg start download");
            game.utils.loadRemoteImg(randomConfig.imageUrl, function (error, tex, extra) {
                if (!error && tex) {
                    cc.log("cross promotion tryToDownloadPromoImg downloaded:" + self.downloadedShow);
                    self.cachedTexture = tex;
                    self.cachedTexture.retain();
                    self.cachedConfig = randomConfig;
                    if (self.downloadedShow) {
                        self.downloadedShow = false;
                        self.tryToPopupCrossPromDlg();
                    }
                }
            }, null);
        }
    },

    removeCrossPromoCfg: function (crossPromCfg) {
        for (var i = 0; i < this.crossProms.length; ++i) {
            if (this.crossProms[i] === crossPromCfg) {
                this.crossProms.splice(i, 1);
                break;
            }
        }
    },


    getRandomConfig: function (crossProms) {
        var totalWeight = 0;
        var i;
        for (i = 0; i < crossProms.length; ++i) {
            totalWeight += crossProms[i].weight;
        }

        var randomNum = game.utils.randomNextInt(totalWeight);

        var curWeight = 0;
        for (i = 0; i < crossProms.length; ++i) {
            curWeight += crossProms[i].weight;
            if (curWeight > randomNum) {
                return crossProms[i];
            }
        }

        return crossProms[0];
    },

    popupCrossPromDlg: function (crossPromsConfig, texture) {
        var CrossPromController = require("../controller/CrossPromController");
        var crossPromNode = CrossPromController.createFromCCB("res/cross/cross_prom_view.ccbi");
        crossPromNode.controller.initWith(crossPromsConfig, texture);
        crossPromNode.controller.popup();
    },

    tryToPopupCrossPromDlg: function () {
        cc.log("cross promotion tryToPopupCrossPromDlg start");
        if (this.cachedConfig && this.cachedTexture) {
            cc.log("cross promotion tryToPopupCrossPromDlg poped");
            this.popupCrossPromDlg(this.cachedConfig, this.cachedTexture);
            this.cachedTexture.release();
            this.cachedConfig = null;
            this.cachedTexture = null;
            this.tryToDownloadPromoImg();
        }
    }
});

CrossPromManager.sharedDirector = null;
CrossPromManager.firstUseDirector = true;

CrossPromManager.getInstance = function () {
    if (CrossPromManager.firstUseDirector) {
        CrossPromManager.firstUseDirector = false;
        CrossPromManager.sharedDirector = new CrossPromManager();
    }
    return CrossPromManager.sharedDirector;
};


module.exports = CrossPromManager;
},{"../../common/net/HttpClient":26,"../controller/CrossPromController":5}],18:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var GCManager = cc.Class.extend({

    ctor: function () {
    },

    isGameCenterAvailable: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isGameCenterAvailable();
        }
        return false;
    },

    reportScore: function (score, leaderBoardKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.reportScore(score, leaderBoardKey);
        }
    },

    showLeaderboard: function (leaderBoardKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showLeaderboard(leaderBoardKey);
        }
    },

    reportAchievement: function (percentCompleted, archievementKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.reportAchievement(percentCompleted, archievementKey);
        }
    },

    showAchievements: function (leaderBoardkey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showAchievements(leaderBoardkey);
        }
    },

    highScoreForLeaderboard: function (leaderBoardKey) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.highScoreForLeaderboard(leaderBoardKey);
        }
        return 0;
    },

    progressForAchievement: function (archievementKey) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.progressForAchievement(archievementKey);
        }
        return 0;
    }
});

GCManager.sharedDirector = null;
GCManager.firstUseDirector = true;

GCManager.getInstance = function () {
    if (GCManager.firstUseDirector) {
        GCManager.firstUseDirector = false;
        GCManager.sharedDirector = new GCManager();
    }
    return GCManager.sharedDirector;
};

module.exports = GCManager;
},{}],19:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/11.
 */

var LocalizationManager = cc.Class.extend({

    _isLoaded: false,
    curLanguage: null,
    ctor: function () {
    },

    reload: function () {
        if (this._isLoaded) {
            return;
        }
        if (game.utils.isSelfGame()) {
            this.curLanguage = game.utils.loadJson("res/config/strings-zh.json");
        } else {
            this.curLanguage = game.utils.loadJson("res/config/strings-en.json");
        }
        this._isLoaded = true;
    },

    getValue: function (key) {
        return this.curLanguage[key] || key;
    },

    isChinese: function () {
        if (game.utils.isSelfGame()) {
            return true;
        }
        return false;
    }
});

LocalizationManager.sharedDirector = null;
LocalizationManager.firstUseDirector = true;

LocalizationManager.getInstance = function () {
    if (LocalizationManager.firstUseDirector) {
        LocalizationManager.firstUseDirector = false;
        LocalizationManager.sharedDirector = new LocalizationManager();
    }
    return LocalizationManager.sharedDirector;
};


module.exports = LocalizationManager;
},{}],20:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var NotificationManager = cc.Class.extend({

    ctor: function () {
    },

    registerNotification: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.registerNotification();
        }
    },

    /**
     *
     * @param timeFromNow
     * @param alertText
     * @param alertAction
     * @param badgeNumber
     * @param sound
     */
    scheduleNotification: function (timeFromNow, alertText, alertAction, badgeNumber) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.scheduleNotification(timeFromNow, alertText, alertAction, badgeNumber);
        }
    },

    unscheduleNotification: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.unscheduleNotification();
        }
    }
});

NotificationManager.sharedDirector = null;
NotificationManager.firstUseDirector = true;

NotificationManager.getInstance = function () {
    if (NotificationManager.firstUseDirector) {
        NotificationManager.firstUseDirector = false;
        NotificationManager.sharedDirector = new NotificationManager();
    }
    return NotificationManager.sharedDirector;
};


module.exports = NotificationManager;
},{}],21:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var RateManager = cc.Class.extend({

    ctor: function () {
    },

    init: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.initRateParams(3, 1, 0.5, 0.5, true);
        }
    },

    rate: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.launchRate();
        }
    },

    likeInFacebook: function (url) {
        cc.sys.openURL(url);
    },

    launchAppReview: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.launchAppReview();
        }
        return false;
    }
});

RateManager.sharedDirector = null;
RateManager.firstUseDirector = true;

RateManager.getInstance = function () {
    if (RateManager.firstUseDirector) {
        RateManager.firstUseDirector = false;
        RateManager.sharedDirector = new RateManager();
    }
    return RateManager.sharedDirector;
};

module.exports = RateManager;
},{}],22:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */

var ShareManager = cc.Class.extend({
    ctor: function () {
    },

    shareWithSystem: function (tips) {
        if (cc.sys.isNative) {
            var fileName = "";
            if (cc.sys.os === cc.sys.OS_IOS) {
                fileName = game.utils.getScreenShot("capture_screen.jpg");
            }
            jsb_dp.oneSdkBridge.systemShare(fileName, tips);
        }
    },

    openAppWithIdentifier: function (appId) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.openAppWithIdentifier(appId);
        }
    },

    sendEmail: function (address, title, body) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.sendEmail(address, title, body);
        }
    }
});

ShareManager.sharedDirector = null;
ShareManager.firstUseDirector = true;

ShareManager.getInstance = function () {
    if (ShareManager.firstUseDirector) {
        ShareManager.firstUseDirector = false;
        ShareManager.sharedDirector = new ShareManager();
    }
    return ShareManager.sharedDirector;
};

module.exports = ShareManager;
},{}],23:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var PaymentInfo = require("../entity/PaymentInfo");
var PaymentCode = require("../enum/PaymentCode");
var ProductInfo = require("../entity/ProductInfo");

var PaymentDelegate = cc.Class.extend({
    /**
     * @param {PaymentCode} error
     * @param {PaymentInfo} paymentInfo
     */
    onPaymentCompleted: function (error, paymentInfo) {
    },

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    onGetUnverifiedReceiptList: function (paymentInfoList) {
    },

    /**
     * on get product list.
     * @param {Array.<ProductInfo>} productList
     */
    onGetProductList: function (productList) {
    }
});

var StoreManager = cc.Class.extend({
    /**
     * @type {PaymentDelegate}
     */
    paymentDelegate: null,

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    productList: null,

    ctor: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onGetProductList = this.onGetProductList.bind(this);
            jsb_dp.oneSdkBridge.onPurchase = this.onPurchase.bind(this);
            jsb_dp.oneSdkBridge.onConsume = this.onConsume.bind(this);
            jsb_dp.oneSdkBridge.onGetUnverifiedReceiptList = this.onGetUnverifiedReceiptList.bind(this);
        }
    },

    /**
     * set payment delegate.
     * @param {PaymentDelegate} paymentDelegate
     */
    setPaymentDelegate: function (paymentDelegate) {
        this.paymentDelegate = paymentDelegate;
    },

    onGetProductList: function (jsonResult) {
        cc.log("onGetProductList: " + jsonResult);
        if (jsonResult) {
            var products = JSON.parse(jsonResult);
            if (products && products.length > 0) {
                var productList = [];
                for (var i = 0; i < products.length; ++i) {
                    var productInfo = new ProductInfo();
                    productInfo.unmarshal(products[i]);
                    productList.push(productInfo);
                }
                this.paymentDelegate.onGetProductList(productList);
                this.productList = productList;
            }
        }
    },

    onPurchase: function (jsonResult) {
        cc.log("onPurchase: " + jsonResult);
        var purchaseResult = JSON.parse(jsonResult);
        var purchaseData;
        if (purchaseResult.errorCode === PaymentCode.PAYMENT_CODE_SUCCESS) {
            purchaseData = JSON.parse(jsonResult);
            this._paymentCompleted(PaymentCode.PAYMENT_CODE_SUCCESS, purchaseData);
        } else {
            purchaseData = JSON.parse(jsonResult);
            this._paymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, purchaseData);
        }
    },

    onConsume: function (jsonInfo) {
        cc.log("onConsume: " + jsonInfo);
    },

    onGetUnverifiedReceiptList: function (purchaseListString) {
        cc.log("onGetUnverifiedReceiptList: " + purchaseListString);
        if (purchaseListString && purchaseListString.length > 0) {
            var purchaseJsonList = JSON.parse(purchaseListString);
            if (purchaseJsonList && purchaseJsonList.length > 0) {
                var purchaseInfoList = [];
                for (var i = 0; i < purchaseJsonList.length; ++i) {
                    var paymentMsg = purchaseJsonList[i];
                    var paymentInfo = new PaymentInfo();
                    paymentInfo.unmarshal(paymentMsg);
                    purchaseInfoList.push(paymentInfo);
                }
                this.paymentDelegate.onGetUnverifiedReceiptList(purchaseInfoList);
            }
        }

    },

    _paymentCompleted: function (error, paymentMsg) {
        var paymentInfo = new PaymentInfo();
        paymentInfo.unmarshal(paymentMsg);
        if (error === PaymentCode.PAYMENT_CODE_SUCCESS) {
            if (paymentMsg) {
                this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_SUCCESS, paymentInfo);
                var product = this._getProductById(paymentInfo.productId);
                if (product) {
                    var price = this._getNumFromString(product.price) * 100;
                    game.analyseManager.trackPurchaseEvent(price, product.title, paymentInfo.productId,
                        paymentInfo.receipt);
                }
            } else {
                this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, paymentInfo);
            }
        } else {
            this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, paymentInfo);
        }
        //if (cc.sys.os !== cc.sys.OS_ANDROID) {
        //    this.consume(paymentInfo.purchaseId);
        //}
    },

    _getNumFromString: function (text) {
        return text.replace(/[^0-9.]/ig, "");
    },

    requestProduct: function (productIds) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.getProductsInfo(productIds);
        }
    },

    payForProduct: function (productId) {
        cc.log("payForProduct:" + productId);
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.purchase(productId);
        }
    },

    consume: function (transactionId) {
        cc.log("consume:" + transactionId);
        if (cc.sys.isNative) {
            if (transactionId && transactionId.length > 0) {
                jsb_dp.oneSdkBridge.consume(transactionId);
            }
        }
    },

    restoreCompletedTransactions: function () {
        cc.log("restoreCompletedTransactions");
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.restoreTransactions();
        }
    },

    getUnverifiedReceiptList: function () {
        cc.log("getUnverifiedReceiptList");
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.getUnverifiedReceiptList();
        }
    },

    _getProductById: function (productId) {
        if (this.productList && this.productList.length > 0) {
            for (var i = 0; i < this.productList.length; ++i) {
                var product = this.productList[i];
                if (product.productId === productId) {
                    return product;
                }
            }
        }
        return null;
    }
});

StoreManager.sharedDirector = null;
StoreManager.firstUseDirector = true;

StoreManager.getInstance = function () {
    if (StoreManager.firstUseDirector) {
        StoreManager.firstUseDirector = false;
        StoreManager.sharedDirector = new StoreManager();
    }
    return StoreManager.sharedDirector;
};

module.exports = StoreManager;
},{"../entity/PaymentInfo":6,"../entity/ProductInfo":8,"../enum/PaymentCode":10}],24:[function(require,module,exports){
var DAY_IN_SECONDS = 24 * 60 * 60;

var NOTIFICATION_DAYS = [1, 3, 7, 15, 30];
var AdsPlace = require("../enum/AdsPlace");

var LogicMan = cc.Class.extend({
    _isRegisterGameEventListener: false,
    _start: false,
    ctor: function() {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge = jsb_dp.OneSDKJSBridge.getInstance();
            if (jsb_dp.LogicJSBridge && jsb_dp.LogicJSBridge.getInstance) {
                jsb_dp.logicBridge = jsb_dp.LogicJSBridge.getInstance();
            }
        }

        var EventDispatcher = require("../events/EventDispatcher");
        var NotificationManager = require("../manager/NotificationManager");
        var AnalyseManager = require("../manager/AnalyseManager");
        var StoreManager = require("../manager/StoreManager");
        var GCManager = require("../manager/GCManager");
        var RateManager = require("../manager/RateManager");
        var PlayerMan = require("../model/PlayerMan");
        var StorageController = require("../storage/StorageController");
        var AdsManager = require("../manager/AdsManager");
        var AudioPlayer = require("../audio/AudioPlayer");
        var Utils = require("../util/Utils");
        var ShareManager = require("../manager/ShareManager");
        var DialogManager = require("../popup/DialogManager");
        var AssetsManager = require("../assets/AssetsManager");

        var BaseCCBController = require("../controller/BaseCCBController");
        var AudioHelper = require("../util/AudioHelper");
        var CaptureManager = require("../manager/CaptureManager");
        var LocalizationManager = require("../manager/LocalizationManager");
        var CrossPromManager = require("../manager/CrossPromManager");

        window.game = {};
        window.game.utils = Utils;
        window.game.eventDispatcher = EventDispatcher.getInstance();
        window.game.logicMan = this;
        window.game.notificationManager = NotificationManager.getInstance();
        window.game.analyseManager = AnalyseManager.getInstance();
        window.game.storeManager = StoreManager.getInstance();
        window.game.gcManager = GCManager.getInstance();
        window.game.rateManager = RateManager.getInstance();
        window.game.playerMan = PlayerMan.getInstance();
        window.game.storageController = StorageController.getInstance();
        window.game.adsManager = AdsManager.getInstance();
        window.game.audioPlayer = AudioPlayer.getInstance();
        window.game.shareManager = ShareManager.getInstance();
        window.game.dialogManager = DialogManager.getInstance();
        window.game.assetsManager = AssetsManager.getInstance();
        window.game.captureManager = CaptureManager.getInstance();
        window.game.local = LocalizationManager.getInstance();

        window.BaseCCBController = BaseCCBController;
        window.AudioHelper = AudioHelper;

        var GameBridge = require("../bridge/GameBridge");
        window.GameBridge = GameBridge;
        window.game.config = GameBridge.getConfig();
        window.game.popupMan = GameBridge.getPopupMan();
        window.game.gameMan = GameBridge.getGameMan();

        window.game.crossPromMan = CrossPromManager.getInstance();

        _ = function (key) {
            return game.local.getValue(key);
        };
    },

    init: function () {
    },

    registerGameEventListener: function() {
        if(!this._isRegisterGameEventListener) {
            this._isRegisterGameEventListener = true;
            game.eventDispatcher.addEventListener(cc.game.EVENT_SHOW, this.gameOnShow, this);
            game.eventDispatcher.addEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
        }
    },

    purge: function() {
        game.eventDispatcher.removeEventListener(cc.game.EVENT_SHOW, this.gameOnShow, this);
        game.eventDispatcher.removeEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
    },

    gameOnShow: function() {
        game.notificationManager.unscheduleNotification();

        game.adsManager.onGameOnShow();

        setTimeout(function () {
            if (game.playerMan.getLevel() >= 4) {
                game.adsManager.showInterstitial(AdsPlace.BackGround);
            }
        }.bind(this), 100);
    },

    gameOnHide: function() {
        if (cc.sys.isNative) {
            this.scheduleLocalNotification();
        }
        game.adsManager.setInterstitialShowed(AdsPlace.BackGround);
        this.lastHideTime = Date.now();
    },

    registerNotification: function () {
        game.notificationManager.registerNotification();
    },

    startGame: function (notInitPlayer) {
        if (this._start) {
            return;
        }
        this._start = true;
        game.notificationManager.unscheduleNotification();
        this.registerGameEventListener();

        if (!notInitPlayer) {
            game.playerMan.initData();
        }
        game.adsManager.init();
        game.adsManager.loadRemoteData();
        game.analyseManager.initAnalytics();
        game.gcManager.isGameCenterAvailable();
        game.rateManager.init(3, 1, 0.5, 0.5, true);
        game.analyseManager.trackLoginEvent();
        game.crossPromMan.tryToLoadFromRemote();
        game.adsManager.setIsNewPlayer(game.playerMan.isNewPlayer());
    },

    scheduleLocalNotification: function () {
        if (!cc.sys.isNative) {
            return;
        }


        var leftTimeSeconds = Math.floor(game.gameMan.getWheelLeftTime() / 1000);
        if (leftTimeSeconds < 5 * 60) {
            leftTimeSeconds = 5 * 60;
        }
        var index = 1;
        //wheel notification.
        game.notificationManager.scheduleNotification(leftTimeSeconds,
            _("wheel_is_ready"), game.local.getValue("app_name"), index++);

        //daily bonus notification.
        var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
        var currentDayClaimed = (lastClaimDay >= game.utils.getDayByTs(Date.now()));
        var dailyBonusSeconds = 0;
        if (currentDayClaimed) {
            var nextDayTime = (game.utils.getDayByTs(Date.now()) + 1) * (24 * 3600 * 1000);
            dailyBonusSeconds = (nextDayTime - Date.now()) / 1000;
        }
        if (dailyBonusSeconds <= 10 * 60) {
            dailyBonusSeconds = 10 * 60;
        }
        game.notificationManager.scheduleNotification(dailyBonusSeconds,
            _("daily_bonus_is_ready"), game.local.getValue("app_name"), index++);

        //normal notification.
        for (var i = 0; i < NOTIFICATION_DAYS.length; ++i) {
            game.notificationManager.scheduleNotification(DAY_IN_SECONDS * NOTIFICATION_DAYS[i],
                game.local.getValue(game.utils.sprintf("noti_tips%d", i + 1)), game.local.getValue("app_name"), index++);
        }
    },

    rsyncUserDataFromGC: function () {
        //var highLevel = game.gcManager.highScoreForLeaderboard(game.config.getLeaderBoardKey());
        //if (highLevel > game.playerMan.getLevel()) {
        //    game.playerMan.setLevel(highLevel);
        //}
    }
});

LogicMan._instance = null;
LogicMan._firstUseInstance = true;

/**
 *
 * @returns {LogicMan}
 */
LogicMan.getInstance = function () {
    if (LogicMan._firstUseInstance) {
        LogicMan._firstUseInstance = false;
        LogicMan._instance = new LogicMan();
    }
    return LogicMan._instance;
};

module.exports = LogicMan;
},{"../assets/AssetsManager":1,"../audio/AudioPlayer":2,"../bridge/GameBridge":3,"../controller/BaseCCBController":4,"../enum/AdsPlace":9,"../events/EventDispatcher":11,"../manager/AdsManager":14,"../manager/AnalyseManager":15,"../manager/CaptureManager":16,"../manager/CrossPromManager":17,"../manager/GCManager":18,"../manager/LocalizationManager":19,"../manager/NotificationManager":20,"../manager/RateManager":21,"../manager/ShareManager":22,"../manager/StoreManager":23,"../model/PlayerMan":25,"../popup/DialogManager":27,"../storage/StorageController":29,"../util/AudioHelper":30,"../util/Utils":31}],25:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var PlayerInfo = require("../entity/PlayerInfo");

var PLAYER_KEY = "player_key";

var PlayerMan = cc.Class.extend({
    player: null,
    bestScoreKey: null,
    levelBoardKey: null,
    ctor: function () {
    },

    initData: function () {
        var playerInfoStr = game.storageController.getItem(PLAYER_KEY, null);
        var player;
        if (playerInfoStr == null || playerInfoStr == "") {
            player = PlayerInfo.createDefault();
            game.storageController.setItem(PLAYER_KEY, JSON.stringify(player));
        } else {
            player = new PlayerInfo();
            player.unmarshall(JSON.parse(playerInfoStr));
        }
        this.player = player;
    },

    getBestScore: function () {
        return this.player.bestScore;
    },

    getLevel: function () {
        if (cc.isUndefined(this.player.level)) {
            return 1;
        } else {
            return this.player.level;
        }
    },

    setLevel: function (level) {
        this.player.level = level;
        this._flushToStorage();
    },

    updateLevelStar: function (level, levelStar) {
        if (cc.isUndefined(this.player.levelMap[level]) || this.player.levelMap[level] < levelStar) {
            this.player.levelMap[level] = levelStar;
            game.gcManager.reportScore(level, this.getLevelBoardKey());
            this._flushToStorage();
        }
    },

    getLevelStar: function (level) {
        return this.player.levelMap[level] || 0;
    },

    addLevel: function () {
        game.gcManager.reportScore(this.player.level, this.getLevelBoardKey());
        this.player.level++;
        this.player.progress = 0;
        this._flushToStorage();
    },

    updateBestScore: function (newBestScore) {
        if (newBestScore > this.player.bestScore) {
            this.player.bestScore = newBestScore;
            game.gcManager.reportScore(newBestScore, this.getBestScoreBoardKey());
            this._flushToStorage();
            return true;
        }
        return false;
    },

    getLevelBoardKey: function () {
        return this.levelBoardKey || game.config.getLeaderBoardKey();
    },

    getBestScoreBoardKey: function () {
        return this.bestScoreKey || game.config.getLeaderBoardKey();
    },

    setLevelBoardKey: function (key) {
        this.levelBoardKey = key;
    },

    setBestScoreBoardKey: function (bestScoreKey) {
        this.bestScoreKey = bestScoreKey;
    },

    updateProgress: function (progress) {
        if (this.player.progress < progress) {
            this.player.progress = progress;
            this._flushToStorage();
        }
    },

    removedAds: function () {
        this.player.removedAds = true;
        game.adsManager.removeBannerAds();
        this._flushToStorage();
    },

    setRated: function () {
        this.player.rated = true;
        this._flushToStorage();
    },

    _flushToStorage: function () {
        game.storageController.setItem(PLAYER_KEY, JSON.stringify(this.player));
    }
});

PlayerMan._instance = null;
PlayerMan._firstUseInstance = true;

/**
 *
 * @returns {PlayerMan}
 */
PlayerMan.getInstance = function () {
    if (PlayerMan._firstUseInstance) {
        PlayerMan._firstUseInstance = false;
        PlayerMan._instance = new PlayerMan();
    }
    return PlayerMan._instance;
};

module.exports = PlayerMan;
},{"../entity/PlayerInfo":7}],26:[function(require,module,exports){
/**
 * Created by qinning on 15/4/22.
 */
var HttpClient = {

    /**
     * get request,jsb ok,html5 shows  No 'Access-Control-Allow-Origin' header is present on the requested resource
     * @param {string} url
     * @param {function} callback
     */
    doGet: function (url, callback) {
        var xhr = cc.loader.getXMLHttpRequest();
        xhr.open("GET", url, true);

        xhr.onreadystatechange = function () {
            cc.log("readyState:"+xhr.readyState+",status:"+xhr.status+",statuText:"+xhr.statusText+",,,responseText:"+xhr.responseText);
            if (xhr.readyState == 4 && xhr.status == 200) {
                var httpStatus = xhr.statusText;
                var response = xhr.responseText;
                callback(null,response);
            }else{
                callback(xhr.statusText);
            }
        };
        xhr.send();
    },

    /**
     *
     * @param {string} url
     * @param {string} param
     * @param {Object.<string,string>} headers
     * @param {Function} callback
     */
    doPost: function (url, params, headers, callback) {
        var xhr = cc.loader.getXMLHttpRequest();
        xhr.open("POST", url);
        for (var key in headers) {
            xhr.setRequestHeader(key, headers[key]);
        }
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (xhr.status >= 200 && xhr.status <= 207) {
                    callback(null, xhr.responseText);
                } else {
                    callback(xhr.status, xhr.statusText);
                }
            }
        };
        try {
            xhr.send(params);
        } catch (e) {
        }
    }
};

module.exports = HttpClient;
},{}],27:[function(require,module,exports){
var ModalLayer = require("./ModalLayer");

var DialogManager = cc.Class.extend({
    DIALOG_ZORDER_BEGIN: 999,
    DIALOG_ZORDER_STEP: 2,

    /**
     * @types {ModalLayer}
     */
    _overlay: null,
    _scaleFactor: 0,
    /**
     * @types {Array.<ModalLayer>}
     */
    _dialogStack: null,

    ctor: function () {
    },

    createOverlay: function () {
        this._overlay = new ModalLayer();
        this._overlay.setColor(cc.color.BLACK);
        this._overlay.setOpacity(190);
        this._overlay.setContentSize(cc.size(cc.winSize.width, cc.winSize.height));
        this._overlay.setLocalZOrder(999);
        this._overlay.retain();
        this._scaleFactor = 1.0;
        this._dialogStack = [];
    },

    popup: function (dlg, param) {
        dlg.ignoreAnchorPointForPosition(false);
        dlg.setScale(this._scaleFactor);
        var dlgLen = this._dialogStack.length;
        cc.log("dlgLen:" + dlgLen);
        if (dlgLen == 0) {
            dlg.setLocalZOrder(this.DIALOG_ZORDER_BEGIN);
        }
        else {
            dlg.setLocalZOrder(this._dialogStack[dlgLen - 1].getLocalZOrder() + this.DIALOG_ZORDER_STEP);
        }
        this._dialogStack.push(dlg);
        this._overlay.setLocalZOrder(dlg.getLocalZOrder() - 1);

        if (this._overlay.getParent() == null) {
            this.attachScene(this._overlay);
        }

        if (param && param.overlayColor) {
            this._overlay.setColor(param.overlayColor);
        } else {
            this._overlay.setColor(cc.color.BLACK);
        }

        if (param && param.overlayOpacity) {
            this._overlay.setOpacity(param.overlayOpacity);
        } else {
            this._overlay.setOpacity(190);
        }

        this.attachScene(dlg);

        game.eventDispatcher.dispatchEvent("dialog_poped");
    },

    attachScene: function (node) {
        cc.director.getRunningScene().addChild(node);
    },

    close: function (dlg, dispose) {
        if (cc.isUndefined(dispose)) {
            dispose = true;
        }
        var closeIndex;
        var dlgLen = this._dialogStack.length;
        for (closeIndex = dlgLen - 1; closeIndex >= 0; --closeIndex) {
            if (dlg === this._dialogStack[closeIndex]) {
                break;
            }
        }

        if (closeIndex >= 0) {
            this._dialogStack.splice(closeIndex, 1);
            dlgLen = this._dialogStack.length;
            dlg.removeFromParent(dispose);
        } else {
            return;
        }

        if (dlgLen === 0) {
            this._overlay.removeFromParent(false);
        } else {
            var topIndex = dlgLen - 1;

            if (topIndex >= 0) {
                this._overlay.setLocalZOrder(this._dialogStack[topIndex].getLocalZOrder() - 1);
            } else {
                this._overlay.removeFromParent(false);
                this._dialogStack.length = 0;
            }
        }
        game.eventDispatcher.dispatchEvent("dialog_closed");
    },

    closeAll: function () {
        var dlgLen = this._dialogStack.length;
        while (dlgLen != 0) {
            var modalLayer = this._dialogStack[dlgLen - 1];
            this.close(modalLayer, true);
            dlgLen = this._dialogStack.length;
        }
    },

    isTopestDialog: function (node) {
        return (this._dialogStack[this._dialogStack.length - 1] === node);
    }

});

DialogManager._instance = null;
DialogManager._firstUseInstance = true;

/**
 *
 * @returns {DialogManager}
 */
DialogManager.getInstance = function () {
    if (DialogManager._firstUseInstance) {
        DialogManager._firstUseInstance = false;
        DialogManager._instance = new DialogManager();
    }
    return DialogManager._instance;
};

module.exports = DialogManager;
},{"./ModalLayer":28}],28:[function(require,module,exports){
/**
 * Created by qinning on 15/4/28.
 */
var ModalLayer = cc.LayerColor.extend({
    ctor:function(){
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this)
        }, this);
    },
    onTouchBegan:function(touch, event) {
        if(!this.isVisible() || (!this.isTouchInside(this,touch))){
            return false;
        }
        return true;
    },
    isTouchInside: function (owner,touch) {
        if(!owner || !owner.getParent()){
            return false;
        }
        var touchLocation = touch.getLocation(); // Get the touch position
        touchLocation = owner.getParent().convertToNodeSpace(touchLocation);
        return cc.rectContainsPoint(owner.getBoundingBox(), touchLocation);
    }
});

module.exports = ModalLayer;
},{}],29:[function(require,module,exports){
/**
 * Created by qinning on 15/4/23.
 */

var StorageController = cc.Class.extend({
    setItem: function (key, value) {
        cc.sys.localStorage.setItem(key, value);
    },
    getItem: function (key, defaultValue) {
        var value = cc.sys.localStorage.getItem(key);
        if (value == "" || value == null) {
            return defaultValue;
        }
        return value;
    },
    removeItem: function (key) {
        cc.sys.localStorage.removeItem(key);
    }
});

StorageController._instance = null;
StorageController._firstUseInstance = true;

/**
 *
 * @returns {StorageController}
 */
StorageController.getInstance = function () {
    if (StorageController._firstUseInstance) {
        StorageController._firstUseInstance = false;
        StorageController._instance = new StorageController();
    }
    return StorageController._instance;
};

module.exports = StorageController;
},{}],30:[function(require,module,exports){
/**
 * Created by oye on 16/3/12.
 */

var AudioHelper = {
    playBtnSound: function () {
        game.audioPlayer.playEffectByKey("enter");
    }
};

module.exports = AudioHelper;
},{}],31:[function(require,module,exports){
/**
 * Created by oye on 15-4-19.
 */


var Utils = {
    /**
     * Generate a random integer value which meets [0, upperValue)
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextInt: function(upperValue) {
        return Math.floor(Math.random() * upperValue);
    },

    /**
     * generate a random number value which meets [0, upperValue)
     * @param upperValue
     * @returns {number}
     */
    randomNextNumber: function (upperValue) {
        return Math.random() * upperValue;
    },

    /**
     * random a integer from [min, max]
     * @param {number} min
     * @param {number} max
     * @returns {number}
     */
    rangeNextInt: function(min, max) {
        return min + this.randomNextInt(max - min + 1);
    },

    rangeNextNumber: function (min, max) {
        return min + this.randomNextNumber(max - min);
    },

    /**
     * Generate a random number value which meets [lowerValue, upperValue)
     * @param {number} lowerValue
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextNumberInRange: function (lowerValue, upperValue) {
        return Math.random() * (upperValue - lowerValue) + lowerValue;
    },

    /**
     * Generate a random integer value which meets [lowerValue, upperValue)
     * @param {number} lowerValue
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextIntInRange: function (lowerValue, upperValue) {
        return Math.floor(Math.random() * (upperValue - lowerValue) + lowerValue);
    },

    /**
     * 格式化字符串
     * @returns {string}
     */
    sprintf: function () {
        var i = 0, a, f = arguments[i++], o = [], m, p, c, x, s = '';
        while (f) {
            if (m = /^[^\x25]+/.exec(f)) {
                o.push(m[0]);
            }
            else if (m = /^\x25{2}/.exec(f)) {
                o.push('%');
            }
            else if (m = /^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(f)) {
                if (((a = arguments[m[1] || i++]) == null) || (a == undefined)) {
                    throw('Too few arguments.');
                }
                if (/[^s]/.test(m[7]) && (typeof(a) != 'number')) {
                    throw('Expecting number but found ' + typeof(a));
                }
                switch (m[7]) {
                    case 'b':
                        a = a.toString(2);
                        break;
                    case 'c':
                        a = String.fromCharCode(a);
                        break;
                    case 'd':
                        a = parseInt(a);
                        break;
                    case 'e':
                        a = m[6] ? a.toExponential(m[6]) : a.toExponential();
                        break;
                    case 'f':
                        a = m[6] ? parseFloat(a).toFixed(m[6]) : parseFloat(a);
                        break;
                    case 'o':
                        a = a.toString(8);
                        break;
                    case 's':
                        a = ((a = String(a)) && m[6] ? a.substring(0, m[6]) : a);
                        break;
                    case 'u':
                        a = Math.abs(a);
                        break;
                    case 'x':
                        a = a.toString(16);
                        break;
                    case 'X':
                        a = a.toString(16).toUpperCase();
                        break;
                }
                a = (/[def]/.test(m[7]) && m[2] && a >= 0 ? '+' + a : a);
                c = m[3] ? m[3] == '0' ? '0' : m[3].charAt(1) : ' ';
                x = m[5] - String(a).length - s.length;
                p = m[5] ? str_repeat(c, x) : '';
                o.push(s + (m[4] ? a + p : p + a));
            }
            else {
                throw('Huh ?!');
            }
            f = f.substring(m[0].length);
        }
        return o.join('');
    },

    getDistance : function(point1,point2){
        return Math.sqrt((point1.x - point2.x) * (point1.x - point2.x) + (point1.y - point2.y) * (point1.y - point2.y));
    },

    arrayContain : function (arr, element) {
        if(arr && arr.length > 0) {
            for(var i = 0; i < arr.length; ++i) {
                if(arr[i] == element) {
                    return true;
                }
            }
        }
        return false;
    },

    /**
     * @param {string} ccbFileName
     * @param {string} controllerName
     * @param {object | cc.Node} controllerNode
     * @returns {cc.Node | null}
     */
    loadNodeFromCCB : function(ccbFileName,containerNode,controllerName,controllerNode){
        if(!cc.isUndefined(controllerName) && !cc.isUndefined(controllerNode)){
            cc.BuilderReader.registerController(controllerName,controllerNode);
        }
        var node = cc.BuilderReader.load(ccbFileName, containerNode);
        node.retain();
        this.executeInNextFrame(function () {
            node.release();
        });
        return node;
    },

    /**
     *
     * @param {function} subType
     * @param {function} superType
     */
    inherits: function(subType, superType) {
        var subPrototype = Object.create(superType.prototype);
        subPrototype.constructor = subType;
        subType.prototype = subPrototype;
    },

    /**
     *
     * @param {string} url
     * @returns {Object}
     */
    loadJson: function (url) {
        if (!cc.sys.isNative) {
            return cc.loader.getRes(url);
        } else {
            if(jsb.fileUtils.isFileExist(url)) {
                return JSON.parse(jsb.fileUtils.getStringFromFile(url));
            } else {
                return null;
            }
        }
    },

    loadPlist: function (url) {
        if (!cc.sys.isNative) {
            return cc.loader.getRes(url);
        } else {
            if(jsb.fileUtils.isFileExist(url)) {
                return cc.plistParser.parse(jsb.fileUtils.getStringFromFile(url));
            } else {
                return null;
            }
        }
    },

    getScreenShot: function (fileName) {
        cc.log("fileName:" + fileName);
        var tex = new cc.RenderTexture(cc.winSize.width, cc.winSize.height, cc.Texture2D.PIXEL_FORMAT_RGBA8888);
        tex.setPosition(cc.p(cc.winSize.width / 2, cc.winSize.height / 2));
        tex.begin();
        cc.director.getRunningScene().visit();
        tex.end();

        var imgPath = jsb.fileUtils.getWritablePath();
        if (imgPath.length == 0) {
            return "";
        }
        var result = tex.saveToFile(fileName, cc.IMAGE_FORMAT_JPEG);
        if (result) {
            imgPath += fileName;
            cc.log("save image:" + imgPath);
            return imgPath;
        }
        return "";
    },

    isPad: function () {
        var winSize = cc.winSize;
        if (!!GameBridge.getConfig().horizontalGame) {
            return (winSize.width / winSize.height < 1.5);
        } else {
            return (winSize.height / winSize.width < 1.5);
        }
    },

    getFormatRotation: function (rotation) {
        return ((rotation % 360) + 360) % 360;
    },

    doClipping: function (maskLayer, clipLayer) {
        if(maskLayer && clipLayer){
            var clipParentNode = clipLayer.getParent();
            clipLayer.retain();
            clipLayer.removeFromParent(false);

            maskLayer.removeFromParent(false);
            maskLayer.visible = true;

            var clippingNode = new cc.ClippingNode(maskLayer);
            clippingNode.alphaThreshold = 1;
            clippingNode.addChild(clipLayer);
            clipLayer.release();

            clipParentNode.addChild(clippingNode);
        }
    },

    isPixelCollision: function (spr1, spr2) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isPixelCollision(spr1, spr2);
        } else {
            return cc.rectIntersectsRect(spr1.getBoundingBox(), spr2.getBoundingBox());
        }
    },

    scaleCCLabelBMFont: function (label, maxWidth) {
        if (label.width > maxWidth) {
            var scaleFactor = maxWidth / label.width;
            label.scaleX = label.scaleY = scaleFactor;
        } else {
            label.scaleX = label.scaleY = 1.0;
        }
    },

    scaleCCLabelBMFontWithMaxScale: function (label, maxWidth, maxScale) {
        if (label.width * label.scaleX > maxWidth) {
            label.scaleX = label.scaleY = maxWidth / label.width;
        }
        if (label.scaleX > maxScale) {
            label.scaleX = label.scaleY = maxScale;
        }
    },

    /**
     *
     * @param {cc.Node} node
     */
    walkNode: function (node, cb) {
        if(node) {
            var more = cb(node);
            if(more) {
                for(var k in node.children) {
                    more = this.walkNode(node.children[k], cb);
                    if(!more)
                        break;
                }
            }
            return more;
        }
        else {
            return true;
        }
    },

    isNodeButton: function(nd) {
        return (nd instanceof cc.ControlButton);
    },

    isNodeMenuItem: function(nd) {
        return (nd instanceof cc.MenuItem || nd instanceof cc.MenuItemImage);
    },

    isLabelBMFont:function (nd) {
        return (nd instanceof cc.LabelBMFont || nd instanceof cc.Label);
    },

    /**
     * Load an image with the given url
     * @param {string} url
     * @param {function} callback - function(error, texture, extra)
     * @param {*} extra
     */
    loadRemoteImg: function (url, callback, extra) {
        if (!cc.sys.isNative) {
            cc.loader.loadImg(url, {isCrossOrigin: true}, function (error, img) {
                var texture2d = new cc.Texture2D();
                texture2d.initWithElement(img);
                texture2d.handleLoadedTexture();
                callback(error, texture2d, extra);
            });
        } else {
            cc.loader.loadImg(url, {isCrossOrigin: true}, function (error, texture2d) {
                callback(error, texture2d, extra);
            });
        }
    },

    playCCBAnimation: function(node, anmName){
        var animMgr = node.animationManager;
        var seqId;
        if(anmName) {
            if (cc.sys.isNative){
                seqId = animMgr.getSequenceId(anmName);
            }
            else{
                seqId = animMgr._getSequenceId(anmName);
            }
        } else {
            seqId = animMgr.getAutoPlaySequenceId();
        }

        if (seqId != -1){
            if(!anmName) {
                animMgr.runAnimationsForSequenceIdTweenDuration(seqId, 0);
            } else {
                animMgr.runAnimationsForSequenceNamed(anmName);
            }
            return true;
        } else {
            cc.log("animation " + anmName + " not exists!");
            return false;
        }
    },

    randomScaleAnim: function (spr, startScale, totalTime) {
        totalTime = this.randomNextNumberInRange(totalTime * 0.8, totalTime * 1.2);
        var delayTime = this.randomNextNumber(totalTime / 2);

        var scaleBigTime = 0.3 * (totalTime - delayTime) * 2;
        var scaleSmallTime = 0.1 * (totalTime - delayTime) * 2;
        var scaleNormalTime = 0.1 * (totalTime - delayTime) * 2;

        spr.stopAllActions();
        spr.setScale(0);
        spr.runAction(cc.sequence(cc.delayTime(delayTime),
            cc.scaleTo(scaleBigTime, 1.1 * startScale).easing(cc.easeInOut(2)) ,
            cc.scaleTo(scaleSmallTime, 0.9 * startScale).easing(cc.easeInOut(2)),
            cc.scaleTo(scaleNormalTime, 1 * startScale).easing(cc.easeInOut(2))));
    },

    getFormatTime: function (time) {
        var decimals = time - Math.floor(time);
        time = Math.floor(time);
        if (time <= 60) {
            return "" + (time + decimals).toFixed(2);
        } else if (time <= 3600) {
            return Math.floor(time / 60) + ":" + ((time % 60) + decimals).toFixed(2);
        } else {
            return Math.floor(time / 3600) + ":" + Math.floor(time % 3600 / 60) + ":" + ((time % (3600 * 60)) + decimals).toFixed(2);
        }
    },

    getLongFormatTime: function (time) {
        return Math.floor(time / 3600) + ":" + Math.floor(time % 3600 / 60) + ":" + (time % (3600 * 60));
    },

    seekNodeByTag: function (rootNode, tag) {
        if (null === rootNode){
            return null;
        }
        if(rootNode.getTag() === tag){
            return rootNode;
        }
        var arrayRootChildren = rootNode.getChildren();
        if(arrayRootChildren && arrayRootChildren.length > 0) {
            var length = arrayRootChildren.length;
            for(var i = 0; i < length; i++) {
                var child = arrayRootChildren[i];
                if (null !== child){
                    var res = this.seekNodeByTag(child, tag);
                    if (null !== res) {
                        return res;
                    }
                }
            }
        }
        return null;
    },

    autoRelease: function (obj) {
        Utils.executeInNextFrame(function () {
            obj.release();
        });
    },

    executeInNextFrame: function (callback) {
        setTimeout(function () {
            if (callback) {
                callback();
            }
        }, 0);
    },

    isIOS: function () {
        if (cc.sys.os === cc.sys.OS_IOS) {
            return true;
        }
        return false;
    },

    getDayByTs: function(ts) {
        return Math.floor(ts / (1000 * 3600 * 24));
    },

    isSelfGame: function () {
        if (cc.sys.os === cc.sys.OS_IOS) {
            if (cc.sys.language === cc.sys.LANGUAGE_CHINESE) {
                return true;
            }
        }
        return false;
    }
};

module.exports = Utils;
},{}],32:[function(require,module,exports){
/**
 * Created by XinCheng on 8/18/16.
 */

var EasingFunctions = {
    // no easing, no acceleration
    linear: function (t) { return t; },
    // accelerating from zero velocity
    easeInQuad: function (t) { return t*t; },
    // decelerating to zero velocity
    easeOutQuad: function (t) { return t*(2-t); },
    // acceleration until halfway, then deceleration
    easeInOutQuad: function (t) { return t<0.5 ? 2*t*t : -1+(4-2*t)*t; },
    // accelerating from zero velocity
    easeInCubic: function (t) { return t*t*t; },
    // decelerating to zero velocity
    easeOutCubic: function (t) { return (--t)*t*t+1; },
    // acceleration until halfway, then deceleration
    easeInOutCubic: function (t) { return t<0.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1; },
    // accelerating from zero velocity
    easeInQuart: function (t) { return t*t*t*t; },
    // decelerating to zero velocity
    easeOutQuart: function (t) { return 1-(--t)*t*t*t; },
    // acceleration until halfway, then deceleration
    easeInOutQuart: function (t) { return t<0.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t; },
    // accelerating from zero velocity
    easeInQuint: function (t) { return t*t*t*t*t; },
    // decelerating to zero velocity
    easeOutQuint: function (t) { return 1+(--t)*t*t*t*t; },
    // acceleration until halfway, then deceleration
    easeInOutQuint: function (t) { return t<0.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t; },

    easeOutElastic: function(t){  var p = 0.4; return Math.pow(2,-10*t) * Math.sin((t-p/4)*(2*Math.PI)/p) + 1; },

    elastic: function(t, x) { return Math.pow(2, 10 * (t-1)) * Math.cos(20*Math.PI*x/3*t); },

    // 弹跳
    bounce: function(t) {
        for(var a = 0, b = 1; 1; a += b, b /= 2) {
            if (t >= (7 - 4 * a) / 11) {
                return -Math.pow((11 - 6 * a - 11 * t) / 4, 2) + Math.pow(b, 2);
            }
        }
    },

    //三次贝塞尔算法
    bseBase: function(t, p0, p1, p2, p3){
        var x = p0.x * (1 - t) * (1 - t) * (1 - t) + p1.x * 3 * t * (1 - t) * (1 - t) + p2.x * 3 * t * t * (1 - t) + p3.x * t * t * t;
        var y = p0.y * (1 - t) * (1 - t) * (1 - t) + p1.y * 3 * t * (1 - t) * (1 - t) + p2.y * 3 * t * t * (1 - t) + p3.y * t * t * t;
        return {x:x,y:y};
    },

    doShaking: function (t) {
        return -Math.sin(2 * Math.PI * 3 * t) * Math.pow((1 - t), 2);
    }

};

var Wheel = cc.Class.extend({
    target: null,                               // the target node you want to rotate
    bCurve: [0.42, -0.08, 0.58, 1.10],          // magic curve
    fps: 0,                                     // fps
    nRound: 1,                                  // move nRound x 360

    frameCount: 0,
    elapsedTime: 0,
    totalRotationTime: 0,
    startRotation: 0,       // the start rotation
    movement: 0,             // the movement degrees
    easyFunction: null,
    endCallback: null,
    targetRotation: 0,
    wheelItemAngle: 0,
    lastTime: 0,
    lastRotation: 0,
    speed: 0,

    _lotteryReseting: false,
    _isHighRotating: false,
    _startUpdate: false,


    /*
     * target: the node you want to rotate
     * fps: 30fps by default
     */
    ctor: function (target, fps) {
        this.target = target;
        this.fps = fps || 60;
    },

    /**
     * rotate the target node to the specified value
     * the index should start with 0
     * @param {number} rotationTime
     * @param {number} targetRotation
     * @param {number} wheelItemAngle
     * @param {Function} rollEndCallback
     */
    rotate: function (rotationTime, targetRotation, wheelItemAngle, rollEndCallback) {
        // I am moving
        if (this._startUpdate) {
            return;
        }

        this.targetRotation = targetRotation;
        this.frameCount = 0;
        this.totalRotationTime = rotationTime;

        this.startRotation = this.target.rotation % 360;
        this.movement = targetRotation - this.startRotation;
        this.wheelItemAngle = wheelItemAngle;

        this.lastTime = Date.now();
        this.lastRotation = 0;
        this._isHighRotating = false;
        this._lotteryReseting = false;

        this.easyFunction = this.defaultEasyFunction;
        //// use bezier
        //if (Array.isArray(params.easyFunction)) {
        //    this.bCurve = params.easyFunction;
        //    this.easyFunction = this.defaultEasyFunction;
        //}
        //// provide a function
        //else if (typeof easyFunction === 'function') {
        //    this.easyFunction = params.easyFunction;
        //}
        //// provide a functionName
        //else {
        //    this.easyFunction = EasingFunctions[params.easyFunction] || this.defaultEasyFunction;
        //}

        this.endCallback = rollEndCallback;

        this.scheduleUpdate();
        this._startUpdate = true;
    },

    scheduleUpdate: function () {
        this.elapsedTime = 0;
        cc.director.getScheduler().scheduleUpdateForTarget(this, 0, false);
    },

    unscheduleUpdate: function () {
        cc.director.getScheduler().unscheduleUpdateForTarget(this);
        this.elapsedTime = 0;
    },

    update: function (dt) {
        if (this._startUpdate) {
            this.moveByFrame(dt);
        }
    },

    /*rotate the reel frame by frame*/
    moveByFrame: function (dt) {
        // calculate elapsed time
        this.elapsedTime += dt;

        // calculate the moving progress
        var progress = this.easyFunction(this.elapsedTime / this.totalRotationTime);

        // do the rotation
        this.target.rotation = progress * this.movement + this.startRotation;

        //var hasStop = false;
        // stop here
        if (this.targetRotation <= this.target.rotation) {
            this.target.rotation = this.targetRotation;
            this.unscheduleUpdate();
            this._startUpdate = false;

            //game.audio.stopEffect("slots/roulette-bg");

            if (this.endCallback) {
                this.endCallback();
            }
        }

        this.speed = (this.target.rotation - this.lastRotation) / (Date.now() - this.lastTime) * 1000;

        this.lastTime = Date.now();
        this.lastRotation = this.target.rotation;
    },

    /* Use bezier Curive as default */
    defaultEasyFunction: function (t) {
        var bez = this.bCurve;
        var coord = EasingFunctions.bseBase(t, {x: 0, y: 0}, {x: bez[0], y: bez[1]}, {x: bez[2], y: bez[3]}, {
            x: 1,
            y: 1
        });
        return coord.y;
    },

    getTargetRotation: function () {
        return this.targetRotation;
    },

    getSpeed: function () {
        return this.speed;
    }
});


module.exports = Wheel;

},{}],33:[function(require,module,exports){
/**
 * A brief explanation for "project.json":
 * Here is the content of project.json file, this is the global configuration for your game, you can modify it to customize some behavior.
 * The detail of each field is under it.
 {
    "project_type": "javascript",
    // "project_type" indicate the program language of your project, you can ignore this field

    "debugMode"     : 1,
    // "debugMode" possible values :
    //      0 - No message will be printed.
    //      1 - cc.error, cc.assert, cc.warn, cc.log will print in console.
    //      2 - cc.error, cc.assert, cc.warn will print in console.
    //      3 - cc.error, cc.assert will print in console.
    //      4 - cc.error, cc.assert, cc.warn, cc.log will print on canvas, available only on web.
    //      5 - cc.error, cc.assert, cc.warn will print on canvas, available only on web.
    //      6 - cc.error, cc.assert will print on canvas, available only on web.

    "showFPS"       : true,
    // Left bottom corner fps information will show when "showFPS" equals true, otherwise it will be hide.

    "frameRate"     : 60,
    // "frameRate" set the wanted frame rate for your game, but the real fps depends on your game implementation and the running environment.

    "id"            : "gameCanvas",
    // "gameCanvas" sets the id of your canvas element on the web page, it's useful only on web.

    "renderMode"    : 0,
    // "renderMode" sets the renderer type, only useful on web :
    //      0 - Automatically chosen by engine
    //      1 - Forced to use canvas renderer
    //      2 - Forced to use WebGL renderer, but this will be ignored on mobile browsers

    "engineDir"     : "frameworks/cocos2d-html5/",
    // In debug mode, if you use the whole engine to develop your game, you should specify its relative path with "engineDir",
    // but if you are using a single engine file, you can ignore it.

    "modules"       : ["cocos2d"],
    // "modules" defines which modules you will need in your game, it's useful only on web,
    // using this can greatly reduce your game's resource size, and the cocos console tool can package your game with only the modules you set.
    // For details about modules definitions, you can refer to "../../frameworks/cocos2d-html5/modulesConfig.json".

    "jsList"        : [
    ]
    // "jsList" sets the list of js files in your game.
 }
 *
 */

cc.game.onStart = function() {
    if (!cc.sys.isNative && document.getElementById("cocosLoading"))
        document.body.removeChild(document.getElementById("cocosLoading"));

    cc.view.enableRetina(false);
    cc.view.adjustViewPort(true);

    var LogicMan = require("./common/model/LogicMan");
    LogicMan.getInstance().init();

    var Utils = require("./common/util/Utils");
    cc.view.resizeWithBrowserSize(true);
    cc.view.setDesignResolutionSize(1000, 1300, cc.ResolutionPolicy.SHOW_ALL);
    //if (cc.sys.isNative) {
    //    var width = 0;
    //    var height = 0;
    //    if (!!GameBridge.getConfig().horizontalGame) {
    //        height = 640;
    //        if (Utils.isPad()) {
    //            height = 768;
    //        }
    //        width = height * cc.winSize.width / cc.winSize.height;
    //        cc.log("cc.winSize.width:" + cc.winSize.width);
    //        cc.log("cc.winSize.height:" + cc.winSize.height);
    //
    //    } else {
    //        height = 1136;
    //        if (Utils.isPad()) {
    //            height = 1024;
    //        }
    //        width = height * cc.winSize.width / cc.winSize.height;
    //    }
    //    cc.log("width:" + width);
    //    cc.log("height:" + height);
    //    cc.view.setDesignResolutionSize(width, height, cc.ResolutionPolicy.SHOW_ALL);
    //} else {
    //    if (!!GameBridge.getConfig().horizontalGame) {
    //        cc.view.setDesignResolutionSize(960, 640, cc.ResolutionPolicy.SHOW_ALL);
    //    } else {
    //        cc.view.setDesignResolutionSize(640, 960, cc.ResolutionPolicy.SHOW_ALL);
    //    }
    //}

    // The game will be resized when browser size change
    cc.BuilderReader.setResourcePath("res/");
    cc.view.resizeWithBrowserSize(true);

    game.dialogManager.createOverlay();
    window.isEditor = true;

    if (cc.sys.isNative) {
        game.local.reload();
        cc.director.runScene(new GameBridge.getMenuScene());
    } else {
        cc.loader.loadJson("res/resource_list/resource_list.json", function (error, result) {
            if (!error) {
                cc.LoaderScene.preload(result, function () {
                    game.local.reload();
                    var EditorScene = require("./many_bricks/editor/scene/EditorScene");
                    cc.director.runScene(new EditorScene());
                }, this);
            }
        });
    }
};
cc.game.run();

},{"./common/model/LogicMan":24,"./common/util/Utils":31,"./many_bricks/editor/scene/EditorScene":79}],34:[function(require,module,exports){

var BrickConfig = function () {
    this.width = 0;
    this.height = 0;
    this.x = 0;
    this.y = 0;
    this.type = 0;
};

BrickConfig.prototype.unmarshal = function (jsonObj) {
    this.x = jsonObj[0];
    this.y = jsonObj[1];
    this.width = jsonObj[2];
    this.height = jsonObj[3];
    this.type = jsonObj[4];
};

BrickConfig.prototype.getHardCfg = function () {
    var hardCfg = new BrickConfig();
    hardCfg.x = this.x * 2;
    hardCfg.y = this.y * 2;
    hardCfg.width = this.width * 2;
    hardCfg.height = this.height * 2;
    hardCfg.type = this.type;
    return hardCfg;
};

module.exports = BrickConfig;
},{}],35:[function(require,module,exports){
/**
 * Created by oye on 16/5/19.
 */
var Config = {
    itunesDownloadUrl: "itms-apps://itunes.apple.com/app/id1372837123?action=write-review",
    googlePlayUrl: "http://bit.ly/2O8G9vx",
    iosShortUrl: "https://apple.co/2UPCwz6",
    androidShortUrl: "http://bit.ly/2O8G9vx",
    appName: "Blast Bricks",
    iosLeaderBoardKey: "com.douapp.manybricks.rank",
    iosHardLeaderBoardKey: "com.douapp.manybricks.hardrank",
    googlePlayLeaderBoardKey: "CgkIouCt0-kBEAIQAQ",
    IS_DEBUG: false,
    IS_ENABLE_HOT_UPDATE: false,

    getLeaderBoardKey: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayLeaderBoardKey;
        } else {
            return this.iosLeaderBoardKey;
        }
    },

    getHardBoardKey: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayLeaderBoardKey;
        } else {
            return this.iosHardLeaderBoardKey;
        }
    },

    getPlatformDownloadUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayUrl;
        } else {
            return this.itunesDownloadUrl;
        }
    },

    getShortPlatformDownloadUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.androidShortUrl;
        } else {
            return this.iosShortUrl;
        }
    },
    getCrossPromUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.androidCrossPromUrl;
        } else {
            if (cc.sys.language === cc.sys.LANGUAGE_CHINESE) {
                return this.cnCrossPromUrl;
            }
            return this.crossPromUrl;
        }
    },
    getPackageName: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            if (game.utils.isSelfGame()) {
                return "com.douapp.manybricks";
            } else {
                return "com.q1.breakbricks";
            }
        } else {
            return "com.douapp.manybricks";
        }
    },
    getAdUrl: function () {
        if (game.utils.isSelfGame()) {
            return this.cnNewAdConfigUrl;
        }
        return this.adConfigUrl;
    },
    horizontalGame: false,

    //bingchuan ad url.
    adConfigUrl: "https://onegameinc.github.io/many_bricks/game_bingchuan.html",
    //bingchuan prom url.
    crossPromUrl: "https://onegameinc.github.io/cross_promotion/config/many_bricks/cross_promotion_bingchuan.html",

    //old version cn ad url.
    cnAdConfigUrl: "https://onegameinc.github.io/many_bricks/game.html",
    //new version cn ad url.
    cnNewAdConfigUrl: "https://onegameinc.github.io/many_bricks/game_cn.html",
    //cn prom url.
    cnCrossPromUrl: "https://onegameinc.github.io/cross_promotion/config/many_bricks/cross_promotion.html",


    androidCrossPromUrl: "https://onegameinc.github.io/cross_promotion/config/many_bricks_android/cross_promotion.html",
    connectEmail: "bricks.crush.play@gmail.com",

    rewardAdMaxCountPerDay: 10
};

module.exports = Config;
},{}],36:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */
var LevelConfig = require("./LevelConfig");
//var PackageConfig = require("./PackageConfig");
var StoreConfig = require("./StoreConfig");
var WheelConfig = require("./WheelConfig");
var ShareConfig = require("./ShareConfig");
var SkinConfig = require("./SkinConfig");
var DailyBonusConfig = require("./DailyBonusConfig");
var StoreType = require("../enum/StoreType");
var TaskConfig = require("./TaskConfig");
var BoostType = require("../enum/BoostType");
var TaskOldConfig = require("./TaskOldConfig");

var LevelConfigMan = cc.Class.extend({

    levelList: null,
    storeList: null,
    wheelList: null,
    shareList: null,
    skinList: null,
    dailyBonusList: null,
    storeListWithoutFirstPurchase: null,
    taskList: null,
    oldTaskList: null,
    originalLevelList: null,

    ctor: function () {
        this.storeList = [];
        this.levelList = [];
        this.wheelList = [];
        this.shareList = [];
        this.skinList = [];
        this.dailyBonusList = [];
        this.storeListWithoutFirstPurchase = [];
        this.taskList = [];
        this.oldTaskList = [];

        this.reload();
    },

    reload: function () {
        var i;

        var jsonObj = game.utils.loadJson("res/config/store_config.json");
        var storeConfigs = jsonObj["stores"];
        for (i = 0; i < storeConfigs.length; ++i) {
            var storeConfig = new StoreConfig();
            storeConfig.unmarshal(storeConfigs[i]);
            this.storeList.push(storeConfig);

            if (storeConfig.type === StoreType.FIRST_PURCHASE) {
                this.specialOfferCfg = storeConfig;
            } else {
                this.storeListWithoutFirstPurchase.push(storeConfig);
            }
        }

        jsonObj = game.utils.loadJson("res/config/level_configs.json");
        var levelConfigs = jsonObj["levels"];
        this.originalLevelList = levelConfigs;
        for (i = 0; i < levelConfigs.length; ++i) {
            var levelConfig = new LevelConfig();
            levelConfig.unmarshal(levelConfigs[i]);
            this.levelList.push(levelConfig);
        }

        jsonObj = game.utils.loadJson("res/config/data_config.json");
        var wheelConfigs = jsonObj["wheel"];
        for (i = 0; i < wheelConfigs.length; ++i) {
            var wheelConfig = new WheelConfig();
            wheelConfig.unmarshal(wheelConfigs[i]);
            this.wheelList.push(wheelConfig);
        }

        var shareConfigs = jsonObj["share"];
        for (i = 0; i < shareConfigs.length; ++i) {
            var shareConfig = new ShareConfig();
            shareConfig.unmarshal(shareConfigs[i]);
            this.shareList.push(shareConfig);
        }

        var dailyBonusConfigs = jsonObj["daily_bonus"];
        for (i = 0; i < dailyBonusConfigs.length; ++i) {
            var dailyBonusConfig = new DailyBonusConfig();
            dailyBonusConfig.unmarshal(dailyBonusConfigs[i]);
            if (dailyBonusConfig.type === BoostType.SKIN) {
                var getted = game.playerMan.hasSkin(dailyBonusConfig.arg1);
                if (getted) {
                    dailyBonusConfig.type = dailyBonusConfig.extra.type;
                    dailyBonusConfig.count = dailyBonusConfig.extra.count;
                    dailyBonusConfig.image = dailyBonusConfig.extra.image;
                }
            }

            this.dailyBonusList.push(dailyBonusConfig);
        }

        //var specialOfferJson = jsonObj["special_offer"];
        //var specialOfferConfig = new StoreConfig();
        //specialOfferConfig.unmarshal(specialOfferJson);
        //this.specialOfferCfg = specialOfferConfig;

        jsonObj = game.utils.loadJson("res/config/skins_config.json");
        var skinsConfigs = jsonObj["skins"];
        for (i = 0; i < skinsConfigs.length; ++i) {
            var skinConfig = new SkinConfig();
            skinConfig.unmarshal(skinsConfigs[i]);
            this.skinList.push(skinConfig);
        }

        jsonObj = game.utils.loadJson("res/config/task_config.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new TaskConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.taskList.push(taskConfig);
        }

        jsonObj = game.utils.loadJson("res/config/task_old_config.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new TaskOldConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.oldTaskList.push(taskConfig);
        }
    },

    getStoreList: function () {
        return this.storeList;
    },

    getStoreListWithoutFirstPurchase: function () {
        return this.storeListWithoutFirstPurchase;
    },

    getLevelList: function () {
        return this.levelList;
    },

    getLevelConfig: function (levelId) {
        return this.levelList[levelId - 1];
    },

    getOriginalLevelConfig: function (levelId) {
        return this.originalLevelList[levelId - 1];
    },

    getWheelList: function () {
        return this.wheelList;
    },

    getShareList: function () {
        return this.shareList;
    },

    getSkinList: function () {
        return this.skinList;
    },

    getTaskList: function () {
        return this.taskList;
    },

    getOldTaskList: function () {
        return this.oldTaskList;
    },

    getSkinCfg: function (skinId) {
        for (var i = 0; i < this.skinList.length; ++i) {
            if (skinId == this.skinList[i].id) {
                return this.skinList[i];
            }
        }
        return null;
    },

    getDailyBonusList: function () {
        return this.dailyBonusList;
    },

    getSpecialOfferCfg: function () {
        return this.specialOfferCfg;
    }

    //getPackage: function (packageId) {
    //    for (var i = 0; i < this.packageList.length; ++i) {
    //        if (this.packageList[i].id === packageId) {
    //            return this.packageList[i];
    //        }
    //    }
    //    return null;
    //}
});

LevelConfigMan._instance = null;
LevelConfigMan._firstUseInstance = true;

/**
 *
 * @returns {LevelConfigMan}
 */
LevelConfigMan.getInstance = function () {
    if (LevelConfigMan._firstUseInstance) {
        LevelConfigMan._firstUseInstance = false;
        LevelConfigMan._instance = new LevelConfigMan();
    }
    return LevelConfigMan._instance;
};

module.exports = LevelConfigMan;

},{"../enum/BoostType":89,"../enum/StoreType":97,"./DailyBonusConfig":37,"./LevelConfig":38,"./ShareConfig":39,"./SkinConfig":40,"./StoreConfig":41,"./TaskConfig":42,"./TaskOldConfig":43,"./WheelConfig":44}],37:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var DailyBonusConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = 0;
    //this.probability = 0;
    this.image = "";
    this.arg1 = "";
};

DailyBonusConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    //this.probability = jsonObj["probability"];
    this.image = jsonObj["image"];
    this.arg1 = jsonObj["arg1"];
    this.extra = jsonObj["extra"];
};

module.exports = DailyBonusConfig;


},{}],38:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */
var BrickConfig = require("./BrickConfig");

var LevelConfig = function () {
    this.lifeProbability = 0;
    this.boostProbability = 0;
    this.pixelWidth = 0;
    this.pixelHeight = 0;
    this.width = 0;
    this.height = 0;
    /**
     * @type {Array.<BrickConfig>}
     */
    this.obstacles = [];
    /**
     * @type {Array.<BrickConfig>}
     */
    this.bricks = [];
    this.starTime = 0;
};

LevelConfig.prototype.unmarshal = function (jsonObj) {
    this.lifeProbability = jsonObj["l"] || 0;
    this.boostProbability = jsonObj["b"] || 0;
    this.pixelWidth = jsonObj["pixelWidth"];
    this.pixelHeight = jsonObj["pixelHeight"];
    this.width = jsonObj["width"];
    this.height = jsonObj["height"];
    var i;
    var obstacles = jsonObj["obstacles"];
    for (i = 0; i < obstacles.length; ++i) {
        var obstacle = obstacles[i];
        var obstacleCfg = new BrickConfig();
        obstacleCfg.unmarshal(obstacle);
        this.obstacles.push(obstacleCfg);
    }

    var bricks = jsonObj["bricks"];
    for (i = 0; i < bricks.length; ++i) {
        var brick = bricks[i];
        var brickCfg = new BrickConfig();
        brickCfg.unmarshal(brick);
        this.bricks.push(brickCfg);
    }
    this.starTime = jsonObj["starTime"] || 0;
};

LevelConfig.prototype.getHardCfg = function () {
    var levelCfg = new LevelConfig();
    levelCfg.lifeProbability = this.lifeProbability;
    levelCfg.boostProbability = this.boostProbability * 0.85;
    levelCfg.pixelWidth = this.pixelWidth;
    levelCfg.pixelHeight = this.pixelHeight;
    levelCfg.width = this.width * 2;
    levelCfg.height = this.height * 2;
    levelCfg.obstacles = [];
    levelCfg.bricks = [];
    levelCfg.starTime = this.starTime;
    var i;
    for (i = 0; i < this.obstacles.length; ++i) {
        levelCfg.obstacles.push(this.obstacles[i].getHardCfg());
    }
    for (i = 0; i < this.bricks.length; ++i) {
        levelCfg.bricks.push(this.bricks[i].getHardCfg());
    }
    return levelCfg;
};

module.exports = LevelConfig;
},{"./BrickConfig":34}],39:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var ShareConfig = function () {
    this.id = 0;
    this.image = "";
    this.desc = "";
};

ShareConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.image = jsonObj["image"];
    this.desc = jsonObj["desc"];
};

ShareConfig.prototype.copy = function () {
    var config = new ShareConfig();
    config.id = this.id;
    config.image = this.image;
    config.desc = this.desc;
    return config;
};

module.exports = ShareConfig;


},{}],40:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var SkinConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.scale = 1;
};

SkinConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
};

module.exports = SkinConfig;


},{}],41:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var StoreConfig = function () {
    this.id = 0;
    this.type = 0;
    this.name = "";
    this.price = 0;
    this.count = 1;
    this.image = "";
    this.pid = "";
    this.key = "";
    this.hot = false;
    this.best = false;
    this.data = null;
    this.original_price = 0;
    this.discount_multi = 0;
    this.extra = 0;
};

StoreConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.name = jsonObj["name"];
    this.price = jsonObj["price"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.pid = jsonObj["pid"];
    if (cc.sys.os === cc.sys.OS_ANDROID) {
        this.pid = jsonObj["pid_gp"];
    }
    this.key = jsonObj["key"];
    this.hot = jsonObj["hot"];
    this.best = jsonObj["best"];
    this.data = jsonObj["data"] || {};
    this.original_price = jsonObj["original_price"];
    this.discount_multi = jsonObj["discount_multi"];
    this.extra = jsonObj["extra"] || 0;
};

module.exports = StoreConfig;


},{}],42:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var TaskConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = "";
    this.rewardCount = 0;
};

TaskConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.rewardCount = jsonObj["rewardCount"];
};

module.exports = TaskConfig;


},{}],43:[function(require,module,exports){

/**
 * Created by qinning on 2017/12/15.
 */

var TaskOldConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.scale = 1;
    this.type = 0;
};

TaskOldConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
};

module.exports = TaskOldConfig;


},{}],44:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var WheelConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = 0;
    this.probability = 0;
    this.image = "";
};

WheelConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.probability = jsonObj["probability"];
    this.image = jsonObj["image"];
};

module.exports = WheelConfig;


},{}],45:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var AdsReminderController = function () {
    BaseCCBController.call(this);

    this.spReminder = null;
    this.lbReminder = null;
};

game.utils.inherits(AdsReminderController, BaseCCBController);

AdsReminderController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.REWARDED_VIDEO_COUNT, this.onUpdateReminder, this);
};

AdsReminderController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.REWARDED_VIDEO_COUNT, this.onUpdateReminder, this);
    BaseCCBController.prototype.onExit.call(this);
};

AdsReminderController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.onUpdateReminder();
};

AdsReminderController.prototype.onUpdateReminder = function () {
    var count = game.config.rewardAdMaxCountPerDay - game.playerMan.getRewardAdPlaceCountPerDay();
    if (count < 0) {
        count = 0;
    }
    this.lbReminder.setString(count);
};

module.exports = AdsReminderController;
},{"../events/EventsName":98}],46:[function(require,module,exports){
//var SkinItemController = require("./SkinItemController");
//var ConfigMan = require("../config/ConfigMan");
//var EventsName = require("../events/EventsName");
//
//var GRID_SIZE = cc.size(350, 500);
//
//var StoreItemCellView = cc.TableViewCell.extend({
//    entity: null,
//    itemNode: null,
//    ctor: function () {
//        this._super();
//        this.itemNode = SkinItemController.createFromCCB();
//        this.addChild(this.itemNode);
//        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
//    },
//
//    initWith: function (entity, idx, inited) {
//        this.entity = entity;
//        this.itemNode.controller.initWith(entity, idx);
//    }
//});
var BoostType = require("../enum/BoostType");
var GameMan = require("../model/GameMan");

var BagController = function () {
    BaseCCBController.call(this);
    this.lbBoostName1 = null;
    this.lbBoostName2 = null;
    this.lbBoostDesc1 = null;
    this.lbBoostDesc2 = null;
    this.lbShareTips = null;
};

game.utils.inherits(BagController, BaseCCBController);

BagController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

BagController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

BagController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbBoostName1.setString(_("boost_split_title") + " X" + (game.playerMan.getBoostCount(BoostType.SPLIT)));
    this.lbBoostName2.setString(_("boost_new_title") + " X" + (game.playerMan.getBoostCount(BoostType.THREE_BALL)));
    this.lbBoostDesc1.setString(_("boost_split_desc"));
    this.lbBoostDesc2.setString(_("boost_new_desc"));
    this.lbShareTips.setString("");//_("bag_share_tips"));
    this.lbTitle.setString(_("bag_title"));
};

BagController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

BagController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    var share = GameMan.getInstance().getShareConfig();
    game.shareManager.wxShare(share, function (shared) {

    });
};

BagController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

BagController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

BagController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/bag_view.ccbi", null, "BagController", new BagController());
    return node;
};

module.exports = BagController;
},{"../enum/BoostType":89,"../model/GameMan":99}],47:[function(require,module,exports){
var GameMan = require("../model/GameMan");

var BoardController = function () {
    BaseCCBController.call(this);

    this.spCircle = null;
    this.ndBoard = null;
    this.spBall = null;
};

game.utils.inherits(BoardController, BaseCCBController);

BoardController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    GameMan.getInstance().updateSkin(this.spBall);
};

BoardController.prototype.initWith = function (ballWidth) {
    var scale = GameMan.getInstance().getCurrentSkinCfg().scale;
    this.spBall.scaleX = ballWidth / this.spBall.width * scale;
    this.spBall.scaleY = ballWidth / this.spBall.height * scale;
};

BoardController.prototype.hideBall = function () {
    this.spBall.visible = false;
};

BoardController.prototype.showBall = function () {
    this.spBall.visible = true;
};

BoardController.createFromCCB = function(ballWidth) {
    var node = game.utils.loadNodeFromCCB("res/game/board_view.ccbi", null, "BoardController", new BoardController());
    node.controller.initWith(ballWidth);
    return node;
};

module.exports = BoardController;
},{"../model/GameMan":99}],48:[function(require,module,exports){
var ConfigMan = require("../config/ConfigMan");
var DailyBonusItemController = require("./DailyBonusItemController");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");

var DailyBonusController = function () {
    BaseCCBController.call(this);
    this.DAILY_BONUS_COUNT = 7;
    this.DAILY_BONUS_TAG = 200;
    this.ndContainer = null;

    this.lblTitle = null;

    this.ndDailyBonus = null;

    this.btnDouble = null;
    this.btnClaim = null;

    this.lblClaim = null;
    this.lblDouble = null;

    this.dailyBonusNodes = [];

    //user data.
    this.configs = null;

    this.curConfig = null;

    this.claimed = false;
};

game.utils.inherits(DailyBonusController, BaseCCBController);

DailyBonusController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("daily_bonus_title"));
    this.lblClaim.setString(_("claim_title"));
    this.lblDouble.setString(_("double_title"));

    this.configs = ConfigMan.getInstance().getDailyBonusList();

    for (var i = 0; i < this.DAILY_BONUS_COUNT; ++i) {
        var node = this.ndDailyBonus.getChildByTag(this.DAILY_BONUS_TAG + i);
        var itemNode = DailyBonusItemController.createFromCCB();
        this.dailyBonusNodes.push(itemNode);
        node.addChild(itemNode);
    }

    this.initUI();
};

DailyBonusController.prototype.initUI = function () {
    var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
    var consecutiveDay = game.playerMan.checkConsecutiveLoginDay();
    var currentDayClaimed = lastClaimDay >= game.utils.getDayByTs(Date.now());
    consecutiveDay %= 7;
    consecutiveDay = consecutiveDay || 7;
    this.claimed = currentDayClaimed;

    this.btnClaim.enabled = !currentDayClaimed;
    this.btnDouble.enabled = !currentDayClaimed;

    cc.log("consecutiveDay:" + consecutiveDay + ",dailyBonusNodes length:" + this.dailyBonusNodes.length + ",currentDayClaimed:" + currentDayClaimed);
    for (var i = 1; i <= 7; ++i) {
        cc.log("initUI:" + i);
        var config = this.configs[i - 1];
        var node = this.dailyBonusNodes[i - 1];
        if (!node) {
            cc.log("daily bonus node is null:" + i);
            continue;
        }
        var controller = node.controller;
        if (!controller) {
            cc.log("daily bonus controller is null:" + i);
            continue;
        }
        if (i < consecutiveDay) {
            controller.initWith(config, i, false, true);
        }
        else if (i === consecutiveDay) {
            controller.initWith(config, i, true, currentDayClaimed);
            this.curConfig = config;
        }
        else {
            controller.initWith(config, i, false, false);
        }
    }

    if (consecutiveDay === 3) {
        this.btnDouble.enabled = false;
    }
};

DailyBonusController.prototype.popupClaimReward = function (config, double, callback) {
    //var count = double ? config.count * 2 : config.count;
    var param = double ? 2 : 1;
    var count = config.count;
    var splitCount = 0;
    var threeBallCount = 0;
    if (config.type === BoostType.SPLIT) {
        splitCount = count;
    } else if (config.type === BoostType.THREE_BALL) {
        threeBallCount = count;
    } else if (config.type === BoostType.GIFT) {
        splitCount = game.utils.randomNextIntInRange(2, 4);
        threeBallCount = game.utils.randomNextIntInRange(2, 4);
    } else if (config.type === BoostType.SKIN) {
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("skin_claimed"),
            function () {
                game.playerMan.setClaimedSkin(config.arg1);
                if (callback) {
                    callback();
                }
            }, config.image, 1);
        return;
    } else if (config.type === BoostType.DIAMOND) {
        var diamondCount = config.count;
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
            function () {
                game.playerMan.addDiamonds(diamondCount);
                if (callback) {
                    callback();
                }
            }, config.image, diamondCount);
        return;
    }
    splitCount = splitCount * param;
    threeBallCount = threeBallCount * param;
    StoreHelper.getInstance().popupBoostRewardDlg(splitCount, threeBallCount, function () {
        callback && callback();
    });
};

DailyBonusController.prototype.claimClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (!this.claimed) {
        var self = this;
        this.popupClaimReward(this.curConfig, false, function () {
            self.setClaimed();
        });
    }
    this.close();
};

DailyBonusController.prototype.doubleClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (!this.claimed) {
        var self = this;
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "shuangbeilibao" : "dailybonus", function (rewarded) {
            if (rewarded) {
                this.popupClaimReward(this.curConfig, true, function () {
                    self.setClaimed();
                });
                this.close();
            }
        }.bind(this));
    }
};

DailyBonusController.prototype.setClaimed = function () {
    game.playerMan.setLastClaimDailyBonusDay(game.utils.getDayByTs(Date.now()));
    this.claimed = true;
};

DailyBonusController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

DailyBonusController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

DailyBonusController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

DailyBonusController.prototype.onExit = function () {
};

DailyBonusController.createFromCCB = function() {
    cc.BuilderReader.registerController("DailyBonusItemController", new DailyBonusItemController());
    //cc.BuilderReader.registerController("TitleController", new TitleController());
    var node = game.utils.loadNodeFromCCB("res/menu/daily_bonus_view.ccbi", null, "DailyBonusController", new DailyBonusController());
    cc.BuilderReader._controllerClassCache["DailyBonusItemController"] = undefined;
    return node;
};

module.exports = DailyBonusController;
},{"../config/ConfigMan":36,"../enum/BoostType":89,"../model/StoreHelper":103,"./DailyBonusItemController":49}],49:[function(require,module,exports){
var BoostType = require("../enum/BoostType");

var DailyBonusItemController = function () {
    BaseCCBController.call(this);

    this.spBlack = null;
    this.spItem = null;
    this.spCurrent = null;
    this.spClaimed = null;
    this.lblCount = null;
    this.lblDay = null;

    this.dailyBonusCfg = null;
};

game.utils.inherits(DailyBonusItemController, BaseCCBController);

DailyBonusItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {DailyBonusConfig} data
 * @param {number} day
 * @param {boolean} current
 * @param {boolean} claimed
 */
//day, state, rewardObj, claimed
DailyBonusItemController.prototype.initWith = function (data, day, current, claimed) {
    this.dailyBonusCfg = data;

    if (data.type === BoostType.SKIN) {
        var getted = game.playerMan.hasSkin(data.arg1);
        if (getted) {
            data.type = data.extra.type;
            data.count = data.extra.count;
            data.image = data.extra.image;
        }
    }

    this.spBlack.visible = claimed;
    this.spItem.setSpriteFrame(data.image);
    //game.utils.scaleCCLabelBMFont(this.spItem, 59);
    if (!claimed) {
        this.spCurrent.visible = current;
    } else {
        this.spCurrent.visible = false;
    }

    this.spClaimed.visible = claimed;
    this.lblCount.setString("x" + data.count);
    this.lblDay.setString(game.utils.sprintf(_("day_title"), day));
};

DailyBonusItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

DailyBonusItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/daily_bonus_item_view.ccbi", null, "DailyBonusItemController", new DailyBonusItemController());
};

module.exports = DailyBonusItemController;
},{"../enum/BoostType":89}],50:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");

var FailController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    this.spFailCn = null;
    this.spFailEn = null;

    this.lblReward = null;
    //this.lblRelife = null;
    this.lblWheel = null;

    this.lblSkip = null;
};

game.utils.inherits(FailController, BaseCCBController);

FailController.prototype.onExit = function () {
    this._replayCallback = null;
    game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    this.removeNativeAd();
};

FailController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    this.showNativeAd();
};

FailController.prototype.onDialogPoped = function () {
    this.updateNativeAd();
};

FailController.prototype.onDialogClosed = function () {
    this.updateNativeAd();
};

FailController.prototype.updateNativeAd = function () {
    if (game.dialogManager.isTopestDialog(this.rootNode)) {
        this.showNativeAd();
    } else {
        this.removeNativeAd();
    }
};

FailController.prototype.showNativeAd = function () {
    game.adsManager.showNativeAd("fail", 0, 0);
};

FailController.prototype.removeNativeAd = function () {
    game.adsManager.removeNativeAd("fail");
};

FailController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblWheel.setString(_("lucky_wheel_title"));
    this.lblReward.setString(_("watch_ads_get_boosts"));
    this.lblSkip.setString(_("skip_level_title"));
    game.audioPlayer.playEffectByKey("fail");
};

FailController.prototype.initWith = function (replayCallback, skipCallback) {
    this._replayCallback = replayCallback;
    this._skipCallback = skipCallback;
};

FailController.prototype.onAnimEnd = function () {
};

FailController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    GameMan.getInstance().showAds(false);
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

FailController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    GameMan.getInstance().showAds(false);
    game.sceneMan.switchScene(game.sceneType.MENU);
};

FailController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    //game.sceneMan.switchScene(game.sceneType.MENU);
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "failgift" : "jili06", null, "FailAndWatchDiamondsAds");
};

FailController.prototype.relifeClicked = function (sender) {
    //game.audioPlayer.playEffectByKey("enter");
    //var StoreHelper = require("../model/StoreHelper");
    //StoreHelper.getInstance().checkAndShowRewardVideo(function () {
    //});
};

FailController.prototype.skipClicked = function (sender) {
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "tiaoguo01" : "skip", function (rewarded) {
        if (rewarded) {
            game.analyseManager.trackEvent("WatchAdsToSkipLevel", {"level": GameMan.getInstance().levelId});
            if (this._skipCallback) {
                this._skipCallback();
            }
        }
    }.bind(this));
};

FailController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupWheelDlg();
};

FailController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

FailController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

FailController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/fail_view.ccbi", null, "FailController", new FailController());
    return node;
};

module.exports = FailController;
},{"../model/GameMan":99,"../model/StoreHelper":103}],51:[function(require,module,exports){
var EventsName = require("../events/EventsName");
var BricksView = require("../view/BricksView");
var GameMan = require("../model/GameMan");
var BoostType = require("../enum/BoostType");
var HelpController = require("./HelpController");
var StoreType = require("../enum/StoreType");

var GameController = function () {
    BaseCCBController.call(this);
    this.LIFE_START_TAG = 100;
    this.LIFE_COUNT = 6;

    this.ndLifeNode = null;
    this.lbTime = null;
    this.lb3New = null;
    this.lb3Multiple = null;
    this._gameNode = null;
    this.ndHelp = null;

    this.ndBoost1 = null;
    this.ndBoost2 = null;

    this.ndLifeNodes = null;

    this.spTopProgress = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.lbLevel = null;

    this.spYellows = [];
    this.spBlacks = [];
};

game.utils.inherits(GameController, BaseCCBController);

GameController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.UPDATE_LEVEL, this.onUpdateLevel, this);
    game.eventDispatcher.addEventListener(EventsName.REFRESH_BOOST, this.onUpdateBoost, this);

    //this.ndBoost1.runAction();
};

GameController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.REFRESH_BOOST, this.onUpdateBoost, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_LEVEL, this.onUpdateLevel, this);
    this._gameCoreNode = null;
};

GameController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.ndLifeNodes = [];
    for (var i = 0; i < this.LIFE_COUNT; ++i) {
        var lifeNode = this.ndLifeNode.getChildByTag(this.LIFE_START_TAG + i);
        this.ndLifeNodes.push(lifeNode);
    }

    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];
    this.spBlacks = [this.spBlack1, this.spBlack2, this.spBlack3];

    var config = null;
    var levelId = null;
    if (window.isEditor) {
        config = game.gameMan.levelCfg;
        levelId = 0;
    } else {
        config = GameMan.getInstance().getCurConfig();
        levelId = GameMan.getInstance().levelId;
    }

    this._gameCoreNode = new BricksView(config, this);
    this._gameNode.addChild(this._gameCoreNode);

    this.lbLevel.setString(game.utils.sprintf(_("level_title"), levelId));

    this.updateLifeCount();
    this.updateBoost();

    var firstEnter = game.storageController.getItem("first_enter", "true");
    if (firstEnter === "true") {
        this.ndHelp.visible = true;
    } else {
        this.ndHelp.visible = false;
    }

    this.updateTime();
};

GameController.prototype.updateLifeCount = function () {
    var nowLifeCount = this._gameCoreNode.lifeCount;
    for (var i = 0; i < this.LIFE_COUNT; ++i) {
        var lifeNode = this.ndLifeNodes[i];
        if (lifeNode) {
            lifeNode.visible = (nowLifeCount > i);
        }
    }
};

GameController.prototype.onUpdateBoost = function () {
    this.updateBoost();
};

GameController.prototype.updateBoost = function () {
    this.lb3New.setString(game.playerMan.getBoostCount(BoostType.THREE_BALL));
    this.lb3Multiple.setString(game.playerMan.getBoostCount(BoostType.SPLIT));
};

GameController.prototype.updateTime = function () {
    var costTime = 0;
    if (this._gameCoreNode.eclipsedTime) {
        costTime = this._gameCoreNode.eclipsedTime / 1000;
    }
    this.lbTime.setString(game.utils.getLongFormatTime(costTime));

    var percent = GameMan.getInstance().getProgressPercent(costTime);
    this.spTopProgress.setPreferredSize(cc.size(150 * percent * 0.01, 8));
    var star = GameMan.getInstance().getCurrentStar(costTime);
    this.updateStar(star);
};

GameController.prototype.updateStar = function (star) {
    for (var i = 0; i < 3; ++i) {
        this.spYellows[i].visible = (star >= i + 1);
        this.spBlacks[i].visible = (star < i + 1);
    }
};

GameController.prototype.pauseClicked = function () {
    AudioHelper.playBtnSound();
    if (window.isEditor) {
        var EditorScene = require("../editor/scene/EditorScene");
        cc.director.runScene(new EditorScene());
    } else {
        this.showPause();
    }
};

GameController.prototype.showPause = function () {
    this._gameCoreNode.stop();
    var self = this;
    game.popupMan.popupPauseDlg(function () {
        self._gameCoreNode.resume();
    });
};

GameController.prototype.storeClicked = function () {
    AudioHelper.playBtnSound();
    this._gameCoreNode.stop();
    var self = this;
    game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
        self._gameCoreNode.resume();
    });
};

GameController.prototype.new3Clicked = function () {
    AudioHelper.playBtnSound();
    if (game.playerMan.useBoost(BoostType.THREE_BALL)) {
        this._gameCoreNode.useNew3BallBoost();
        this.updateBoost();
    } else {
        this._gameCoreNode.stop();
        //GameMan.getInstance().showAds();
        var self = this;
        game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
            self._gameCoreNode.resume();
        });
    }
};

GameController.prototype.multiple3Clicked = function () {
    AudioHelper.playBtnSound();
    if (game.playerMan.useBoost(BoostType.SPLIT)) {
        this._gameCoreNode.useSplitBallBoost();
        this.updateBoost();
    } else {
        this._gameCoreNode.stop();
        //GameMan.getInstance().showAds();
        var self = this;
        game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
            self._gameCoreNode.resume();
        });
    }
};

GameController.createFromCCB = function() {
    cc.BuilderReader.registerController("HelpController", new HelpController());
    var node = game.utils.loadNodeFromCCB("res/game/game_view.ccbi", null, "GameController", new GameController());
    cc.BuilderReader._controllerClassCache["HelpController"] = undefined;
    return node;
};

module.exports = GameController;
},{"../editor/scene/EditorScene":79,"../enum/BoostType":89,"../enum/StoreType":97,"../events/EventsName":98,"../model/GameMan":99,"../view/BricksView":109,"./HelpController":54}],52:[function(require,module,exports){
var GameMan = require("../model/GameMan");
var GameMode = require("../enum/GameMode");

var GameOverController = function () {
    BaseCCBController.call(this);
    this._bestScoreLabel = null;
    this._scoreLabel = null;

    this._iconEnglish = null;
    this._iconChinese = null;
    this._newRecordLabel = null;

    this._replayCallback = null;
};

game.utils.inherits(GameOverController, BaseCCBController);

GameOverController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this._newRecordLabel.visible = false;
};

GameOverController.prototype.initWith = function (percent, callback) {
    if (GameMan.getInstance().gameMode === GameMode.GAME_MODE_ENDLESS) {
        this._bestScoreLabel.setString(game.utils.sprintf(game.local.getValue("best_score_title"), game.playerMan.getBestScore()));
        this._scoreLabel.setString(percent);
        this._newRecordLabel.setString(game.local.getValue("new_record_title"));
        if (GameMan.getInstance().isNewRecord) {
            this._newRecordLabel.visible = true;
            this._newRecordLabel.runAction(cc.sequence(cc.fadeOut(0.3), cc.fadeIn(0.3)).repeatForever());
        }
    } else {
        this._bestScoreLabel.setString(game.utils.sprintf(game.local.getValue("level_title"), GameMan.getInstance().levelConfig.id));
        this._scoreLabel.setString(game.utils.sprintf("%d%%", percent));
    }
    this._replayCallback = callback;
};

GameOverController.prototype.homeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var reScene = new cc.TransitionFade(0.5, GameBridge.getMenuScene(), cc.color(255, 255, 255));
    cc.director.runScene(reScene);
};

GameOverController.prototype.replayClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

GameOverController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

GameOverController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getBestScore(), game.config.getPlatformDownloadUrl()));
};

GameOverController.prototype.popup = function () {
    //game.dialogManager.popup(this.rootNode);
    //game.dialogManager.popup(this.rootNode, {"overlayOpacity": 100});
    game.dialogManager.popup(this.rootNode, {"overlayColor": cc.color(243, 243, 243), "overlayOpacity": 210});
};

GameOverController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

GameOverController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/game_over_view.ccbi", null, "GameOverController", new GameOverController());
    return node;
};

module.exports = GameOverController;
},{"../enum/GameMode":90,"../model/GameMan":99}],53:[function(require,module,exports){
var GameMan = require("../model/GameMan");

var GameWinController = function () {
    BaseCCBController.call(this);
    this.YELLOW_COLOR = cc.color(254, 175, 25);

    this._nextNode = null;

    this._resultLabel = null;

    this._replayCallback = null;
    this._nextCallback = null;
};

game.utils.inherits(GameWinController, BaseCCBController);

GameWinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this._resultLabel.setString(game.local.getValue("mission_completed_title"));
    var hasNextLevel = GameMan.getInstance().hasNextLevel();
    if (!hasNextLevel) {
        this._nextNode.visible = false;
    }
};

GameWinController.prototype.initWith = function (callback, nextCallback) {
    this._replayCallback = callback;
    this._nextCallback = nextCallback;
};

GameWinController.prototype.homeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var reScene = new cc.TransitionFade(0.5, GameBridge.getMenuScene(), cc.color(255, 255, 255));
    cc.director.runScene(reScene);
};

GameWinController.prototype.nextClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._nextCallback) {
        this._nextCallback();
    }
    this.close();
};

GameWinController.prototype.replayClicked = function (sender) {
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

GameWinController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

GameWinController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getBestScore(), game.config.getPlatformDownloadUrl()));
};

GameWinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {"overlayColor": cc.color(243, 243, 243), "overlayOpacity": 210});
};

GameWinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

GameWinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/game_win_view.ccbi", null, "GameWinController", new GameWinController());
    return node;
};

module.exports = GameWinController;
},{"../model/GameMan":99}],54:[function(require,module,exports){


var HelpController = function () {
    BaseCCBController.call(this);
    this.lbHelpInfo = null;
};

game.utils.inherits(HelpController, BaseCCBController);

HelpController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbHelpInfo.setString(game.local.getValue("help_content"));
    this.lbHelpInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

module.exports = HelpController;
},{}],55:[function(require,module,exports){
var GameScene = require("../scene/GameScene");
var StoreHelper = require("../model/StoreHelper");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var LevelItemController = require("./LevelItemController");
var LevelConfigMan = require("../config/ConfigMan");
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");
var TitleController = require("./TitleController");

var GRID_SIZE = [137.5, 120];

var LevelItemCellView = cc.TableViewCell.extend({
    levelEntity: null,
    levelItemNode: null,
    ctor: function () {
        this._super();
        this.levelItemNode = LevelItemController.createFromCCB();
        this.addChild(this.levelItemNode);

        this.levelItemNode.setPosition(cc.p(GRID_SIZE[0] * 0.5, GRID_SIZE[1] * 0.5));
    },

    initWith: function (levelEntity, idx) {
        this.levelEntity = levelEntity;
        this.levelItemNode.controller.initWith(levelEntity, idx);
    },

    showAppearAnim: function () {
        this.levelItemNode.controller.showAppearAnim();
    },

    showDisappearAnim: function () {
        this.levelItemNode.controller.showDisappearAnim();
    }
});

var LevelController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;
    this.lbLevelName = null;

    //user data.
    this._levelList = null;
};

game.utils.inherits(LevelController, BaseCCBController);

LevelController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this._levelList = GameMan.getInstance().getLevelList();
    this.showLevelTableView();

    var userLevel = GameMan.getInstance().getPlayerLevel();
    if (userLevel > this._levelList.length) {
        userLevel = 1;
    }
    var curRow = 0;
    if (userLevel % this.numberOfGridsInCell() === 0) {
        curRow = Math.floor(userLevel / this.numberOfGridsInCell());
    } else {
        curRow = Math.floor(userLevel / this.numberOfGridsInCell()) + 1;
    }

    var yOffset = -(this.numberOfCellsInTableView() - curRow + 1) * this.gridSizeForTable().height +
        this._tableView.getViewSize().height;

    if (yOffset < this._tableView.minContainerOffset().y) {
        yOffset = this._tableView.minContainerOffset().y;
    } else if (yOffset >= this._tableView.maxContainerOffset().y) {
        yOffset = this._tableView.maxContainerOffset().y;
    }

    this._tableView.setContentOffset(cc.p(0, yOffset));
};

LevelController.prototype.showLevelTableView = function () {
    var size = this.ndContainer.getContentSize();
    this._tableView = new MultiColTableView(this, size, null);
    this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    this._tableView.setMultiTableViewDelegate(this);
    this._tableView.ignoreAnchorPointForPosition(false);
    this._tableView.setAnchorPoint(cc.p(0, 0));
    this.ndContainer.addChild(this._tableView);
    this._tableView.reloadData();
};

LevelController.prototype.scrollViewDidScroll = function (view) {
};

LevelController.prototype.scrollViewDidZoom = function (view) {
};

LevelController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new LevelItemCellView();
    }

    if (idx < this._levelList.length) {
        var levelEntity = this._levelList[idx];
        cell.initWith(levelEntity, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

LevelController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    if (this._levelList.length % gridsInCell === 0) {
        return Math.floor(this._levelList.length / gridsInCell);
    } else {
        return Math.floor(this._levelList.length / gridsInCell) + 1;
    }
};

LevelController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 4;
};

LevelController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(GRID_SIZE[0], GRID_SIZE[1]);
};

LevelController.prototype.gridTouched = function(table, grid) {
    //console.log("grid touched at index: " + grid.getIdx());
    AudioHelper.playBtnSound();
    if (grid.getIdx() < GameMan.getInstance().getPlayerLevel()) {
        if (this.clicked) {
            return;
        }
        this.clicked = true;
        GameMan.getInstance().chooseLevel(grid.getIdx() + 1);
        game.sceneMan.switchScene(game.sceneType.GAME);
    }
};

LevelController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.MENU);
};

LevelController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/level_view.ccbi", null, "LevelController", new LevelController());
    return node;
};

module.exports = LevelController;
},{"../../common/ext/MultiColTableView":12,"../config/ConfigMan":36,"../enum/LockStatus":92,"../model/GameMan":99,"../model/StoreHelper":103,"../scene/GameScene":104,"./LevelItemController":56,"./TitleController":76}],56:[function(require,module,exports){
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");

var LevelItemController = function () {
    BaseCCBController.call(this);

    this.lbLevel = null;
    this.spPlayed = null;
    this.spLocked = null;

    this.spCurrent = null;

    this.ndStar = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.spYellows = [];
    this.spBlacks = [];

    this.idx = 0;
};

game.utils.inherits(LevelItemController, BaseCCBController);

LevelItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];
    this.spBlacks = [this.spBlack1, this.spBlack2, this.spBlack3];
};

LevelItemController.prototype.showAppearAnim = function () {
    game.utils.randomScaleAnim(this.rootNode, 1, 0.8);
};

LevelItemController.prototype.showDisappearAnim = function () {
    this.rootNode.runAction(cc.scaleTo(0.4, 0));
};

/**
 * @param {LevelConfig} data
 * @param {number} idx
 */
LevelItemController.prototype.initWith = function (data, idx) {
    cc.log("LevelItemController initWith");
    this.idx = idx;
    this.lbLevel.setString(idx + 1);
    var level = idx + 1;

    this.spCurrent.visible = false;
    this.spLocked.visible = false;
    this.spPlayed.visible = false;
    this.ndStar.visible = false;
    this.lbLevel.visible = true;
    var curLevel = GameMan.getInstance().getPlayerLevel();
    if (curLevel === idx + 1) {
        this.spCurrent.visible = true;
        this.lbLevel.y = 0;
    } else if (curLevel > idx + 1) {
        this.spPlayed.visible = true;
        this.ndStar.visible = true;
        var star = 0;
        if (GameMan.getInstance().isHardMode()) {
            star = game.playerMan.getHardLevelStar(level) || 0;
        } else {
            star = game.playerMan.getLevelStar(level) || 0;
        }
        cc.log("LevelItemController star:" + star);
        for (var i = 0; i < 3; ++i) {
            this.spYellows[i].visible = (star >= i + 1);
            this.spBlacks[i].visible = (star < i + 1);
        }
        this.lbLevel.y = 11;
    } else {
        this.lbLevel.y = 0;
        //this.lbLevel.visible = false;
        this.spLocked.visible = true;
    }
};

LevelItemController.prototype.levelClicked = function () {
    AudioHelper.playBtnSound();
    if (this.idx < GameMan.getInstance().getPlayerLevel()) {
        GameMan.getInstance().chooseLevel(this.idx + 1);
        game.sceneMan.switchScene(game.sceneType.GAME);
    }
};

LevelItemController.prototype.getContentSize = function () {
    return this.spPlayed.getContentSize();
};

LevelItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/level_item_view.ccbi", null, "LevelItemController", new LevelItemController());
};

module.exports = LevelItemController;
},{"../enum/LockStatus":92,"../model/GameMan":99}],57:[function(require,module,exports){
var MenuScene = require("../scene/MenuScene");
var PlayerMan = require("../model/PlayerMan");
var StoreHelper = require("../model/StoreHelper");
var GameScene = require("../scene/GameScene");
var SceneType = require("../enum/SceneType");
var GameMan = require("../model/GameMan");
var SceneMan = require("../model/SceneMan");
var AdsReminderController = require("../controller/AdsReminderController");

var LoadingController = function () {
    BaseCCBController.call(this);
    this.bgEnSprite = null;
    this.bgCnSprite = null;
};

game.utils.inherits(LoadingController, BaseCCBController);

LoadingController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);

    cc.BuilderReader.registerController("AdsReminderController", new AdsReminderController());

    game.playerMan = PlayerMan.getInstance();
    game.playerMan.initData();

    var LogicMan = require("../../common/model/LogicMan");
    LogicMan.getInstance().startGame(true);

    game.sceneMan = SceneMan.getInstance();
    game.sceneType = SceneType;

    game.gameMan.init();
    game.gameMan.adjustSkinConfigs();

    game.analyseManager.trackEvent("Loading");
    var isFirstEnterGame = true;
    var firstOpenGame = game.storageController.getItem("firstOpenGame", "true");
    if (firstOpenGame != "true") {
        isFirstEnterGame = false;
    } else {
        game.storageController.setItem("firstOpenGame", "false");
    }

    var myLogo = game.utils.isSelfGame();

    cc.log("isFirstEnterGame:" + isFirstEnterGame);

    this.bgCnSprite.visible = false;
    this.bgEnSprite.visible = false;
    var sprite = myLogo ? this.bgCnSprite : this.bgEnSprite;
    sprite.visible = true;
    sprite.opacity = 0;
    sprite.runAction(cc.sequence(cc.fadeIn(0.5), cc.delayTime(2), cc.fadeOut(0.5), cc.callFunc(function () {
        if (isFirstEnterGame) {
            GameMan.getInstance().chooseLatestLevel();
            game.sceneMan.switchScene(game.sceneType.GAME);
            game.analyseManager.trackEvent("EnterFirstLevel");
            //game.sceneMan.switchScene(SceneType.GAME);
        } else {
            cc.director.runScene(new MenuScene());
        }
        setTimeout(function () {
            StoreHelper.getInstance().init();
        }, 1);
    }, this)));
};

LoadingController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

LoadingController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

LoadingController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/loading_view.ccbi", null, "LoadingController", new LoadingController());
    return node;
};

module.exports = LoadingController;
},{"../../common/model/LogicMan":24,"../controller/AdsReminderController":45,"../enum/SceneType":94,"../model/GameMan":99,"../model/PlayerMan":100,"../model/SceneMan":102,"../model/StoreHelper":103,"../scene/GameScene":104,"../scene/MenuScene":107}],58:[function(require,module,exports){
//var PackageScene = require("../scene/PackageScene");
//var StoreHelper = require("../model/StoreHelper");
//var LevelScene = require("../scene/LevelScene");
//var GameScene = require("../scene/GameScene");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");
var EventsName = require("../events/EventsName");

game.firstEnter = true;

var MenuController = function () {
    BaseCCBController.call(this);

    this.spPlayEn = null;
    this.spPlayCn = null;
    this.spLevelsEn = null;
    this.spLevelsCn = null;
    this.spIconEn = null;
    this.spIconCn = null;

    this._rankItem = null;
    this._supportItem = null;
    this._storeItem = null;
    this._rateItem = null;
    this._soundItem = null;

    this.spHardCn = null;
    this.spHardEn = null;

    this.spHardHint = null;

    this.btnGiftEn = null;
    this.btnGiftCn = null;

    this.btnWheelCn = null;
    this.btnWheelEn = null;

    this.spGiftBg = null;
    this.ndSpecialOffer = null;

    this.ndGifts = null;

    this.spSkinReminder = null;
};

game.utils.inherits(MenuController, BaseCCBController);

MenuController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    /*
    setTimeout(function () {
        var firstOpenGame = game.storageController.getItem("firstOpenGame", "true");
        if (firstOpenGame != "true") {
            if (game.firstEnter && GameMan.getInstance().isFreeWheel()) {
                game.popupMan.popupWheelDlg();
            }
        } else {
            game.storageController.setItem("firstOpenGame", "false");
        }
        game.firstEnter = false;
    }, 300);
    */
    setTimeout(function () {
        var firstOpenGame = game.storageController.getItem("firstOpenGame", "true");
        if (firstOpenGame != "true") {
            GameMan.getInstance().checkAutoPopup();
        } else {
            game.storageController.setItem("firstOpenGame", "false");
        }
    }, 300);
    this.updateSkinReminder();
    //this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SPECIAL_OFFER, this.updateSpeicialOffer, this);
    game.eventDispatcher.addEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    game.eventDispatcher.addEventListener(EventsName.TASK_UPDATE, this.updateSkinReminder, this);
};

MenuController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    game.eventDispatcher.removeEventListener(EventsName.TASK_UPDATE, this.updateSkinReminder, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_SPECIAL_OFFER, this.updateSpeicialOffer, this);
    game.eventDispatcher.removeEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
};

MenuController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    game.analyseManager.trackEvent("EnterMenu");
    //this.createClubButton();
    this.updateSoundItem();
    this.updateGiftItem();
    this.spPlayEn.visible = false;
    this.spPlayCn.visible = false;
    this.spLevelsEn.visible = false;
    this.spLevelsCn.visible = false;
    this.spIconEn.visible = false;
    this.spIconCn.visible = false;
    this.spHardCn.visible = false;
    this.spHardEn.visible = false;
    this.btnGiftEn.visible = false;
    this.btnGiftCn.visible = false;
    this.btnWheelCn.visible = false;
    this.btnWheelEn.visible = false;

    if (game.local.isChinese()) {
        this.spPlayCn.visible = true;
        this.spLevelsCn.visible = true;
        this.spIconCn.visible = true;
        this.spHardCn.visible = true;
        this.btnGiftCn.visible = true;
        this.btnWheelCn.visible = true;
    } else {
        this.spPlayEn.visible = true;
        this.spLevelsEn.visible = true;
        this.spIconEn.visible = true;
        this.spHardEn.visible = true;
        this.btnGiftEn.visible = true;
        this.btnWheelEn.visible = true;
    }
    this.ndGifts.visible = true;

    this.spGiftBg.runAction(cc.rotateBy(3, 360).repeatForever());
    this.updateSpeicialOffer();
    this.onUpdateDiamonds();
};

MenuController.prototype.updateSpeicialOffer = function () {
    this.ndSpecialOffer.visible = !GameMan.getInstance().isSpecialOfferPurchased();
};

MenuController.prototype.onUpdateDiamonds = function () {
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

MenuController.prototype.onUpdate = function () {
    this.updateGiftItem();
};

MenuController.prototype.updateGiftItem = function () {
    if (game.adsManager.isRewardVideoReady()) {
        this.ndGifts.visible = true;
    } else {
        this.ndGifts.visible = false;
    }
};

MenuController.prototype.updateSoundItem = function () {
    var isSoundOn = game.audioPlayer.isEffectOn();
    if (isSoundOn) {
        this._soundItem.setNormalImage(new cc.Sprite("#btn_sound_on.png"));
        this._soundItem.setSelectedImage(new cc.Sprite("#btn_sound_on.png"));
    } else {
        this._soundItem.setNormalImage(new cc.Sprite("#btn_sound_off.png"));
        this._soundItem.setSelectedImage(new cc.Sprite("#btn_sound_off.png"));
    }
};

MenuController.prototype.storeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.DIAMOND);
};

MenuController.prototype.diamondClicked = function (sender) {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.DIAMOND);
};

MenuController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getLevel(), game.config.getPlatformDownloadUrl()));
};

MenuController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

MenuController.prototype.supportClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.sendEmail(game.config.connectEmail,
        game.local.getValue("feed_back_title"), game.local.getValue("feed_back_content"));
};

MenuController.prototype.rateClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(game.config.getPlatformDownloadUrl());
};

MenuController.prototype.playClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    GameMan.getInstance().chooseLatestLevel();
    game.sceneMan.switchScene(game.sceneType.GAME);
};

MenuController.prototype.packageClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    GameMan.getInstance().setHardMode(false);
    game.sceneMan.switchScene(game.sceneType.LEVEL);
};

MenuController.prototype.soundClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.audioPlayer.setEffectOn(!game.audioPlayer.isEffectOn());
    game.audioPlayer.setMusicOn(!game.audioPlayer.isMusicOn());
    this.updateSoundItem();
};

MenuController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupWheelDlg();
};

MenuController.prototype.dailyBonusClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupDailyBonus();
};

MenuController.prototype.hardClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    game.storageController.setItem("hard_reminded", "false");
    this.spHardHint.visible = false;
    GameMan.getInstance().setHardMode(true);
    game.sceneMan.switchScene(game.sceneType.LEVEL);
};

MenuController.prototype.giftClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "shouye" : "jili04");
};

MenuController.prototype.taskClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("ClickTasks");
    game.popupMan.popupTaskDlg();

    game.storageController.setItem("click_task", "true");
    this.updateSkinReminder();
};

MenuController.prototype.updateSkinReminder = function () {
    var clickSkin = game.storageController.getItem("click_task", "false");
    if (clickSkin == "false") {
        this.spSkinReminder.visible = true;
    } else {
        if (GameMan.getInstance().hasCompletedTask()) {
            this.spSkinReminder.visible = true;
        } else {
            this.spSkinReminder.visible = false;
        }
    }
};

MenuController.prototype.specialOfferClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupSpeicialOffer();
};

MenuController.prototype.skinClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("ClickSkins");
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.SKIN);
};

MenuController.prototype.removeAdsClicked = function (sender) {
    var StoreType = require("../enum/StoreType");
    var StoreHelper = require("../model/StoreHelper");
    var removeAdEntity = StoreHelper.getInstance().getStoreEntityByType(StoreType.REMOVE_ADS);
    StoreHelper.getInstance().buyProduct(removeAdEntity);
};

MenuController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/menu_view.ccbi", null, "MenuController", new MenuController());
    return node;
};

MenuController.time = 0;

module.exports = MenuController;
},{"../enum/StoreType":97,"../events/EventsName":98,"../model/GameMan":99,"../model/StoreHelper":103}],59:[function(require,module,exports){


var NoticeController = function () {
    BaseCCBController.call(this);
    this._okItem = null;
    this._cancelItem = null;
    this._confirmItem = null;
    this._closeItem = null;
    this._infoLabel = null;

    this._okLabel = null;
    this._cancelLabel = null;
    this._confirmLabel = null;

    this.ndReward1 = null;
    this.ndReward2 = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;
    this.lbReward2Info = null;

    this.spReward = null;
    this.lbReward = null;
    this.lbRewardInfo = null;

    this.sprAd = null;

    this._okCallFunc = null;
    this._failCallFunc = null;
};

game.utils.inherits(NoticeController, BaseCCBController);

NoticeController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    //game.adsManager.showNativeAd("notice", 0, 0);
};

NoticeController.prototype.onExit = function () {
    //game.adsManager.removeNativeAd("notice");
    BaseCCBController.prototype.onExit.call(this);
};

NoticeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this._titleLabel.setString(game.local.getValue("notice_title"));
    this.ndReward1.visible = false;
    this.ndReward2.visible = false;
    this._infoLabel.visible = false;
    this.sprAd.visible = false;
};

NoticeController.prototype.initWithYes = function (info, okCallFunc) {
    this._infoLabel.visible = true;
    this._infoLabel.setString(info);
    this._infoLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._okCallFunc = okCallFunc;
    this._confirmItem.visible = true;
    this._okItem.visible = false;
    this._cancelItem.visible = false;
    this._okLabel.visible = false;
    this._cancelLabel.visible = false;
    this._closeItem.visible = false;
    this._confirmLabel.visible = true;
    this._confirmLabel.setString(game.local.getValue("confirm_info"));
    this._confirmLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

NoticeController.prototype.initWithYesNo = function (info, yesInfo, cancelInfo, okCallFunc, failCallFunc, showClose, isShowAds) {
    this._infoLabel.visible = true;
    this._infoLabel.setString(info);
    this._infoLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._okCallFunc = okCallFunc;
    this._failCallFunc = failCallFunc;
    if (this._confirmItem) {
        this._confirmItem.visible = false;
    }
    this._okItem.visible = true;
    this._cancelItem.visible = true;
    this._okLabel.visible = true;
    this._cancelLabel.visible = true;
    if (this._confirmLabel) {
        this._confirmLabel.visible = false;
    }
    this._okLabel.setString(yesInfo);
    this._cancelLabel.setString(cancelInfo);
    this._okLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._cancelLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._closeItem.visible = showClose;
    this.sprAd.visible = !!isShowAds;
    if (isShowAds) {
        this.rootNode.scheduleOnce(function () {
            game.utils.playCCBAnimation(this.rootNode, "loop");
        }.bind(this), 1);
    }
};

NoticeController.prototype.initWithRewardYes = function (info, okCallFunc, reward1Sprite, reward1Count,
                                                      reward2Sprite, reward2Count) {
    this._infoLabel.visible = false;
    var spriteFrame;
    if (reward1Sprite && reward2Sprite) {
        this.ndReward2.visible = true;
        this.lbReward2Info.setString(info);
        this.lbReward2Info.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward1.setSpriteFrame(spriteFrame);
        }
        this.lbReward1.setString("x" + reward1Count);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward2Sprite);
        if (spriteFrame) {
            this.spReward2.setSpriteFrame(spriteFrame);
        }
        this.lbReward2.setString("x" + reward2Count);
    } else {
        this.ndReward1.visible = true;
        this.lbRewardInfo.setString(info);
        this.lbRewardInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward.setSpriteFrame(spriteFrame);
        }
        this.lbReward.setString("x" + reward1Count);
    }

    this._okCallFunc = okCallFunc;
    this._confirmItem.visible = true;
    this._okItem.visible = false;
    this._cancelItem.visible = false;
    this._okLabel.visible = false;
    this._cancelLabel.visible = false;
    this._closeItem.visible = false;
    this._confirmLabel.visible = true;
    this._confirmLabel.setString(game.local.getValue("confirm_info"));
    this._confirmLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

NoticeController.prototype.okClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

NoticeController.prototype.cancelClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._failCallFunc) {
        this._failCallFunc();
    }
    this.close();
};

NoticeController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

NoticeController.prototype.confirmClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

NoticeController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

NoticeController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};


NoticeController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/notice_view.ccbi", null, "NoticeController", new NoticeController());
    return node;
};

NoticeController.createGuideFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/new_tip_view.ccbi", null, "NoticeController", new NoticeController());
    return node;
};

module.exports = NoticeController;
},{}],60:[function(require,module,exports){
var GameScene = require("../scene/GameScene");
var StoreHelper = require("../model/StoreHelper");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var PackageItemController = require("./PackageItemController");
var LevelConfigMan = require("../config/ConfigMan");
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");
var LevelScene = require("../scene/LevelScene");
var TitleController = require("./TitleController");

//var CELL_WIDTH = 520;

var PackageItemCellView = cc.TableViewCell.extend({
    packageEntity: null,
    packageItemNode: null,

    ctor: function () {
        this._super();
        this.packageItemNode = PackageItemController.createFromCCB();
        this.addChild(this.packageItemNode);
        var size = this.packageItemNode.controller.getContentSize();
        this.packageItemNode.setPosition(cc.p(cc.winSize.width * 0.5, size.height * 0.5));
    },

    initWith: function (packageEntity, idx) {
        cc.log("PackageItemCellView initWith:idx:" + idx);
        this.packageEntity = packageEntity;
        this.packageItemNode.controller.initWith(packageEntity, idx);
    },

    refresh: function () {
        this.packageItemNode.controller.refresh();
    },

    showAppearAnim: function () {
        this.packageItemNode.controller.showAppearAnim(false);
    },

    showDisappearAnim: function () {
        this.packageItemNode.controller.showDisappearAnim();
    }
});

var PackageController = function () {
    BaseCCBController.call(this);
    this.lbChapterName = null;
    this.ndContainer = null;
    this.lbLevelName = null;
    this._tableView = null;

    //user data.
    this.packageConfigs = null;
};

game.utils.inherits(PackageController, BaseCCBController);

PackageController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.packageConfigs = LevelConfigMan.getInstance().getPackageList();

    this.showLevelTableView();

    var packageId = 1;
    var packageInfo = GameMan.getInstance().getMinUnCompletedPackage();
    if (!packageInfo || (packageInfo.id > this.packageConfigs.length)) {
        packageId = 1;
    } else {
        packageId = packageInfo.id;
    }
    cc.log("packageId:" + packageId);
    var curRow = 0;
    if (packageId % this.numberOfGridsInCell() === 0) {
        curRow = Math.floor(packageId / this.numberOfGridsInCell());
    } else {
        curRow = Math.floor(packageId / this.numberOfGridsInCell()) + 1;
    }

    var yOffset = -(this.numberOfCellsInTableView() - curRow + 1) * this.gridSizeForTable().height +
        this._tableView.getViewSize().height;

    if (yOffset < this._tableView.minContainerOffset().y) {
        yOffset = this._tableView.minContainerOffset().y;
    } else if (yOffset >= this._tableView.maxContainerOffset().y) {
        yOffset = this._tableView.maxContainerOffset().y;
    }

    this._tableView.setContentOffset(cc.p(0, yOffset));

    for (var i = 0; i < this.numberOfCellsInTableView(); ++i) {
        var cell = this._tableView.getGridAtIndex(i);
        if (cell) {
            cell.showAppearAnim();
        }
    }

    this.lbLevelName.setString(game.local.getValue("package_title"));
};

PackageController.prototype.showLevelTableView = function () {
    this._tableView = new MultiColTableView(this, this.ndContainer.getContentSize(), null);
    this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    this._tableView.setMultiTableViewDelegate(this);
    this._tableView.ignoreAnchorPointForPosition(false);
    this._tableView.setAnchorPoint(cc.p(0, 0));
    this.ndContainer.addChild(this._tableView);
    this._tableView.reloadData();
};

PackageController.prototype.scrollViewDidScroll = function (view) {
};

PackageController.prototype.scrollViewDidZoom = function (view) {
};

PackageController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new PackageItemCellView();
    }

    if (idx < this.packageConfigs.length) {
        var packageConfig = this.packageConfigs[idx];
        cell.initWith(packageConfig, idx, this.inited);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

PackageController.prototype.numberOfCellsInTableView = function(multiTable) {
    return this.packageConfigs.length;
};

PackageController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 1;
};

PackageController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(cc.winSize.width, 143);
};

PackageController.prototype.gridTouched = function(table, grid) {
    cc.log("grid touched at index: " + grid.getIdx());
    var packageEntity = grid.packageEntity;
    AudioHelper.playBtnSound();
    if (packageEntity.isLocked()) {
        game.popupMan.popupYesNoCommonDlg(game.utils.sprintf(game.local.getValue("unlock_info"), packageEntity.unlockCount),
            game.local.getValue("unlock_title"),
            game.local.getValue("cancel_title"),
            function () {
            if (game.playerMan.player.coins >= packageEntity.unlockCount) {
                game.playerMan.addCoins(-packageEntity.unlockCount);
                game.playerMan.setPackageUnlocked(packageEntity.id);
                grid.refresh();
            } else {
                game.popupMan.popupStoreDlg();
            }
        });
    } else {
        this.showCloseAnim(function () {
            GameMan.getInstance().setPackageEntity(packageEntity);
            game.sceneMan.switchScene(game.sceneType.LEVEL);
        });
    }
};

PackageController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.showCloseAnim(function () {
        game.sceneMan.switchScene(game.sceneType.MENU);
    });
};

PackageController.prototype.showCloseAnim = function (callback) {
    for (var i = 0; i < this.numberOfCellsInTableView(); ++i) {
        var cell = this._tableView.getGridAtIndex(i);
        if (cell) {
            cell.showDisappearAnim();
        }
    }
    this.rootNode.scheduleOnce(function () {
        if (callback) {
            callback();
        }
    }.bind(this), 0.8);
};

PackageController.createFromCCB = function() {
    cc.BuilderReader.registerController("TitleController", new TitleController());
    var node = game.utils.loadNodeFromCCB("res/menu/package_view.ccbi", null, "PackageController", new PackageController());
    cc.BuilderReader._controllerClassCache["TitleController"] = undefined;
    return node;
};

module.exports = PackageController;
},{"../../common/ext/MultiColTableView":12,"../config/ConfigMan":36,"../enum/LockStatus":92,"../model/GameMan":99,"../model/StoreHelper":103,"../scene/GameScene":104,"../scene/LevelScene":105,"./PackageItemController":61,"./TitleController":76}],61:[function(require,module,exports){
var LockStatus = require("../enum/LockStatus");

var PackageItemController = function () {
    BaseCCBController.call(this);
    this.lbName = null;
    this.lbCount = null;

    this.spBg = null;

    this.spCompleted = null;
    this.spUnCompleted = null;

    this.ndLock = null;
    this.lbUnlockCount = null;

    this.packageEntity = null;

    this.idx = 0;
};

game.utils.inherits(PackageItemController, BaseCCBController);

PackageItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

PackageItemController.prototype.showAppearAnim = function (inited) {
    //if (!inited) {
        this.rootNode.stopAllActions();
        game.utils.playCCBAnimation(this.rootNode, "left");
        this.rootNode.scheduleOnce(function () {
            game.utils.playCCBAnimation(this.rootNode, "normal");
        }.bind(this), this.idx * 0.05);
    //} else {
    //    game.utils.playCCBAnimation(this.rootNode, "none");
    //}
};

PackageItemController.prototype.showDisappearAnim = function () {
    this.rootNode.stopAllActions();
    this.rootNode.scheduleOnce(function () {
        game.utils.playCCBAnimation(this.rootNode, "disappear");
    }.bind(this), this.idx * 0.05);
};

/**
 * @param {PackageConfig} data
 * @param {number} idx
 */
PackageItemController.prototype.initWith = function (data, idx) {
    this.packageEntity = data;
    this.idx = idx;
    this.refresh();
    game.utils.playCCBAnimation(this.rootNode, "none");
};

PackageItemController.prototype.refresh = function () {
    this.lbName.setString(game.local.getValue(game.utils.sprintf("package_%d", this.idx + 1)));
    var maxLevel = game.playerMan.getPackageUnlockLevel(this.packageEntity.id) + 1;
    if (maxLevel > this.packageEntity.count) {
        maxLevel = this.packageEntity.count;
    }
    this.lbCount.setString(maxLevel + "/" + this.packageEntity.count);
    this.spBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(this.packageEntity.image));
    this.spCompleted.visible = false;
    this.spUnCompleted.visible = false;
    if (maxLevel === this.packageEntity.count) {
        this.spCompleted.visible = true;
    } else {
        this.spUnCompleted.visible = true;
    }
    if (this.packageEntity.isLocked()) {
        this.ndLock.visible = true;
        this.lbUnlockCount.setString(this.packageEntity.unlockCount);
    } else {
        this.ndLock.visible = false;
    }

    if (!game.local.isChinese()) {
        this.lbName.setScale(1.0);
    }
};

PackageItemController.prototype.getContentSize = function () {
    return this.spBg.getContentSize();
};

PackageItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/package_item_view.ccbi", null, "PackageItemController", new PackageItemController());
};

module.exports = PackageItemController;
},{"../enum/LockStatus":92}],62:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");

var PassController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    //this.spWinCn = null;
    //this.spWinEn = null;

    this.ndWheel = null;

    this.lblReward = null;
    this.lblWheel = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.spYellows = [];
    //this.spBlacks = [];
};

game.utils.inherits(PassController, BaseCCBController);

PassController.prototype.onExit = function () {
    this._replayCallback = null;
    this._nextCallback = null;
    game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    this.removeNativeAd();
};

PassController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    this.showNativeAd();
};

PassController.prototype.onDialogPoped = function () {
    this.updateNativeAd();
};

PassController.prototype.onDialogClosed = function () {
    this.updateNativeAd();
};

PassController.prototype.updateNativeAd = function () {
    if (game.dialogManager.isTopestDialog(this.rootNode)) {
        this.showNativeAd();
    } else {
        this.removeNativeAd();
    }
};

PassController.prototype.showNativeAd = function () {
    game.adsManager.showNativeAd("pass", 0, 0);
};

PassController.prototype.removeNativeAd = function () {
    game.adsManager.removeNativeAd("pass");
};

PassController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.lblReward.setString(_("watch_ads_get_boosts"));
    this.lblWheel.setString(_("lucky_wheel_title"));

    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];

    var star = GameMan.getInstance().currentStar;
    for (var i = 0; i < 3; ++i) {
        this.spYellows[i].visible = (star >= i + 1);
    }

    for (i = 0; i < star; ++i) {
        setTimeout(function (index) {
            return function () {
                game.audioPlayer.playEffectByKey("star_" + (index + 1));
            };
        }(i), 250 * (i + 1));
    }
};

PassController.prototype.initWith = function (replayCallback, nextCallback) {
    this._replayCallback = replayCallback;
    this._nextCallback = nextCallback;
};

PassController.prototype.onAnimEnd = function () {
    // GameMan.getInstance().showAdsAndRate(true);
};

PassController.prototype.nextClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    GameMan.getInstance().showAdsAndRate(true);
    if (this._nextCallback) {
        this._nextCallback();
    }
    GameMan.getInstance().showRegisterNotification();
    this.close();
};

PassController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    GameMan.getInstance().showAdsAndRate(true);
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

PassController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    GameMan.getInstance().showAdsAndRate(true);
    game.sceneMan.switchScene(game.sceneType.MENU);
};

PassController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "wingift" : "jili05", null, "WinAndWatchDiamondsAds");
};

PassController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupWheelDlg();
};

PassController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PassController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PassController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pass_view.ccbi", null, "PassController", new PassController());
    return node;
};

module.exports = PassController;
},{"../model/GameMan":99,"../model/StoreHelper":103}],63:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var AdsPlace = require("../../common/enum/AdsPlace");

var PauseController = function () {
    BaseCCBController.call(this);
    this.lblReward = null;

    this._replayCallback = null;
    this._nextCallback = null;
};

game.utils.inherits(PauseController, BaseCCBController);

PauseController.prototype.onExit = function () {
    this._resumeCallback = null;
    game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    this.removeNativeAd();
};

PauseController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    this.showNativeAd();
};

PauseController.prototype.onDialogPoped = function () {
    this.updateNativeAd();
};

PauseController.prototype.onDialogClosed = function () {
    this.updateNativeAd();
};

PauseController.prototype.updateNativeAd = function () {
    if (game.dialogManager.isTopestDialog(this.rootNode)) {
        this.showNativeAd();
    } else {
        this.removeNativeAd();
    }
};

PauseController.prototype.showNativeAd = function () {
    game.adsManager.showNativeAd("pause", 0, 99);
};

PauseController.prototype.removeNativeAd = function () {
    game.adsManager.removeNativeAd("pause");
};

PauseController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblReward.setString(_("watch_ads_get_boosts"));
};

PauseController.prototype.initWith = function (resumeCallback) {
    this._resumeCallback = resumeCallback;
};

PauseController.prototype.resumeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (this._resumeCallback) {
        this._resumeCallback();
    }
    this.close();
};

PauseController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.analyseManager.trackEvent("PauseHome");
    game.popupMan.popupYesNoCommonDlg(_("exit_game_confirm"), _("yes_title"), _("no_title"), function () {
        game.sceneMan.switchScene(game.sceneType.MENU);
        if (game.playerMan.getLevel() >= 4) {
            game.adsManager.showInterstitial(AdsPlace.Home);
        }
    });
};

PauseController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.sceneMan.switchScene(game.sceneType.GAME);
    game.adsManager.showInterstitial(AdsPlace.Refresh);
    game.analyseManager.trackEvent("PauseRetry");
};

PauseController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "pause" : "pause");
};

PauseController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PauseController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PauseController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pause_view.ccbi", null, "PauseController", new PauseController());
    return node;
};

module.exports = PauseController;
},{"../../common/enum/AdsPlace":9,"../model/StoreHelper":103}],64:[function(require,module,exports){
//var SkinItemController = require("./SkinItemController");
//var ConfigMan = require("../config/ConfigMan");
//var EventsName = require("../events/EventsName");
//
//var GRID_SIZE = cc.size(350, 500);
//
//var StoreItemCellView = cc.TableViewCell.extend({
//    entity: null,
//    itemNode: null,
//    ctor: function () {
//        this._super();
//        this.itemNode = SkinItemController.createFromCCB();
//        this.addChild(this.itemNode);
//        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
//    },
//
//    initWith: function (entity, idx, inited) {
//        this.entity = entity;
//        this.itemNode.controller.initWith(entity, idx);
//    }
//});
var RankType = require("../enum/RankType");

var RankController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;
    this.lblTitle = null;

    this.rankType = 0;

    this.updateCount = 0;
};

game.utils.inherits(RankController, BaseCCBController);

RankController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    //this.rootNode.schedule(this.onUpdate.bind(this));
    this.intervalKey = setInterval(this.onUpdate.bind(this), 500);
};

RankController.prototype.onExit = function () {
    //this.rootNode.unschedule(this.onUpdate.bind(this));
    clearInterval(this.intervalKey);
    if (this.closeCallback) {
        this.closeCallback();
    }
    this.closeCallback = null;
    BaseCCBController.prototype.onExit.call(this);
};

RankController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    ////onewx.social.loadShareCanvas(this.ndContainer);
    //this.onUpdate(0);
};

RankController.prototype.init = function (rankType, closeCallback) {
    this.rankType = rankType;
    this.closeCallback = closeCallback;
    if (rankType === RankType.Friends) {
        this.lblTitle.setString(game.local.getValue("friends_rank_title"));
    } else {
        this.lblTitle.setString(game.local.getValue("group_rank_title"));
    }
    if (this.rankType === RankType.Friends) {
        onewx.social.initFriend();
    } else {
        onewx.social.initGroup();
    }
    this.refreshRank();
};

RankController.prototype.refreshRank = function () {
    this.updateCount = 0;
    this.onUpdate(0);
};

RankController.prototype.onUpdate = function () {
    if (this.updateCount <= 10) {
        onewx.social.loadShareCanvas(this.ndContainer);
        this.updateCount++;
    }
};

RankController.prototype.prevClicked = function (sender) {
    AudioHelper.playBtnSound();
    onewx.social.onPageChange(this.ndContainer, -1);
    this.refreshRank();
};

RankController.prototype.nextClicked = function (sender) {
    AudioHelper.playBtnSound();
    onewx.social.onPageChange(this.ndContainer, 1);
    this.refreshRank();
};

RankController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

RankController.prototype.challengeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.GAME);
};

RankController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RankController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RankController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/rank_view.ccbi", null, "RankController", new RankController());
    return node;
};

module.exports = RankController;
},{"../enum/RankType":93}],65:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var RewardDoubleController = function () {
    BaseCCBController.call(this);

    this._titleLabel = null;

    this.lbReward = null;
    this.spReward = null;
    this.spRewardBg = null;

    this.btnCloseCn = null;
    this.btnCloseEn = null;

    this.lbDouble = null;

    this.closeCallback = null;

    this.doubled = false;
};

game.utils.inherits(RewardDoubleController, BaseCCBController);

RewardDoubleController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.btnCloseCn.visible = false;
    this.btnCloseEn.visible = false;
    //this.spTitleCn.visible = false;
    //this.spTitleEn.visible = false;
    if (game.local.isChinese()) {
        this.btnCloseCn.visible = true;
        //this.spTitleCn.visible = true;
    } else {
        this.btnCloseEn.visible = true;
        //this.spTitleEn.visible = true;
    }
    this.lbDouble.setString(_("double_rewards"));
};

RewardDoubleController.prototype.init = function (image, count, closeCallback) {
    console.log("RewardDoubleController.prototype.init");
    this.spReward.setSpriteFrame(image);
    this.lbReward.setString("X" + count);
    this.closeCallback = closeCallback;

    this.spRewardBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

RewardDoubleController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardDoubleController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "zhuanpan02" : "jili02", function (rewarded) {
        if (rewarded) {
            self.doubled = true;
            self.close();
        }
    });
};

RewardDoubleController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 210});
};

RewardDoubleController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.doubled);
        this.closeCallback = null;
    }
};

RewardDoubleController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_double_view.ccbi", null, "RewardDoubleController", new RewardDoubleController());
    return node;
};

module.exports = RewardDoubleController;
},{"../model/StoreHelper":103}],66:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var BoostType = require("../enum/BoostType");

var RewardGiftController = function () {
    BaseCCBController.call(this);

    this.lbTitle = null;

    this.lbTips = null;
    this.lbButton = null;

    this.closeCallback = null;
};

game.utils.inherits(RewardGiftController, BaseCCBController);

RewardGiftController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbTitle.setString(_("gift_title"));
    this.lbTips.setString(_("gift_tips"));
    this.lbButton.setString(_("gift_button"));

    //this.lbTips.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

RewardGiftController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

RewardGiftController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardGiftController.prototype.giftClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    var share = GameMan.getInstance().getShareConfig();
    game.shareManager.wxGroupShare(share, "gift_share", function (shared) {
        if (shared) {
            var splitCount = game.utils.randomNextIntInRange(2, 3);
            var threeBallCount = game.utils.randomNextIntInRange(2, 3);
            StoreHelper.getInstance().popupBoostRewardDlg(splitCount, threeBallCount, function () {
                self.close();
            });
        } else {
            game.utils.showWXToast("需要分享到群");
        }
    });
};

RewardGiftController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 210});
};

RewardGiftController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

RewardGiftController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_gift_view.ccbi", null, "RewardGiftController", new RewardGiftController());
    return node;
};

module.exports = RewardGiftController;
},{"../enum/BoostType":89,"../model/GameMan":99,"../model/StoreHelper":103}],67:[function(require,module,exports){


var RewardNoticeController = function () {
    BaseCCBController.call(this);
    this.ndReward1 = null;
    this.ndReward2 = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;

    this.spReward = null;
    this.lbReward = null;

    this.lblOk = null;

    this._okCallFunc = null;
};

game.utils.inherits(RewardNoticeController, BaseCCBController);

RewardNoticeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.ndReward1.visible = false;
    this.ndReward2.visible = false;

    game.audioPlayer.playEffectByKey("get_diamonds");

    //this.spBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

RewardNoticeController.prototype.initWithRewardYes = function (info, okCallFunc, reward1Sprite, reward1Count,
                                                      reward2Sprite, reward2Count) {
    var spriteFrame;
    if (reward1Sprite && reward2Sprite) {
        this.ndReward2.visible = true;
        //this.lbReward2Info.setString(info);
        //this.lbReward2Info.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward1.setSpriteFrame(spriteFrame);
        }
        this.lbReward1.setString("x" + reward1Count);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward2Sprite);
        if (spriteFrame) {
            this.spReward2.setSpriteFrame(spriteFrame);
        }
        this.lbReward2.setString("x" + reward2Count);
    } else {
        this.ndReward1.visible = true;
        //this.lbRewardInfo.setString(info);
        //this.lbRewardInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward.setSpriteFrame(spriteFrame);
        }
        this.lbReward.setString("x" + reward1Count);
    }

    this.lblOk.setString(game.local.getValue("confirm_info"));
    this._okCallFunc = okCallFunc;
};

RewardNoticeController.prototype.okClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

RewardNoticeController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RewardNoticeController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RewardNoticeController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_notice_view.ccbi", null, "RewardNoticeController", new RewardNoticeController());
    return node;
};

module.exports = RewardNoticeController;
},{}],68:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var RewardVideoController = function () {
    BaseCCBController.call(this);

    this._titleLabel = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;
    this.lbReward2Info = null;
    this.lblFree = null;

    this.closeCallback = null;
};

game.utils.inherits(RewardVideoController, BaseCCBController);

RewardVideoController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbReward1.setString("X1");
    this.lbReward2.setString("X1");
    this.lbReward2Info.setString(game.local.getValue("watch_ads_tips"));
    this._titleLabel.setString(game.local.getValue("watch_ads_title"));
    this.lblFree.setString(_("free_coins_title"));
};

RewardVideoController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

RewardVideoController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardVideoController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "jili03-IOS" : "jili03");
};

RewardVideoController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RewardVideoController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

RewardVideoController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_video_view.ccbi", null, "RewardVideoController", new RewardVideoController());
    return node;
};

module.exports = RewardVideoController;
},{"../model/StoreHelper":103}],69:[function(require,module,exports){
var SkinItemController = require("./SkinItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");

var GRID_SIZE = cc.size(270, 200);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = SkinItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var SkinController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;

    this.lblTitle = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(SkinController, BaseCCBController);

SkinController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

SkinController.prototype.onExit = function () {
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};

SkinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("skin_title"));

    this.configs = ConfigMan.getInstance().getSkinList();
    this.showTableView();
};

SkinController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

SkinController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

SkinController.prototype.scrollViewDidScroll = function (view) {
};

SkinController.prototype.scrollViewDidZoom = function (view) {
};

SkinController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

SkinController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

SkinController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 2;
};

SkinController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(270, 220);
};

SkinController.prototype.gridTouched = function(table, grid) {
};

SkinController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

SkinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

SkinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

SkinController.prototype.onExit = function () {
    //if (this.closeCallback) {
    //    this.closeCallback();
    //    this.closeCallback = null;
    //}
};

SkinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/skin_view.ccbi", null, "SkinController", new SkinController());
    return node;
};

module.exports = SkinController;
},{"../../common/ext/MultiColTableView":12,"../config/ConfigMan":36,"../events/EventsName":98,"./SkinItemController":70}],70:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");

var SkinItemController = function () {
    BaseCCBController.call(this);

    this.ndPurchase = null;
    this.ndOwned = null;

    this.lbDiamondPrice = null;
    this.lbUsing = null;

    this.spSkin = null;

    this.idx = 0;
    this.skinCfg = null;
};

game.utils.inherits(SkinItemController, BaseCCBController);

SkinItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

SkinItemController.prototype.onEnter = function() {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

SkinItemController.prototype.onExit = function() {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};
/**
 * @param {SkinConfig} data
 * @param {number} idx
 */
SkinItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.skinCfg = data;
    //var completed = false;

    try {
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
        this.spSkin.setSpriteFrame(spriteFrame);

        this.ndPurchase.visible = false;
        this.ndOwned.visible = false;

        var owned = game.playerMan.hasSkin(this.skinCfg.id);
        if (owned) {
            this.ndOwned.visible = true;
            if (data.id === game.playerMan.getCurrentSkinId()) {
                this.lbUsing.setString(_("selected_title"));
            } else {
                this.lbUsing.setString(_("select_title"));
            }
        } else {
            this.ndPurchase.visible = true;
            this.lbDiamondPrice.setString(this.skinCfg.count);
        }
    } catch (ex) {
        cc.error(ex);
    }
};

SkinItemController.prototype.onUpdateSkin = function () {
    this.initWith(this.skinCfg, this.idx);
};

SkinItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

SkinItemController.prototype.purchaseClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buySkin(this.skinCfg);
};

SkinItemController.prototype.selectClicked = function () {
    AudioHelper.playBtnSound();
    game.playerMan.setCurrentSkinId(this.skinCfg.id);
    game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
};

SkinItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/skin_item_view.ccbi", null, "SkinItemController", new SkinItemController());
};

module.exports = SkinItemController;
},{"../enum/SkinRewardType":96,"../events/EventsName":98,"../model/StoreHelper":103}],71:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");

var SpecialOfferController = function () {
    BaseCCBController.call(this);

    this.lbTitle = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    //this.spReward2 = null;
    //this.lbReward2 = null;
    this.lbLeftTime = null;

    this.lblOriginalPrice = null;
    this.lbPrice = null;
    this.lblDiscount = null;

    this.btnPurchase = null;

    /**
     * @type {StoreConfig}
     */
    this.specialOfferCfg = null;
};

game.utils.inherits(SpecialOfferController, BaseCCBController);

SpecialOfferController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.PURCHASE_END, this.onPurchaseEnd, this);
};

SpecialOfferController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.PURCHASE_END, this.onPurchaseEnd, this);
    BaseCCBController.prototype.onExit.call(this);
};

SpecialOfferController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.specialOfferCfg = ConfigMan.getInstance().getSpecialOfferCfg();
    this.lbTitle.setString(_("special_offer_title"));
    this.lbReward1.setString("x" + this.specialOfferCfg.data.diamonds);

    this.lbPrice.setString(this.specialOfferCfg.price);
    this.lblOriginalPrice.setString(this.specialOfferCfg.original_price);
    this.lblDiscount.setString(game.utils.sprintf(_("more_title"), "" + (this.specialOfferCfg.discount_multi * 100)));
};

SpecialOfferController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

SpecialOfferController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

SpecialOfferController.prototype.onPurchaseEnd = function (event) {
    var success = event.getUserData();
    if (success) {
        this.close();
    } else {
        this.btnPurchase.enabled = true;
    }
};

SpecialOfferController.prototype.onPurchase = function (sender) {
    AudioHelper.playBtnSound();
    this.btnPurchase.enabled = false;
    StoreHelper.getInstance().buyProduct(this.specialOfferCfg);
};

SpecialOfferController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

SpecialOfferController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

SpecialOfferController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/special_offer_view.ccbi", null, "SpecialOfferController", new SpecialOfferController());
    return node;
};

module.exports = SpecialOfferController;
},{"../config/ConfigMan":36,"../events/EventsName":98,"../model/StoreHelper":103}],72:[function(require,module,exports){
var MultiColTableView = require("../../common/ext/MultiColTableView");
var StoreItemController = require("./StoreItemController");
var StoreHelper = require("../model/StoreHelper");
var SkinItemController = require("./SkinItemController");
var ConfigMan = require("../config/ConfigMan");
var StoreType = require("../enum/StoreType");
var EventsName = require("../events/EventsName");

var StoreTab = {
    DIAMONDS: 0,
    SKINS: 1
};

var TabVisualConfig = {};
TabVisualConfig[StoreTab.DIAMONDS] = {
    tabNode: "tabDiamondsLight",
    unselectNode: "tabDiamondsDark",
    contentNode:"diamondsContentNode"
};
TabVisualConfig[StoreTab.SKINS] = {
    tabNode:"tabSkinLight",
    unselectNode:"tabSkinDark",
    contentNode:"skinContentNode"
};

var StoreSize = cc.size(571, 110);
var SkinSize = cc.size(285, 200);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = StoreItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(StoreSize.width * 0.5, StoreSize.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var SkinItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = SkinItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(SkinSize.width * 0.5, SkinSize.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var StoreController = function () {
    BaseCCBController.call(this);
    //this.lbChapterName = null;
    this.ndContainer = null;

    this.ndTitle = null;
    this.lbStoreName = null;

    this.lbDiamonds = null;

    //user data.
    this.configs = null;
    this.closeCallback = null;
};

game.utils.inherits(StoreController, BaseCCBController);

StoreController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

StoreController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    //this.refreshUI();
    this.onUpdateDiamonds();
};

StoreController.prototype.onUpdateDiamonds = function () {
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

StoreController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbStoreName.setString(game.local.getValue("store_title"));
    this.initStoreUI();
};

StoreController.prototype.initStoreUI = function () {
    //var originalTab = this.currentTab;
    var skinConfigs = ConfigMan.getInstance().getSkinList();
    cc.log("skinConfigs length:" + skinConfigs.length);
    //this.currentTab = StoreTab.SKINS;
    this[TabVisualConfig[StoreTab.SKINS].contentNode] = this.getTableView({
        gridAtIndex: function (multiTable, idx) {
            var cell = multiTable.dequeueGrid();
            if (!cell) {
                cell = new SkinItemCellView();
            }

            if (idx < skinConfigs.length) {
                var config = skinConfigs[idx];
                cell.initWith(config, idx);
                cell.visible = true;
            } else {
                cell.visible = false;
            }

            return cell;
        },

        numberOfCellsInTableView: function (multiTable) {
            var gridsInCell = this.numberOfGridsInCell(multiTable);
            return Math.ceil(skinConfigs.length / gridsInCell);
        },

        numberOfGridsInCell: function (multiTable, colIdx) {
            return 2;
        },

        gridSizeForTable: function (table, colIdx) {
            //return cc.size(200, 200);
            return cc.size(SkinSize.width, SkinSize.height);
        }
    }, {
        gridTouched: function (table, grid) {
            //cc.log("grid touched at index: " + grid.getIdx());
            //var entity = grid.entity;
            //AudioHelper.playBtnSound();
            //StoreHelper.getInstance().buySkin(entity);
        }
    });

    var diamondConfigs = ConfigMan.getInstance().getStoreListWithoutFirstPurchase();
    //this.currentTab = StoreTab.DIAMONDS;
    this[TabVisualConfig[StoreTab.DIAMONDS].contentNode] = this.getTableView({
        gridAtIndex: function (multiTable, idx) {
            var cell = multiTable.dequeueGrid();
            if (!cell) {
                cell = new StoreItemCellView();
            }

            if (idx < diamondConfigs.length) {
                var config = diamondConfigs[idx];
                cell.initWith(config, idx);
                cell.visible = true;
            } else {
                cell.visible = false;
            }

            return cell;
        },

        numberOfCellsInTableView: function (multiTable) {
            return diamondConfigs.length;
        },

        numberOfGridsInCell: function (multiTable, colIdx) {
            return 1;
        },

        gridSizeForTable: function (table, colIdx) {
            return StoreSize;
        }
    }, {
        gridTouched: function (table, grid) {
            //cc.log("grid touched at index: " + grid.getIdx());
            //var entity = grid.entity;
            //AudioHelper.playBtnSound();
            //StoreHelper.getInstance().buyProduct(entity);
        }
    });

    //this.currentTab = originalTab;
};

StoreController.prototype.refreshUI = function() {
    this.currentTab = this.currentTab || StoreTab.DIAMONDS;
    cc.log("StoreController.prototype.refreshUI:" + this.currentTab);
    //this.currentTab = StoreTab.SKINS;
    for(var i in TabVisualConfig) {
        //var tabNode = this[TabVisualConfig[i].tabNode];
        var unSelectNode = this[TabVisualConfig[i].unselectNode];
        var contentNode = this[TabVisualConfig[i].contentNode];
        //tabNode && tabNode.setVisible(Number(i) === this.currentTab);
        contentNode && contentNode.setVisible(Number(i) === this.currentTab);
        unSelectNode && unSelectNode.setVisible(Number(i) !== this.currentTab);
    }
};

StoreController.prototype.initWith = function (type, callback) {
    cc.log("StoreController.prototype.initWith:" + type);
    if (type === StoreType.SKIN) {
        this.currentTab = StoreTab.SKINS;
    } else if (type === StoreType.DIAMOND) {
        this.currentTab = StoreTab.DIAMONDS;
    }
    this.refreshUI();
    this.closeCallback = callback;
};

StoreController.prototype.getTableView = function (dataSource, delegate) {
    var tableView = new MultiColTableView(dataSource, this.ndContainer.getContentSize(), null);
    tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    tableView.setMultiTableViewDelegate(delegate);
    tableView.ignoreAnchorPointForPosition(false);
    tableView.setAnchorPoint(cc.p(0, 0));
    tableView.reloadData();
    this.ndContainer.addChild(tableView);
    return tableView;
};

StoreController.prototype.onClickSkin = function () {
    AudioHelper.playBtnSound();
    this.currentTab = StoreTab.SKINS;
    this.refreshUI();
};

StoreController.prototype.onClickDiamonds = function () {
    AudioHelper.playBtnSound();
    this.currentTab = StoreTab.DIAMONDS;
    this.refreshUI();
};

StoreController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

StoreController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

StoreController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

StoreController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/store_view.ccbi", null, "StoreController", new StoreController());
    return node;
};

module.exports = StoreController;
},{"../../common/ext/MultiColTableView":12,"../config/ConfigMan":36,"../enum/StoreType":97,"../events/EventsName":98,"../model/StoreHelper":103,"./SkinItemController":70,"./StoreItemController":73}],73:[function(require,module,exports){
var StoreType = require("../enum/StoreType");
var EventsName = require("../events/EventsName");

var StoreItemController = function () {
    BaseCCBController.call(this);

    //price
    this.lbPrice = null;
    this.spRewardedVideo = null;
    this.ndDiamondPrice = null;
    this.lbDiamondPrice = null;

    //node
    this.ndRestore = null;
    this.ndBoosts = null;
    this.ndDiamond = null;
    this.ndPurchase = null;

    //
    this.lbSplit = null;
    this.lbNewThree = null;
    this.lbDiamond = null;
    this.spDiamond = null;

    //tag
    this.spHotTag = null;
    this.spFreeTag = null;
    this.spPercentTag = null;

    this.spRedBg = null;

    this.lbTag = null;

    this.btnClaim = null;

    this.ndReminder = null;

    this.idx = 0;
};

game.utils.inherits(StoreItemController, BaseCCBController);

StoreItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

/**
 * @param {StoreConfig} data
 * @param {number} idx
 */
StoreItemController.prototype.initWith = function (data, idx) {
    this.storeEntity = data;
    this.idx = idx;
    this.lbPrice.setString(data.price);

    try {

        this.ndRestore.visible = false;
        this.ndBoosts.visible = false;
        this.ndDiamond.visible = false;
        this.ndPurchase.visible = true;

        this.lbPrice.visible = false;
        this.ndDiamondPrice.visible = false;
        this.spRewardedVideo.visible = false;

        this.spHotTag.visible = false;
        this.spFreeTag.visible = false;
        this.spPercentTag.visible = false;

        this.lbTag.visible = false;

        this.spRedBg.visible = false;

        this.btnClaim.enabled = true;

        this.ndReminder.visible = false;

        var spriteFrame;
        switch (data.type) {
            case StoreType.FREE:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(data.count);
                this.spRewardedVideo.visible = true;
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                //tag
                this.spFreeTag.visible = true;
                this.lbTag.visible = true;
                this.lbTag.setString(_("free_coins_title"));
                this.ndReminder.visible = true;
                break;
            case StoreType.REMOVE_ADS:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(game.local.getValue("remove_ads_title"));
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                this.lbPrice.visible = true;
                this.spHotTag.visible = true;
                this.lbTag.visible = true;
                this.lbTag.setString(_("hot_title"));
                break;
            case StoreType.RESTORE:
                this.ndRestore.visible = true;
                this.ndPurchase.visible = false;
                this.spRedBg.visible = true;
                break;
            case StoreType.NEW_AND_SPLIT:
                this.ndBoosts.visible = true;
                this.lbSplit.setString("x" + data.data.multiple_3);
                this.lbNewThree.setString("x" + data.data.multiple_3);
                this.ndDiamondPrice.visible = true;
                this.lbDiamondPrice.setString(data.count);
                break;
            case StoreType.DIAMOND:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(data.count);
                this.lbPrice.visible = true;
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                //tag
                if (data.extra > 0) {
                    this.spPercentTag.visible = true;
                    this.lbTag.visible = true;
                    this.lbTag.setString("+" + (data.extra * 100) + "%");
                }
                break;
        }
    } catch (ex) {
        cc.error(ex);
    }
};

StoreItemController.prototype.getContentSize = function () {
    return this.spBg.getContentSize();
};

StoreItemController.prototype.purchaseClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buyProduct(this.storeEntity);
};

StoreItemController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/store_item_view.ccbi", null, "StoreItemController", new StoreItemController());
    return node;
};

module.exports = StoreItemController;
},{"../enum/StoreType":97,"../events/EventsName":98,"../model/StoreHelper":103}],74:[function(require,module,exports){
var TaskItemController = require("./TaskItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");

var GRID_SIZE = cc.size(270, 200);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = TaskItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var TaskController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;

    this.lblTitle = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(TaskController, BaseCCBController);

TaskController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

TaskController.prototype.onExit = function () {
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};

TaskController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("task_title"));

    this.configs = ConfigMan.getInstance().getTaskList();
    this.showTableView();
};

TaskController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

TaskController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

TaskController.prototype.scrollViewDidScroll = function (view) {
};

TaskController.prototype.scrollViewDidZoom = function (view) {
};

TaskController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

TaskController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

TaskController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 2;
};

TaskController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(270, 220);
};

TaskController.prototype.gridTouched = function(table, grid) {
};

TaskController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

TaskController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

TaskController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

TaskController.prototype.onExit = function () {
    //if (this.closeCallback) {
    //    this.closeCallback();
    //    this.closeCallback = null;
    //}
};

TaskController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/task_view.ccbi", null, "TaskController", new TaskController());
    return node;
};

module.exports = TaskController;
},{"../../common/ext/MultiColTableView":12,"../config/ConfigMan":36,"../events/EventsName":98,"./TaskItemController":75}],75:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");

var TaskItemController = function () {
    BaseCCBController.call(this);

    this.lblGoal = null;
    this.lblGoalInfo = null;
    //this.spSkin = null;
    this.spBgSelected = null;

    this.lblSelect = null;
    this.btnSelect = null;
    this.ndSelect = null;

    this.lblDiamonds = null;

    //this.lblUsing = null;

    this.idx = 0;
    this.taskCfg = null;
};

game.utils.inherits(TaskItemController, BaseCCBController);

TaskItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {TaskConfig} data
 * @param {number} idx
 */
TaskItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.taskCfg = data;
    this.refresh();
};

TaskItemController.prototype.refresh = function () {
    var data = this.taskCfg;
    var completed = false;
    switch (data.type) {
        case SkinRewardType.None:
            this.lblGoal.visible = false;
            this.lblGoalInfo.visible = false;
            completed = true;
            break;
        case SkinRewardType.LevelCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("level_count_title"), data.count));
            if (game.playerMan.getLevel() >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.getLevel(), data.count));
            }
            break;
        case SkinRewardType.WatchAdCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("watch_ad_count_title"), data.count));
            if (game.playerMan.player.interstitialAdCount >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.player.interstitialAdCount, data.count));
            }
            break;
        case SkinRewardType.WatchRewardAdCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("watch_reward_ad_count_title"), data.count));
            if (game.playerMan.player.rewardedAdCount >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.player.rewardedAdCount, data.count));
            }
            break;
        case SkinRewardType.Claimed:
            if (game.playerMan.hasSkin(data.id)) {
                this.lblGoal.visible = false;
                this.lblGoalInfo.visible = false;
                completed = true;
            } else {
                this.lblGoal.setString(_("skin_gift_title"));
                this.lblGoalInfo.setString("--");
            }
            break;
        case SkinRewardType.Purchase:
            if (game.playerMan.hasSkin(data.id)) {
                this.lblGoal.visible = false;
                this.lblGoalInfo.visible = false;
                completed = true;
            } else {
                this.lblGoal.setString(_("skin_purchase_title"));
                this.lblGoalInfo.setString("--");
            }
            break;
    }

    this.lblDiamonds.setString("x" + data.rewardCount);

    //var spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
    //this.spSkin.setSpriteFrame(spriteFrame);
    //this.lblUsing.setString(_("selected_title"));

    //this.lblUsing.visible = false;
    //this.ndSelect.visible = false;
    this.btnSelect.enabled = false;

    var claimed = game.playerMan.isTaskClaimed(this.taskCfg.id);
    this.ndSelect.visible = true;

    if (completed) {
        if (!claimed) {
            this.btnSelect.enabled = true;
            this.lblSelect.setString(game.local.getValue("claim_title"));
        } else {
            this.lblSelect.setString(game.local.getValue("claimed_title"));
        }
    } else {
        this.lblSelect.setString(_("uncompleted_title"));
    }
};

TaskItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

TaskItemController.prototype.selectClicked = function () {
    AudioHelper.playBtnSound();
    cc.log("task claimed:" + game.playerMan.isTaskClaimed(this.taskCfg.id));
    if (!game.playerMan.isTaskClaimed(this.taskCfg.id)) {
        cc.log("task set claimed:" + this.taskCfg.id);
        game.playerMan.setTaskClaimed(this.taskCfg.id);
        var rewardCount = this.taskCfg.rewardCount;
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
            function () {
                game.playerMan.addDiamonds(rewardCount);
            }, "icon_diamond_1.png", rewardCount);
        this.refresh();
        game.eventDispatcher.dispatchEvent(EventsName.TASK_UPDATE);
    }
};

TaskItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/task_item_view.ccbi", null, "TaskItemController", new TaskItemController());
};

module.exports = TaskItemController;
},{"../enum/BoostType":89,"../enum/SkinRewardType":96,"../events/EventsName":98}],76:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var EventsName = require("../events/EventsName");

var ColorList = [
    cc.color(255, 106, 107),
    cc.color(90, 181, 110),
    cc.color(83, 183, 209),
    cc.color(243, 77, 151),
    cc.color(153, 95, 206),
    cc.color(57, 103, 249),
    cc.color(249, 112, 49),
    cc.color(232, 59, 20),
    cc.color(84, 235, 43),
    cc.color(50, 84, 117),
    cc.color(127, 127, 127)
];


var TitleController = function () {
    BaseCCBController.call(this);
    this.lbCoins = null;

    this.spCoinsAdd = null;
    this.btnAdd = null;

    this.bgNode = null;
};

game.utils.inherits(TitleController, BaseCCBController);

TitleController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.COINS_UPDATE, this.refresh, this);
};

TitleController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.COINS_UPDATE, this.refresh, this);
};

TitleController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.refresh();
    this.randomSquares();

    if (TitleController.time > 0) {
        game.utils.playCCBAnimation(this.rootNode, "Default Timeline");
    }
    TitleController.time ++;
};

TitleController.prototype.randomSquares = function () {
    for (var i = 0; i < 20; ++i) {
        var square = new cc.Sprite("#square_circle.png");

        square.setPosition(this.getRandomPos());
        square.setColor(ColorList[game.utils.randomNextInt(ColorList.length - 1)]);
        square.setOpacity(15);
        square.setScale(1.4);

        var pos1 = this.getRandomPos();
        square.setPosition(pos1);
        var pos2 = this.getRandomPos();
        var t = this.getTime(pos1, pos2);
        var moveTo1 = cc.moveTo(t, pos2);
        var moveTo2 = cc.moveTo(t, pos1);
        var action = cc.sequence(moveTo1, moveTo2).repeatForever();
        square.runAction(action);
        square.runAction(cc.rotateBy(20, 360).repeatForever());
        this.bgNode.addChild(square);
    }
};

TitleController.prototype.getTime = function (pos1, pos2) {
    return cc.pDistance(pos1, pos2) / 20;
};

TitleController.prototype.getRandomPos = function () {
    return cc.p(game.utils.randomNextInt(cc.winSize.width * 1.5) - cc.winSize.width * 0.25,
        game.utils.randomNextInt(cc.winSize.height * 1.5) - cc.winSize.height * 0.25);
};

TitleController.prototype.initWith = function (replayCallback, nextCallback) {
    this._replayCallback = replayCallback;
    this._nextCallback = nextCallback;
};

TitleController.prototype.refresh = function () {
    this.lbCoins.setString(game.playerMan.player.coins);
};

TitleController.prototype.disableAddCoins = function () {
    this.spCoinsAdd.visible = false;
    this.btnAdd.enabled = false;
    game.utils.playCCBAnimation(this.rootNode, "none");
};

TitleController.prototype.storeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupStoreDlg();
};

TitleController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/title_view.ccbi", null, "TitleController", new TitleController());
    return node;
};

TitleController.time = 0;

module.exports = TitleController;
},{"../events/EventsName":98}],77:[function(require,module,exports){
var Wheel = require("../../common/wheel/Wheel");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");

var WheelController = function () {
    BaseCCBController.call(this);
    this.WHEEL_TIME = 5;
    this.WHEEL_ITEM_ANGLE = 90;

    this.WHEEL_ICON_TAG = 100;
    this.WHEEL_NUM_TAG = 200;

    this.WHEEL_COUNT = 4;

    this.ndWheel = null;
    this.lblLeft = null;
    this.lblRight = null;
    this.btnLeft = null;
    this.btnRight = null;

    this.btnClose = null;

    this.lblLeftTips = null;
    this.lblRightTips = null;

    this.spTitleCn = null;
    this.spTitleEn = null;

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;




    /**
     * @type {Wheel}
     */
    this.wheel = null;

    this.wheelIcons = null;
    this.wheelNums = null;
};

game.utils.inherits(WheelController, BaseCCBController);

WheelController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
};

WheelController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    BaseCCBController.prototype.onExit.call(this);
};

WheelController.prototype.onDidLoadFromCCB = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    this.spTitleCn.visible = false;
    this.spTitleEn.visible = false;
    if (game.local.isChinese()) {
        //this.btnCloseCn.visible = true;
        this.spTitleCn.visible = true;
    } else {
        //this.btnCloseEn.visible = true;
        this.spTitleEn.visible = true;
    }

    this.wheelIcons = [];
    this.wheelNums = [];
    for (var i = 0; i < this.WHEEL_COUNT; ++i) {
        var wheelIcon = game.utils.seekNodeByTag(this.ndWheel, this.WHEEL_ICON_TAG + i);
        var wheelNum = game.utils.seekNodeByTag(this.ndWheel, this.WHEEL_NUM_TAG + i);
        this.wheelIcons.push(wheelIcon);
        this.wheelNums.push(wheelNum);
    }

    this.initWheelUI();
    this.updateWheelItems();
    this.wheel = new Wheel(this.ndWheel);
};

WheelController.prototype.initWheelUI = function () {
    var wheels = ConfigMan.getInstance().getWheelList();
    for (var i = 0; i < wheels.length; ++i) {
        var wheelIcon = this.wheelIcons[i];
        var wheelNum = this.wheelNums[i];
        wheelIcon.setSpriteFrame(wheels[i].image);
        wheelNum.setString("x" + wheels[i].count);
    }
};

WheelController.prototype.isShowRewardedVideo = function () {
    return game.adsManager.isRewardVideoReady();
};

WheelController.prototype.onUpdate = function () {
    this.updateWheelItems();
};

WheelController.prototype.isFreeWheel = function () {
    var leftTime = GameMan.getInstance().getWheelLeftTime();
    if (leftTime <= 0) {
        return true;
    }
    return false;
};

WheelController.prototype.getLeftHour = function () {
    var leftTime = GameMan.getInstance().getWheelLeftTime();
    return Math.ceil(leftTime / (60 * 60 * 1000));
};

WheelController.prototype.updateWheelItems = function () {
    this.lblLeft.setString(_("wheel_reward_video_btn"));
    this.lblLeftTips.setString(_("wheel_reward_video_tips"));
    //if (this.isShowRewardedVideo()) {
    //    this.btnLeft.enabled = true;
    //} else {
    //    this.btnLeft.enabled = false;
    //}
    //    this.lblLeft.setString(_("wheel_share_btn"));
    //    this.lblLeftTips.setString(_("wheel_share_tips"));
    //}
    //this.lblLeft.setString(_("wheel_share_btn"));
    //this.lblLeftTips.setString("");//_("wheel_share_tips"));

    this.lblRight.setString(_("wheel_free_btn"));
    var freeWheel = this.isFreeWheel();
    this.btnRight.enabled = freeWheel;
    if (freeWheel) {
        this.lblRightTips.setString("");
    } else {
        this.lblRightTips.setString(game.utils.sprintf(_("wheel_free_tips"), this.getLeftHour()));
    }
};

WheelController.prototype.getRandomWheel = function () {
    var wheels = ConfigMan.getInstance().getWheelList();
    var randomNum = game.utils.randomNextInt(100);
    console.log("randomNum:" + randomNum);
    var sumProbability = 0;
    for (var i = 0; i < wheels.length; ++i) {
        if (sumProbability + wheels[i].probability > randomNum) {
            return wheels[i];
        } else {
            sumProbability += wheels[i].probability;
        }
    }
    return null;
};

WheelController.prototype.startWheel = function () {
    this.wheelConfig = this.getRandomWheel();
    var wheelId = this.wheelConfig.id;
    console.log("random wheel id:" + wheelId);
    this.wheel.rotate(this.WHEEL_TIME, 360 * 3 + (wheelId - 1) * 90, this.WHEEL_ITEM_ANGLE, this.onRotateEnd.bind(this));
    this.btnClose.enabled = false;
    this.wheelInterval = setInterval(function () {
        game.audioPlayer.playEffectByKey("wheel_pin");
    }, 100);
};

WheelController.prototype.onRotateEnd = function () {
    clearInterval(this.wheelInterval);
    game.audioPlayer.playEffectByKey("wheel_stop");
    setTimeout(this.onShowReward.bind(this), 1000);
};

WheelController.prototype.onShowReward = function () {
    var wheel = this.wheelConfig;
    game.popupMan.popupRewardDoubleTipDlg(wheel.image, wheel.count, function (double) {
        var count = double ? wheel.count * 2 : wheel.count;
        var splitCount = 0;
        var threeBallCount = 0;
        if (wheel.type === BoostType.SPLIT) {
            splitCount = count;
        } else if (wheel.type === BoostType.THREE_BALL) {
            threeBallCount = count;
        }
        if (double) {
            StoreHelper.getInstance().popupBoostRewardDlg(splitCount, threeBallCount, function () {
            });
        } else {
            game.playerMan.addBoost(BoostType.SPLIT, splitCount);
            game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
        }
        this.btnClose.enabled = true;
        this.updateWheelItems();
    }.bind(this));
};

WheelController.prototype.leftClicked = function () {
    AudioHelper.playBtnSound();
    var self = this;
    if (this.isShowRewardedVideo()) {
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "zhuanpan01" : "jili01", function (rewarded) {
            if (rewarded) {
                self.startWheel();
            }
            self.updateWheelItems();
        });
    } else {
        //share
        //var share = GameMan.getInstance().getShareConfig();
        //game.shareManager.wxGroupShare(share, "wheel_share", function (shared) {
        //    if (shared) {
        //        self.startWheel();
        //    } else {
        //        game.utils.showWXToast("需要转发到群");
        //    }
        //});
    }
};

WheelController.prototype.rightClicked = function () {
    AudioHelper.playBtnSound();
    game.playerMan.setLastWheelTime(Date.now());
    this.updateWheelItems();
    this.btnRight.enabled = false;
    this.startWheel();
};

WheelController.prototype.closeClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

WheelController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

WheelController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

WheelController.createFromCCB = function() {
    var ccbiName = game.utils.isSelfGame() ? "res/wheel/wheel_view.ccbi" : "res/wheel/wheel_view_new.ccbi";
    var node = game.utils.loadNodeFromCCB(ccbiName, null, "WheelController", new WheelController());
    return node;
};

module.exports = WheelController;
},{"../../common/wheel/Wheel":32,"../config/ConfigMan":36,"../enum/BoostType":89,"../model/GameMan":99,"../model/StoreHelper":103}],78:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var Grid = cc.LayerColor.extend({

    col: 0,
    row: 0,

    editing: false,
    used: false,

    ctor: function (color, width, height, col, row) {
        this._super(color, width, height);
        this.ignoreAnchor = false;
        //this.type = type;
        this.col = col;
        this.row = row;
    },

    setColor: function (color) {
        this._super(color);
    }
});

module.exports = Grid;
},{}],79:[function(require,module,exports){
var ConfigMan = require("../../config/ConfigMan");
var PlayerMan = require("../../model/PlayerMan");
var LevelConfig = require("../../config/LevelConfig");
//var AdsReminderController = require("../../controller/AdsReminderController");

var ColorConfigs = [
    cc.color(252, 178, 0),
    cc.color(81, 229, 12),
    cc.color(27, 226, 255),
    cc.color(255, 252, 29),
    cc.color(255, 56, 56),
    cc.color(248, 70, 255),
    cc.color(255, 129, 17),
    cc.color(57, 103, 249),
    cc.color(90, 181, 110),

    cc.color(255, 90, 141),
    cc.color(242, 86, 9),
    cc.color(66, 46, 176),
    cc.color(144, 85, 222),
    cc.color(23, 167, 104),
    cc.color(176, 72, 206),
    cc.color(147, 192, 26),
    cc.color(55, 70, 219)
];

var GrayColor = cc.color.GRAY;
var LightGrayColor = cc.color(130, 130, 130);
var StatusList = ["brick", "obstacle", "delete"];

var EditorScene = cc.Scene.extend({

    CONTENT_WIDTH: 600,
    CONTENT_HEIGHT: 600,

    COL: 50,
    ROW: 50,

    GRID_WIDTH: 9,
    GRID_HEIGHT: 9,

    GAP_WIDTH: 3,
    GAP_HEIGHT: 3,

    brickRects: null,

    obstacleRects: null,

    //_isBrick: true,
    _status: "brick",

    _brickItem: null,

    _levelEditBox: null,

    ctor: function () {
        game.playerMan = PlayerMan.getInstance();
        game.playerMan.initData();

        //var LogicMan = require("../../../common/model/LogicMan");
        //LogicMan.getInstance().startGame(true);
        //cc.BuilderReader.registerController("AdsReminderController", new AdsReminderController());

        this._super();

        var scale = 1.5;
        this.xOffset = (cc.winSize.width - this.CONTENT_WIDTH * scale) * 0.5;
        this.yOffset = (cc.winSize.height - this.CONTENT_HEIGHT * scale) * 0.5;

        this.brickRects = [];
        this.obstacleRects = [];

        this.currentRects = this.brickRects;
        this.selectColor = ColorConfigs[0];
        this.selectColorIndex = 0;

        this.gridNode = new cc.Node();
        this.addChild(this.gridNode);
        this.gridNode.x = this.xOffset;
        this.gridNode.y = this.yOffset;
        this.gridNode.scale = scale;

        this.initGrids();
        this.initButtons();
        this.initColorButtons();
        this.initEditBox();

        if (game.gameMan.levelCfg) {
            this.loadConfig(game.gameMan.levelCfg.originalConfig);
        }
    },

    initEditBox: function () {
        var xOffset = 200;
        this._levelEditBox = this.createEditBox("", "Input LevelId", cc.p(cc.winSize.width * 0.5 - xOffset, 100));
        this._boostEditBox = this.createEditBox("1", "Input Boost Probability", cc.p(cc.winSize.width * 0.5, 100));
        this._star3EditBox = this.createEditBox("90", "Input 3Star Time", cc.p(cc.winSize.width * 0.5 + xOffset, 100));
    },

    createEditBox: function (content, placeHolder, position) {
        var editBox = new cc.EditBox(cc.size(270, 100), new cc.Scale9Sprite("res/common/blank.png"),
            new cc.Scale9Sprite("res/common/blank.png"));
        editBox.setString(content);
        editBox.setPosition(position);
        editBox.setFontColor(cc.color(255, 255, 255));
        //editBox.setHintCo
        editBox.setPlaceholderFontColor(cc.color(255, 0, 0));
        editBox.setPlaceHolder(placeHolder);
        editBox.setDelegate(this);
        this.addChild(editBox);
        return editBox;
    },

    initButtons: function () {
        // Bugs Item
        var brickItem = new cc.MenuItemFont("Brick", this.onBrickTypeChange, this);
        var saveItem = new cc.MenuItemFont("Save", this.onSave, this);
        var deleteItem = new cc.MenuItemFont("Back", this.onDelete, this);
        //var refreshItem = new cc.MenuItemFont("Refresh", this.onRefresh, this);
        var addItem = new cc.MenuItemFont("Add", this.onAdd, this);
        var reduceItem = new cc.MenuItemFont("Reduce", this.onReduce, this);
        var loadItem = new cc.MenuItemFont("Load", this.onLoad, this);
        var previewItem = new cc.MenuItemFont("Preview", this.onPreview, this);
        var menu = new cc.Menu(brickItem, saveItem, deleteItem, addItem, reduceItem, loadItem, previewItem);

        menu.alignItemsHorizontally();
        this.addChild(menu);
        menu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 20));
        this._brickItem = brickItem;

        this._gridLabel = new cc.LabelTTF("", "Arial", 40);
        this.addChild(this._gridLabel);

        this._gridLabel.setAnchorPoint(cc.p(0, 0.5));

        this._gridLabel.setPosition(cc.p(100, cc.winSize.height - 80));

        this._gridLabel.setString(this.COL + "x" + this.ROW);
    },

    initColorButtons: function () {

        var items = [];
        for (var i = 0; i < ColorConfigs.length; ++i) {
            var colorItem = new cc.MenuItemFont(" O ", this.onSelectColor, this);
            colorItem.setColor(ColorConfigs[i]);
            colorItem.setTag(i);
            items.push(colorItem);
        }
        var menu = new cc.Menu(items.slice(0, items.length / 2 + 1));
        menu.alignItemsHorizontally();
        menu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 55));
        this.addChild(menu);

        var bottomMenu = new cc.Menu(items.slice(items.length / 2 + 1));
        bottomMenu.alignItemsHorizontally();
        bottomMenu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 90));
        this.addChild(bottomMenu);
    },

    onLoad: function (sender) {
        var levelString = this._levelEditBox.getString();
        var levelId = parseInt(levelString);
        if (isNaN(levelId)) {
            alert("level id not found:" + levelString);
        } else {
            var levelConfig = ConfigMan.getInstance().getOriginalLevelConfig(levelId);
            if (!levelConfig) {
                alert("level id not found:" + levelString);
            } else {
                this.loadConfig(levelConfig);
            }
        }
    },

    onPreview: function (sender) {
        var obj = this.generateLevelObj();
        var levelConfig = new LevelConfig();
        levelConfig.unmarshal(obj);
        levelConfig.originalConfig = obj;
        game.gameMan.levelCfg = levelConfig;
        //var scene = new GameScene();
        var GameScene = require("./GameScene");
        //cc.winSize.width = cc.winSize.height * 0.5;
        cc.director.runScene(new GameScene());
    },

    generateLevelObj: function () {
        var boostProbability = Number(this._boostEditBox.getString());
        if (isNaN(boostProbability)) {
            boostProbability = 1;
        }

        var starTime = Number(this._star3EditBox.getString());
        if (isNaN(starTime)) {
            starTime = 90;
        }

        var id = parseInt(this._levelEditBox.getString());
        if (isNaN(id)) {
            id = undefined;
        }

        var obj = {
            id: id,
            b: boostProbability,
            starTime: starTime,
            pixelWidth: this.CONTENT_WIDTH,
            pixelHeight: this.CONTENT_HEIGHT,
            width: this.COL,
            height: this.ROW,
            bricks: this.brickRects,
            obstacles: this.obstacleRects
        };
        return obj;
    },

    loadConfig: function (config) {
        this.resetOldView();

        this.CONTENT_WIDTH = config.pixelWidth;
        this.CONTENT_HEIGHT = config.pixelHeight;
        this.COL = config.width;
        this.ROW = config.height;
        this.brickRects = config.bricks;
        this.obstacleRects = config.obstacles;

        //this.updateView();
        var width = this.CONTENT_WIDTH / this.COL;
        var height = this.CONTENT_HEIGHT / this.ROW;
        this.GRID_WIDTH = width * 0.75;
        this.GRID_HEIGHT = height * 0.75;
        this.GAP_WIDTH = width - this.GRID_WIDTH;
        this.GAP_HEIGHT = height - this.GRID_HEIGHT;

        this.initGrids();

        //this.brickRects = [];
        //this.obstacleRects = [];
        this.currentRects = this.brickRects;
        //this._isBrick = true;
        //this._status = "brick";
        //this._brickItem.setString("Brick");
        this._gridLabel.setString(this.COL + "x" + this.ROW);

        for (var i = 0; i < this.brickRects.length; ++i) {
            var brickRect = this.brickRects[i];
            this.markOccupiedWithRect(brickRect, ColorConfigs[brickRect[4] - 1]);
        }
        for (var i = 0; i < this.obstacleRects.length; ++i) {
            var brickRect = this.obstacleRects[i];
            this.markOccupiedWithRect(brickRect,  cc.color.WHITE);
        }
        this._boostEditBox.setString(config.b);
        this._star3EditBox.setString(config.starTime);
        //this.currentRects =
    },

    onSelectColor: function (sender) {
        this.selectColor = ColorConfigs[sender.getTag()];
        this.selectColorIndex = sender.getTag();
    },

    resetOldView: function () {
        this.forEachGrids(function (grid) {
            grid.removeFromParent();
        });
        this.grids = [];
    },

    updateView: function () {
        var width = this.CONTENT_WIDTH / this.COL;
        var height = this.CONTENT_HEIGHT / this.ROW;
        this.GRID_WIDTH = width * 0.75;
        this.GRID_HEIGHT = height * 0.75;
        this.GAP_WIDTH = width - this.GRID_WIDTH;
        this.GAP_HEIGHT = height - this.GRID_HEIGHT;

        this.initGrids();

        this.brickRects = [];
        this.obstacleRects = [];
        this.currentRects = this.brickRects;
        //this._isBrick = true;
        this._status = "brick";
        this._brickItem.setString("Brick");

        this._gridLabel.setString(this.COL + "x" + this.ROW);
    },

    onAdd: function () {
        this.resetOldView();
        this.COL += 4;
        this.ROW += 4;
        this.updateView();
    },

    onReduce: function () {
        this.resetOldView();
        this.COL -= 4;
        this.ROW -= 4;
        this.updateView();
    },


    onSave: function () {
        var obj = this.generateLevelObj();

        cc.log("results:" + JSON.stringify(obj));

        //alert(JSON.stringify(obj));
        var blob = new Blob([JSON.stringify(obj)]);
        var tag = document.createElement("a");
        tag.download = "level.json";
        tag.href = URL.createObjectURL(blob);
        tag.click();
        URL.revokeObjectURL(blob);
    },

    onDelete: function () {
        this.deleteLatestRect();
    },

    onRefresh: function () {
        this.reset();
    },

    onBrickTypeChange: function () {
        this._status = StatusList[(StatusList.indexOf(this._status) + 1) % StatusList.length];
        //this._isBrick = !this._isBrick;
        this._brickItem.setString(this._status);
        if (this._status === "obstacle") {
            this.currentRects = this.obstacleRects;
        } else if (this._status === "brick") {
            this.currentRects = this.brickRects;
        } else {
            this.currentRects = null;
        }
    },

    initGrids: function () {
        this.grids = [];
        var Grid = require("../entity/Grid");
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            this.grids.push([]);
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                var grid = new Grid(LightGrayColor, this.GRID_WIDTH, this.GRID_HEIGHT, localCol, localRow);
                this.gridNode.addChild(grid);
                grid.setPosition(this.getGridPos(localCol, localRow));
                this.grids[localCol].push(grid);
                this.markGrayHint(grid, localCol, localRow);
                grid._color = grid.color;
            }
        }
    },

    markGrayHint: function (grid, localCol, localRow) {
        var grayColor = GrayColor;
        var isLeft = (this.COL / localCol) > 2;
        var isBottom = (this.ROW / localRow) > 2;
        if (localCol === Math.floor(this.COL / 2) ||
            localCol === Math.floor(this.COL / 2) - 1 ||
            localRow === Math.floor(this.ROW / 2) ||
            localRow === Math.floor(this.ROW / 2) - 1
        ) {
            grid.setColor(grayColor);
        }

        var iii = isLeft ? 4 : 0;

        if (localCol % 5 === iii) {
            grid.setColor(grayColor);
        }

        var jjj = isBottom ? 4 : 0;

        if (localRow % 5 === jjj) {
            grid.setColor(grayColor);
        }

        //iii = isLeft ? 9 : 0;
        //jjj = isBottom ? 9 : 0;
        //
        //if (localCol % 10 === iii && localRow % 10 === jjj) {
        //    grid.setColor(cc.color.YELLOW);
        //}
    },

    reset: function () {
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                this.grids[localCol][localRow].editing = false;
                this.grids[localCol][localRow].setColor(LightGrayColor);
                this.grids[localCol][localRow].used = false;

                this.markGrayHint(this.grids[localCol][localRow], localCol, localRow);
            }
        }
        this.brickRects = [];
        this.obstacleRects = [];
        this.currentRects = this.brickRects;
        //this._isBrick = true;
        this._status = "brick";
        this._brickItem.setString("Brick");
    },

    onEnter:function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this),
            onTouchCancelled: this.onTouchCancelled.bind(this)
        }, this.gridNode);

        //cc.eventManager.addListener({
        //    event: cc.EventListener.KEYBOARD,
        //    onKeyReleased: function (keyCode, event) {
        //        if (keyCode === cc.KEY.backspace) {
        //            //cc.director.end();
        //            this.deleteLatestRect();
        //        }
        //    }.bind(this)
        //}, this);
    },

    onExit: function () {
        this._super();
    },

    getGridPos: function (localCol, localRow) {
        var gridSize = this.getGridSize();
        return cc.p((gridSize.width + this.GAP_WIDTH) * (localCol + 0.5),
            (gridSize.height + this.GAP_HEIGHT) * (localRow + 0.5));
    },

    getGridSize: function () {
        return cc.size(this.GRID_WIDTH, this.GRID_HEIGHT);
    },

    getFullGridSize: function () {
        return cc.size(this.GRID_WIDTH + this.GAP_WIDTH, this.GRID_HEIGHT + this.GAP_HEIGHT);
    },

    onTouchBegan:function(touch, event) {
        var grid = this.getClosestGrid(touch);
        if (!grid) {
            return false;
        }
        if (this._status === "delete") {
            this.firstGrid = grid;
            // grid.setColor(grid._color);
        } else {
            if (grid.used) {
                return false;
            }
            this.firstGrid = grid;
            grid.setColor(this.getCurrentColor());
        }
        return true;
    },

    onTouchMoved:function(touch, event) {
        if (this._status === "delete") {
            this.touchDelete(touch);
        } else {
            this.touchDraw(touch);
        }
        return true;
    },

    onTouchEnded:function(touch, event) {
        if (this._status === "delete") {
            this.touchDelete(touch);
        } else {
            this.touchDraw(touch);
        }

        if (this.firstGrid && this.lastGrid) {
            var region = this.getRegion(this.firstGrid, this.lastGrid);
            var index = this.selectColorIndex + 1;
            if (this._status !== "brick") {
                index = 0;
            }
            var rect = [region.minCol, region.minRow,
                region.maxCol - region.minCol + 1, region.maxRow - region.minRow + 1, index];
            var ccRect = cc.rect(rect[0], rect[1], rect[2], rect[3]);
            if (this._status === "delete") {
                this.deleteRectFromRects(ccRect, this.brickRects);
                this.deleteRectFromRects(ccRect, this.obstacleRects);
                this.forEachGrids(function (grid) {
                    grid.deleted = false;
                });
            } else {
                this.currentRects.push(rect);
                this.markOccupiedWithRect(rect, null);
                this.forEachGrids(function (grid) {
                    grid.editing = false;
                });
            }
        }

        this.firstGrid = null;
        this.lastGrid = null;
    },

    deleteRectFromRects: function (ccRect, rects) {
        for (var i = rects.length - 1; i >= 0; --i) {
            var brickRect = rects[i];
            var ccBrickRect = cc.rect(brickRect[0], brickRect[1], brickRect[2], brickRect[3]);
            var overlapsRect = cc.rectIntersection(ccRect, ccBrickRect);
            if (overlapsRect.width <= 0 || overlapsRect.height <= 0) {
                continue;
            }
            var resultRects = this.getOverlapsRects(overlapsRect, ccBrickRect);
            rects.splice(i, 1);
            for (var j = 0; j < resultRects.length; ++j) {
                rects.push(this.convertToJsonList(resultRects[j], brickRect[4]));
            }
        }
    },

    convertToJsonList: function (rect, color) {
        return [rect.x, rect.y, rect.width, rect.height, color];
    },

    getOverlapsRects: function (overlapsRect, brickRect) {
        var results = [
            cc.rect(brickRect.x, brickRect.y, brickRect.width, overlapsRect.y - brickRect.y),
            cc.rect(brickRect.x, cc.rectGetMaxY(overlapsRect), brickRect.width, cc.rectGetMaxY(brickRect) - cc.rectGetMaxY(overlapsRect)),
            cc.rect(brickRect.x, overlapsRect.y, overlapsRect.x - brickRect.x, overlapsRect.height),
            cc.rect(cc.rectGetMaxX(overlapsRect), overlapsRect.y, cc.rectGetMaxX(brickRect) - cc.rectGetMaxX(overlapsRect), overlapsRect.height)
        ];
        console.log("results:" + JSON.stringify(results));
        var rects = [];
        for (var i = results.length - 1; i >= 0; --i) {
            var rect = results[i];
            if (rect.width <= 0 || rect.height <= 0) {
                continue;
            }
            rects.push(rect);
        }
        return rects;
    },

    //markOccupied: function () {
    //    var region = this.getRegion(this.firstGrid, this.lastGrid);
    //
    //    for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
    //        for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
    //            this.grids[localCol][localRow].used = true;
    //        }
    //    }
    //},

    markOccupiedWithRect: function (rect, color) {
        for (var localCol = rect[0]; localCol < rect[0] + rect[2]; ++localCol) {
            for (var localRow = rect[1]; localRow < rect[1] + rect[3]; ++localRow) {
                this.grids[localCol][localRow].editing = false;
                this.grids[localCol][localRow].used = true;
                if (color) {
                    this.grids[localCol][localRow].setColor(color);
                }
            }
        }
    },

    isOccupied: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);
        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                if (this.grids[localCol][localRow].used) {
                    return true;
                }
            }
        }
        return false;
    },

    touchDraw: function (touch) {
        if (!this.firstGrid) {
            return false;
        }
        var grid = this.getClosestGrid(touch);

        if (!grid) {
            return false;
        }

        if (grid === this.lastGrid) {
            return false;
        }

        if (this.isOccupied(grid)) {
            return false;
        }
        this.lastGrid = grid;
        this.clearRect();
        this.drawRect(grid);
        return true;
    },

    touchDelete: function (touch) {
       if (!this.firstGrid) {
           return false;
       }
       var grid = this.getClosestGrid(touch);

       if (!grid) {
           return false;
       }

       if (grid === this.lastGrid) {
           return false;
       }

       // if (this.isOccupied(grid)) {
       //     return false;
       // }
       this.lastGrid = grid;
       // this.clearRect();
       // this.drawRect(grid);
        this.drawDeleteRect(grid);
    },

    deleteLatestRect: function () {
        var rect = this.currentRects.pop();
        if (rect) {
            for (var localCol = rect[0]; localCol < rect[0] + rect[2]; ++localCol) {
                for (var localRow = rect[1]; localRow < rect[1] + rect[3]; ++localRow) {
                    var grid = this.grids[localCol][localRow];
                    grid.setColor(grid._color);
                    grid.used = false;
                }
            }
        }
    },

    clearRect: function () {
        this.forEachGrids(function (grid) {
            if (grid.editing && !grid.used) {
                grid.setColor(grid._color);
                grid.editing = false;
            }
        });
    },

    drawRect: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);

        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                this.grids[localCol][localRow].editing = true;
                this.grids[localCol][localRow].setColor(this.getCurrentColor());
            }
        }
    },

    forEachGrids: function (cb) {
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                var grid = this.grids[localCol][localRow];
                cb(grid);
            }
        }
    },

    drawDeleteRect: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);

        this.forEachGrids(function (grid) {
            if (grid.deleted) {
                grid.setColor(grid._showColor);
                grid.deleted = false;
            }
        });

        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                var grid = this.grids[localCol][localRow];
                // grid.editing = false;
                grid.used = false;
                grid.deleted = true;
                grid._showColor = grid.getColor();
                grid.setColor(grid._color);
            }
        }
    },

    getRegion: function (grid1, grid2) {
        var minRow = Math.min(grid1.row, grid2.row);
        var maxRow = Math.max(grid1.row, grid2.row);
        var minCol = Math.min(grid1.col, grid2.col);
        var maxCol = Math.max(grid1.col, grid2.col);
        return {
            minRow: minRow,
            maxRow: maxRow,
            minCol: minCol,
            maxCol: maxCol
        };
    },

    onTouchCancelled:function(touch, event) {
    },

    getClosestGrid: function (touch) {
        var localPos = this.gridNode.convertToNodeSpace(touch.getLocation());
        var gridSize = this.getFullGridSize();

        cc.log("localPos:" + JSON.stringify(localPos));

        var row = Math.floor(localPos.x / gridSize.width);
        var col = Math.floor(localPos.y / gridSize.height);

        cc.log("row:" + row + ",col:" + col);

        return this.grids[row][col];
    },

    getCurrentColor: function () {
        if (this._status === "brick") {
            return this.selectColor;
        } else {
            return cc.color.WHITE;
        }
    }
    //
    //drawRect: function(region, color, clear) {
    //    if (clear){
    //        this._drawNode.clear();
    //    }
    //    if (region == null) {
    //        return;
    //    }
    //    var min = region.getMin();
    //    var max = region.getMax();
    //    max.x += 1;
    //    max.y += 1;
    //    this._drawNode.drawSegment(cc.p(min.x, min.y),
    //        cc.p(min.x, max.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(min.x, max.y),
    //        cc.p(max.x, max.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(max.x, max.y),
    //        cc.p(max.x, min.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(max.x, min.y),
    //        cc.p(min.x, min.y), 1, color);
    //},
    //
    //drawRectFill: function (region, color) {
    //    if (region == null) {
    //        return;
    //    }
    //    this._drawNode.drawRect(region.getMin(), region.getMax(), color, 1, color);
    //}
});

module.exports = EditorScene;
},{"../../config/ConfigMan":36,"../../config/LevelConfig":38,"../../model/PlayerMan":100,"../entity/Grid":78,"./GameScene":80}],80:[function(require,module,exports){
var GameController = require("../../controller/GameController");

var GameScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var gameNode = GameController.createFromCCB();
        this.addChild(gameNode);
    }
});

module.exports = GameScene;

},{"../../controller/GameController":51}],81:[function(require,module,exports){
var GridType = require("../enum/GridType");
var ShapeType = require("../enum/ShapeType");
var GameMan = require("../model/GameMan");

var Ball = cc.Node.extend({

    type: GridType.BALL,
    body: null,
    sprite: null,
    addScale: 1,
    ctor: function (width) {
        this._super();
        var skinCfg = GameMan.getInstance().getCurrentSkinCfg();
        var image = skinCfg.image + ".png";
        var sprite = new cc.Sprite("#" + image);
        this.addScale = skinCfg.scale;
        this.addChild(sprite);
        this.sprite = sprite;
        this.reset(width);
    },

    reset: function (width) {
        this.sprite.scaleX = width / this.sprite.width * this.addScale;
        this.sprite.scaleY = width / this.sprite.width * this.addScale;
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    update: function (dt) {
        if (this.body) {
            var bodyPos = this.body.getPos();
            this.sprite.setPosition(bodyPos);
            this.sprite.setRotation(this.getBodyAngle());
        }
    },

    setAngleVel: function (w) {
        this.body.setAngVel(-cc.radiansToDegrees(w));
    },

    getBodyAngle: function () {
        return -cc.radiansToDegrees(this.body.a);
    },

    initBody: function (space, pos) {
        this.space = space;
        var body = new cp.Body(1, cp.momentForCircle(1, 0, this.sprite.width * this.sprite.scaleX, cp.v(0, 0)));
        var shape = new cp.CircleShape(body, this.sprite.width * this.sprite.scaleX / 2, cp.v(0, 0));
        shape.setElasticity(1);
        shape.setFriction(0);
        this.space.addShape(shape);
        this.space.addBody(body);
        shape.setCollisionType(ShapeType.BALL);
        shape.group = 1;
        body.userData = this;
        this.body = body;
        this.shape = shape;
        this.body.setPos(pos);
        body.setAngVel(3);
        this.update(0);
        //this.sprite.setPosition(pos);
    },

    getPosition: function () {
        return this.sprite.getPosition();
    },

    removeBody: function () {
        //console.log("Ball removeBody");
        if (this.body) {
            this.space.removeBody(this.body);
            this.space.removeShape(this.shape);
            this.body = null;
            this.shape = null;
        }
    },

    setVel: function (directionPos) {
        this.body.setVel(directionPos);
    },

    getVel: function () {
        return this.body.getVel();
    }
});

module.exports = Ball;
},{"../enum/GridType":91,"../enum/ShapeType":95,"../model/GameMan":99}],82:[function(require,module,exports){
/**
 * Created by qinning on 2017/11/8.
 */
var Utils = require("../../common/util/Utils");

var BallPool = {
    MAX_POOL_SIZE: 300,
    _pool: {},

    putInPool: function (name, obj) {
        if (!this._pool[name]) {
            this._pool[name] = [];
        }
        if (this._pool[name].length < this.MAX_POOL_SIZE) {
            obj.retain && obj.retain();
            this._pool[name].push(obj);
        } else {
            cc.log("Symbol pool is full, throw away this symbol:" + name);
        }
    },

    hasObject: function (name) {
        return (this._pool[name] && this._pool[name].length > 0);
    },

    removeObject: function (name, obj) {
        var list = this._pool[name];
        if (list) {
            for (var i = 0; i < list.length; i++) {
                if (obj === list[i]) {
                    // JSB release to avoid memory leak
                    obj.release && obj.release();
                    list.splice(i, 1);
                }
            }
        }
    },

    getFromPool: function (name) {
        if (this.hasObject(name)) {
            var obj = this._pool[name].pop();
            cc.sys.isNative && obj.release && Utils.autoRelease(obj);
            return obj;
        }
    },

    drainAllPools: function () {
        for (var i in this._pool) {
            if (this._pool.hasOwnProperty(i)) {
                for (var j = 0; j < this._pool[i].length; j++) {
                    var obj = this._pool[i][j];
                    // JSB release to avoid memory leak
                    obj.release && obj.release();
                }
            }
        }
        this._pool = {};
    }
};

module.exports = BallPool;
},{"../../common/util/Utils":31}],83:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var GridType = require("../enum/GridType");
var BoardController = require("../controller/BoardController");
var ShapeType = require("../enum/ShapeType");

var Board = cc.Node.extend({

    type: GridType.BOARD,

    node: null,

    shape: null,

    ctor: function (width) {
        this._super();
        this.node = BoardController.createFromCCB(width);
        this.addChild(this.node);

        this.width = this.node.controller.ndBoard.width + 16;
        this.height = this.node.controller.ndBoard.height;
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    removeBody: function () {
        //console.log("Board removeBody");
        if (this.body) {
            //this.space.removeBody(this.body);
            this.space.removeStaticShape(this.shape);
            this.body = null;
            this.shape = null;
        }
    },

    initBody: function (space, pos) {
        this.setPosition(pos);
        this.space = space;

        var body = new cp.Body(Infinity, Infinity);
        var shape = new cp.BoxShape(body, this.width, this.height);
        shape.setElasticity(1);
        shape.setFriction(0);
        shape.setCollisionType(ShapeType.BOARD);
        this.space.addStaticShape(shape);
        body.setPos(pos);
        body.userData = this;
        this.body = body;
        this.shape = shape;
        this.space.reindexShape(this.shape);
    },

    setPosX: function (posX) {
        this.x = posX;
        this.body.setPos(cc.p(this.x, this.y));
        this.space.reindexShape(this.shape);
    },

    getBoundingBox: function () {
        return this.node.controller.ndBoard.getBoundingBoxToWorld();
    },

    hideBall: function () {
        this.node.controller.hideBall();
    },

    showBall: function () {
        this.node.controller.showBall();
    }
});

module.exports = Board;
},{"../controller/BoardController":47,"../enum/GridType":91,"../enum/ShapeType":95}],84:[function(require,module,exports){
var BoostType = require("../enum/BoostType");

var Boost = cc.Sprite.extend({

    type: 0,
    ctor: function (type) {
        this.type = type;
        switch (type) {
            case BoostType.LIFE:
                this._super("#icon_new_life.png");
                //this.setColor(cc.color.RED);
                break;
            case BoostType.SPLIT:
                this._super("#icon_3_multiple.png");
                //this.setColor(cc.color.BLUE);
                break;
            case BoostType.THREE_BALL:
                this._super("#icon_3_new.png");
                //this.setColor(cc.color.GREEN);
                break;
        }
    }
});

module.exports = Boost;
},{"../enum/BoostType":89}],85:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var ShapeType = require("../enum/ShapeType");

var Grid = cc.Node.extend({

    isGift: false,
    type: 0,
    removeable: false,

    sprite: null,
    ctor: function (color, width, height, type) {
        this._super();
        this.ignoreAnchor = false;
        this.sprite = new cc.Sprite("#grid.png");
        this.addChild(this.sprite);
        this.reset(color, width, height, type);
    },

    reset: function (color, width, height, type) {
        this.type = type;
        this.sprite.scaleX = width / this.sprite.width;
        this.sprite.scaleY = height / this.sprite.height;
        this.sprite.setColor(color);
        this.width = width;
        this.height = height;
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    setGift: function () {
        this.isGift = true;
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame("grid_gift.png");
        this.sprite.setSpriteFrame(spriteFrame);
        this.sprite.setColor(cc.color.WHITE);
        this.sprite.scaleX = (this.width + 4) / this.sprite.width;
        this.sprite.scaleY = (this.height + 4) / this.sprite.height;
    },

    setColor: function (color) {
        this._super();
        if (!this.isGift) {
            this.sprite.setColor(color);
        }
    },

    initBody: function (space, pos) {
        this.setPosition(pos);
        this.space = space;

        var body = new cp.Body(Infinity, Infinity);
        var shape = new cp.BoxShape(body, this.width, this.height);
        shape.setElasticity(1);
        shape.setFriction(0);
        this.space.addStaticShape(shape);
        shape.setCollisionType(ShapeType.BRICK);
        body.setPos(pos);
        this.body = body;
        body.userData = this;
        this.shape = shape;
        this.space.reindexShape(shape);
    },

    removeBody: function () {
        //console.log("Grid removeBody");
        if (this.shape) {
            this.space.removeStaticShape(this.shape);
            this.shape = null;
            this.body = null;
            this.removeable = false;
        }
    }
});

module.exports = Grid;
},{"../enum/ShapeType":95}],86:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var Obstacle = cc.Node.extend({

    ctor: function (color, width, height) {
        this._super(color, width, height);
        this.ignoreAnchor = false;
        this.sprite = new cc.Sprite("#grid.png");
        this.addChild(this.sprite);
        this.reset(color, width, height);
    },

    reset: function (color, width, height) {
        this.sprite.scaleX = width / this.sprite.width;
        this.sprite.scaleY = height / this.sprite.height;
        this.width = width;
        this.height = height;
        this.sprite.setColor(color);
    },

    setColor: function (color) {
        this._super();
        this.sprite.setColor(color);
    }
});

module.exports = Obstacle;
},{}],87:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var BoostType = require("../enum/BoostType");

var PlayerInfo = function(){
    this.playerId = "";
    this.bestScore = 0;
    this.removedAds = false;
    this.level = 0;
    this.progress = 0;
    this.levelMap = null;
    this.rated = false;

    this.boostMap = null;
    this.coins = 0;
    this.guided = false;

    this.hardLevel = 0;
    this.lastWheelTime = 0;
    this.currentSkinId = 0;
    this.interstitialAdCount = 0;
    this.rewardedAdCount = 0;

    this.createDt = 0;

    this.levelsMap = {};

    this.lastLoginDay = 0;
    this.consecutiveLoginDays = 1;
    this.lastClaimDailyBonusDay = 0;
    this.nextDayTips = false;

    this.skinMap = {};
    this.specialOfferMap = {};

    this.diamonds = 0;

    this.taskMap = {};
    this.skinAdjusted = false;
    this.lastShowRateTime = 0;

    this.rewardAdCountPerDay = {};
    this.rewardAdRecordDay = 0;
    this.iapCount = 0;
};

PlayerInfo.prototype.unmarshall = function (json) {
    this.playerId = json["playerId"];
    this.bestScore = json["bestScore"] || 0;
    this.removedAds = json["removedAds"] || false;
    this.level = json["level"] || 1;
    this.progress = json["progress"] || 0;
    this.levelMap = json["levelMap"] || {};
    this.rated = json["rated"] || false;
    this.coins = json["coins"] || 0;
    this.guided = json["guided"] || false;
    this.boostMap = json["boostMap"] || {};
    this.hardLevel = json["hardLevel"] || 1;
    this.lastWheelTime = json["lastWheelTime"] || 0;
    this.currentSkinId = json["currentSkinId"] || 0;
    this.interstitialAdCount = json["interstitialAdCount"] || 0;
    this.rewardedAdCount = json["rewardedAdCount"] || 0;
    this.createDt = json["createDt"] || Date.now();
    this.levelsMap = json["levelsMap"] || {};
    this.lastLoginDay = json["lastLoginDay"] || 0;
    this.consecutiveLoginDays = json["consecutiveLoginDays"] || 1;
    this.lastClaimDailyBonusDay = json["lastClaimDailyBonusDay"] || 0;
    this.nextDayTips = json["nextDayTips"] || false;
    this.skinMap = json["skinMap"] || {
        "0": true
    };
    this.specialOfferMap = json["specialOfferMap"] || {};
    this.diamonds = json["diamonds"] || 50;
    this.taskMap = json["taskMap"] || {};
    this.skinAdjusted = json["skinAdjusted"] || false;
    this.lastShowRateTime = json["lastShowRateTime"] || 0;
    this.rewardAdCountPerDay = json["rewardAdCountPerDay"] || 0;
    this.rewardAdRecordDay = json["rewardAdRecordDay"] || 0;
    this.iapCount = json["iapCount"] || 0;
};

PlayerInfo.createDefault = function () {
    var playerInfo = new PlayerInfo();
    playerInfo.hintsCount = 5;
    playerInfo.bestScore = 0;
    playerInfo.removedAds = false;
    playerInfo.level = 1;
    playerInfo.progress = 0;
    playerInfo.levelMap = {};
    playerInfo.rated = false;
    playerInfo.coins = 0;
    playerInfo.guided = false;
    playerInfo.boostMap = {};
    playerInfo.boostMap[BoostType.SPLIT] = 5;
    playerInfo.boostMap[BoostType.THREE_BALL] = 5;
    playerInfo.hardLevel = 1;
    playerInfo.lastWheelTime = 0;
    playerInfo.currentSkinId = 0;
    playerInfo.interstitialAdCount = 0;
    playerInfo.rewardedAdCount = 0;
    playerInfo.createDt = Date.now();
    playerInfo.levelsMap = {};
    playerInfo.dailyBonusDt = Date.now();
    playerInfo.lastLoginDay = 0;
    playerInfo.consecutiveLoginDays = 1;
    playerInfo.lastClaimDailyBonusDay = 0;
    playerInfo.nextDayTips = false;
    playerInfo.skinMap = {
        "0": true
    };
    playerInfo.specialOfferMap = {};
    playerInfo.diamonds = 50;
    playerInfo.taskMap = {};
    playerInfo.skinAdjusted = false;
    playerInfo.lastShowRateTime = 0;
    playerInfo.rewardAdCountPerDay = 0;
    playerInfo.rewardAdRecordDay = 0;
    playerInfo.iapCount = 0;
    return playerInfo;
};

module.exports = PlayerInfo;

},{"../enum/BoostType":89}],88:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var ShapeType = require("../enum/ShapeType");

var Wall = cc.Node.extend({

    initBody: function (space, pos) {
        this.setPosition(pos);
        this.space = space;

        var body = new cp.Body(Infinity, Infinity);
        var shape = new cp.BoxShape(body, this.width, this.height);
        shape.setElasticity(1);
        shape.setFriction(0);
        this.space.addStaticShape(shape);
        shape.setCollisionType(ShapeType.WALL);
        body.setPos(cc.pAdd(pos, cc.p(this.width * 0.5, this.height * 0.5)));
        body.userData = this;
        this.space.reindexShape(shape);
    }
});

module.exports = Wall;
},{"../enum/ShapeType":95}],89:[function(require,module,exports){

var BoostType = {
    LIFE: 1,
    THREE_BALL: 2,
    SPLIT: 3,
    GIFT: 4,
    SKIN: 5,
    DIAMOND: 6,
    NUM: 6
};

module.exports = BoostType;
},{}],90:[function(require,module,exports){
/**
 * Created by qinning on 2017/5/7.
 */

var GameMode = {
    GAME_MODE_ENDLESS: 0,
    GAME_MODE_LEVEL: 1
};

module.exports = GameMode;
},{}],91:[function(require,module,exports){

var GridType = {
    OBSTACLE: 0,
    BRICK: 1,
    BALL: 2,
    BOARD: 3
};

module.exports = GridType;
},{}],92:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */

var LockStatus = {
    LOCK_STATUS_LOCK: 0,
    LOCK_STATUS_UNLOCK: 1,
    LOCK_STATUS_DOING: 2
};

module.exports = LockStatus;
},{}],93:[function(require,module,exports){

var RankType = {
    Friends: 0,
    Group: 1,
    Global:2
};

module.exports = RankType;
},{}],94:[function(require,module,exports){
/**
 * Created by qinning on 2018/1/1.
 */


var SceneType = {
    NONE: -1,
    LOADING: 0,
    MENU: 1,
    PACKAGE: 2,
    LEVEL: 3,
    GAME: 4
};

module.exports = SceneType;
},{}],95:[function(require,module,exports){

var ShapeType = {
    BALL: 1,
    BRICK: 2,
    BOARD: 3,
    WALL: 4
};

module.exports = ShapeType;
},{}],96:[function(require,module,exports){

var SkinRewardType = {
    None: 0,
    LevelCount: 1,
    WatchAdCount: 2,
    WatchRewardAdCount: 3,
    Claimed: 4,
    Purchase: 5
};

module.exports = SkinRewardType;
},{}],97:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/16.
 */

var StoreType = {
    FREE: 1,
    NEW_3: 2,
    SPLIT: 3,
    REMOVE_ADS: 4,
    RESTORE: 5,
    FIRST_PURCHASE: 6,
    NEW_AND_SPLIT: 7,
    DIAMOND: 8,
    SKIN: 9
};

module.exports = StoreType;
},{}],98:[function(require,module,exports){
/**
 * Created by oye on 15/11/21.
 */

var EventsName = {
    EVENT_NAME_GAME_START: "event_name_start",
    EVENT_NAME_GAME_OVER: "event_name_game_over",
    EVENT_NAME_UPDATE_SCORE: "event_name_update_score",
    EVENT_NAME_UPDATE_LEFT_BULLET: "event_name_update_left_bullet",
    EVENT_NAME_UPDATE_BEST_SCORE: "event_name_update_best_score",
    EVENT_NAME_UPDATE_AUDIO: "event_name_update_audio",
    UPDATE_LEVEL: "update_level",
    COINS_UPDATE: "coins_update",
    REFRESH_BOOST: "refresh_boost",
    UPDATE_SKIN: "update_skin",
    UPDATE_SPECIAL_OFFER: "update_special_offer",
    PURCHASE_END: "purchase_end",
    DIALOG_POPED: "dialog_poped",
    DIALOG_CLOSED: "dialog_closed",
    DIAMONDS_UPDATE: "diamonds_update",
    TASK_UPDATE: "task_update",
    REWARDED_VIDEO_COUNT: "rewarded_video_count"
};

module.exports = EventsName;
},{}],99:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var EventsName = require("../events/EventsName");
var ConfigMan = require("../config/ConfigMan");
var ShareConfig = require("../config/ShareConfig");
//var ConfigMan = require("../config/ConfigMan");


var GameMan = cc.Class.extend({
    FREE_WHEEL_HOURS: 12,

    ONE_HOUR_SECONDS: 60 * 60 * 1000,
    startTime: 0,
    resultCount: 0,
    rated: false,
    endTime: 0,
    canReLife: true,
    distance: 0,
    levelId: 1,
    hardMode: false,
    giftCount: 0,
    lastShowLevel: 0,

    totalFailCount: 0,
    poped3StarTips: false,

    setHardMode: function (hardMode) {
        this.hardMode = hardMode;
    },

    canPop3StarTips: function () {
        return !this.poped3StarTips;
    },

    setPop3StarTips: function () {
        this.poped3StarTips = true;
    },

    isHardMode: function () {
        return this.hardMode;
    },

    getPlayerLevel: function () {
        if (this.isHardMode()) {
            return game.playerMan.getHardLevel();
        } else {
            return game.playerMan.getLevel();
        }
    },

    ctor: function () {
    },

    init: function () {
        this.rated = game.playerMan.player.rated;
        this.chooseLatestLevel();
    },

    chooseLatestLevel: function () {
        if (game.playerMan.getLevel() <= this.getLevelList().length) {
            this.levelId = game.playerMan.getLevel();
        } else {
            this.setHardMode(true);
            this.levelId = game.playerMan.getHardLevel();
        }
    },

    getLevelList: function () {
        return ConfigMan.getInstance().getLevelList();
    },

    updateScore: function () {
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_SCORE);
    },

    gameOver: function () {
        //game.analyseManager.trackFailedProgressionEvent("level", game.playerMan.getLevel());
        this.resultCount++;
    },

    getCurrentStar: function (costTime) {
        //cc.log("costTime:" + costTime);
        var levelCfg = this.getCurConfig();
        var star = 1;
        if (costTime <= levelCfg.starTime) {
            star = 3;
        } else if (costTime <= levelCfg.starTime * 2) {
            star = 2;
        }
        return star;
    },

    getProgressPercent: function (costTime) {
        var levelCfg = this.getCurConfig();
        return Math.max(0, 1 - (costTime / levelCfg.starTime / 3)) * 100;
    },

    gameWin: function (costTime) {
        var star = this.getCurrentStar(costTime);
        this.currentStar = star;
        var hasPssed = false;
        var levelIdAndStar = this.levelId + "-" + star;
        if (!this.isHardMode()) {
            if (game.playerMan.getLevelStar(this.levelId) > 0) {
                hasPssed = true;
            }
            this.updateLevelStar(this.levelId, star);
            if (!hasPssed) {
                game.analyseManager.trackEvent("level_pass", {
                    "level": this.levelId
                });
                game.analyseManager.trackEvent("level_pass_star", {
                    "level": levelIdAndStar
                });
                cc.log("track event level_pass:" + this.levelId);
            }
            this.resultCount++;
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.gcManager.reportScore(this.levelId, game.config.getLeaderBoardKey());
                game.playerMan.setLevel(this.levelId);
            }
        } else {
            if (game.playerMan.getHardLevelStar(this.levelId) > 0) {
                hasPssed = true;
            }
            this.updateHardLevelStar(this.levelId, star);
            if (!hasPssed) {
                game.analyseManager.trackEvent("level_pass_hard", {
                    "level": this.levelId
                });
                game.analyseManager.trackEvent("level_pass_hard_star", {
                    levelStarKey: levelIdAndStar
                });
                cc.log("track event level_pass_hard:" + this.levelId);
            }
            this.resultCount++;
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.gcManager.reportScore(this.levelId, game.config.getHardBoardKey());
                game.playerMan.setHardLevel(this.levelId);
            }
        }
    },

    skipLevel: function () {
        if (!this.isHardMode()) {
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.playerMan.setLevel(this.levelId);
            }
        } else {
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.playerMan.setHardLevel(this.levelId);
            }
        }
    },

    updateLevelStar: function (level, star) {
        var oldStar = game.playerMan.getLevelData(this.levelId, "star") || 0;
        if (star > oldStar) {
            cc.log("updateLevelStar:oldStar:" + oldStar + ",star:" + star);
            game.playerMan.updateLevelData(level, "star", star);
        }
    },

    updateHardLevelStar: function (level, star) {
        var oldStar = game.playerMan.getLevelData(this.levelId, "hardStar") || 0;
        if (star > oldStar) {
            cc.log("updateHardLevelStar:oldStar:" + oldStar + ",star:" + star);
            game.playerMan.updateLevelData(level, "hardStar", star);
        }
    },

    resumeGame: function () {
        this.levelId--;
    },

    chooseLevel: function (levelId) {
        this.levelId = levelId;
    },

    getDisplayLevel: function () {
        return this.levelId;
    },

    getCurConfig: function () {
        var levelList = this.getLevelList();
        if (levelList) {
            return levelList[this.levelId - 1];
        }
        return null;
    },

    hasNextLevel: function () {
        var levelList = this.getLevelList();
        if (this.levelId > levelList.length) {
            return false;
        }
        return true;
    },

    switchFail: function () {
        this.totalFailCount++;
    },

    showAds: function (success) {
        cc.log("GameMan showAds:" + success + ",isNewPlayer:" + game.playerMan.isNewPlayer());
        if (game.playerMan.isNewPlayer()) {
            if (success) {
                if (this.levelId > 4) {
                    this._showInterstitialAds();
                }
            } else {
                if (this.totalFailCount % 2 === 0) {
                    this._showInterstitialAds();
                }
            }
        } else {
            this._showInterstitialAds();
        }
    },

    _showInterstitialAds: function () {
        if (game.playerMan.getLevel() >= 3) {
            var AdsPlace = require("../../common/enum/AdsPlace");
            game.adsManager.showInterstitial(AdsPlace.Pass);
        }
    },

    showRegisterNotification: function () {
        if (this.resultCount > 0 && this.resultCount % 3 === 0) {
            game.logicMan.registerNotification();
        }
    },

    showAdsAndRate: function (success) {
        var count = 4;
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            count = 5;
        }
        var lastShowedRateDay = Math.floor((Date.now() - game.playerMan.player.lastShowRateTime) / (24 * 3600 * 1000));
        if (!this.rated && (this.resultCount > 0 && this.resultCount % count === 0) && lastShowedRateDay >= 2) {
            if (!game.rateManager.launchAppReview()) {
                game.popupMan.popupRateDlg(function () {
                    this.rated = true;
                    game.playerMan.setRated(true);
                }.bind(this), function () {
                    this.rated = true;
                    this.showAds(success);
                }.bind(this));
            } else {
                this.rated = true;
            }
            game.playerMan.setLastShowRateTime();
        } else {
            this.showAds(success);
        }
    },

    restartGame: function () {
        game.logicMan.registerNotification();
        this.startGame();
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_SCORE);
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_BG_SPRITE);
    },

    startGame: function () {
        //game.analyseManager.trackStartProgressionEvent("level", game.playerMan.getLevel());
    },

    enterGame: function () {
        //game.analyseManager.trackStartProgressionEvent("level", game.playerMan.getLevel());
    },

    leaveGame: function () {
        this.startTime = 0;
        this.distance = 0;
    },

    canShowRewardedVideo: function () {
        return (this.canReLife && game.adsManager.isRewardVideoReady());
    },

    getShareConfig: function () {
        var shareList = ConfigMan.getInstance().getShareList();
        var randomNum = game.utils.randomNextInt(shareList.length);
        return shareList[randomNum];
    },

    getFriendHelpShare: function () {
        var desc = game.utils.sprintf("砖块破坏者我已经%d关了，帮我继续玩，让我冲上榜首。", game.playerMan.getLevel());
        var shareConfig = this.getShareConfig();
        var share = shareConfig.copy();
        share.desc = desc;
        return share;
    },

    getFriendChallengeShare: function () {
        var desc = game.utils.sprintf("砖块破坏者我已经%d关了，你能超越我吗？", game.playerMan.getLevel());
        var shareConfig = this.getShareConfig();
        var share = shareConfig.copy();
        share.desc = desc;
        return share;
    },

    getWheelLeftTime: function () {
        var lastWheelTime = game.playerMan.getLastWheelTime();
        return (lastWheelTime + this.FREE_WHEEL_HOURS * this.ONE_HOUR_SECONDS - Date.now());
    },

    isFreeWheel: function () {
        var leftTime = this.getWheelLeftTime();
        if (leftTime <= 0) {
            return true;
        }
        return false;
    },

    addGiftCount: function () {
        this.giftCount++;
    },

    canShowGift: function () {
        return false;
        if (this.levelId >= 9) {
            if (this.levelId % 3 === 0) {
                if (this.giftCount < 3) {
                    this.lastShowLevel = this.levelId;
                    return true;
                }
            }
        }
        return false;
    },

    getCurrentSkinCfg: function () {
        var currentSkinId = game.playerMan.getCurrentSkinId();
        var skinCfg = ConfigMan.getInstance().getSkinCfg(currentSkinId);
        return skinCfg;
        //return skinCfg.image + ".png";
    },

    updateSkin: function (sprite) {
        var skinCfg = this.getCurrentSkinCfg();
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame(skinCfg.image + ".png");
        if (spriteFrame) {
            sprite.setSpriteFrame(spriteFrame);
        } else {
            var defaultSpriteFrame = cc.spriteFrameCache.getSpriteFrame("skin_0.png");
            sprite.setSpriteFrame(defaultSpriteFrame);
        }
    },

    checkAutoPopup: function () {
        if (!this.checkDailyBonus()) {
            if (!this.checkSpecialOffer()) {
                this.checkNextDayTip();
            }
        }
    },

    checkNextDayTip: function () {
        if (this.resultCount >= 3) {
            if (!game.playerMan.player.nextDayTips) {
                //game.popupMan.popupCommonDlg(_("next_day_tips"));
                game.popupMan.popupRewardDlg(_("next_day_tips"),
                    function () {
                    }, "icon_gifts.png", 1);
                game.playerMan.setNextDayTips();
                return true;
            }
        }
        return false;
    },

    checkDailyBonus: function () {
        var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
        var currentDayClaimed = lastClaimDay >= game.utils.getDayByTs(Date.now());
        if (!currentDayClaimed) {
            cc.log("game.popupMan.popupDailyBonus");
            game.popupMan.popupDailyBonus();
            return true;
        }
        return false;
    },

    checkSpecialOffer: function () {
        if (this.isSpecialOfferPurchased()) {
            return false;
        }
        if (!this.showedSpecialOffer) {
            this.showedSpecialOffer = true;
            game.popupMan.popupSpeicialOffer();
            return true;
        }
        return false;
    },

    isSpecialOfferPurchased: function () {
        var specialOffer = ConfigMan.getInstance().getSpecialOfferCfg();
        var purchased = game.playerMan.isSpecialOfferPurchased(specialOffer.pid);
        cc.log("isSpecialOfferPurchased:" + purchased);
        return purchased;
    },

    adjustSkinConfigs: function () {
        if (game.playerMan.player.skinAdjusted) {
            return;
        }
        game.playerMan.setSkinAdjusted();
        var oldTaskConfigs = ConfigMan.getInstance().getOldTaskList();
        for (var i = 0; i < oldTaskConfigs.length; ++i) {
            var oldTaskConfig = oldTaskConfigs[i];
            this.adjustOldTaskConfig(oldTaskConfig);
        }
    },

    adjustOldTaskConfig: function (data) {
        var SkinRewardType = require("../enum/SkinRewardType");
        var completed = false;
        switch (data.type) {
            case SkinRewardType.None:
                completed = true;
                break;
            case SkinRewardType.LevelCount:
                if (game.playerMan.getLevel() >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchAdCount:
                if (game.playerMan.player.interstitialAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchRewardAdCount:
                if (game.playerMan.player.rewardedAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.Claimed:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
            case SkinRewardType.Purchase:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
        }

        if (completed) {
            game.playerMan.setClaimedSkin(data.id);
            game.playerMan.setTaskClaimed(data.id);
        }
    },

    hasCompletedTask: function () {
        var taskConfigs = ConfigMan.getInstance().getTaskList();
        for (var i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = taskConfigs[i];
            if (game.playerMan.isTaskClaimed(taskConfig.id)) {
                continue;
            }
            if (this.isTaskCompleted(taskConfig)) {
                return true;
            }
        }
        return false;
    },

    isTaskCompleted: function (data) {
        var SkinRewardType = require("../enum/SkinRewardType");
        var completed = false;
        switch (data.type) {
            case SkinRewardType.None:
                completed = true;
                break;
            case SkinRewardType.LevelCount:
                if (game.playerMan.getLevel() >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchAdCount:
                if (game.playerMan.player.interstitialAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchRewardAdCount:
                if (game.playerMan.player.rewardedAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.Claimed:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
            case SkinRewardType.Purchase:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
        }
        return completed;
    }
});

GameMan._instance = null;
GameMan._firstUseInstance = true;

/**
 *
 * @returns {GameMan}
 */
GameMan.getInstance = function () {
    if (GameMan._firstUseInstance) {
        GameMan._firstUseInstance = false;
        GameMan._instance = new GameMan();
    }
    return GameMan._instance;
};

module.exports = GameMan;
},{"../../common/enum/AdsPlace":9,"../config/ConfigMan":36,"../config/ShareConfig":39,"../enum/SkinRewardType":96,"../events/EventsName":98}],100:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var PlayerInfo = require("../entity/PlayerInfo");
var EventsName = require("../events/EventsName");

var PLAYER_KEY = "player_key";

var PlayerMan = cc.Class.extend({
    player: null,
    bestScoreKey: null,
    levelBoardKey: null,

    inited: false,
    ctor: function () {
    },

    initData: function () {
        if (this.inited) {
            return;
        }
        this.inited = false;
        var playerInfoStr = game.storageController.getItem(PLAYER_KEY, null);
        var player;
        if (playerInfoStr == null || playerInfoStr == "") {
            player = PlayerInfo.createDefault();
            game.storageController.setItem(PLAYER_KEY, JSON.stringify(player));
        } else {
            player = new PlayerInfo();
            player.unmarshall(JSON.parse(playerInfoStr));
        }
        this.player = player;
    },

    removedAds: function () {
        this.player.removedAds = true;
        game.adsManager.removeBannerAds("top");
        game.adsManager.removeBannerAds("bottom");
        this._flushToStorage();
    },

    setRated: function () {
        this.player.rated = true;
        this._flushToStorage();
    },

    getLevel: function () {
        if (cc.isUndefined(this.player.level)) {
            return 1;
        } else {
            return this.player.level;
        }
    },

    setLevel: function (level) {
        if (this.player.level < level) {
            this.player.level = level;
            this._flushToStorage();
        }
    },

    updateLevelData: function (level, name, data) {
        if (cc.isUndefined(this.player.levelsMap[level])) {
            this.player.levelsMap[level] = {};
        }
        this.player.levelsMap[level][name] = data;
        this._flushToStorage();
    },

    getLevelData: function (level, name) {
        return (this.player.levelsMap[level] || {})[name];
    },

    getLevelStar: function (level) {
        return this.getLevelData(level, "star") || 0;
    },

    getHardLevelStar: function (level) {
        return this.getLevelData(level, "hardStar") || 0;
    },

    addInterstitialAdCount: function () {
        this.player.interstitialAdCount++;
        this._flushToStorage();
    },

    addRewardedAdCount: function () {
        this.player.rewardedAdCount++;
        this._flushToStorage();
    },

    setHardLevel: function (level) {
        if (this.player.hardLevel < level) {
            this.player.hardLevel = level;
            this._flushToStorage();
        }
    },

    getHardLevel: function () {
        if (cc.isUndefined(this.player.hardLevel)) {
            return 1;
        } else {
            return this.player.hardLevel;
        }
    },

    getBoostCount: function (boostType) {
        return this.player.boostMap[boostType] || 0;
    },

    useBoost: function (boostType) {
        if (this.getBoostCount(boostType) > 0) {
            this.player.boostMap[boostType]--;
            this._flushToStorage();
            return true;
        }
        return false;
    },

    addBoost: function (boostType, count) {
        this.player.boostMap[boostType] += count;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.REFRESH_BOOST);
    },

    addDiamonds: function (diamonds) {
        if (isNaN(diamonds)) {
            cc.error("diamonds is NAN");
            return;
        }
        if (diamonds > 0) {
            game.audioPlayer.playEffectByKey("diamond_add");
        }
        this.player.diamonds += diamonds;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.DIAMONDS_UPDATE);
    },

    getDiamonds: function () {
        return this.player.diamonds;
    },

    setTaskClaimed: function (taskId) {
        cc.log("PlayerMan setTaskClaimed:" + taskId);
        this.player.taskMap[taskId] = true;
        this._flushToStorage();
    },

    isTaskClaimed: function (taskId) {
        cc.log("PlayerMan isTaskClaimed:" + taskId);
        return !!this.player.taskMap[taskId];
    },

    setGuided: function (guided) {
        this.player.guided = guided;
        this._flushToStorage();
    },

    setLastWheelTime: function (wheelTime) {
        this.player.lastWheelTime = wheelTime;
        this._flushToStorage();
    },

    getLastWheelTime: function () {
        return this.player.lastWheelTime;
    },

    //addPlayCount: function () {
    //    this.player.playCount++;
    //    this._flushToStorage();
    //},
    //
    //getPlayCount: function () {
    //    return this.player.playCount;
    //},

    setCurrentSkinId: function (skinId) {
        if (skinId === this.player.currentSkinId) {
            return;
        }
        var BallPool = require("../entity/BallPool");
        BallPool.drainAllPools();
        this.player.currentSkinId = skinId;
        this._flushToStorage();
    },

    getCurrentSkinId: function () {
        return this.player.currentSkinId;
    },

    setClaimedSkin: function (skinId) {
        this.player.skinMap[skinId] = true;
        this._flushToStorage();
    },

    hasSkin: function (skinId) {
        return !!this.player.skinMap[skinId];
    },

    isNewPlayer: function () {
        return (Date.now() - this.player.createDt < 24 * 3600 * 1000);
    },

    getRegisterDay: function () {
        return Math.floor((Date.now() - this.player.createDt) / (24 * 3600 * 1000)) + 1;
    },

    currentDay: function(){
        return game.utils.getDayByTs(Date.now());
    },

    checkConsecutiveLoginDay: function() {
        var today = this.currentDay();
        var days = today - this.player.lastLoginDay;
        if (days < 0) {
            cc.error("consecutive login day error, today is smaller than lastLoginDay, maybe you have adjust the time.");
            days = 0;
        }
        if (days <= 1){
            this.player.consecutiveLoginDays += days;
        }
        else{
            this.player.consecutiveLoginDays = 1;
        }

        this.player.lastLoginDay = today;
        if (this.player.consecutiveLoginDays < 1) {
            this.player.consecutiveLoginDays = 1;
        }
        return this.player.consecutiveLoginDays;
    },

    setLastClaimDailyBonusDay: function (day) {
        this.player.lastClaimDailyBonusDay = day;
        this._flushToStorage();
    },

    setNextDayTips: function () {
        this.player.nextDayTips = true;
        this._flushToStorage();
    },

    isSpecialOfferPurchased: function (pid) {
        return this.player.specialOfferMap[pid] || false;
    },

    setSpecialOfferPurchased: function (pid) {
        this.player.specialOfferMap[pid] = true;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SPECIAL_OFFER);
    },

    setSkinAdjusted: function () {
        this.player.skinAdjusted = true;
        this._flushToStorage();
    },

    setLastShowRateTime: function () {
        this.player.lastShowRateTime = Date.now();
        this._flushToStorage();
    },

    addRewardAdCountPerDay: function () {
        this.tryClearPreviousAdCountPerDay();
        if (cc.isUndefined(this.player.rewardAdCountPerDay)) {
            this.player.rewardAdCountPerDay = 0;
        }
        this.player.rewardAdCountPerDay++;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.REWARDED_VIDEO_COUNT);
    },

    getRewardAdPlaceCountPerDay: function () {
        this.tryClearPreviousAdCountPerDay();
        return this.player.rewardAdCountPerDay || 0;
    },

    tryClearPreviousAdCountPerDay: function () {
        if (this.player.rewardAdRecordDay !== this.getRegisterDay()) {
            this.player.rewardAdCountPerDay = 0;
            this.player.rewardAdRecordDay = this.getRegisterDay();
        }
    },

    addIapCount: function () {
        this.player.iapCount++;
        this._flushToStorage();
    },

    _flushToStorage: function () {
        game.storageController.setItem(PLAYER_KEY, JSON.stringify(this.player));
    }
});

PlayerMan._instance = null;
PlayerMan._firstUseInstance = true;

/**
 *
 * @returns {PlayerMan}
 */
PlayerMan.getInstance = function () {
    if (PlayerMan._firstUseInstance) {
        PlayerMan._firstUseInstance = false;
        PlayerMan._instance = new PlayerMan();
    }
    return PlayerMan._instance;
};

module.exports = PlayerMan;
},{"../entity/BallPool":82,"../entity/PlayerInfo":87,"../events/EventsName":98}],101:[function(require,module,exports){
/**
 * Created by oye on 15/11/21.
 */

var NoticeController = require("../controller/NoticeController");
var GameOverController = require("../controller/GameOverController");
var HelpController = require("../controller/HelpController");
var GameWinController = require("../controller/GameWinController");
var PassController = require("../controller/PassController");
var StoreController = require("../controller/StoreController");
var PauseController = require("../controller/PauseController");
var FailController = require("../controller/FailController");
var RankController = require("../controller/RankController");
var RewardVideoController = require("../controller/RewardVideoController");
var WheelController = require("../controller/WheelController");
var RewardDoubleController = require("../controller/RewardDoubleController");
var BagController = require("../controller/BagController");
var RewardGiftController = require("../controller/RewardGiftController");
var SkinController = require("../controller/SkinController");
var DailyBonusController = require("../controller/DailyBonusController");
var SpecialOfferController = require("../controller/SpecialOfferController");
var RewardNoticeController = require("../controller/RewardNoticeController");
var TaskController = require("../controller/TaskController");

var PopupMan = {

    popupCommonDlg: function (info, yesCallback) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithYes(info, yesCallback, null);
        noticeNode.controller.popup();
    },

    popupYesNoCommonDlg: function (info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose, isShowAds) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithYesNo(info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose, isShowAds);
        noticeNode.controller.popup();
    },

    popupRewardDlg: function (info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithRewardYes(info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count);
        noticeNode.controller.popup();
    },

    popupNewTipCommonDlg: function (info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose) {
        var noticeNode = NoticeController.createGuideFromCCB();
        noticeNode.controller.initWithYesNo(info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose);
        noticeNode.controller.popup();
    },

    popupGameOverDlg: function (percent, replayCallback) {
        var gameOverNode = GameOverController.createFromCCB();
        gameOverNode.controller.initWith(percent, replayCallback);
        gameOverNode.controller.popup();
    },

    popupRateDlg: function (ratedCallback, closeCallback) {
        var rateInfo = game.local.getValue("rate_info");
        this.popupYesNoCommonDlg(rateInfo,
            game.local.getValue("rate_confirm"), game.local.getValue("rate_cancel"), function () {
                //cc.sys.openURL(game.config.getPlatformDownloadUrl());
                if (game.utils.isIOS()) {
                    cc.sys.openURL(game.config.getPlatformDownloadUrl());
                } else {
                    jsb_dp.oneSdkBridge.openApplicationMarket(game.config.getPackageName());
                }
                game.adsManager.rateTime = Date.now();
                if (ratedCallback) {
                    ratedCallback();
                }
            },
            function () {
                if (closeCallback) {
                    closeCallback();
                }
            }, false);
    },

    popupHelpDlg: function () {
        var helpNode = HelpController.createFromCCB();
        helpNode.controller.popup();
    },

    popupGameWinDlg: function (replayCallback, nextCallback) {
        var gameOverNode = GameWinController.createFromCCB();
        gameOverNode.controller.initWith(replayCallback, nextCallback);
        gameOverNode.controller.popup();
    },

    popupPassDlg: function (replayCallback, nextCallback) {
        var node = PassController.createFromCCB();
        node.controller.initWith(replayCallback, nextCallback);
        node.controller.popup();
    },

    popupFailDlg: function (replayCallback, skipCallback) {
        var node = FailController.createFromCCB();
        node.controller.initWith(replayCallback, skipCallback);
        node.controller.popup();
    },

    popupStoreDlg: function (type, callback) {
        var node = StoreController.createFromCCB();
        node.controller.initWith(type, callback);
        node.controller.popup();
    },

    popupPauseDlg: function (resuemCallback) {
        var node = PauseController.createFromCCB();
        node.controller.initWith(resuemCallback);
        node.controller.popup();
    },
    popupRankDlg: function (rankType, closeCallback) {
        var node = RankController.createFromCCB();
        node.controller.init(rankType, closeCallback);
        node.controller.popup();
        return node;
    },
    popupGroupRankDlg: function () {
        if (this.lastGroupRankNode) {
            this.lastGroupRankNode.controller.closeCallback = null;
            this.lastGroupRankNode.controller.close();
        }
        var RankType = require("../enum/RankType");
        var self = this;
        this.lastGroupRankNode = this.popupRankDlg(RankType.Group, function () {
            self.lastGroupRankNode = null;
        });

    },
    popupRewardVideo: function (closeCallback) {
        var node = RewardVideoController.createFromCCB();
        node.controller.init(closeCallback);
        node.controller.popup();
    },

    popupWheelDlg: function () {
        var node = WheelController.createFromCCB();
        node.controller.popup();
    },

    popupRewardDoubleTipDlg: function (image, count, callback) {
        var node = RewardDoubleController.createFromCCB();
        node.controller.init(image, count, callback);
        node.controller.popup();
    },

    popupBagDlg: function () {
        var node = BagController.createFromCCB();
        node.controller.popup();
    },

    popupRewardGift: function (closeCallback) {
        var node = RewardGiftController.createFromCCB();
        node.controller.init(closeCallback);
        node.controller.popup();
    },

    popupSkinDlg: function () {
        var node = SkinController.createFromCCB();
        node.controller.popup();
    },

    popupDailyBonus: function () {
        var node = DailyBonusController.createFromCCB();
        node.controller.popup();
    },

    popupSpeicialOffer: function () {
        var node = SpecialOfferController.createFromCCB();
        node.controller.popup();
    },

    popupRewardNoticeDlg: function (info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count) {
        var noticeNode = RewardNoticeController.createFromCCB();
        noticeNode.controller.initWithRewardYes(info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count);
        noticeNode.controller.popup();
    },

    popupTaskDlg: function () {
        var node = TaskController.createFromCCB();
        node.controller.popup();
    }
};

module.exports = PopupMan;
},{"../controller/BagController":46,"../controller/DailyBonusController":48,"../controller/FailController":50,"../controller/GameOverController":52,"../controller/GameWinController":53,"../controller/HelpController":54,"../controller/NoticeController":59,"../controller/PassController":62,"../controller/PauseController":63,"../controller/RankController":64,"../controller/RewardDoubleController":65,"../controller/RewardGiftController":66,"../controller/RewardNoticeController":67,"../controller/RewardVideoController":68,"../controller/SkinController":69,"../controller/SpecialOfferController":71,"../controller/StoreController":72,"../controller/TaskController":74,"../controller/WheelController":77,"../enum/RankType":93}],102:[function(require,module,exports){
/**
 * Created by qinning on 2018/1/1.
 */

var SceneType = require("../enum/SceneType");
var MenuScene = require("../scene/MenuScene");
var LevelScene = require("../scene/LevelScene");
var PackageScene = require("../scene/PackageScene");
var GameScene = require("../scene/GameScene");
var GameBridge = require("../../common/bridge/GameBridge");

var SceneMan = cc.Class.extend({

    sceneMap: null,

    lastScene: null,
    curScene: null,

    ctor: function () {
        this.sceneMap = {};
        this.register();
        this.lastScene = SceneType.NONE;
        this.curScene = SceneType.MENU;
    },

    setCurScene: function (scene) {
        this.curScene = scene;
    },

    register: function () {
        this.sceneMap[SceneType.MENU] = GameBridge.getMenuScene;
        this.sceneMap[SceneType.PACKAGE] = function () {
            return new PackageScene();
        };
        this.sceneMap[SceneType.LEVEL] = function () {
            return new LevelScene();
        };
        this.sceneMap[SceneType.GAME] = function () {
            return new GameScene();
        };
    },

    switchScene: function (sceneType) {
        this.lastScene = this.curScene;
        this.curScene = sceneType;
        var scene = this.sceneMap[this.curScene];
        if (scene) {
            cc.director.runScene(scene());
        }
    },

    switchLastScene: function () {
        this.switchScene(this.lastScene);
    }
});

SceneMan._instance = null;
SceneMan._firstUseInstance = true;

/**
 *
 * @returns {SceneMan}
 */
SceneMan.getInstance = function () {
    if (SceneMan._firstUseInstance) {
        SceneMan._firstUseInstance = false;
        SceneMan._instance = new SceneMan();
    }
    return SceneMan._instance;
};

module.exports = SceneMan;
},{"../../common/bridge/GameBridge":3,"../enum/SceneType":94,"../scene/GameScene":104,"../scene/LevelScene":105,"../scene/MenuScene":107,"../scene/PackageScene":108}],103:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentInfo = require("../../common/entity/PaymentInfo");
var PaymentCode = require("../../common/enum/PaymentCode");
var ProductInfo = require("../../common/entity/ProductInfo");
var StoreType = require("../enum/StoreType");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var EventsName = require("../events/EventsName");

var StoreHelper = cc.Class.extend({

    /**
     * @type {Array.<ProductInfo>}
     */
    productList: null,
    /**
     * @type {Array.<StoreConfig>}
     */
    storeList: null,

    inited: false,

    _rewardCB: null,

    ctor: function () {
        game.storeManager.setPaymentDelegate(this);
        this.storeList = ConfigMan.getInstance().getStoreList();

        game.adsManager.setAdListener(this);
    },

    init: function () {
        if (this.inited) {
            return;
        }
        this.inited = true;
        this.requestProducts();
        this.getUnverifiedReceiptList();
    },

    clear: function () {
        game.adsManager.setAdListener(null);
    },

    onRewardedVideoFinished: function (isRewarded) {
        cc.log("onRewardedVideoFinished:" + isRewarded);
        this._isRewarded = isRewarded;
        if (isRewarded && cc.sys.os !== cc.sys.OS_ANDROID) {
            this.onRewardedVideoReward();
        }
    },

    onShowVideoAdBegin: function () {
        cc.log("GameNode onShowVideoAdBegin");
        this._isRewarded = false;
    },

    onShowVideoAdEnd: function () {
        cc.log("GameNode onShowVideoAdEnd");
        var time = 100;
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            time = 1000;
        }
        setTimeout(function () {
            if (this._isRewarded && cc.sys.os === cc.sys.OS_ANDROID) {
                this.onRewardedVideoReward();
            }
            if (!this._isRewarded) {
                if (this._rewardCB) {
                    this._rewardCB(false);
                    this._rewardCB = null;
                }
            }
        }.bind(this), time);
    },

    onRewardedVideoReward: function () {
        if (this._rewardCB) {
            this._rewardCB(true);
            this._rewardCB = null;
            return;
        }
        if (game.playerMan.getRewardAdPlaceCountPerDay() > game.config.rewardAdMaxCountPerDay) {
            cc.log("StoreHelper onRewardedVideoReward has reached max count:" + game.playerMan.getRewardAdPlaceCountPerDay());
            return;
        }
        if (this.adParam1) {
            game.analyseManager.trackEvent(this.adParam1);
        } else {
            cc.error("StoreHelper adParam is null:" + this.adParam1);
        }
        game.playerMan.addRewardAdCountPerDay();
        var freeEntity = this.getStoreEntityByType(StoreType.FREE);
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
            function () {
                game.playerMan.addDiamonds(freeEntity.count);
            }, this.getBoostImage(BoostType.DIAMOND), freeEntity.count);
    },

    /**
     * @param pid
     * @returns {StoreConfig | null}
     */
    getStoreEntity: function (pid) {
        for (var i = 0; i < this.storeList.length; ++i) {
            if (this.storeList[i].pid === pid) {
                return this.storeList[i];
            }
        }
        return null;
    },

    getStoreEntityByType: function (type) {
        for (var i = 0; i < this.storeList.length; ++i) {
            if (this.storeList[i].type === type) {
                return this.storeList[i];
            }
        }
        return null;
    },

    getBoostImage: function (boostType) {
        switch (boostType) {
            case BoostType.SPLIT:
                return "store_3_multiple.png";
            case BoostType.THREE_BALL:
                return "store_3_new.png";
            case BoostType.DIAMOND:
                return "icon_diamond_1.png";
        }
    },

    _getNumFromString: function (text) {
        return text.replace(/[^0-9.]/ig, "");
    },

    updatePrice: function (product) {
        var storeProduct = this.getStoreEntity(product.productId);
        if (storeProduct) {
            storeProduct.price = product.price;
            try {
                if (storeProduct.original_price) {
                    var priceStr = this._getNumFromString(product.price);
                    var priceNum = Number(priceStr);
                    storeProduct.original_price = product.price.replace(priceStr,
                        (priceNum * (storeProduct.discount_multi + 1)).toFixed(2));
                }
            } catch (ex) {
                cc.error("update price:" + ex);
            }
        }
    },

    checkAndShowRewardVideo: function (name, cb, param1) {
        this.adParam1 = param1;
        if (game.adsManager.isRewardVideoReady()) {
            this._rewardCB = cb;
            game.adsManager.showRewardVideoAd(name);
        } else {
            cc.log("reward video not ready");
        }
    },

    /**
     * @param {StoreConfig} storeEntity
     */
    buyProduct: function (storeEntity) {
        switch (storeEntity.type) {
            case StoreType.NEW_3:
            case StoreType.SPLIT:
            case StoreType.FIRST_PURCHASE:
                game.storeManager.payForProduct(storeEntity.pid);
                break;
            case StoreType.DIAMOND:
                //game.analyseManager.trackEvent("PurchaseDiamonds", {"pid": storeEntity.pid});
                game.storeManager.payForProduct(storeEntity.pid);
                break;
            case StoreType.FREE:
                this.checkAndShowRewardVideo(game.utils.isIOS() ? "daoju01" : "store");
                break;
            case StoreType.REMOVE_ADS:
                this.buyRemoveAds(storeEntity.pid);
                break;
            case StoreType.RESTORE:
                game.storeManager.restoreCompletedTransactions();
                break;
            case StoreType.NEW_AND_SPLIT:
                this.buyBoosts(storeEntity);
                break;
        }
    },

    buyRemoveAds: function (pid) {
        if (game.playerMan.player.removedAds) {
            game.popupMan.popupCommonDlg(game.local.getValue("removed_all_ads_tips"));
        } else {
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                game.popupMan.popupYesNoCommonDlg(game.local.getValue("purchase_no_ad_tips"),
                    game.local.getValue("buy_title"), game.local.getValue("cancel_title"), function () {
                        game.storeManager.payForProduct(pid);
                    }, null, false);
            } else {
                game.popupMan.popupYesNoCommonDlg(game.local.getValue("purchase_no_ad_tips"),
                    game.local.getValue("buy_title"), game.local.getValue("restore_title"), function () {
                    game.storeManager.payForProduct(pid);
                }, function () {
                    game.storeManager.restoreCompletedTransactions();
                }, true);
            }
        }
    },

    buySkin: function (skinCfg) {
        if (!game.playerMan.hasSkin(skinCfg.id)) {
            if (game.playerMan.getDiamonds() >= skinCfg.count) {
                game.playerMan.setClaimedSkin(skinCfg.id);
                game.playerMan.setCurrentSkinId(skinCfg.id);
                game.playerMan.addDiamonds(-skinCfg.count);
                game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
                game.analyseManager.trackEvent("DiamondPurchaseSkin", {"skinId": skinCfg.id});
            } else {
                game.popupMan.popupCommonDlg(_("diamond_not_enough"));
            }
        }
    },

    useSkin: function (skinCfg) {
        game.playerMan.setCurrentSkinId(skinCfg.id);
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
    },

    buyBoosts: function (storeEntity) {
        if (game.playerMan.getDiamonds() >= storeEntity.count) {
            //game.analyseManager.trackEvent("PurchaseBoosts", {"diamonds": storeEntity.count});
            game.playerMan.addDiamonds(-storeEntity.count);
            var splitCount = storeEntity.data.multiple_3;
            var threeBallCount = storeEntity.data.new_3;
            var splitImage = this.getBoostImage(BoostType.SPLIT);
            var new3Image = this.getBoostImage(BoostType.THREE_BALL);
            game.analyseManager.trackEvent("DiamondPurchaseBoosts", {"diamonds": storeEntity.count});
            game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"),
                function () {
                    game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                    game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                }, splitImage, splitCount, new3Image, threeBallCount);
        } else {
            game.popupMan.popupCommonDlg(_("diamond_not_enough"));
        }
    },

    requestProducts: function () {
        var productIds = [];
        for (var i = 0; i < this.storeList.length; ++i) {
            var entity = this.storeList[i];
            if (entity && entity.pid) {
                productIds.push(entity.pid);
            }
        }
        cc.log("requestproducts:" + JSON.stringify(productIds));
        game.storeManager.requestProduct(productIds);
    },

    getUnverifiedReceiptList: function () {
        game.storeManager.getUnverifiedReceiptList();
    },

    /**
     * @param {PaymentCode} error
     * @param {PaymentInfo} paymentInfo
     */
    onPaymentCompleted: function (error, paymentInfo) {
        var paymentSuccess = false;
        if (error === PaymentCode.PAYMENT_CODE_SUCCESS) {
            this._onPaymentSuccess(paymentInfo, true);
            paymentSuccess = true;
        } else {
            game.popupMan.popupCommonDlg(game.local.getValue("purchase_fail"));
        }
        game.eventDispatcher.dispatchEvent(EventsName.PURCHASE_END, paymentSuccess);
    },

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    onGetUnverifiedReceiptList: function (paymentInfoList) {
        for (var i = 0; i < paymentInfoList.length; ++i) {
            this._onPaymentSuccess(paymentInfoList[i], false);
        }
    },

    /**
     * on get product list.
     * @param {Array.<ProductInfo>} productList
     */
    onGetProductList: function (productList) {
        this.productList = productList;
        for (var i = 0; i < productList.length; ++i) {
            var product = productList[i];
            this.updatePrice(product);
        }
    },

    /**
     * @param {PaymentInfo} paymentInfo
     * @param hasNotice
     * @private
     */
    _onPaymentSuccess: function (paymentInfo, hasNotice) {
        var storeEntity = this.getStoreEntity(paymentInfo.productId);
        var splitImage = this.getBoostImage(BoostType.SPLIT);
        var new3Image = this.getBoostImage(BoostType.THREE_BALL);
        var self = this;
        switch (storeEntity.type) {
            case StoreType.REMOVE_ADS:
                game.playerMan.removedAds();
                if (hasNotice) {
                    game.popupMan.popupCommonDlg(game.local.getValue("purchase_no_ad_success"));
                }
                if (cc.sys.os === cc.sys.OS_IOS) {
                    game.storeManager.consume(paymentInfo.purchaseId);
                }
                self.addIapCount(storeEntity);
                break;
            case StoreType.NEW_3:
            case StoreType.SPLIT:
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"), function () {
                    game.playerMan.addBoost(storeEntity.type, storeEntity.count);
                    game.storeManager.consume(paymentInfo.purchaseId);
                    self.addIapCount(storeEntity);
                }, storeEntity.image, storeEntity.count);
                break;
            case StoreType.FIRST_PURCHASE:
                var diamondCount = storeEntity.data.diamonds;
                var skinId = storeEntity.data.skin;
                var skinImage = storeEntity.data.skin_image;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_diamond_success"),
                    function () {
                        game.playerMan.addDiamonds(diamondCount);
                        game.playerMan.setClaimedSkin(skinId);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        game.playerMan.setSpecialOfferPurchased(paymentInfo.productId);
                        game.analyseManager.trackEvent("PurchaseSpecialOffer");
                        self.addIapCount(storeEntity);
                        game.popupMan.popupRewardDlg(game.local.getValue("skin_claimed"),
                            function () {
                            }, skinImage, 1);
                    }, this.getBoostImage(BoostType.DIAMOND), diamondCount);
                break;
            case StoreType.NEW_AND_SPLIT:
                var splitCount = storeEntity.data.multiple_3;
                var threeBallCount = storeEntity.data.new_3;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"),
                    function () {
                        game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                        game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        self.addIapCount(storeEntity);
                    }, splitImage, splitCount, new3Image, threeBallCount);
                break;
            case StoreType.DIAMOND:
                var count = storeEntity.count;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_diamond_success"),
                    function () {
                        game.playerMan.addDiamonds(count);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        self.addIapCount(storeEntity);
                    }, storeEntity.image, count);
                break;
        }
    },

    addIapCount: function (storeEntity) {
        game.playerMan.addIapCount();
        var iapCount = game.playerMan.player.iapCount;
        if (iapCount === 1) {
            game.analyseManager.trackEvent("FirstPurchase", {"pid": storeEntity.pid});
        } else if (iapCount === 2) {
            game.analyseManager.trackEvent("SecondPurchase", {"pid": storeEntity.pid});
        }
        if (iapCount >= 2) {
            game.analyseManager.trackEvent("MultiPurchase", {"pid": storeEntity.pid});
        }
    },

    popupBoostRewardDlg: function (splitCount, threeBallCount, callback) {
        var new3Image = this.getBoostImage(BoostType.THREE_BALL);
        var splitImage = this.getBoostImage(BoostType.SPLIT);

        var image1 = undefined;
        var count1 = 0;
        var image2 = undefined;
        var count2 = 0;
        if (threeBallCount > 0) {
            image1 = new3Image;
            count1 = threeBallCount;
            if (splitCount > 0) {
                image2 = splitImage;
                count2 = splitCount;
            }
        } else {
            image1 = splitImage;
            count1 = splitCount;
        }

        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_boosts"),
            function () {
                game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                if (callback) {
                    callback();
                }
            }, image1, count1, image2, count2);
    }
});

StoreHelper._instance = null;
StoreHelper._firstUseInstance = true;

/**
 *
 * @returns {StoreHelper}
 */
StoreHelper.getInstance = function () {
    if (StoreHelper._firstUseInstance) {
        StoreHelper._firstUseInstance = false;
        StoreHelper._instance = new StoreHelper();
    }
    return StoreHelper._instance;
};

module.exports = StoreHelper;
},{"../../common/entity/PaymentInfo":6,"../../common/entity/ProductInfo":8,"../../common/enum/PaymentCode":10,"../config/ConfigMan":36,"../enum/BoostType":89,"../enum/StoreType":97,"../events/EventsName":98}],104:[function(require,module,exports){
var GameController = require("../controller/GameController");
var GameMan = require("../model/GameMan");

var GameScene = cc.Scene.extend({
    _gameType: 0,
    _isBackClicked: false,

    ctor: function () {
        this._super();
        game.adsManager.removeBannerAds("bottom");
        var gameNode = GameController.createFromCCB();
        this.addChild(gameNode);
    },

    onEnter:function () {
        this._super();

        //cc.eventManager.addListener({
        //    event: cc.EventListener.KEYBOARD,
        //    onKeyReleased: function (keyCode, event) {
        //        if (keyCode === cc.KEY.back) {
        //            if (!this._isBackClicked) {
        //                this._isBackClicked = true;
        //                game.sceneMan.switchLastScene();
        //            }
        //        }
        //    }.bind(this)
        //}, this);
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = GameScene;

},{"../controller/GameController":51,"../model/GameMan":99}],105:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var LevelController = require("../controller/LevelController");

var LevelScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var layer = LevelController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.PACKAGE);
                    }
                }
            }.bind(this)
        }, this);

        if (game.playerMan.getLevel() >= 3) {
            game.adsManager.showBannerAds("bottom");
        }
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = LevelScene;
},{"../controller/LevelController":55,"../controller/MenuController":58,"../model/StoreHelper":103}],106:[function(require,module,exports){
/**
 * Created by oye on 15-4-19.
 */
var LoadingController = require("../controller/LoadingController");

var LoadingScene = cc.Scene.extend({
    ctor:function () {
        this._super();
        var layer = LoadingController.createFromCCB();
        this.addChild(layer);
    }
});

module.exports = LoadingScene;
},{"../controller/LoadingController":57}],107:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var PlayerMan = require("../model/PlayerMan");
var SceneMan = require("../model/SceneMan");
var SceneType = require("../enum/SceneType");
//var BricksView = require("../view/BricksView");

window.isFirstEnter = true;

var MenuScene = cc.Scene.extend({

    ctor: function () {
        this._super();

        var layer = MenuController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        var self = this;
        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!self._isBackClicked) {
                        self._isBackClicked = true;
                        game.popupMan.popupYesNoCommonDlg(_("exit_game_confirm"), _("yes_title"), _("no_title"), function () {
                            game.logicMan.scheduleLocalNotification();
                            cc.director.end();
                        }, function () {
                            self._isBackClicked = false;
                        });
                    }
                }
            }
        }, this);

        if (game.playerMan.getLevel() >= 3) {
            game.adsManager.showBannerAds("bottom");
        }

        if (game.adsManager.showTopBanner) {
            game.adsManager.removeBannerAds("top");
        }

        this.scheduleOnce(function () {
            StoreHelper.getInstance().init();
            game.gcManager.reportScore(0, game.config.getLeaderBoardKey());
            if (!window.isFirstEnter) {
                game.crossPromMan.tryToPopupCrossPromDlg();
            } else {
                window.isFirstEnter = false;
            }
        }, 1);
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = MenuScene;
},{"../controller/MenuController":58,"../enum/SceneType":94,"../model/GameMan":99,"../model/PlayerMan":100,"../model/SceneMan":102,"../model/StoreHelper":103}],108:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var PackageController = require("../controller/PackageController");

var PackageScene = cc.Scene.extend({
    ctor: function () {
        this._super();
        var layer = PackageController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.MENU);
                    }
                }
            }.bind(this)
        }, this);
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = PackageScene;
},{"../controller/MenuController":58,"../controller/PackageController":60,"../model/StoreHelper":103}],109:[function(require,module,exports){
var Grid = require("../entity/Grid");
var Ball = require("../entity/Ball");
var BoardController = require("../controller/BoardController");
var BallPool = require("../entity/BallPool");
var Utils = require("../../common/util/Utils");
var GridType = require("../enum/GridType");
var Board = require("../entity/Board");
var ShapeType = require("../enum/ShapeType");
var Boost = require("../entity/Boost");
var BoostType = require("../enum/BoostType");
var Obstacle = require("../entity/Obstacle");
var Wall = require("../entity/Wall");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");

var ColorConfigs = [
    cc.color(252, 178, 0),
    cc.color(81, 229, 12),
    cc.color(27, 226, 255),
    cc.color(255, 252, 29),
    cc.color(255, 56, 56),
    cc.color(248, 70, 255),
    cc.color(255, 129, 17),
    cc.color(57, 103, 249),
    cc.color(90, 181, 110),

    cc.color(255, 90, 141),
    cc.color(242, 86, 9),
    cc.color(66, 46, 176),
    cc.color(144, 85, 222),
    cc.color(23, 167, 104),
    cc.color(176, 72, 206),
    cc.color(147, 192, 26),
    cc.color(55, 70, 219)
];

var GrayColor = cc.color(82, 82, 82);

var getColor = function (type) {
    return ColorConfigs[(type - 1) % ColorConfigs.length];
};

var GameStep = {
    PRE_START: 1,
    START: 2,
    RELIFE: 3,
    WATCH_AD: 4,
    END: 5
};

var BricksView = cc.Node.extend({
    SPACE_STEP: 1 / 60,
    LIFE_POSIBILITY: 0.005,
    BOOST_POSIBILITY: 0.06,
    MAX_SPEED: 420,
    MAX_LIFE: 6,
    BOOST_SPEED: 80,
    MAX_BALL: 1000,
    TOP_INNER_WALL: 50,
    MAX_SPLIT_COUNT: 100,
    TOP_AD_WALL: 100,
    //this.TOP_AD_WALL = 100;

    /**
     * @type {LevelConfig}
     */
    config: null,

    row: 0,
    col: 0,

    ballList: null,

    gameStep: -1,

    lifeCount: 3,

    gameController: null,

    //startTime: 0,

    stoped: false,

    lastTime: 0,

    totalTime: 0,
    lastAdjustTime: 0,

    hardMode: false,

    accumulator: 0,

    _curTouchId: -1,

    ctor: function (config, gameController) {
        this._super();
        if (cc.sys.os === cc.sys.OS_IOS) {
            this.MAX_BALL = 1000;
        }
        this.hardMode = GameMan.getInstance().isHardMode();
        if (this.hardMode) {
            config = config.getHardCfg();
        }
        if (config.lifeProbability > 0) {
            this.LIFE_POSIBILITY *= config.lifeProbability;
        }
        if (config.boostProbability > 0) {
            this.BOOST_POSIBILITY *= config.boostProbability;
        }
        this.gameController = gameController;
        this.config = config;
        this.row = config.width;
        this.col = config.height;

        this.GRID_WIDTH = config.pixelWidth / config.width * 0.7;
        this.GRID_HEIGHT = config.pixelHeight / config.height * 0.7;

        this.GAP_WIDTH = config.pixelWidth / config.width - this.GRID_WIDTH;
        this.GAP_HEIGHT = config.pixelHeight / config.height - this.GRID_HEIGHT;

        var minBrickHeight = 600 + this.TOP_INNER_WALL + this.TOP_AD_WALL + 10;
        var maxBrickHeight = cc.winSize.height - minBrickHeight;
        
        this.BRICK_Y = Math.min(cc.winSize.height * 0.3, maxBrickHeight);

        this.BOARD_Y = this.BRICK_Y - cc.winSize.height * 0.16;

        this.setContentSize(cc.winSize);

        this.init();
    },

    onEnter: function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this),
            onTouchCancelled: this.onTouchCancelled.bind(this)
        }, this);

        this.scheduleUpdate();

        this.space.setDefaultCollisionHandler(
            this.collisionBegin.bind(this),
            this.collisionPre.bind(this),
            this.collisionPost.bind(this),
            this.collisionSeparate.bind(this)
        );
        this.gameStep = GameStep.PRE_START;
        game.eventDispatcher.addEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);

        this.showTopBannerAds();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    this.tryShowPause();
                }
            }.bind(this)
        }, this);
    },

    onExit: function () {
        game.eventDispatcher.removeEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
        //this.space.removeCollisionHandler(ShapeType.BALL,
        //    ShapeType.BRICK);
        this.unscheduleUpdate();
        this.removeTopBannerAds();
        //BallPool.drainAllPools();
        this.space = null;
        this.ballList = null;
        this.boosts = null;
        this.obstacles = null;
        this.walls = null;
        this.bricks = null;
        this._super();
    },

    gameOnHide: function () {
        if (this.gameStep === GameStep.START) {
            this.tryShowPause();
        }
    },

    tryShowPause: function () {
        if (!this.stoped) {
            if (this.gameController) {
                this.gameController.showPause();
            }
        }
    },

    init: function () {
        this.initWorld();
        this.initObstacles();
        this.initBricks();
        this.initBoard();

        this.ballList = [];
        this.boosts = [];
    },

    initObstacles: function () {
        this.obstacles = [];
        this.walls = [];
        for (var i = 0; i < this.config.obstacles.length; ++i) {
            var obstacleCfg = this.config.obstacles[i];
            for (var x = 0; x < obstacleCfg.width; ++x) {
                for (var y = 0; y < obstacleCfg.height; ++y) {
                    var localCol = x + obstacleCfg.x;
                    var localRow = y + obstacleCfg.y;
                    var obstacle = BallPool.getFromPool("obstacle");
                    if (!obstacle) {
                        obstacle = new Obstacle(GrayColor, this.GRID_WIDTH, this.GRID_HEIGHT);
                    } else {
                        obstacle.reset(GrayColor, this.GRID_WIDTH, this.GRID_HEIGHT);
                    }
                    this.addChild(obstacle);
                    obstacle.setPosition(this.getGridPos(localRow, localCol));
                    this.obstacles.push(obstacle);
                }
            }
            var WALL_FILL_SIZE = cc.size(6, 6);
            var wall = new Wall();
            wall.setContentSize(cc.size(
                this.GRID_WIDTH * obstacleCfg.width + this.GAP_WIDTH * (obstacleCfg.width - 1) + WALL_FILL_SIZE.width,
                this.GRID_HEIGHT * obstacleCfg.height + this.GAP_HEIGHT * (obstacleCfg.height - 1) + WALL_FILL_SIZE.height));
            this.walls.push(wall);
            this.addChild(wall);
            var pos = cc.pAdd(this.getGridPos(obstacleCfg.y, obstacleCfg.x),
                cc.p(-0.5 * this.GRID_WIDTH, -0.5 * this.GRID_HEIGHT));
            pos = cc.pAdd(pos, cc.p(-WALL_FILL_SIZE.width * 0.5, -WALL_FILL_SIZE.height * 0.5));
            wall.initBody(this.space, pos);
        }
    },

    initBricks: function () {
        this.bricks = [];
        for (var i = 0; i < this.config.bricks.length; ++i) {
            var brickCfg = this.config.bricks[i];
            for (var x = 0; x < brickCfg.width; ++x) {
                for (var y = 0; y < brickCfg.height; ++y) {
                    var brick = this.createBrick(x, y, brickCfg);
                    this.bricks.push(brick);
                }
            }
        }
    },

    createBrick: function (x, y, brickCfg) {
        var localCol = x + brickCfg.x;
        var localRow = y + brickCfg.y;
        var brick = BallPool.getFromPool("brick");
        if (!brick) {
            brick = new Grid(getColor(brickCfg.type), this.GRID_WIDTH, this.GRID_HEIGHT, GridType.BRICK);
        } else {
            brick.reset(getColor(brickCfg.type), this.GRID_WIDTH, this.GRID_HEIGHT, GridType.BRICK);
        }
        this.addChild(brick);
        brick.initBody(this.space, this.getGridPos(localRow, localCol));
        return brick;
    },

    initBoard: function () {
        this.boardNode = new Board(this.getBallWidth());
        this.addChild(this.boardNode);
        this.boardNode.initBody(this.space, cc.p(cc.winSize.width * 0.5, this.BOARD_Y));
    },

    getBallWidth: function () {
        return Math.max(this.GRID_WIDTH, 8);
    },

    initWorld: function () {
        this.WALL_THICK = 50;
        this.INNER_WALL = 20;
        //this.TOP_INNER_WALL = 50;
        this.space = new cp.Space();
        var walls = [
            {
                "shape": cc.size(cc.winSize.width + this.WALL_THICK, this.WALL_THICK), //bottom
                "pos": cp.v(cc.winSize.width * 0.5 - this.WALL_THICK * 0.5, -this.WALL_THICK * 0.5 + this.INNER_WALL)
            },
            {
                "shape": cc.size(cc.winSize.width + this.WALL_THICK, this.WALL_THICK), //top
                "pos": cp.v(cc.winSize.width * 0.5 - this.WALL_THICK * 0.5, cc.winSize.height + this.WALL_THICK * 0.5 - this.TOP_INNER_WALL - this.TOP_AD_WALL)
            },
            {
                "shape": cc.size(this.WALL_THICK, cc.winSize.height + this.WALL_THICK), //left
                "pos": cp.v(-this.WALL_THICK * 0.5 + this.INNER_WALL, cc.winSize.height * 0.5 - this.WALL_THICK * 0.5)
            },
            {
                "shape": cc.size(this.WALL_THICK, cc.winSize.height + this.WALL_THICK), //right
                "pos": cp.v(cc.winSize.width + this.WALL_THICK * 0.5 - this.INNER_WALL, cc.winSize.height * 0.5 - this.WALL_THICK * 0.5)
            }
        ];

        for (var i = 0; i < walls.length; i++) {
            var body = new cp.Body(Infinity, Infinity);
            var wall = walls[i];
            var shape = new cp.BoxShape(body, wall.shape.width, wall.shape.height);
            shape.setElasticity(1);
            shape.setFriction(0);
            body.setPos(wall.pos);
            this.space.addStaticShape(shape);
        }

        // Gravity
        this.space.gravity = cp.v(0, 0);
        this.space.sleepTimeThreshold = 0.5;
        this.space.collisionSlop = 0.5;
        this.space.iterations = 5;
        if (cc.sys.isNative) {
            this.space.useSpatialHash(this.GRID_WIDTH + 2, 10000);
        }

        //this.initDebugMode();
    },

    initDebugMode: function () {
        this._debugNode = cc.PhysicsDebugNode.create(this.space);
        this.addChild(this._debugNode);
    },

    getGridPos: function (localRow, localCol) {
        var gridSize = this.getGridSize();
        return cc.p((cc.winSize.width - this.config.pixelWidth) * 0.5 + (gridSize.width + this.GAP_WIDTH) * (localCol + 0.5),
            (gridSize.height + this.GAP_HEIGHT) * (localRow + 0.5) + this.BRICK_Y);
    },

    getGridSize: function () {
        if (!this.lastGridSize) {
            this.lastGridSize = cc.size(this.GRID_WIDTH, this.GRID_HEIGHT);
        }
        return this.lastGridSize;
    },

    update: function (dt) {
        if (this.stoped) {
            return;
        }
        switch (this.gameStep) {
            case GameStep.PRE_START:

                break;
            case GameStep.START:
                this.updateTime(dt);
                this.updateGrids(dt);
                this.updateChipmunk(dt);
                this.updateBoost(dt);
                this.checkGameOver();
                break;
            case GameStep.RELIFE:
                if (this.gameController) {
                    this.gameController.updateLifeCount();
                }
                this.removeAllBoosts();
                this.boardNode.showBall();
                this.gameStep = GameStep.PRE_START;
                break;
            case GameStep.END:
                this.updateChipmunk(dt);
                //this.updateBoost(dt);
                break;
        }
    },

    updateTime: function (dt) {
        if (!this.eclipsedTime) {
            this.eclipsedTime = 0;
        }
        this.eclipsedTime += dt * 1000;
        //if (!this.startTime) {
        //    this.startTime = Date.now();
        //}
        if (this.gameController) {
            this.gameController.updateTime();
        }
    },

    updateBalls: function (dt) {
        for (var i = this.ballList.length - 1; i >= 0; --i) {
            var ball = this.ballList[i];
            if (ball.getPosition().y < this.boardNode.y - 40 || !this.isInView(ball)) {
                this.removeBall(ball);
            } else {
                ball.update(dt);
            }
        }
    },

    adjustBallSpeed: function (ball) {
        var vel = ball.getVel();
        var distance = cc.pLength(vel);
        //cc.log("adjustBallSpeed:" + distance);
        if (distance < this.MAX_SPEED * 0.9) {
            var radian = Math.atan(vel.x / vel.y);
            ball.setVel(cc.p(this.MAX_SPEED * Math.sin(radian), this.MAX_SPEED * Math.cos(radian)));
        }
    },

    updateGrids: function (dt) {
        for (var i = this.bricks.length - 1; i >= 0; --i) {
            var brick = this.bricks[i];
            if (brick.removeable) {
                this.removeBrick(brick);
            }
        }
    },

    updateChipmunk: function (dt) {
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            if (this.ballList.length > 20) {
                this.space.step(1 / 60);
            } else {
                for (var i = 0; i < 2; ++i) {
                    this.space.step(1 / 120);
                }
            }
        } else {
            if (this.ballList.length > 20) {
                for (var i = 0; i < 2; ++i) {
                    this.space.step(1 / 120);
                }
            } else {
                for (var i = 0; i < 3; ++i) {
                    this.space.step(1 / 180);
                }
            }
        }
        //var step = this.SPACE_STEP;
        //var frameTime = Math.min(dt, 0.25);
        //this.accumulator += frameTime;
        //while (this.accumulator >= step) {
        //    this.space.step(step);
        //    this.accumulator -= step;
        //}
        this.updateBalls(dt);
        this.adjustRandomVel(dt);
    },

    adjustRandomVel: function (dt) {
        var RANDOM_MAX_COUNT = 10;
        if (this.totalTime - this.lastAdjustTime > 5) {
            this.lastAdjustTime = this.totalTime;
            if (this.ballList.length < 10) {
                for (var i = this.ballList.length - 1; i >= 0; --i) {
                    var ball = this.ballList[i];
                    var random1 = game.utils.rangeNextNumber(-RANDOM_MAX_COUNT * 0.5, RANDOM_MAX_COUNT * 0.5);
                    var random2 = game.utils.rangeNextNumber(-RANDOM_MAX_COUNT * 0.5, RANDOM_MAX_COUNT * 0.5);
                    ball.setVel(cc.pAdd(ball.getVel(), cc.p(random1, random2)));
                }
            }
        }
        this.totalTime += dt;
    },

    updateBoost: function (dt) {
        for (var i = this.boosts.length - 1; i >= 0; --i) {
            var boost = this.boosts[i];
            boost.y -= dt * this.BOOST_SPEED;
            if (cc.rectIntersectsRect(boost.getBoundingBox(), this.boardNode.getBoundingBox())) {
                switch (boost.type) {
                    case BoostType.LIFE:
                        this.onAddLife();
                        break;
                    case BoostType.SPLIT:
                        this.useSplitBallBoost();
                        break;
                    case BoostType.THREE_BALL:
                        this.useNew3BallBoost();
                        break;
                }
                this.boosts.splice(i, 1);
                boost.removeFromParent();
            }
        }
    },

    useSplitBallBoost: function () {
        this.tryShootFirstBall();
        game.audioPlayer.playEffectByKey("boost_add");
        for (var j = this.ballList.length - 1; j >= 0; --j) {
            var ball = this.ballList[j];
            this.onSplitBall(ball.getPosition());
        }
    },

    useNew3BallBoost: function () {
        this.tryShootFirstBall();
        game.audioPlayer.playEffectByKey("boost_add");
        this.onShoot3Ball();
    },

    onAddLife: function () {
        this.lifeCount++;
        if (this.gameController) {
            this.gameController.updateLifeCount();
        }
        game.audioPlayer.playEffectByKey("life_add");
    },

    onSplitBall: function (position) {
        var vel = this.MAX_SPEED;
        for (var i = 0; i < 3; ++i) {
            var angle = game.utils.randomNextInt(90);
            var symbol1 = (game.utils.randomNextInt(2) === 1 ? 1 : -1);
            var symbol2 = (game.utils.randomNextInt(2) === 1 ? 1 : -1);
            var x = 10,y = 10;
            var randomPos = cc.pAdd(position, cc.p(-x / 2 + x * game.utils.randomNextNumber(1),
                -y / 2 + y * game.utils.randomNextNumber(1)));
            this.shootBall(randomPos, cc.p(symbol1 * vel * Math.sin(Math.PI / 180 * angle),
                    symbol2 * vel * Math.cos(Math.PI / 180 * angle)));
        }
    },

    onShoot3Ball: function () {
        var vel = this.MAX_SPEED;
        for (var i = 0; i < 3; ++i) {
            var angle = game.utils.randomNextInt(90);
            var symbol = (game.utils.randomNextInt(2) === 1 ? 1 : -1);
            this.shootBall(this.getInitBallPos(), cc.p(symbol * vel * Math.sin(Math.PI / 180 * angle),
                vel * Math.cos(Math.PI / 180 * angle)));
        }
    },

    switchPassDlg: function () {
        game.audioPlayer.playEffectByKey("victory");
        setTimeout(function () {
            if (GameMan.getInstance().hasNextLevel()) {
                game.popupMan.popupPassDlg(function () {
                    GameMan.getInstance().resumeGame();
                    game.sceneMan.switchScene(game.sceneType.GAME);
                }, function () {
                    game.sceneMan.switchScene(game.sceneType.GAME);
                });
            } else {
                game.popupMan.popupCommonDlg(game.local.getValue("all_completed"), function () {
                    game.sceneMan.switchScene(game.sceneType.LEVEL);
                });
            }
        }, 500);
    },

    checkGameOver: function () {
        var self = this;
        if (this.bricks.length === 0) {
            this.gameStep = GameStep.END;
            this.showBannerAds();
            GameMan.getInstance().gameWin(this.eclipsedTime / 1000);
            var star = GameMan.getInstance().currentStar;
            if (star < 3 && GameMan.getInstance().canPop3StarTips()) {
                GameMan.getInstance().setPop3StarTips();
                game.popupMan.popupYesNoCommonDlg(_("star_3_tips"), _("retry_title"), _("no_title"), function () {
                    GameMan.getInstance().resumeGame();
                    game.sceneMan.switchScene(game.sceneType.GAME);
                }, function () {
                    self.switchPassDlg();
                });
            } else {
                this.switchPassDlg();
            }
        } else if (this.ballList.length === 0) {
            if (this.lifeCount > 0) {
                this.lifeCount--;
                this.gameStep = GameStep.RELIFE;
            } else {

                if (game.adsManager.isRewardVideoReady()) {
                    this.gameStep = GameStep.WATCH_AD;
                    game.popupMan.popupYesNoCommonDlg(game.local.getValue("watch_ads_relife"),
                        game.local.getValue("relife_yes"),
                        game.local.getValue("relife_no"),
                        function () {
                            self.watchAdAndRelife();
                        },
                        function () {
                            self.switchToFail();
                        }, false, true);
                } else {
                    self.switchToFail();
                }
            }
        }
    },

    switchToRelife: function () {
        StoreHelper.getInstance().popupBoostRewardDlg(1, 1, function () {
            this.lifeCount = 2;
            this.gameStep = GameStep.RELIFE;
        }.bind(this));
    },

    switchToFail: function () {
        GameMan.getInstance().switchFail();
        this.gameStep = GameStep.END;
        game.popupMan.popupFailDlg(function () {
            game.sceneMan.switchScene(game.sceneType.GAME);
        }, function () {
            GameMan.getInstance().skipLevel();
            game.sceneMan.switchScene(game.sceneType.GAME);
        });
    },

    isInView: function (ball) {
        var worldPos = ball.getPosition();
        if (worldPos.x < 0 || worldPos.x > cc.winSize.width || worldPos.y < 0 || worldPos.y > cc.winSize.height) {
            return false;
        }
        return true;
    },

    tryShootFirstBall: function () {
        if (this.gameStep === GameStep.PRE_START) {
            this.gameStep = GameStep.START;
            this.shootBall(this.getInitBallPos(), cc.p(0, this.MAX_SPEED));
            this.boardNode.hideBall();
        }
    },

    onTouchBegan:function(touch, event) {
        if (this._curTouchId > 0) {
            return false;
        }
        this._curTouchId = touch.getID();
        if (this.gameController && this.gameController.ndHelp.visible) {
            this.gameController.ndHelp.visible = false;
            game.storageController.setItem("first_enter", "false");
            return false;
        }

        var touchLocation = touch.getLocation();
        touchLocation = this.getParent().convertToNodeSpace(touchLocation);
        this.lastTouchPos = touchLocation;
        //this.boardNode.setPosX(this.lastTouchPos.x);
        return true;
    },

    onTouchMoved:function(touch, event) {
        if (touch.getID() !== this._curTouchId) {
            return false;
        }
        var touchLocation = touch.getLocation();
        touchLocation = this.getParent().convertToNodeSpace(touchLocation);
        if (this.lastTouchPos) {
            var offset = (touchLocation.x - this.lastTouchPos.x);
            if (Math.abs(offset) > 2) {
                var X_OFFSET = this.INNER_WALL + this.getBallWidth() * 0.5 + 2;
                var x = this.boardNode.x + offset * 1.6;
                if (x < X_OFFSET) {
                    x = X_OFFSET;
                } else if (x > cc.winSize.width - X_OFFSET) {
                    x = cc.winSize.width - X_OFFSET;
                }
                this.boardNode.setPosX(x);
                this.lastTouchPos = touchLocation;
            }
        }
        return true;
    },

    onTouchEnded:function(touch, event) {
        if (touch.getID() !== this._curTouchId) {
            return false;
        }
        this.tryShootFirstBall();
        this.lastSelectGrid = null;
        this.lastTouchPos = null;
        this._curTouchId = -1;
    },

    onTouchCancelled:function(touch, event) {
    },

    collisionBegin : function ( arbiter, space ) {
        //cc.log('collision begin');
        return true;
    },

    collisionPre : function ( arbiter, space ) {
        //cc.log('collision pre');
        var shapes = arbiter.getShapes();
        for (var i = 0; i < shapes.length; ++i) {
            var shape = shapes[i];
            if (shape.collision_type === ShapeType.BRICK) {
                var body = shape.getBody();
                if (body.userData) {
                    body.userData.removeable = true;
                    this.generateBoost(body.userData.getPosition());
                }
            } else if (shape.collision_type === ShapeType.BALL) {
                if (this.gameStep === GameStep.START) {
                    this.playKnockAudio();
                }
            }
        }
        return true;
    },

    collisionPost : function ( arbiter, space ) {
        //cc.log('collision post');
    },

    collisionSeparate : function ( arbiter, space ) {
        //cc.log('collision separate');
        var shapes = arbiter.getShapes();
        var ballShape = null;
        var boardShape = null;
        for (var i = 0; i < shapes.length; ++i) {
            if (shapes[i].collision_type === ShapeType.BALL) {
                var body = shapes[i].getBody();
                if (body && body.userData) {
                    this.adjustBallSpeed(body.userData);
                }
                ballShape = shapes[i];
            } else if (shapes[i].collision_type === ShapeType.BOARD) {
                boardShape = shapes[i];
            }
        }
        if (ballShape && boardShape) {
            if (ballShape.body && ballShape.body.userData && boardShape.body && boardShape.body.userData) {
                var ball = ballShape.body.userData;
                var board = boardShape.body.userData;
                if (ball.getPosition().y < board.y + board.height * 0.5) {
                    return;
                }
                var boardShapeX1 = ball.getPosition().x - (board.x - board.width / 2);
                var x = boardShapeX1 / boardShape.body.userData.width * 100 / 50 - 1;
                x = Math.max(Math.min(0.9, x), -0.9);
                var y = Math.sqrt(1 - x * x);
                ball.setVel(cc.p(this.MAX_SPEED * x, this.MAX_SPEED * y));
            }
        }
    },

    playKnockAudio: function () {
        if (Date.now() - this.lastTime > 50) {
            this.lastTime = Date.now();
            game.audioPlayer.playEffectByKey("knock");
        }
    },

    getInitBallPos: function () {
        return cc.pAdd(this.boardNode.getPosition(), cc.p(0, 30));
    },

    shootBall: function (position, vel) {
        if (this.ballList.length > this.MAX_BALL) {
            return;
        }
        var ball = BallPool.getFromPool("ball");
        if (!ball) {
            ball = new Ball(this.getBallWidth());
        } else {
            ball.reset(this.getBallWidth());
        }
        this.addChild(ball);
        this.ballList.push(ball);
        ball.initBody(this.space, position);
        ball.setVel(vel);
    },

    removeBall: function (ball) {
        var index = this.ballList.indexOf(ball);
        if (index > -1) {
            this.ballList.splice(index, 1);
        }
        ball.removeBody();
        BallPool.putInPool("ball", ball);
        ball.removeFromParent();
    },

    removeBrick: function (brick) {
        var index = this.bricks.indexOf(brick);
        if (index > -1) {
            this.bricks.splice(index, 1);
        }
        brick.removeBody();
        if (brick.isGift) {
            this.stop();
            game.popupMan.popupRewardGift(function () {
                this.resume();
            }.bind(this));
        } else {
            BallPool.putInPool("brick", brick);
        }
        brick.removeFromParent();
    },

    generateBoost: function (pos) {
        var boostType;

        var hasBoost = false;
        if (this.hardMode) {
            hasBoost = game.utils.randomNextInt(400) < 400 * this.BOOST_POSIBILITY / this.ballList.length;
        } else {
            hasBoost = game.utils.randomNextInt(100) < 100 * this.BOOST_POSIBILITY / this.ballList.length;
        }

        if (GameMan.getInstance().levelId <= 2) {
            if (cc.isUndefined(this.generateBoostCount)) {
                this.generateBoostCount = 0;
            }
            if (this.generateBoostCount < 3) {
                hasBoost = true;
                this.generateBoostCount++;
            }
        }
        if (hasBoost) {
            boostType = game.utils.randomNextInt(2) + 2;
        }

        var hasLife = false;

        if (!hasBoost) {
            hasLife = game.utils.randomNextNumber(100) < (100 * this.LIFE_POSIBILITY / this.ballList.length);
            if (hasLife) {
                var lifeBoostCount = 0;
                for (var i = 0; i < this.boosts.length; ++i) {
                    if (this.boosts[i].type === BoostType.LIFE) {
                        lifeBoostCount++;
                    }
                }
                if (this.lifeCount + lifeBoostCount >= this.MAX_LIFE) {
                    hasLife = false;
                } else {
                    boostType = BoostType.LIFE;
                }
            }
        }

        if (hasLife || hasBoost) {
            var boost = new Boost(boostType);
            boost.setPosition(pos);
            this.addChild(boost);
            //boost.runAction(cc.sequence(cc.moveTo((pos.y / 100), cc.p(pos.x, 0)), cc.callFunc(this.onRemoveBoost, this)));
            this.boosts.push(boost);
        }
    },

    onRemoveBoost: function (boost) {
        var index = this.boosts.indexOf(boost);
        if (index > -1) {
            this.boosts.splice(index, 1);
            boost.removeFromParent();
        }
    },

    removeAllBoosts: function () {
        for (var i = 0; i < this.boosts.length; ++i) {
            var boost = this.boosts[i];
            if (boost) {
                boost.removeFromParent();
            }
        }
        this.boosts = [];
    },

    stop: function () {
        this.stoped = true;
        //this.showBannerAds();
    },

    resume: function () {
        this.stoped = false;
        //game.adsManager.removeBannerAds("bottom");
    },

    showBannerAds: function () {
        //if (game.playerMan.getLevel() >= 3) {
        //    game.adsManager.showBannerAds("bottom");
        //}
    },

    showTopBannerAds: function () {
        if (game.playerMan.getLevel() >= 3) {
            if (game.adsManager.showTopBanner) {
                //if 1 > 0
                if (game.playerMan.getRegisterDay() > game.adsManager.topBannerDay) {
                    game.adsManager.showBannerAds("top");
                }
            }
        }
    },

    removeTopBannerAds: function () {
        //if (game.adsManager.showTopBanner) {
        //    game.adsManager.removeBannerAds("top");
        //}
    },

    watchAdAndRelife: function () {
        var self = this;
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "fuhuo01" : "fuhuo01", function (rewarded) {
            if (rewarded) {
                game.analyseManager.trackEvent("WatchAdsToRelife");
                self.switchToRelife();
            } else {
                self.switchToFail();
            }
        });
    }
});

module.exports = BricksView;
},{"../../common/util/Utils":31,"../controller/BoardController":47,"../entity/Ball":81,"../entity/BallPool":82,"../entity/Board":83,"../entity/Boost":84,"../entity/Grid":85,"../entity/Obstacle":86,"../entity/Wall":88,"../enum/BoostType":89,"../enum/GridType":91,"../enum/ShapeType":95,"../model/GameMan":99,"../model/StoreHelper":103}]},{},[33])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImNvbW1vbi9hc3NldHMvQXNzZXRzTWFuYWdlci5qcyIsImNvbW1vbi9hdWRpby9BdWRpb1BsYXllci5qcyIsImNvbW1vbi9icmlkZ2UvR2FtZUJyaWRnZS5qcyIsImNvbW1vbi9jb250cm9sbGVyL0Jhc2VDQ0JDb250cm9sbGVyLmpzIiwiY29tbW9uL2NvbnRyb2xsZXIvQ3Jvc3NQcm9tQ29udHJvbGxlci5qcyIsImNvbW1vbi9lbnRpdHkvUGF5bWVudEluZm8uanMiLCJjb21tb24vZW50aXR5L1BsYXllckluZm8uanMiLCJjb21tb24vZW50aXR5L1Byb2R1Y3RJbmZvLmpzIiwiY29tbW9uL2VudW0vQWRzUGxhY2UuanMiLCJjb21tb24vZW51bS9QYXltZW50Q29kZS5qcyIsImNvbW1vbi9ldmVudHMvRXZlbnREaXNwYXRjaGVyLmpzIiwiY29tbW9uL2V4dC9NdWx0aUNvbFRhYmxlVmlldy5qcyIsImNvbW1vbi9leHQvVG91Y2hlZE5vZGUuanMiLCJjb21tb24vbWFuYWdlci9BZHNNYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvQW5hbHlzZU1hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9DYXB0dXJlTWFuYWdlci5qcyIsImNvbW1vbi9tYW5hZ2VyL0Nyb3NzUHJvbU1hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9HQ01hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9Mb2NhbGl6YXRpb25NYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvTm90aWZpY2F0aW9uTWFuYWdlci5qcyIsImNvbW1vbi9tYW5hZ2VyL1JhdGVNYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvU2hhcmVNYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvU3RvcmVNYW5hZ2VyLmpzIiwiY29tbW9uL21vZGVsL0xvZ2ljTWFuLmpzIiwiY29tbW9uL21vZGVsL1BsYXllck1hbi5qcyIsImNvbW1vbi9uZXQvSHR0cENsaWVudC5qcyIsImNvbW1vbi9wb3B1cC9EaWFsb2dNYW5hZ2VyLmpzIiwiY29tbW9uL3BvcHVwL01vZGFsTGF5ZXIuanMiLCJjb21tb24vc3RvcmFnZS9TdG9yYWdlQ29udHJvbGxlci5qcyIsImNvbW1vbi91dGlsL0F1ZGlvSGVscGVyLmpzIiwiY29tbW9uL3V0aWwvVXRpbHMuanMiLCJjb21tb24vd2hlZWwvV2hlZWwuanMiLCJlZGl0b3JMb2FkZXIuanMiLCJtYW55X2JyaWNrcy9jb25maWcvQnJpY2tDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL0NvbmZpZ01hbi5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9EYWlseUJvbnVzQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL0xldmVsQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1NoYXJlQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1NraW5Db25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvU3RvcmVDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvVGFza0NvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9UYXNrT2xkQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1doZWVsQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9BZHNSZW1pbmRlckNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0JhZ0NvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0JvYXJkQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvRGFpbHlCb251c0NvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0RhaWx5Qm9udXNJdGVtQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvRmFpbENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0dhbWVDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9HYW1lT3ZlckNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0dhbWVXaW5Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9IZWxwQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvTGV2ZWxDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9MZXZlbEl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9Mb2FkaW5nQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvTWVudUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL05vdGljZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1BhY2thZ2VDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9QYWNrYWdlSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Bhc3NDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9QYXVzZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1JhbmtDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9SZXdhcmREb3VibGVDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9SZXdhcmRHaWZ0Q29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkTm90aWNlQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkVmlkZW9Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9Ta2luQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvU2tpbkl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9TcGVjaWFsT2ZmZXJDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9TdG9yZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1N0b3JlSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Rhc2tDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9UYXNrSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1RpdGxlQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvV2hlZWxDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvZWRpdG9yL2VudGl0eS9HcmlkLmpzIiwibWFueV9icmlja3MvZWRpdG9yL3NjZW5lL0VkaXRvclNjZW5lLmpzIiwibWFueV9icmlja3MvZWRpdG9yL3NjZW5lL0dhbWVTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9CYWxsLmpzIiwibWFueV9icmlja3MvZW50aXR5L0JhbGxQb29sLmpzIiwibWFueV9icmlja3MvZW50aXR5L0JvYXJkLmpzIiwibWFueV9icmlja3MvZW50aXR5L0Jvb3N0LmpzIiwibWFueV9icmlja3MvZW50aXR5L0dyaWQuanMiLCJtYW55X2JyaWNrcy9lbnRpdHkvT2JzdGFjbGUuanMiLCJtYW55X2JyaWNrcy9lbnRpdHkvUGxheWVySW5mby5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9XYWxsLmpzIiwibWFueV9icmlja3MvZW51bS9Cb29zdFR5cGUuanMiLCJtYW55X2JyaWNrcy9lbnVtL0dhbWVNb2RlLmpzIiwibWFueV9icmlja3MvZW51bS9HcmlkVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vTG9ja1N0YXR1cy5qcyIsIm1hbnlfYnJpY2tzL2VudW0vUmFua1R5cGUuanMiLCJtYW55X2JyaWNrcy9lbnVtL1NjZW5lVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vU2hhcGVUeXBlLmpzIiwibWFueV9icmlja3MvZW51bS9Ta2luUmV3YXJkVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vU3RvcmVUeXBlLmpzIiwibWFueV9icmlja3MvZXZlbnRzL0V2ZW50c05hbWUuanMiLCJtYW55X2JyaWNrcy9tb2RlbC9HYW1lTWFuLmpzIiwibWFueV9icmlja3MvbW9kZWwvUGxheWVyTWFuLmpzIiwibWFueV9icmlja3MvbW9kZWwvUG9wdXBNYW4uanMiLCJtYW55X2JyaWNrcy9tb2RlbC9TY2VuZU1hbi5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL1N0b3JlSGVscGVyLmpzIiwibWFueV9icmlja3Mvc2NlbmUvR2FtZVNjZW5lLmpzIiwibWFueV9icmlja3Mvc2NlbmUvTGV2ZWxTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3NjZW5lL0xvYWRpbmdTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3NjZW5lL01lbnVTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3NjZW5lL1BhY2thZ2VTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3ZpZXcvQnJpY2tzVmlldy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDblJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5YkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDalFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdHZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDamJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8xNC5cbiAqL1xudmFyIFZFUlNJT05fQVNTRVRfSUQgPSBcIkB2ZXJzaW9uXCI7XG52YXIgTUFOSUZFU1RfQVNTRVRfSUQgPSBcIkBtYW5pZmVzdFwiO1xudmFyIEFzc2V0c01hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIC8qKlxuICAgICAqIHtqc2IuQXNzZXRzTWFuYWdlcn1cbiAgICAgKi9cbiAgICBfYW0gOiBudWxsLFxuICAgIC8qKlxuICAgICAqIHtudW1iZXJ95aSx6LSl5qyh5pWwXG4gICAgICovXG4gICAgX2ZhaWxDb3VudCA6IDAsXG4gICAgLyoqXG4gICAgICoge251bWJlcn3mnIDlpKfplJnor6/ph43or5XmrKHmlbBcbiAgICAgKi9cbiAgICBfbWF4RmFpbENvdW50IDogMSxcbiAgICBjdG9yOmZ1bmN0aW9uKCl7XG5cbiAgICB9LFxuICAgIHB1cmdlOmZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0aGlzLl9hbSl7XG4gICAgICAgICAgICB0aGlzLl9hbS5yZWxlYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYW0gPSBudWxsO1xuICAgIH0sXG5cbiAgICByZXRyeURvd25Bc3NldHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZmFpbENvdW50ID0gMDtcbiAgICAgICAgdGhpcy5fbWF4RmFpbENvdW50ID0gNTtcbiAgICAgICAgaWYodGhpcy5fYW0pIHtcbiAgICAgICAgICAgIHRoaXMuX2FtLmRvd25sb2FkRmFpbGVkQXNzZXRzKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZG93bkxvYWRBc3NldHMgOiBmdW5jdGlvbihwcm9qZWN0TWFuaWZlc3RQYXRoLHN0b3JhZ2VQYXRoLHVwZGF0ZUNhbGxCYWNrLGVuZENhbGxCYWNrKSB7XG4gICAgICAgIHRoaXMuX2ZhaWxDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuX21heEZhaWxDb3VudCA9IDU7XG4gICAgICAgIHRoaXMuX2FtID0gbmV3IGpzYi5Bc3NldHNNYW5hZ2VyKHByb2plY3RNYW5pZmVzdFBhdGgsIHN0b3JhZ2VQYXRoKTtcbiAgICAgICAgdGhpcy5fYW0ucmV0YWluKCk7XG4gICAgICAgIGlmICghdGhpcy5fYW0uZ2V0TG9jYWxNYW5pZmVzdCgpLmlzTG9hZGVkKCkpIHtcbiAgICAgICAgICAgIGVuZENhbGxCYWNrKFwiZXJyb3JfbG9jYWxfbWFuaWZlc3Rfbm90X2xvYWRlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBsaXN0ZW5lciA9IG5ldyBqc2IuRXZlbnRMaXN0ZW5lckFzc2V0c01hbmFnZXIodGhpcy5fYW0sIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgc3dpdGNoIChldmVudC5nZXRFdmVudENvZGUoKSkge1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5VUERBVEVfUFJPR1JFU1NJT046XG4gICAgICAgICAgICAgICAgICAgIHZhciBtc2cgPSBldmVudC5nZXRNZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIlVQREFURV9QUk9HUkVTU0lPTjpcIiArIG1zZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldElkID0gZXZlbnQuZ2V0QXNzZXRJZCgpO1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJhc3NldElkOlwiK2Fzc2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICBpZihhc3NldElkID09IFZFUlNJT05fQVNTRVRfSUQgfHwgYXNzZXRJZCA9PSBNQU5JRkVTVF9BU1NFVF9JRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2FsbEJhY2soMSwgXCJ1cGRhdGUgbWFuaWZlc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDYWxsQmFjayhldmVudC5nZXRQZXJjZW50KCksIG1zZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLlVQREFURV9GQUlMRUQ6XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIlVwZGF0ZSBmYWlsZWQuIFwiICsgZXZlbnQuZ2V0TWVzc2FnZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmFpbENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9mYWlsQ291bnQgPCB0aGF0Ll9tYXhGYWlsQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2FtLmRvd25sb2FkRmFpbGVkQXNzZXRzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJSZWFjaCBtYXhpbXVtIGZhaWwgY291bnQsIGV4aXQgdXBkYXRlIHByb2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9mYWlsQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5VUERBVEVfRklOSVNIRUQ6XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkFMUkVBRFlfVVBfVE9fREFURTpcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2sobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkVSUk9SX05PX0xPQ0FMX01BTklGRVNUOlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJObyBsb2NhbCBtYW5pZmVzdCBmaWxlIGZvdW5kLCBza2lwIGFzc2V0cyB1cGRhdGUuXCIpO1xuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5FUlJPUl9ET1dOTE9BRF9NQU5JRkVTVDpcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJGYWlsIHRvIGRvd25sb2FkIG1hbmlmZXN0IGZpbGUsIHVwZGF0ZSBza2lwcGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkVSUk9SX1BBUlNFX01BTklGRVNUOlxuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkZhaWwgdG8gcGFyc2UgbWFuaWZlc3QgZmlsZSwgdXBkYXRlIHNraXBwZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIGpzYi5FdmVudEFzc2V0c01hbmFnZXIuRVJST1JfVVBEQVRJTkc6XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkFzc2V0IHVwZGF0ZSBlcnJvcjogXCIgKyBldmVudC5nZXRNZXNzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5FUlJPUl9ERUNPTVBSRVNTOlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coZXZlbnQuZ2V0TWVzc2FnZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJkZWZhdWx0OiBcIiArIGV2ZW50LmdldEV2ZW50Q29kZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcihsaXN0ZW5lciwgMSk7XG4gICAgICAgIHRoaXMuX2FtLnVwZGF0ZSgpO1xuICAgIH1cbn0pO1xuXG5Bc3NldHNNYW5hZ2VyLl9pbnN0YW5jZSA9IG51bGw7XG5Bc3NldHNNYW5hZ2VyLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge0Fzc2V0c01hbmFnZXJ9XG4gKi9cbkFzc2V0c01hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEFzc2V0c01hbmFnZXIuX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgQXNzZXRzTWFuYWdlci5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBBc3NldHNNYW5hZ2VyLl9pbnN0YW5jZSA9IG5ldyBBc3NldHNNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBBc3NldHNNYW5hZ2VyLl9pbnN0YW5jZTtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldHNNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzQvMjcuXG4gKi9cblxudmFyIEFDVElPTl9UWVBFID0ge1xuICAgIEFDVElPTl9OVUxMOiAwLFxuICAgIEFDVElPTl9QQVVTRTogMSxcbiAgICBBQ1RJT05fUkVTVU1FOiAyXG59O1xuXG52YXIgUExBWV9UWVBFID0ge1xuICAgIFBMQVlfVFlQRV9OT1JNQUw6IDAsXG4gICAgUExBWV9UWVBFX0ZBREVfT1VUX0ZBREVfSU46IDFcbn07XG5cbnZhciBBdWRpb1BsYXllciA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgbGFzdE11c2ljVm9sdW1lOiAwLFxuICAgIHN1ZmZpeDogbnVsbCxcbiAgICBlZmZlY3RNYXA6IG51bGwsXG4gICAgcGxheVR5cGU6IFBMQVlfVFlQRS5QTEFZX1RZUEVfTk9STUFMLFxuICAgIGFjdGlvblR5cGU6IEFDVElPTl9UWVBFLkFDVElPTl9OVUxMLFxuICAgIG11c2ljTmFtZTogbnVsbCxcbiAgICBsb29wOiBmYWxzZSxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICB0aGlzLnN1ZmZpeCA9IFwicmVzL2F1ZGlvX29nZy8lcy5vZ2dcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3VmZml4ID0gXCJyZXMvYXVkaW9fbXAzLyVzLm1wM1wiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWZmZWN0TWFwID0ge307XG4gICAgICAgIHZhciBpc011c2ljT24gPSB0aGlzLmlzTXVzaWNPbigpO1xuICAgICAgICB0aGlzLmxhc3RNdXNpY1ZvbHVtZSA9IDE7XG4gICAgICAgIHRoaXMuc2V0TXVzaWNPbihpc011c2ljT24pO1xuICAgIH0sXG5cbiAgICBiZWdpblNjaGVkdWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnNjaGVkdWxlQ2FsbGJhY2tGb3JUYXJnZXQodGhpcywgdGhpcy51cGRhdGUsIDAuMSwgY2MuUkVQRUFUX0ZPUkVWRVIsIDAsIGZhbHNlKTtcbiAgICB9LFxuXG4gICAgc3RvcFNjaGVkdWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnVuc2NoZWR1bGVDYWxsYmFja0ZvclRhcmdldCh0aGlzLCB0aGlzLnVwZGF0ZSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIGR0ICo9IDAuNTtcbiAgICAgICAgdmFyIGlzRmluaXNoID0gZmFsc2U7XG4gICAgICAgIHZhciB2b2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRNdXNpY1ZvbHVtZSgpO1xuICAgICAgICBpZiAodGhpcy5wbGF5VHlwZSA9PSBQTEFZX1RZUEUuUExBWV9UWVBFX0ZBREVfT1VUX0ZBREVfSU4pIHtcbiAgICAgICAgICAgIGlmICh2b2x1bWUgPiAwLjAwMSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX1BBVVNFKSB7XG4gICAgICAgICAgICAgICAgICAgIHZvbHVtZSAtPSBkdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZSA8IDAuMDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWUgPSAwLjAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5TXVzaWNCeUtleSh0aGlzLm11c2ljTmFtZSwgdGhpcy5sb29wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9SRVNVTUU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWN0aW9uVHlwZSA9PSBBQ1RJT05fVFlQRS5BQ1RJT05fUkVTVU1FKSB7XG4gICAgICAgICAgICAgICAgICAgIHZvbHVtZSArPSBkdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDAuOTkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZSA9IDAuOTk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZpbmlzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheU11c2ljQnlLZXkodGhpcy5tdXNpY05hbWUsIHRoaXMubG9vcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNGaW5pc2gpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvblR5cGUgPSBBQ1RJT05fVFlQRS5BQ1RJT05fTlVMTDtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXlUeXBlID0gUExBWV9UWVBFLlBMQVlfVFlQRV9OT1JNQUw7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wU2NoZWR1bGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh2b2x1bWUgPiAwLjAwMSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX1BBVVNFKSB7XG4gICAgICAgICAgICAgICAgICAgIHZvbHVtZSAtPSBkdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZSA8IDAuMDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWUgPSAwLjAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNGaW5pc2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXVzZU11c2ljKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWN0aW9uVHlwZSA9PSBBQ1RJT05fVFlQRS5BQ1RJT05fUkVTVU1FKSB7XG4gICAgICAgICAgICAgICAgICAgIHZvbHVtZSArPSBkdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDAuOTkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZSA9IDAuOTk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZpbmlzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlzRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0ZpbmlzaCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9OVUxMO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFNjaGVkdWxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUVmZmVjdEJ5S2V5OiBmdW5jdGlvbiAoZWZmZWN0TmFtZSwgbG9vcCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNFZmZlY3RPbigpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGZpbGVOYW1lID0gZ2FtZS51dGlscy5zcHJpbnRmKHRoaXMuc3VmZml4LCBlZmZlY3ROYW1lKTtcbiAgICAgICAgdmFyIGtleSA9IFwiXCI7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KGZpbGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIGtleSA9IGNjLmF1ZGlvRW5naW5lLnBsYXlFZmZlY3QoZmlsZU5hbWUsIGxvb3ApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5sb2coZ2FtZS51dGlscy5zcHJpbnRmKFwiZWZmZWN0IGZpbGUgJXMgbm90IGZvdW5kXCIsIGZpbGVOYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2MubG9hZGVyLmdldFJlcyhmaWxlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBrZXkgPSBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KGZpbGVOYW1lLCBsb29wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICB0aGlzLmVmZmVjdE1hcFtmaWxlTmFtZV0gPSBrZXk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheU11c2ljQnlLZXk6IGZ1bmN0aW9uIChtdXNpY05hbWUsIGxvb3ApIHtcbiAgICAgICAgdGhpcy5hY3Rpb25UeXBlID0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEw7XG4gICAgICAgIHRoaXMucGxheVR5cGUgPSBQTEFZX1RZUEUuUExBWV9UWVBFX05PUk1BTDtcbiAgICAgICAgaWYgKHRoaXMuaXNNdXNpY09uKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RNdXNpY1ZvbHVtZSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodGhpcy5sYXN0TXVzaWNWb2x1bWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZmlsZU5hbWUgPSBnYW1lLnV0aWxzLnNwcmludGYodGhpcy5zdWZmaXgsIG11c2ljTmFtZSk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KGZpbGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBsYXlNdXNpYyhmaWxlTmFtZSwgbG9vcCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLmxvZyhnYW1lLnV0aWxzLnNwcmludGYoXCJtdXNpYyBmaWxlICVzIG5vdCBmb3VuZFwiLCBmaWxlTmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNjLmxvYWRlci5nZXRSZXMoZmlsZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheU11c2ljKGZpbGVOYW1lLCBsb29wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc1BsYXlpbmdNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2MuYXVkaW9FbmdpbmUuaXNNdXNpY1BsYXlpbmcoKTtcbiAgICB9LFxuXG4gICAgcmVzdW1lTXVzaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUucmVzdW1lTXVzaWMoKTtcbiAgICB9LFxuXG4gICAgcmVzdW1lTXVzaWNTbG93bHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHZvbHVtZSA9IGNjLmF1ZGlvRW5naW5lLmdldE11c2ljVm9sdW1lKCk7XG4gICAgICAgIGlmICh2b2x1bWUgPCAwLjAwMDEgfHwgdm9sdW1lID49IDAuOTkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hY3Rpb25UeXBlID09IEFDVElPTl9UWVBFLkFDVElPTl9OVUxMKSB7XG4gICAgICAgICAgICB0aGlzLmJlZ2luU2NoZWR1bGUoKTtcbiAgICAgICAgfVxuICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSgwLjAxKTtcbiAgICAgICAgdGhpcy5yZXN1bWVNdXNpYygpO1xuICAgICAgICB0aGlzLmFjdGlvblR5cGUgPSBBQ1RJT05fVFlQRS5BQ1RJT05fUkVTVU1FO1xuICAgIH0sXG5cbiAgICBzdG9wTXVzaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUuc3RvcE11c2ljKCk7XG4gICAgfSxcblxuICAgIHN0b3BFZmZlY3Q6IGZ1bmN0aW9uIChlZmZlY3ROYW1lKSB7XG4gICAgICAgIHZhciBmaWxlTmFtZSA9IGdhbWUudXRpbHMuc3ByaW50Zih0aGlzLnN1ZmZpeCwgZWZmZWN0TmFtZSk7XG4gICAgICAgIHZhciBlZmZlY3RLZXkgPSB0aGlzLmVmZmVjdE1hcFtmaWxlTmFtZV07XG4gICAgICAgIGlmIChlZmZlY3RLZXkpIHtcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnN0b3BFZmZlY3QoZWZmZWN0S2V5KTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmVmZmVjdE1hcFtmaWxlTmFtZV07XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcEFsbEVmZmVjdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUuc3RvcEFsbEVmZmVjdHMoKTtcbiAgICB9LFxuXG4gICAgaXNFZmZlY3RPbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXNPbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImVmZmVjdF9vblwiLCBcInRydWVcIik7XG4gICAgICAgIGlmIChpc09uID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGlzTXVzaWNPbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXNPbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcIm11c2ljX29uXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgaWYgKGlzT24gPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgcGF1c2VNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5hdWRpb0VuZ2luZS5wYXVzZU11c2ljKCk7XG4gICAgfSxcblxuICAgIHBhdXNlTXVzaWNTbG93bHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUGxheWluZ011c2ljKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2MuYXVkaW9FbmdpbmUuZ2V0TXVzaWNWb2x1bWUoKSA8IDAuMDAwMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEwpIHtcbiAgICAgICAgICAgIHRoaXMuYmVnaW5TY2hlZHVsZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUoMC45OSk7XG4gICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9QQVVTRTtcbiAgICB9LFxuXG4gICAgcGxheU11c2ljU2xvd2x5QnlLZXk6IGZ1bmN0aW9uIChtdXNpY05hbWUsIGxvb3ApIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUGxheWluZ011c2ljKCkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheU11c2ljQnlLZXkobXVzaWNOYW1lLCBsb29wKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGxheVR5cGUgPSBQTEFZX1RZUEUuUExBWV9UWVBFX0ZBREVfT1VUX0ZBREVfSU47XG4gICAgICAgIHRoaXMubXVzaWNOYW1lID0gbXVzaWNOYW1lO1xuICAgICAgICB0aGlzLmxvb3AgPSBsb29wO1xuXG4gICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEwpIHtcbiAgICAgICAgICAgIHRoaXMuYmVnaW5TY2hlZHVsZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9QQVVTRTtcbiAgICB9LFxuICAgIFxuICAgIHNldEVmZmVjdE9uOiBmdW5jdGlvbiAoaXNPbikge1xuICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJlZmZlY3Rfb25cIiwgXCJcIiArIGlzT24pO1xuICAgIH0sXG5cbiAgICBzZXRNdXNpY09uOiBmdW5jdGlvbiAoaXNPbikge1xuICAgICAgICBpZiAoaXNPbikge1xuICAgICAgICAgICAgaWYgKHRoaXMubGFzdE11c2ljVm9sdW1lICE9IDApIHtcbiAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSh0aGlzLmxhc3RNdXNpY1ZvbHVtZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnNldE11c2ljVm9sdW1lKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYXN0TXVzaWNWb2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRNdXNpY1ZvbHVtZSgpO1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUoMCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFwibXVzaWNfb25cIiwgXCJcIiArIGlzT24pO1xuICAgIH0sXG5cbiAgICBzZXRNdXNpY1ZvbHVtZTogZnVuY3Rpb24gKHZvbHVtZSkge1xuICAgICAgICBpZiAodGhpcy5pc011c2ljT24oKSkge1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5BdWRpb1BsYXllci5faW5zdGFuY2UgPSBudWxsO1xuQXVkaW9QbGF5ZXIuX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7QXVkaW9QbGF5ZXJ9XG4gKi9cbkF1ZGlvUGxheWVyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChBdWRpb1BsYXllci5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBBdWRpb1BsYXllci5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBBdWRpb1BsYXllci5faW5zdGFuY2UgPSBuZXcgQXVkaW9QbGF5ZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEF1ZGlvUGxheWVyLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXVkaW9QbGF5ZXI7IiwidmFyIEdhbWVCcmlkZ2UgPSB7XG4gICAgZ2V0TWVudVNjZW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBNZW51U2NlbmUgPSByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3Mvc2NlbmUvTWVudVNjZW5lXCIpO1xuICAgICAgICByZXR1cm4gbmV3IE1lbnVTY2VuZSgpO1xuICAgIH0sXG5cbiAgICBnZXRDb25maWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJlcXVpcmUoXCIuLi8uLi9tYW55X2JyaWNrcy9jb25maWcvQ29uZmlnXCIpO1xuICAgIH0sXG5cbiAgICBnZXRQb3B1cE1hbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL21vZGVsL1BvcHVwTWFuXCIpO1xuICAgIH0sXG5cbiAgICBnZXRMb2FkaW5nU2NlbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIExvYWRpbmdTY2VuZSA9IHJlcXVpcmUoXCIuLi8uLi9tYW55X2JyaWNrcy9zY2VuZS9Mb2FkaW5nU2NlbmVcIik7XG4gICAgICAgIHJldHVybiBuZXcgTG9hZGluZ1NjZW5lKCk7XG4gICAgfSxcblxuICAgIGdldEdhbWVNYW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3MvbW9kZWwvR2FtZU1hblwiKTtcbiAgICAgICAgcmV0dXJuIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVCcmlkZ2U7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8yMy5cbiAqL1xudmFyIFV0aWxzID0gcmVxdWlyZShcIi4uL3V0aWwvVXRpbHNcIik7XG5cbnZhciBCYXNlQ0NCQ29udHJvbGxlciA9IGZ1bmN0aW9uKCkge1xufTtcblxuQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG9sZE9uRW50ZXIgPSB0aGlzLnJvb3ROb2RlW1wib25FbnRlclwiXTtcbiAgICB0aGlzLnJvb3ROb2RlW1wib25FbnRlclwiXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZihjYy5pc0Z1bmN0aW9uKG9sZE9uRW50ZXIpKXtcbiAgICAgICAgICAgIG9sZE9uRW50ZXIuYXBwbHkoc2VsZi5yb290Tm9kZSwgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBzZWxmLm9uRW50ZXIoKTtcbiAgICB9O1xuICAgIHZhciBvbGRPbkV4aXQgPSB0aGlzLnJvb3ROb2RlW1wib25FeGl0XCJdO1xuICAgIHRoaXMucm9vdE5vZGVbXCJvbkV4aXRcIl0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNjLmlzRnVuY3Rpb24ob2xkT25FeGl0KSkge1xuICAgICAgICAgICAgb2xkT25FeGl0LmFwcGx5KHNlbGYucm9vdE5vZGUsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5vbkV4aXQoKTtcbiAgICB9O1xuICAgIHRoaXMuX3Zpc2l0Tm9kZXMoKTtcbn07XG5cbkJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24oKSB7XG59O1xuXG5CYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24oKSB7XG59O1xuXG5mdW5jdGlvbiBzZXRTY2FsZVdpdGhQYXJlbnRTaXplKGxhYmVsKSB7XG4gICAgY2MubG9nKFwic2V0U2NhbGVXaXRoUGFyZW50U2l6ZVwiKTtcbiAgICB2YXIgcGFyZW50ID0gbGFiZWwuZ2V0UGFyZW50KCk7XG4gICAgdmFyIHBhcmVudFNpemUgPSBwYXJlbnQuZ2V0Q29udGVudFNpemUoKTtcbiAgICB2YXIgZm9udFNpemUgPSBsYWJlbC5nZXRDb250ZW50U2l6ZSgpO1xuXG4gICAgaWYgKCFsYWJlbC5fX29yaWdpbl9zY2FsZSkge1xuICAgICAgICBsYWJlbC5fX29yaWdpbl9zY2FsZSA9IHtcbiAgICAgICAgICAgIHg6IGxhYmVsLmdldFNjYWxlWCgpLFxuICAgICAgICAgICAgeTogbGFiZWwuZ2V0U2NhbGVZKClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGggOiBmb250U2l6ZS53aWR0aCAqIGxhYmVsLl9fb3JpZ2luX3NjYWxlLngsXG4gICAgICAgIGhlaWdodCA6IGZvbnRTaXplLmhlaWdodCAqIGxhYmVsLl9fb3JpZ2luX3NjYWxlLnlcbiAgICB9O1xuXG4gICAgLy8gYSBjbGVhbiBoYWNraW5nLCBzYXZlIHVzIHRvIGNhbGMgdGhlIGxhYmVsIGhlaWdodCBtYW51YWxseS4gOl1cbiAgICAvLyBwYXJlbnRTaXplLmhlaWdodCAqPSBsYWJlbC5fX29yaWdpbl9zY2FsZS55O1xuXG4gICAgaWYgKHNpemUud2lkdGggPiBwYXJlbnRTaXplLndpZHRoIHx8IHNpemUuaGVpZ2h0ID4gcGFyZW50U2l6ZS5oZWlnaHQpIHtcbiAgICAgICAgdmFyIHggPSBNYXRoLm1pbihwYXJlbnRTaXplLndpZHRoIC8gc2l6ZS53aWR0aCwgMSkgKiBsYWJlbC5fX29yaWdpbl9zY2FsZS54O1xuICAgICAgICB2YXIgeSA9IE1hdGgubWluKHBhcmVudFNpemUuaGVpZ2h0IC8gc2l6ZS5oZWlnaHQsIDEpICogbGFiZWwuX19vcmlnaW5fc2NhbGUueTtcblxuICAgICAgICB2YXIgc2NhbGUgPSBNYXRoLm1pbih4LCB5KTtcbiAgICAgICAgbGFiZWwuc2V0U2NhbGUoc2NhbGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vbWF5YmUgcmV1c2VkLCByZXNldCBvcmlnaW4gc2l6ZVxuICAgICAgICBsYWJlbC5zZXRTY2FsZShsYWJlbC5fX29yaWdpbl9zY2FsZS54KTtcbiAgICB9XG59XG5cbkJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5fdmlzaXROb2RlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgVG91Y2hlZE5vZGUgPSByZXF1aXJlKFwiLi4vZXh0L1RvdWNoZWROb2RlXCIpO1xuICAgIFV0aWxzLndhbGtOb2RlKHRoaXMucm9vdE5vZGUsIGZ1bmN0aW9uKG5kKSB7XG4gICAgICAgIGlmIChuZC5fX192aXNpdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBuZC5fX192aXNpdGVkID0gdHJ1ZTtcbiAgICAgICAgaWYgKCFnYW1lLmNvbmZpZy5tZW51Tm9TY2FsZSkge1xuICAgICAgICAgICAgdmFyIGlzTWVudUl0ZW0gPSBVdGlscy5pc05vZGVNZW51SXRlbShuZCk7XG4gICAgICAgICAgICBpZiAoaXNNZW51SXRlbSB8fCAoVXRpbHMuaXNOb2RlQnV0dG9uKG5kKSAmJiBuZC56b29tT25Ub3VjaERvd24pKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5kLnpvb21PblRvdWNoRG93bikge1xuICAgICAgICAgICAgICAgICAgICBuZC56b29tT25Ub3VjaERvd24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgVG91Y2hlZE5vZGUoaXNNZW51SXRlbSk7XG4gICAgICAgICAgICAgICAgbmQuYWRkQ2hpbGQobm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmQuZ2V0U3RyaW5nICE9IG51bGwgJiYgbmQuc2V0U3RyaW5nICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBuZC5nZXRQYXJlbnQoKTtcbiAgICAgICAgICAgIC8vY2MubG9nKFwiX3Zpc2l0Tm9kZXMgdGFnOlwiICsgcGFyZW50LmdldFRhZygpKTtcbiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LmdldFRhZygpID09PSA3OSkge1xuICAgICAgICAgICAgICAgIHZhciBpc0JNRm9udCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKFV0aWxzLmlzTGFiZWxCTUZvbnQobmQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzQk1Gb250ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9jYy5sb2coXCJfdmlzaXROb2RlcyBuZC5fY2xhc3NOYW1lOlwiICsgbmQuX2NsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgLy9jYy5sb2coXCJfdmlzaXROb2RlcyBpc0JNRm9udDpcIiArIGlzQk1Gb250KTtcbiAgICAgICAgICAgICAgICBpZihpc0JNRm9udCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NjLmxvZyhcIl92aXNpdE5vZGVzIDJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXliZSByZXBlYXQgY2FsbCBpbiBvbkVudGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5kLl9fb3JpZ2luX3NldHN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5kLl9fb3JpZ2luX3NldHN0cmluZyA9IG5kLnNldFN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZC5zZXRTdHJpbmcgPSBmdW5jdGlvbihuZXdTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fX29yaWdpbl9zZXRzdHJpbmcobmV3U3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVyZSB3ZSBzdGFydCB0byBoYWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNjYWxlV2l0aFBhcmVudFNpemUodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKG5kKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5kLnNldFN0cmluZyA9IGZ1bmN0aW9uKG5ld1N0cmluZywgbmVlZFVwZGF0ZUxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3JpZ2luIGNvZGUgY29waWVkIGZyb20gQ0NMYWJlbEJNRm9udC5qcyBzZXRTdHJpbmdcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1N0cmluZyA9IFN0cmluZyhuZXdTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWVkVXBkYXRlTGFiZWwgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVlZFVwZGF0ZUxhYmVsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3U3RyaW5nID09IG51bGwgfHwgIWNjLmlzU3RyaW5nKG5ld1N0cmluZykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1N0cmluZyA9IG5ld1N0cmluZyArIFwiXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMuX2luaXRpYWxTdHJpbmcgPSBuZXdTdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0U3RyaW5nKG5ld1N0cmluZywgbmVlZFVwZGF0ZUxhYmVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhlcmUgd2Ugc3RhcnQgdG8gaGFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgZGltZW5zaW9uIGFjY29yZGluZyB0byBpdCdzIHBhcmVudCB3aG8gaGFzIGEgdGFnIDc5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmVlZFVwZGF0ZUxhYmVsID09IHRydWUsIGl0IHByZXZlbnRzIHRoZSBsb29wIGJlZW4gY2FsbGVkIHJlY3Vyc2l2ZWx5LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWVkVXBkYXRlTGFiZWwgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTY2FsZVdpdGhQYXJlbnRTaXplKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKG5kKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHN0ciA9IG5kLmdldFN0cmluZygpO1xuICAgICAgICAgICAgdmFyIHNlYXJjaFN0ciA9IFwiJmtleS5cIjtcbiAgICAgICAgICAgIGlmIChzdHIuc3Vic3RyKDAsIHNlYXJjaFN0ci5sZW5ndGgpID09IHNlYXJjaFN0cikge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBzdHIuc3Vic3RyKHNlYXJjaFN0ci5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF8oa2V5KTtcbiAgICAgICAgICAgICAgICBuZC5zZXRTdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDQ0JDb250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvOC8yOS5cbiAqL1xuXG5cbnZhciBDcm9zc1Byb21Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fY3Jvc3NQcm9tUGljID0gbnVsbDtcblxuICAgIHRoaXMuX2NvcnNzUHJvbUNvbmZpZyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKENyb3NzUHJvbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQ3Jvc3NQcm9tQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMuX2luZm9MYWJlbCkge1xuICAgICAgICBpZiAoZ2FtZS5sb2NhbC5pc0NoaW5lc2UoKSkge1xuICAgICAgICAgICAgdGhpcy5faW5mb0xhYmVsLnNldFN0cmluZyhcIumprOS4iueOqVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoXCJQbGF5XCIpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuQ3Jvc3NQcm9tQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLmRvd25sb2FkQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBjYy5zeXMub3BlblVSTCh0aGlzLl9jb3Jzc1Byb21Db25maWcuZG93bmxvYWRVcmwpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGNvbmZpZywgdGV4dHVyZSkge1xuICAgIHRoaXMuX2NvcnNzUHJvbUNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLl9jcm9zc1Byb21QaWMuc2V0VGV4dHVyZSh0ZXh0dXJlKTtcbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKGNjYk5hbWUpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKGNjYk5hbWUsIG51bGwsIFwiQ3Jvc3NQcm9tQ29udHJvbGxlclwiLCBuZXcgQ3Jvc3NQcm9tQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ3Jvc3NQcm9tQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEvMjMuXG4gKi9cblxudmFyIFBheW1lbnRJbmZvID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wdXJjaGFzZUlkID0gbnVsbDtcbiAgICB0aGlzLnByb2R1Y3RJZCA9IG51bGw7XG4gICAgdGhpcy5yZWNlaXB0ID0gbnVsbDtcbiAgICB0aGlzLnNpZ25hdHVyZSA9IG51bGw7XG5cbiAgICB0aGlzLmluZm8gPSBcIlwiO1xufTtcblxuUGF5bWVudEluZm8ucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uKGpzb25PYmopIHtcbiAgICB0aGlzLnB1cmNoYXNlSWQgPSBqc29uT2JqW1wicHVyY2hhc2VJZFwiXSB8fCBcIlwiO1xuICAgIHRoaXMucHJvZHVjdElkID0ganNvbk9ialtcInByb2R1Y3RJZFwiXSB8fCBcIlwiO1xuICAgIHRoaXMucmVjZWlwdCA9IGpzb25PYmpbXCJyZWNlaXB0XCJdIHx8IFwiXCI7XG4gICAgdGhpcy5zaWduYXR1cmUgPSBqc29uT2JqW1wic2lnbmF0dXJlXCJdIHx8IFwiXCI7XG4gICAgdGhpcy5pbmZvID0ganNvbk9ialtcImluZm9cIl0gfHwgXCJcIjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGF5bWVudEluZm87IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG52YXIgUGxheWVySW5mbyA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5wbGF5ZXJJZCA9IFwiXCI7XG4gICAgdGhpcy5iZXN0U2NvcmUgPSAwO1xuICAgIHRoaXMucmVtb3ZlZEFkcyA9IGZhbHNlO1xuICAgIHRoaXMubGV2ZWwgPSAwO1xuICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xuICAgIHRoaXMubGV2ZWxNYXAgPSBudWxsO1xuICAgIHRoaXMucmF0ZWQgPSBmYWxzZTtcbn07XG5cblBsYXllckluZm8ucHJvdG90eXBlLnVubWFyc2hhbGwgPSBmdW5jdGlvbiAoanNvbikge1xuICAgIHRoaXMucGxheWVySWQgPSBqc29uW1wicGxheWVySWRcIl07XG4gICAgdGhpcy5iZXN0U2NvcmUgPSBqc29uW1wiYmVzdFNjb3JlXCJdIHx8IDA7XG4gICAgdGhpcy5yZW1vdmVkQWRzID0ganNvbltcInJlbW92ZWRBZHNcIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5sZXZlbCA9IGpzb25bXCJsZXZlbFwiXSB8fCAxO1xuICAgIHRoaXMucHJvZ3Jlc3MgPSBqc29uW1wicHJvZ3Jlc3NcIl0gfHwgMDtcbiAgICB0aGlzLmxldmVsTWFwID0ganNvbltcImxldmVsTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMucmF0ZWQgPSBqc29uW1wicmF0ZWRcIl0gfHwgZmFsc2U7XG59O1xuXG5QbGF5ZXJJbmZvLmNyZWF0ZURlZmF1bHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBsYXllckluZm8gPSBuZXcgUGxheWVySW5mbygpO1xuICAgIHBsYXllckluZm8uaGludHNDb3VudCA9IDU7XG4gICAgcGxheWVySW5mby5iZXN0U2NvcmUgPSAwO1xuICAgIHBsYXllckluZm8ucmVtb3ZlZEFkcyA9IGZhbHNlO1xuICAgIHBsYXllckluZm8ubGV2ZWwgPSAxO1xuICAgIHBsYXllckluZm8ucHJvZ3Jlc3MgPSAwO1xuICAgIHBsYXllckluZm8ubGV2ZWxNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLnJhdGVkID0gZmFsc2U7XG4gICAgcmV0dXJuIHBsYXllckluZm87XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllckluZm87XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEvMjMuXG4gKi9cblxudmFyIFByb2R1Y3RJbmZvID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucHJvZHVjdElkID0gMDtcbiAgICB0aGlzLnByaWNlID0gMDtcbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gbnVsbDtcbiAgICB0aGlzLnRpdGxlID0gbnVsbDtcbn07XG5cblByb2R1Y3RJbmZvLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMucHJvZHVjdElkID0ganNvbk9ialtcInByb2R1Y3RJZFwiXTtcbiAgICB0aGlzLnByaWNlID0ganNvbk9ialtcInByaWNlXCJdO1xuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBqc29uT2JqW1wiZGVzY3JpcHRpb25cIl07XG4gICAgdGhpcy50aXRsZSA9IGpzb25PYmpbXCJ0aXRsZVwiXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvZHVjdEluZm87IiwidmFyIEFkc1BsYWNlID0ge1xuICAgIFBhc3M6IDEsXG4gICAgSG9tZTogMixcbiAgICBCYWNrR3JvdW5kOiAzLFxuICAgIFJlZnJlc2g6IDQsXG4gICAgTnVtOiA0XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFkc1BsYWNlOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMS8yMy5cbiAqL1xuXG52YXIgUGF5bWVudENvZGUgPSB7XG4gICAgUEFZTUVOVF9DT0RFX1NVQ0NFU1M6IDAsXG4gICAgUEFZTUVOVF9DT0RFX0ZBSUw6IDFcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGF5bWVudENvZGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGFsYW5tYXJzIG9uIDE1LzQvMTcuXG4gKi9cbnZhciBFdmVudFBhY2thZ2UgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIGNhbGxiYWNrOiBudWxsLFxuICAgIHRhcmdldDogbnVsbCxcbiAgICBsaXN0ZW5lcjogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChjYWxsYmFjaywgdGFyZ2V0LCBsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gICAgfVxufSk7XG5cbnZhciBFdmVudERpc3BhdGNoZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBpbnN0YW5jZTtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUluc3RhbmNlKCkge1xuICAgICAgICB2YXIgbGlzdGVuZXJzTWFwID0ge307XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZVxuICAgICAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0YXJnZXRcbiAgICAgICAgICAgICAqIEByZXR1cm4ge2NjLkV2ZW50TGlzdGVuZXJ9IFJldHVybiB0aGUgbGlzdGVuZXIuIE5lZWRlZCBpbiBvcmRlciB0byByZW1vdmUgdGhlIGV2ZW50IGZyb20gdGhlIGRpc3BhdGNoZXIuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrLCB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnRMaXN0ZW5lciA9IGNjLmV2ZW50TWFuYWdlci5hZGRDdXN0b21MaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRhcmdldCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNob3VsZEFkZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZXMgPSBsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQoZXZlbnRQYWNrYWdlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRQYWNrYWdlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXSA9IGV2ZW50UGFja2FnZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50UGFja2FnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudFBhY2thZ2UgPSBldmVudFBhY2thZ2VzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50UGFja2FnZS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYgZXZlbnRQYWNrYWdlLnRhcmdldCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQWRkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQWRkKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UGFja2FnZXMucHVzaChuZXcgRXZlbnRQYWNrYWdlKGNhbGxiYWNrLCB0YXJnZXQsIGV2ZW50TGlzdGVuZXIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gdGFyZ2V0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrLCB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzTWFwW2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEB0eXBlIHtBcnJheS48RXZlbnRQYWNrYWdlPn1cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHZhciBldmVudFBhY2thZ2VzID0gbGlzdGVuZXJzTWFwW2V2ZW50TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoZXZlbnRQYWNrYWdlcykgJiYgZXZlbnRQYWNrYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UGFja2FnZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRQYWNrYWdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIEB0eXBlIHtFdmVudFBhY2thZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZSA9IGV2ZW50UGFja2FnZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50UGFja2FnZS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYgZXZlbnRQYWNrYWdlLnRhcmdldCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmV2ZW50TWFuYWdlci5yZW1vdmVMaXN0ZW5lcihldmVudFBhY2thZ2UubGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGFja2FnZXMucHVzaChldmVudFBhY2thZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyc01hcFtldmVudE5hbWVdID0gbmV3UGFja2FnZXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB1c2VyRGF0YVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBkaXNwYXRjaEV2ZW50OiBmdW5jdGlvbiAoZXZlbnROYW1lLCB1c2VyRGF0YSkge1xuICAgICAgICAgICAgICAgIGNjLmV2ZW50TWFuYWdlci5kaXNwYXRjaEN1c3RvbUV2ZW50KGV2ZW50TmFtZSwgdXNlckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldEluc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBjcmVhdGVJbnN0YW5jZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgICAgICB9XG4gICAgfTtcbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnREaXNwYXRjaGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzcvMi5cbiAqL1xuY2MuVEFCTEVWSUVXX0ZJTExfTEVGVF9SSUdIVCA9IDA7XG5jYy5UQUJMRVZJRVdfRklMTF9SSUdIVF9MRUZUID0gMDtcblxuLyoqXG4gKiBTb2xlIHB1cnBvc2Ugb2YgdGhpcyBkZWxlZ2F0ZSBpcyB0byBzaW5nbGUgdG91Y2ggZXZlbnQgaW4gdGhpcyB2ZXJzaW9uLlxuICovXG5jYy5NdWx0aUNvbFRhYmxlVmlld0RlbGVnYXRlID0gY2MuQ2xhc3MuZXh0ZW5kKC8qKiBAbGVuZHMgY2MuTXVsdGlDb2xUYWJsZVZpZXdEZWxlZ2F0ZSMgKi97XG4gICAgZ3JpZFRvdWNoZWQ6ZnVuY3Rpb24odGFibGUsZ3JpZCl7XG4gICAgfVxufSk7XG5cbi8qKlxuICogRGF0YSBzb3VyY2UgdGhhdCBnb3Zlcm5zIHRhYmxlIGJhY2tlbmQgZGF0YS5cbiAqL1xuY2MuTXVsdGlDb2xUYWJsZVZpZXdEYXRhU291cmNlID0gY2MuQ2xhc3MuZXh0ZW5kKC8qKiBAbGVuZHMgY2MuVGFibGVWaWV3RGF0YVNvdXJjZSMgKi97XG4gICAgZ3JpZEF0SW5kZXg6ZnVuY3Rpb24odGFibGUsaWR4KXtcbiAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuICAgIG51bWJlck9mQ2VsbHNJblRhYmxlVmlldzpmdW5jdGlvbih0YWJsZSl7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0sXG4gICAgbnVtYmVyT2ZHcmlkc0luQ2VsbDpmdW5jdGlvbih0YWJsZSwgaWR4KXtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfSxcbiAgICBncmlkU2l6ZUZvclRhYmxlOmZ1bmN0aW9uKHRhYmxlLCBpZHgpe1xuICAgICAgICByZXR1cm4gY2Muc2l6ZSgwLDApO1xuICAgIH1cbn0pO1xuXG5jYy5NdWx0aUNvbFRhYmxlVmlldyA9IGNjLkxheWVyQ29sb3IuZXh0ZW5kKHtcbiAgICBfbXVsdGlUYWJsZVZpZXdEYXRhU291cmNlOiBudWxsLFxuICAgIF9tdWx0aVRhYmxlVmlld0RlbGVnYXRlOiBudWxsLFxuICAgIF9ob3Jpem9udGFsT3JkZXI6IGNjLlRBQkxFVklFV19GSUxMX0xFRlRfUklHSFQsXG4gICAgX2dyaWRzRnJlZWQ6IG51bGwsXG4gICAgX2N1clRvdWNoTG9jYXRpb246IG51bGwsXG5cbiAgICBfdGFibGVWaWV3OiBudWxsLFxuICAgIF90b3VjaE5vZGU6IG51bGwsXG4gICAgX2dyaWRDZWxsczogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBkYXRhU291cmNlXG4gICAgICogQHBhcmFtIHtjYy5TaXplfSBzaXplXG4gICAgICogQHBhcmFtIGNvbnRhaW5lclxuICAgICAqL1xuICAgIGN0b3I6IGZ1bmN0aW9uIChkYXRhU291cmNlLCBzaXplLCBjb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY2MuY29sb3IoMCwgMCwgMjU1LCAwKSwgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQpO1xuICAgICAgICB0aGlzLl9ncmlkc0ZyZWVkID0gW107XG4gICAgICAgIHRoaXMuX2dyaWRDZWxscyA9IHt9O1xuICAgICAgICB0aGlzLnNldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZShkYXRhU291cmNlKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3ID0gbmV3IGNjLlRhYmxlVmlldyh0aGlzLCBzaXplLCBjb250YWluZXIpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5fdGFibGVWaWV3KTtcbiAgICAgICAgdGhpcy5fdG91Y2hOb2RlID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LmFkZENoaWxkKHRoaXMuX3RvdWNoTm9kZSwxKTtcbiAgICB9LFxuXG4gICAgb25FbnRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuVE9VQ0hfT05FX0JZX09ORSxcbiAgICAgICAgICAgIHN3YWxsb3dUb3VjaGVzOiBmYWxzZSxcbiAgICAgICAgICAgIG9uVG91Y2hCZWdhbjogdGhpcy5vblRvdWNoQmVnYW4uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzLl90b3VjaE5vZGUpO1xuICAgIH0sXG5cbiAgICBkZXF1ZXVlR3JpZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZ3JpZHNGcmVlZC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuX2dyaWRzRnJlZWQuc2hpZnQoKTtcbiAgICAgICAgICAgIHRoaXMuX2F1dG9SZWxlYXNlKGdyaWQpO1xuICAgICAgICAgICAgcmV0dXJuIGdyaWQ7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3JlbGVhc2VDQjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlbGVhc2UoKTtcbiAgICB9LFxuXG4gICAgX2F1dG9SZWxlYXNlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHZhciBydW5uaW5nID0gb2JqLl9ydW5uaW5nID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICFvYmouX3J1bm5pbmc7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnNjaGVkdWxlKHRoaXMuX3JlbGVhc2VDQiwgb2JqLCAwLCAwLCAwLCBydW5uaW5nLCBvYmouX19pbnN0YW5jZUlkKTtcbiAgICB9LFxuXG4gICAgdGFibGVDZWxsU2l6ZUZvckluZGV4OiBmdW5jdGlvbiAodGFibGUsIGlkeCkge1xuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkuZ3JpZFNpemVGb3JUYWJsZSh0aGlzLCBpZHgpO1xuICAgICAgICBpZiAodGFibGUuZ2V0RGlyZWN0aW9uKCkgPT09IGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX0hPUklaT05UQUwpIHtcbiAgICAgICAgICAgIHNpemUuaGVpZ2h0ICo9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkubnVtYmVyT2ZHcmlkc0luQ2VsbCh0aGlzLCBpZHgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2l6ZS53aWR0aCAqPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLm51bWJlck9mR3JpZHNJbkNlbGwodGhpcywgaWR4KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9LFxuXG4gICAgdGFibGVDZWxsQXRJbmRleDogZnVuY3Rpb24gKHRhYmxlLCBpZHgpIHtcbiAgICAgICAgdmFyIGdyaWQ7XG4gICAgICAgIHZhciBudW1iZXJPZkdyaWRzSW5DZWxsID0gdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5udW1iZXJPZkdyaWRzSW5DZWxsKHRoaXMsIGlkeCk7XG4gICAgICAgIHZhciBjZWxsID0gdGFibGUuZGVxdWV1ZUNlbGwoKTtcbiAgICAgICAgaWYgKCFjZWxsKSB7XG4gICAgICAgICAgICBjZWxsID0gbmV3IGNjLlRhYmxlVmlld0NlbGwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGNlbGwuZ2V0Q2hpbGRyZW4oKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBjaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgIGdyaWQgPSBjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ncmlkc0ZyZWVkLnB1c2goZ3JpZCk7XG4gICAgICAgICAgICAgICAgZ3JpZC5zZXRJZHgoY2MuSU5WQUxJRF9JTkRFWCk7XG4gICAgICAgICAgICAgICAgZ3JpZC5yZXRhaW4oKTtcbiAgICAgICAgICAgICAgICBncmlkLnJlbW92ZUZyb21QYXJlbnQoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gMDtcbiAgICAgICAgZm9yICh2YXIgbG9jYWxJZHggPSAwOyBsb2NhbElkeCA8IGlkeDsgKytsb2NhbElkeCkge1xuICAgICAgICAgICAgc3RhcnRJbmRleCArPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLm51bWJlck9mR3JpZHNJbkNlbGwodGhpcywgbG9jYWxJZHgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBncmlkU2l6ZSA9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkuZ3JpZFNpemVGb3JUYWJsZSh0aGlzLCBpZHgpO1xuICAgICAgICBmb3IgKHZhciBncmlkSWR4ID0gc3RhcnRJbmRleCwgY29sSWR4ID0gMDsgZ3JpZElkeCA8IChudW1iZXJPZkdyaWRzSW5DZWxsICsgc3RhcnRJbmRleCk7IGdyaWRJZHgrKywgY29sSWR4KyspIHtcbiAgICAgICAgICAgIGdyaWQgPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLmdyaWRBdEluZGV4KHRoaXMsIGdyaWRJZHgpO1xuICAgICAgICAgICAgaWYgKGdyaWQpIHtcbiAgICAgICAgICAgICAgICBncmlkLnNldElkeChncmlkSWR4KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ncmlkQ2VsbHNbZ3JpZElkeF0gPSBncmlkO1xuICAgICAgICAgICAgICAgIGdyaWQuc2V0QW5jaG9yUG9pbnQoY2MucCgwLCAwKSk7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlLmdldERpcmVjdGlvbigpID09PSBjYy5TQ1JPTExWSUVXX0RJUkVDVElPTl9IT1JJWk9OVEFMKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZS5nZXRWZXJ0aWNhbEZpbGxPcmRlcigpID09PSBjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkLnNldFBvc2l0aW9uKGNjLnAoMCwgZ3JpZFNpemUuaGVpZ2h0ICogKG51bWJlck9mR3JpZHNJbkNlbGwgLSBjb2xJZHggLSAxKSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5zZXRQb3NpdGlvbihjYy5wKDAsIGdyaWRTaXplLmhlaWdodCAqIGNvbElkeCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5zZXRQb3NpdGlvbihjYy5wKGdyaWRTaXplLndpZHRoICogY29sSWR4LCAwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNlbGwuYWRkQ2hpbGQoZ3JpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNlbGw7XG4gICAgfSxcblxuICAgIG51bWJlck9mQ2VsbHNJblRhYmxlVmlldzogZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHZhciBudW1iZXJPZkNlbGxzID0gdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcodGhpcyk7XG4gICAgICAgIHJldHVybiBudW1iZXJPZkNlbGxzO1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxUb3VjaGVkOiBmdW5jdGlvbiAodGFibGUsIGNlbGwpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdldE11bHRpVGFibGVWaWV3RGVsZWdhdGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2VsbC5nZXRDaGlsZHJlbigpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IGNlbGwuZ2V0Q2hpbGRyZW4oKVtpXTtcbiAgICAgICAgICAgIGdyaWQuc2V0Q29udGVudFNpemUodGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5ncmlkU2l6ZUZvclRhYmxlKHRoaXMsIGNlbGwuZ2V0SWR4KCkpKTtcbiAgICAgICAgICAgIGlmIChncmlkICE9IG51bGwgJiYgdGhpcy5pc1RvdWNoSW5zaWRlKGdyaWQsIHRoaXMuX2N1clRvdWNoTG9jYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKCkuZ3JpZFRvdWNoZWQodGhpcywgZ3JpZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2Nyb2xsVmlld0RpZFNjcm9sbDogZnVuY3Rpb24gKHZpZXcpIHtcbiAgICAgICAgaWYgKHRoaXMuX211bHRpVGFibGVWaWV3RGVsZWdhdGUgJiYgdGhpcy5fbXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZS5zY3JvbGxWaWV3RGlkU2Nyb2xsKSB7XG4gICAgICAgICAgICB0aGlzLl9tdWx0aVRhYmxlVmlld0RlbGVnYXRlLnNjcm9sbFZpZXdEaWRTY3JvbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdGFibGVDZWxsV2lsbFJlY3ljbGU6IGZ1bmN0aW9uICh0YWJsZSwgY2VsbCkge1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxIaWdobGlnaHQ6ZnVuY3Rpb24odGFibGUsIGNlbGwpe1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxVbmhpZ2hsaWdodDpmdW5jdGlvbih0YWJsZSwgY2VsbCl7XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjogZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xuICAgICAgICB0aGlzLl9jdXJUb3VjaExvY2F0aW9uID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211bHRpVGFibGVWaWV3RGF0YVNvdXJjZTtcbiAgICB9LFxuICAgIHNldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZTogZnVuY3Rpb24gKGRhdGFTb3VyY2UpIHtcbiAgICAgICAgdGhpcy5fbXVsdGlUYWJsZVZpZXdEYXRhU291cmNlID0gZGF0YVNvdXJjZTtcbiAgICB9LFxuXG4gICAgZ2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTtcbiAgICB9LFxuXG4gICAgc2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTogZnVuY3Rpb24gKGRlbGVnYXRlKSB7XG4gICAgICAgIHRoaXMuX211bHRpVGFibGVWaWV3RGVsZWdhdGUgPSBkZWxlZ2F0ZTtcbiAgICB9LFxuXG4gICAgc2V0SG9yaXpvbnRhbE9yZGVyOiBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgdGhpcy5faG9yaXpvbnRhbE9yZGVyID0gb3JkZXI7XG4gICAgfSxcbiAgICBnZXRIb3Jpem9udGFsT3JkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvcml6b250YWxPcmRlcjtcbiAgICB9LFxuXG4gICAgaXNUb3VjaEluc2lkZTogZnVuY3Rpb24gKG93bmVyLCB0b3VjaExvY2F0aW9uKSB7XG4gICAgICAgIGlmICghb3duZXIgfHwgIW93bmVyLmdldFBhcmVudCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdG91Y2hMb2NhdGlvbiA9IG93bmVyLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaExvY2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIGNjLnJlY3RDb250YWluc1BvaW50KG93bmVyLmdldEJvdW5kaW5nQm94KCksIHRvdWNoTG9jYXRpb24pO1xuICAgIH0sXG5cbiAgICByZWxvYWREYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG4gICAgfSxcblxuICAgIHNldENvbnRlbnRPZmZzZXQ6IGZ1bmN0aW9uIChvZmZzZXQsIGFuaW1hdGVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldChvZmZzZXQsIGFuaW1hdGVkKTtcbiAgICB9LFxuXG4gICAgZ2V0Q29udGVudE9mZnNldDpmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuZ2V0Q29udGVudE9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBtaW5Db250YWluZXJPZmZzZXQ6ZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBtYXhDb250YWluZXJPZmZzZXQ6ZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3Lm1heENvbnRhaW5lck9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBzZXREaXJlY3Rpb246ZnVuY3Rpb24gKGRpcmVjdGlvbikge1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGRpcmVjdGlvbik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGRldGVybWluZXMgaG93IGNlbGwgaXMgb3JkZXJlZCBhbmQgZmlsbGVkIGluIHRoZSB2aWV3LlxuICAgICAqL1xuICAgIHNldFZlcnRpY2FsRmlsbE9yZGVyOiBmdW5jdGlvbiAoZmlsbE9yZGVyKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihmaWxsT3JkZXIpO1xuICAgIH0sXG5cbiAgICBzZXRDb250ZW50T2Zmc2V0SW5EdXJhdGlvbjogZnVuY3Rpb24gKG9mZnNldCwgZHQpIHtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldENvbnRlbnRPZmZzZXRJbkR1cmF0aW9uKG9mZnNldCwgZHQpO1xuICAgIH0sXG5cbiAgICBnZXRWaWV3U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3LmdldFZpZXdTaXplKCk7XG4gICAgfSxcblxuICAgIGdldENvbnRlbnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuZ2V0Q29udGVudFNpemUoKTtcbiAgICB9LFxuXG4gICAgZ2V0R3JpZEF0SW5kZXg6ZnVuY3Rpb24gKGlkeCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ3JpZENlbGxzW2lkeF07XG4gICAgfSxcblxuICAgIHNldFZpZXdTaXplOiBmdW5jdGlvbiAodmlld1NpemUpIHtcbiAgICAgICAgdGhpcy5zZXRDb250ZW50U2l6ZSh2aWV3U2l6ZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWaWV3U2l6ZSh2aWV3U2l6ZSk7XG4gICAgfSxcblxuICAgIHNldEJvdW5jZWFibGU6IGZ1bmN0aW9uIChib3VuY2VhYmxlKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRCb3VuY2VhYmxlKGJvdW5jZWFibGUpO1xuICAgIH0sXG5cbiAgICBzZXRUb3VjaEVuYWJsZWQ6IGZ1bmN0aW9uICh0b3VjaGFibGUpIHtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldFRvdWNoRW5hYmxlZCh0b3VjaGFibGUpO1xuICAgIH0sXG5cbiAgICBpc0RyYWdnaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuaXNEcmFnZ2luZygpO1xuICAgIH0sXG5cbiAgICBnZXRDb250YWluZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhYmxlVmlldy5nZXRDb250YWluZXIoKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBjYy5NdWx0aUNvbFRhYmxlVmlldzsiLCIvKipcbiAqIENyZWF0ZWQgYnkgemhhbmdtaW5neHUgb24gMjkvMTEvMjAxNi5cbiAqL1xuXG52YXIgVG91Y2hlZE5vZGUgPSBjYy5Ob2RlLmV4dGVuZCh7XG4gICAgb2Zmc2V0WDogMTAsXG4gICAgb2Zmc2V0WTogNSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChpc01lbnVJdGVtKSB7XG4gICAgICAgIHRoaXMuX2lzTWVudUl0ZW0gPSBpc01lbnVJdGVtO1xuICAgICAgICB0aGlzLl9pc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5faXNIb3ZlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pc0hvdmVyUGxheWluZyA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuX2J1dHRvblRvdWNoZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9idXR0b25Nb3VzZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLl9uYW1lID0gXCJUb3VjaGVkTm9kZVwiO1xuICAgIH0sXG5cbiAgICBvbkVudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgICAgLy8vVG91Y2ggRXZlbnRzXG4gICAgICAgIHRoaXMuX2J1dHRvblRvdWNoZXIgPSBjYy5FdmVudExpc3RlbmVyLmNyZWF0ZSh7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5UT1VDSF9PTkVfQllfT05FLFxuICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IGZhbHNlLFxuICAgICAgICAgICAgb25Ub3VjaEJlZ2FuOiB0aGlzLm9uVG91Y2hCZWdhbi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaE1vdmVkOiB0aGlzLm9uVG91Y2hNb3ZlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaEVuZGVkOiB0aGlzLm9uVG91Y2hFbmRlZC5iaW5kKHRoaXMpXG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGhpcy5fYnV0dG9uVG91Y2hlciwgdGhpcyk7XG5cbiAgICAgICAgLy8vTW91c2UgRXZlbnRzXG4gICAgICAgIGlmKCEgY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25Nb3VzZXIgPSBjYy5FdmVudExpc3RlbmVyLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuTU9VU0UsXG4gICAgICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgb25Nb3VzZU1vdmU6IHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGhpcy5fYnV0dG9uTW91c2VyLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0aGlzLl9idXR0b25Ub3VjaGVyKSB7XG4gICAgICAgICAgICBjYy5ldmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIodGhpcy5fYnV0dG9uVG91Y2hlcik7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25Ub3VjaGVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZighIGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYodGhpcy5fYnV0dG9uTW91c2VyKSB7XG4gICAgICAgICAgICAgICAgY2MuZXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKHRoaXMuX2J1dHRvbk1vdXNlcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uTW91c2VyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjpmdW5jdGlvbiAodG91Y2gsIGV2ZW50KSB7XG4gICAgICAgIHZhciBwb3MgPSB0b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgIGlmICh0YXJnZXQgJiYgY2MucmVjdENvbnRhaW5zUG9pbnQodGFyZ2V0LmdldEJvdW5kaW5nQm94VG9Xb3JsZCgpLCBwb3MpKSB7XG4gICAgICAgICAgICBpZih0YXJnZXQuZW5hYmxlZCAmJiB0YXJnZXQudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzVG91Y2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNIb3ZlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlCZWdpbih0YXJnZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaE1vdmVkOmZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcblxuICAgIH0sXG5cbiAgICBvblRvdWNoRW5kZWQ6ZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xuICAgICAgICBpZih0aGlzLl9pc1RvdWNoZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMucGFyZW50O1xuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlFbmQodGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHBvcyA9IGV2ZW50LmdldExvY2F0aW9uKCk7XG4gICAgICAgIC8vL05PVEU6IHRhcmdldCdzIHBhcmVudCBpcyBCdXR0b25cbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMucGFyZW50O1xuICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICBpZihjYy5yZWN0Q29udGFpbnNQb2ludCh0YXJnZXQuZ2V0Qm91bmRpbmdCb3hUb1dvcmxkKCksIHBvcykpIHtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5faXNIb3ZlciAmJiAhdGhpcy5faXNUb3VjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRhcmdldC5lbmFibGVkICYmIHRhcmdldC52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0hvdmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlIb3Zlcih0YXJnZXQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9pc0hvdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzSG92ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheUhvdmVyKHRhcmdldCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfb25Ib3ZlckVuZGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5faXNIb3ZlclBsYXlpbmcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgX3BsYXlCZWdpbkV4OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IENDQiBoYXMgYnVnLCBDQ0NvbnRyb2xCdXR0b24gY2FuIE5PVCBzZXQgY2hpbGQsIHNvIHVzZSBlbXB0eSBub2RlIGNvbnRhaW5zIGJ1dHRvbiBhbmQgbGFiZWxcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDQ29udHJvbEJ1dHRvblxuICAgICAgICAgKiAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBNZW51SXRlbSBpcyBtb3JlIHNwZWNpYWxseVxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NNZW51XG4gICAgICAgICAqICAgICAgICAgIHxfQ0NNZW51SXRlbUltYWdlXG4gICAgICAgICAqICAgICAgICAgICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGhpcy5faXNNZW51SXRlbSAmJiB0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldC5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0YXJnZXQucnVuQWN0aW9uKFxuICAgICAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDEpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAxLjEsIDAuOSksXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDEpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIF9wbGF5RW5kRXg6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogQ0NCIGhhcyBidWcsIENDQ29udHJvbEJ1dHRvbiBjYW4gTk9UIHNldCBjaGlsZCwgc28gdXNlIGVtcHR5IG5vZGUgY29udGFpbnMgYnV0dG9uIGFuZCBsYWJlbFxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NDb250cm9sQnV0dG9uXG4gICAgICAgICAqICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IE1lbnVJdGVtIGlzIG1vcmUgc3BlY2lhbGx5XG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ01lbnVcbiAgICAgICAgICogICAgICAgICAgfF9DQ01lbnVJdGVtSW1hZ2VcbiAgICAgICAgICogICAgICAgICAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0aGlzLl9pc01lbnVJdGVtICYmIHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIHRhcmdldC5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoMC4wMSksXG4gICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjEsIDEsIDEpLFxuICAgICAgICAgICAgICAgIGNjLmRlbGF5VGltZSgwLjAxKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICBfcGxheUJlZ2luOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IENDQiBoYXMgYnVnLCBDQ0NvbnRyb2xCdXR0b24gY2FuIE5PVCBzZXQgY2hpbGQsIHNvIHVzZSBlbXB0eSBub2RlIGNvbnRhaW5zIGJ1dHRvbiBhbmQgbGFiZWxcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDQ29udHJvbEJ1dHRvblxuICAgICAgICAgKiAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBNZW51SXRlbSBpcyBtb3JlIHNwZWNpYWxseVxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NNZW51XG4gICAgICAgICAqICAgICAgICAgIHxfQ0NNZW51SXRlbUltYWdlXG4gICAgICAgICAqICAgICAgICAgICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGhpcy5faXNNZW51SXRlbSAmJiB0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldC5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0YXJnZXQucnVuQWN0aW9uKFxuICAgICAgICAgICAgY2Muc2NhbGVUbygwLjIwLCAwLjg1LCAwLjg1KVxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICBfcGxheUVuZDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBDQ0IgaGFzIGJ1ZywgQ0NDb250cm9sQnV0dG9uIGNhbiBOT1Qgc2V0IGNoaWxkLCBzbyB1c2UgZW1wdHkgbm9kZSBjb250YWlucyBidXR0b24gYW5kIGxhYmVsXG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ0NvbnRyb2xCdXR0b25cbiAgICAgICAgICogICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogTWVudUl0ZW0gaXMgbW9yZSBzcGVjaWFsbHlcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDTWVudVxuICAgICAgICAgKiAgICAgICAgICB8X0NDTWVudUl0ZW1JbWFnZVxuICAgICAgICAgKiAgICAgICAgICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRoaXMuX2lzTWVudUl0ZW0gJiYgdGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4yMCAsMSwgMSlcbiAgICAgICAgKTtcbiAgICB9LFxuXG4gICAgX3BsYXlIb3ZlckV4OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgdmFyIGJvdW5kaW5nID0gdGFyZ2V0LmdldEJvdW5kaW5nQm94KCk7XG4gICAgICAgIGlmKGJvdW5kaW5nLndpZHRoIDwgdGhpcy5vZmZzZXRYKSB7XG4gICAgICAgICAgICBib3VuZGluZy53aWR0aCA9IHRoaXMub2Zmc2V0WDtcbiAgICAgICAgfVxuICAgICAgICBpZihib3VuZGluZy5oZWlnaHQgPCB0aGlzLm9mZnNldFkpIHtcbiAgICAgICAgICAgIGJvdW5kaW5nLmhlaWdodCA9IHRoaXMub2Zmc2V0WTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBDQ0IgaGFzIGJ1ZywgQ0NDb250cm9sQnV0dG9uIGNhbiBOT1Qgc2V0IGNoaWxkLCBzbyB1c2UgZW1wdHkgbm9kZSBjb250YWlucyBidXR0b24gYW5kIGxhYmVsXG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ0NvbnRyb2xCdXR0b25cbiAgICAgICAgICogICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogTWVudUl0ZW0gaXMgbW9yZSBzcGVjaWFsbHlcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDTWVudVxuICAgICAgICAgKiAgICAgICAgICB8X0NDTWVudUl0ZW1JbWFnZVxuICAgICAgICAgKiAgICAgICAgICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRoaXMuX2lzTWVudUl0ZW0gJiYgdGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgIGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wOCwgKGJvdW5kaW5nLndpZHRoLXRoaXMub2Zmc2V0WCkvYm91bmRpbmcud2lkdGgsIChib3VuZGluZy5oZWlnaHQrdGhpcy5vZmZzZXRZKS9ib3VuZGluZy5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAoYm91bmRpbmcud2lkdGgrdGhpcy5vZmZzZXRYKS9ib3VuZGluZy53aWR0aCwgKGJvdW5kaW5nLmhlaWdodC10aGlzLm9mZnNldFkpL2JvdW5kaW5nLmhlaWdodCksXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDQpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAxLCAxKSxcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLl9vbkhvdmVyRW5kZWQsIHRoaXMpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIF9wbGF5SG92ZXI6IGZ1bmN0aW9uKHRhcmdldCwgaXNIb3Zlcikge1xuICAgICAgICAvL2NjLmVycm9yKFwiaG92ZXI6IHRhcmdldCA9IFwiLCB0YXJnZXQsIERhdGUubm93KCkpO1xuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogQ0NCIGhhcyBidWcsIENDQ29udHJvbEJ1dHRvbiBjYW4gTk9UIHNldCBjaGlsZCwgc28gdXNlIGVtcHR5IG5vZGUgY29udGFpbnMgYnV0dG9uIGFuZCBsYWJlbFxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NDb250cm9sQnV0dG9uXG4gICAgICAgICAqICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IE1lbnVJdGVtIGlzIG1vcmUgc3BlY2lhbGx5XG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ01lbnVcbiAgICAgICAgICogICAgICAgICAgfF9DQ01lbnVJdGVtSW1hZ2VcbiAgICAgICAgICogICAgICAgICAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0aGlzLl9pc01lbnVJdGVtICYmIHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LnN0b3BBbGxBY3Rpb25zKCk7XG5cbiAgICAgICAgaWYoaXNIb3Zlcikge1xuICAgICAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjE2LCAxLjA4LCAxLjA4KSxcbiAgICAgICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjEsIDEuMDYsIDEuMDYpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC5zZXRTY2FsZSgxLCAxKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBUb3VjaGVkTm9kZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTUtMTcuXG4gKi9cbnZhciBIdHRwQ2xpZW50ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9uZXQvSHR0cENsaWVudFwiKTtcbnZhciBBZHNQbGFjZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Fkc1BsYWNlXCIpO1xuXG52YXIgQURfQ09ORklHX1VSTCA9IFwiaHR0cHM6Ly9xaW5uaW5nMTk5LmdpdGh1Yi5pby9nYW1lLmh0bWxcIjtcblxuLy92YXIgT05FX01JTlVURSA9IDYwICogMTAwMDtcbnZhciBBZExpc3RlbmVyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBvblJld2FyZGVkVmlkZW9GaW5pc2hlZDogZnVuY3Rpb24gKGlzUmV3YXJkZWQpIHtcbiAgICB9LFxuXG4gICAgb25JbnRlcnN0aXRpYWxBZEVuZDogZnVuY3Rpb24gKGNoYW5uZWxOYW1lKSB7XG4gICAgfSxcblxuICAgIG9uU2hvd1ZpZGVvQWRCZWdpbjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBvblNob3dWaWRlb0FkRW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgfVxufSk7XG5cbnZhciBBZFBsYWNlSW5mbyA9IGZ1bmN0aW9uIChpbnRlcnZhbCkge1xuICAgIHRoaXMuaW50ZXJ2YWwgPSBpbnRlcnZhbDtcbiAgICB0aGlzLmxhc3RTaG93VGltZSA9IERhdGUubm93KCk7XG59O1xuXG5cbnZhciBBZHNNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBERUZBVUxUX0FEX0lOVEVSVkFMOiA2MCAqIDEwMDAsXG5cbiAgICBpbnRlcnZhbE1hcDoge1xuICAgICAgICBcIjBcIjogMTUwLFxuICAgICAgICBcIjFcIjogMTUwLFxuICAgICAgICBcIjJcIjogODAsXG4gICAgICAgIFwiM1wiOiA2MFxuICAgIH0sXG5cbiAgICBPTkVfTUlOVVRFX1NFQ09ORDogNjAgKiAxMDAwLFxuXG4gICAgYWRDb25maWdVcmw6IFwiXCIsXG5cbiAgICByYXRlVGltZTogMCxcbiAgICByYXRlZFRpbWU6IDAsXG4gICAgcmF0ZVJlbW92ZUFkczogZmFsc2UsXG5cbiAgICBpc05ld1BsYXllcjogdHJ1ZSxcblxuICAgIGFkUGxhY2VNYXA6IHt9LFxuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0FkTGlzdGVuZXJ9XG4gICAgICovXG4gICAgYWRMaXN0ZW5lcjogbnVsbCxcblxuICAgIHNob3dUb3BCYW5uZXI6IHRydWUsXG4gICAgdG9wQmFubmVyRGF5OiAwLFxuXG4gICAgbGFzdEludGVyc3RpdGlhbFRpbWU6IDAsXG4gICAgZW5hYmxlZEludGVyc3RpdGlhbEFkOiB0cnVlLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZihjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25JbnRlcnN0aXRpYWxBZEZpbmlzaGVkID0gdGhpcy5vbkFkRmluaXNoZWRKc2IuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25WaWRlb0FkRmluaXNoZWQgPSB0aGlzLm9uVmlkZW9BZEZpbmlzaGVkSnNiLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uU2hvd1ZpZGVvQWRCZWdpbiA9IHRoaXMub25TaG93VmlkZW9BZEJlZ2luSnNiLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uU2hvd1ZpZGVvQWRFbmQgPSB0aGlzLm9uU2hvd1ZpZGVvQWRFbmRKc2IuYmluZCh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBBZHNQbGFjZS5OdW07ICsraSkge1xuICAgICAgICAgICAgdGhpcy5hZFBsYWNlTWFwW2ldID0gbmV3IEFkUGxhY2VJbmZvKHRoaXMuREVGQVVMVF9BRF9JTlRFUlZBTCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmluaXRJbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLmxvZ0ludGVydmFsKFwibG9jYWxcIik7XG4gICAgfSxcblxuICAgIGluaXRJbnRlcnZhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIGluaXRJbnRlcnZhbFwiKTtcbiAgICAgICAgdmFyIGRheSA9IGdhbWUucGxheWVyTWFuLmdldFJlZ2lzdGVyRGF5KCk7XG4gICAgICAgIHZhciBpbnRlcnZhbCA9IHRoaXMuaW50ZXJ2YWxNYXBbZGF5XTtcbiAgICAgICAgaWYgKCFpbnRlcnZhbCkge1xuICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLmludGVydmFsTWFwKTtcbiAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzW2tleXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIGluaXQgaW50ZXJ2YWwga2V5OlwiICsga2V5KTtcbiAgICAgICAgICAgIGludGVydmFsID0gdGhpcy5pbnRlcnZhbE1hcFtrZXldO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbnRlcnZhbCkge1xuICAgICAgICAgICAgdGhpcy5hZFBsYWNlTWFwW0Fkc1BsYWNlLlBhc3NdLmludGVydmFsID0gaW50ZXJ2YWwgKiAxMDAwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGxvYWRSZW1vdGVEYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhZENvbmZpZ1VybCA9IGdhbWUuY29uZmlnLmdldEFkVXJsKCkgfHwgQURfQ09ORklHX1VSTDtcbiAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBsb2FkUmVtb3RlRGF0YTpcIiArIGFkQ29uZmlnVXJsKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBIdHRwQ2xpZW50LmRvR2V0KGFkQ29uZmlnVXJsLCBmdW5jdGlvbiAoZXJyb3IsIHRleHQpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcIkFkc01hbmFnZXIgcmVtb3RlIHJlc3BvbnNlOlwiICsgZXJyb3IgKyBcIix0ZXh0OlwiICsgdGV4dCk7XG4gICAgICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkQ29uZmlnID0gSlNPTi5wYXJzZSh0ZXh0KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkQ29uZmlnICYmIGFkQ29uZmlnLmFuZHJvaWRDb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZENvbmZpZyA9IGFkQ29uZmlnLmFuZHJvaWRDb25maWc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZXJ2YWxNYXAgPSBhZENvbmZpZy5uZXdJbnRlcnZhbE1hcDtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBpbnRlcnZhbE1hcDpcIiArIEpTT04uc3RyaW5naWZ5KGludGVydmFsTWFwKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoaW50ZXJ2YWxNYXApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmludGVydmFsTWFwID0gaW50ZXJ2YWxNYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmluaXRJbnRlcnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3dUb3BCYW5uZXIgPSBhZENvbmZpZy5zaG93VG9wQmFubmVyO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHNob3dUb3BCYW5uZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dUb3BCYW5uZXIgPSBzaG93VG9wQmFubmVyO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcEJhbm5lckRheSA9IGFkQ29uZmlnLnRvcEJhbm5lckRheTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZCh0b3BCYW5uZXJEYXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRvcEJhbm5lckRheSA9IHRvcEJhbm5lckRheTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYWNrVG9Hcm91bmRJbnRlcnZhbCA9IGFkQ29uZmlnLmJhY2tUb0dyb3VuZEludGVydmFsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKGJhY2tUb0dyb3VuZEludGVydmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZFBsYWNlTWFwW0Fkc1BsYWNlLkJhY2tHcm91bmRdLmludGVydmFsID0gYmFja1RvR3JvdW5kSW50ZXJ2YWwgKiAxMDAwO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhY2tUb0hvbWVJbnRlcnZhbCA9IGFkQ29uZmlnLmJhY2tUb0hvbWVJbnRlcnZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChiYWNrVG9Ib21lSW50ZXJ2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFkUGxhY2VNYXBbQWRzUGxhY2UuSG9tZV0uaW50ZXJ2YWwgPSBiYWNrVG9Ib21lSW50ZXJ2YWwgKiAxMDAwO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZnJlc2hJbnRlcnZhbCA9IGFkQ29uZmlnLnJlZnJlc2hJbnRlcnZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChyZWZyZXNoSW50ZXJ2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFkUGxhY2VNYXBbQWRzUGxhY2UuUmVmcmVzaF0uaW50ZXJ2YWwgPSByZWZyZXNoSW50ZXJ2YWwgKiAxMDAwO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWRzQ29uZmlnID0gYWRDb25maWcuYWRzQ29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkc0NvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc2JfZHAub25lU2RrQnJpZGdlLnNldEludGVyc3RpdGlhbEFkV2VpZ2h0Q29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2V0SW50ZXJzdGl0aWFsQWRXZWlnaHRDb25maWcoSlNPTi5zdHJpbmdpZnkoYWRzQ29uZmlnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV3YXJkQWRzQ29uZmlnID0gYWRDb25maWcucmV3YXJkQWRzQ29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJld2FyZEFkc0NvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc2JfZHAub25lU2RrQnJpZGdlLnNldFJld2FyZEFkV2VpZ2h0Q29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2V0UmV3YXJkQWRXZWlnaHRDb25maWcoSlNPTi5zdHJpbmdpZnkocmV3YXJkQWRzQ29uZmlnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyQWRzQ29uZmlnID0gYWRDb25maWcuYmFubmVyQWRzQ29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhbm5lckFkc0NvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc2JfZHAub25lU2RrQnJpZGdlLnNldEJhbm5lckFkV2VpZ2h0Q29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2V0QmFubmVyQWRXZWlnaHRDb25maWcoSlNPTi5zdHJpbmdpZnkoYmFubmVyQWRzQ29uZmlnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dJbnRlcnZhbChcInNlcnZlclwiKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkFkc01hbmFnZXIgZXJyb3I6XCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldFJlZ2lzdGVyRGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXRSZWdpc3RlckRheSgpO1xuICAgIH0sXG5cbiAgICBsb2dJbnRlcnZhbDogZnVuY3Rpb24gKHRhZykge1xuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIFwiICsgdGFnICsgXCIgYWRQbGFjZU1hcDpcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWRQbGFjZU1hcCkgK1xuICAgICAgICAgICAgXCIsZGF5OlwiICsgdGhpcy5nZXRSZWdpc3RlckRheSgpKTtcbiAgICB9LFxuXG4gICAgc2V0SXNOZXdQbGF5ZXI6IGZ1bmN0aW9uIChpc05ldykge1xuICAgICAgICB0aGlzLmlzTmV3UGxheWVyID0gaXNOZXc7XG4gICAgfSxcblxuICAgIG9uR2FtZU9uU2hvdzogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBzZXRBZExpc3RlbmVyOiBmdW5jdGlvbiAoYWRMaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmFkTGlzdGVuZXIgPSBhZExpc3RlbmVyO1xuICAgIH0sXG5cbiAgICBpc1JlbW92ZWRBZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdhbWUucGxheWVyTWFuLnBsYXllci5yZW1vdmVkQWRzO1xuICAgIH0sXG5cbiAgICBzaG93QmFubmVyQWRzOiBmdW5jdGlvbiAocGxhY2VtZW50KSB7XG4gICAgICAgIGNjLmxvZyhcIkFkc01hbmFnZXIgc2hvd0Jhbm5lckFkczpcIiArIHBsYWNlbWVudCk7XG4gICAgICAgIGlmICh0aGlzLmlzUmVtb3ZlZEFkcygpKSByZXR1cm47XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1Nob3dCYW5uZXJBZHMocGxhY2VtZW50KSkge1xuICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2hvd0Jhbm5lckFkKHBsYWNlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlQmFubmVyQWRzOiBmdW5jdGlvbiAocGxhY2VtZW50KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucmVtb3ZlQmFubmVyQWQocGxhY2VtZW50KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc1Nob3dCYW5uZXJBZHM6IGZ1bmN0aW9uIChwbGFjZW1lbnQpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNTaG93QmFubmVyQWQocGxhY2VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHNob3dJbnRlcnN0aXRpYWw6IGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEludGVyc3RpdGlhbEFkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNSZW1vdmVkQWRzKCkpIHJldHVybjtcbiAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBzaG93SW50ZXJzdGl0aWFsIHBsYWNlOlwiICsgcGxhY2UgKyBcIiwgaW50ZXJ2YWw6XCIgKyB0aGlzLmFkUGxhY2VNYXBbcGxhY2VdLmludGVydmFsICsgXCIsY3VycmVudCBpbnRlcnZhbDpcIiArXG4gICAgICAgICAgICAoRGF0ZS5ub3coKSAtIHRoaXMuYWRQbGFjZU1hcFtwbGFjZV0ubGFzdFNob3dUaW1lKSk7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy5hZFBsYWNlTWFwW3BsYWNlXS5sYXN0U2hvd1RpbWUgPCB0aGlzLmFkUGxhY2VNYXBbcGxhY2VdLmludGVydmFsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZFBsYWNlTWFwW3BsYWNlXS5sYXN0U2hvd1RpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy5sYXN0SW50ZXJzdGl0aWFsVGltZSA8IDUgKiAxMDAwKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3dJbnRlcnN0aXRpYWwgaW50ZXJ2YWwgbGVzcyB0aGFuIDUgc2Vjb25kc1wiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3dJbnRlcnN0aXRpYWwgcGxhY2U6XCIgKyBwbGFjZSArIFwiIHNob3dlZFwiKTtcbiAgICAgICAgdGhpcy5sYXN0SW50ZXJzdGl0aWFsVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgICAgdmFyIHBsYWNlbWVudCA9IFwiZGVmYXVsdFwiO1xuICAgICAgICBpZiAocGxhY2UgPT09IEFkc1BsYWNlLkhvbWUpIHtcbiAgICAgICAgICAgIHBsYWNlbWVudCA9IFwiaG9tZVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBsYWNlID09PSBBZHNQbGFjZS5SZWZyZXNoKSB7XG4gICAgICAgICAgICBwbGFjZW1lbnQgPSBcInJlZnJlc2hcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dJbnRlcnN0aXRhbEFkKHBsYWNlbWVudCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd05hdGl2ZUFkOiBmdW5jdGlvbiAocGxhY2UsIHBvc1gsIHBvc1kpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZW1vdmVkQWRzKCkpIHJldHVybjtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zaG93TmF0aXZlQWQocGxhY2UsIHBvc1gsIHBvc1kpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZU5hdGl2ZUFkOiBmdW5jdGlvbiAocGxhY2UpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZW1vdmVkQWRzKCkpIHJldHVybjtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5yZW1vdmVOYXRpdmVBZChwbGFjZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0SW50ZXJzdGl0aWFsU2hvd2VkOiBmdW5jdGlvbiAocGxhY2UpIHtcbiAgICAgICAgdGhpcy5hZFBsYWNlTWFwW3BsYWNlXS5sYXN0U2hvd1RpbWUgPSBEYXRlLm5vdygpO1xuICAgIH0sXG5cbiAgICBzaG93Q3Jvc3NQcm9tb3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zaG93Q3Jvc3NQcm9tb3RlQWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc1Jld2FyZFZpZGVvUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9pZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0UmV3YXJkQWRQbGFjZUNvdW50UGVyRGF5KCkgPiBnYW1lLmNvbmZpZy5yZXdhcmRBZE1heENvdW50UGVyRGF5KSB7XG4gICAgICAgIC8vICAgIGNjLmxvZyhcIkFkc01hbmFnZXIgaXNSZXdhcmRWaWRlb1JlYWR5IGhhcyByZWFjaGVkIG1heCBjb3VudDpcIiArIGdhbWUucGxheWVyTWFuLmdldFJld2FyZEFkUGxhY2VDb3VudFBlckRheSgpKTtcbiAgICAgICAgLy8gICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAvL31cbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNSZXdhcmRWaWRlb1JlYWR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBzaG93UmV3YXJkVmlkZW9BZDogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmV3YXJkVmlkZW9SZWFkeSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbmFibGVkSW50ZXJzdGl0aWFsKGZhbHNlKTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zaG93UmV3YXJkVmlkZW9BZChuYW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBlbmFibGVkSW50ZXJzdGl0aWFsOiBmdW5jdGlvbiAoZW5hYmxlZCkge1xuICAgICAgICB0aGlzLmVuYWJsZWRJbnRlcnN0aXRpYWxBZCA9IGVuYWJsZWQ7XG4gICAgfSxcblxuICAgIG9uQWRGaW5pc2hlZEpzYjogZnVuY3Rpb24gKHN0cikge1xuICAgICAgICBjYy5sb2coXCJvbkFkRmluaXNoZWRKc2I6XCIgKyBzdHIpO1xuICAgICAgICB2YXIgYWRzRmluaXNoZWRPYmogPSBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgIHZhciBjaGFubmVsTmFtZSA9IGFkc0ZpbmlzaGVkT2JqW1wiY2hhbm5lbE5hbWVcIl07XG4gICAgICAgIGNjLmxvZyhcImNoYW5uZWwgOlwiICsgY2hhbm5lbE5hbWUgKyBcIiBzaG93IGludGVyc3RpdGlhbCBhZHMgZmluaXNoZWRcIik7XG5cbiAgICAgICAgaWYgKHRoaXMuYWRMaXN0ZW5lciAmJiB0aGlzLmFkTGlzdGVuZXIub25JbnRlcnN0aXRpYWxBZEVuZCkge1xuICAgICAgICAgICAgdGhpcy5hZExpc3RlbmVyLm9uSW50ZXJzdGl0aWFsQWRFbmQoY2hhbm5lbE5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEludGVyc3RpdGlhbEFkQ291bnQoKTtcbiAgICB9LFxuXG4gICAgb25WaWRlb0FkRmluaXNoZWRKc2I6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgY2MubG9nKFwib25WaWRlb0FkRmluaXNoZWRKc2I6XCIgKyBzdHIpO1xuICAgICAgICB2YXIgYWRzRmluaXNoZWRPYmogPSBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgIHZhciBpc1NraXBwZWQgPSBhZHNGaW5pc2hlZE9iai5pc1NraXBwZWQ7XG4gICAgICAgIGlmICghaXNTa2lwcGVkKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJyZXdhcmQgdmlkZW8gYWRzIHNob3cgc3VjY2Vzc1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmxvZyhcInJld2FyZCB2aWRlbyBhZHMgc2tpcHBlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmFkTGlzdGVuZXIgJiYgdGhpcy5hZExpc3RlbmVyLm9uUmV3YXJkZWRWaWRlb0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICB0aGlzLmFkTGlzdGVuZXIub25SZXdhcmRlZFZpZGVvRmluaXNoZWQoIWlzU2tpcHBlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1NraXBwZWQpIHtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZFJld2FyZGVkQWRDb3VudCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uU2hvd1ZpZGVvQWRCZWdpbkpzYjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5hZExpc3RlbmVyICYmIHRoaXMuYWRMaXN0ZW5lci5vblNob3dWaWRlb0FkQmVnaW4pIHtcbiAgICAgICAgICAgIHRoaXMuYWRMaXN0ZW5lci5vblNob3dWaWRlb0FkQmVnaW4oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvblNob3dWaWRlb0FkRW5kSnNiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmFkTGlzdGVuZXIgJiYgdGhpcy5hZExpc3RlbmVyLm9uU2hvd1ZpZGVvQWRFbmQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRMaXN0ZW5lci5vblNob3dWaWRlb0FkRW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbmFibGVkSW50ZXJzdGl0aWFsKHRydWUpO1xuICAgIH1cbn0pO1xuXG5BZHNNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcbkFkc01hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkFkc01hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEFkc01hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBBZHNNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQWRzTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBBZHNNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBBZHNNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBZHNNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xuXG52YXIgQW5hbHlzZU1hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIGdfcEFuYWx5dGljczogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGluaXRBbmFseXRpY3M6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgdHJhY2tMb2dpbkV2ZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UudHJhY2tMb2dpbigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnROdW1cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbVR5cGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHJlY2VpcHRcbiAgICAgKi9cbiAgICB0cmFja1B1cmNoYXNlRXZlbnQ6IGZ1bmN0aW9uIChhbW91bnROdW0sIGl0ZW1UeXBlLCBpdGVtSWQsIHJlY2VpcHQpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja1B1cmNoYXNlKGFtb3VudE51bSwgaXRlbVR5cGUsIGl0ZW1JZCwgcmVjZWlwdCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJhY2tTdGFydFByb2dyZXNzaW9uRXZlbnQ6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnRyYWNrU3RhcnRQcm9ncmVzc2lvbihuYW1lLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJhY2tDb21wbGV0ZWRQcm9ncmVzc2lvbkV2ZW50OiBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja0NvbXBsZXRlZFByb2dyZXNzaW9uKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0cmFja0ZhaWxlZFByb2dyZXNzaW9uRXZlbnQ6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnRyYWNrRmFpbFByb2dyZXNzaW9uKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiB0cmFjayBlcnJvciBldmVudFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlcnJvck1zZ1xuICAgICAqL1xuICAgIHRyYWNrRXJyb3JFdmVudDogZnVuY3Rpb24gKGVycm9yTXNnKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UudHJhY2tFcnJvcihlcnJvck1zZyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJhY2tFdmVudDogZnVuY3Rpb24gKG5hbWUsIG9iaikge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB2YXIgaW5mbyA9IFwiXCI7XG4gICAgICAgICAgICBpZiAob2JqKSB7XG4gICAgICAgICAgICAgICAgaW5mbyA9IEpTT04uc3RyaW5naWZ5KG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnRyYWNrRXZlbnQobmFtZSwgaW5mbyk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuQW5hbHlzZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuQW5hbHlzZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkFuYWx5c2VNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChBbmFseXNlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIEFuYWx5c2VNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQW5hbHlzZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQW5hbHlzZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEFuYWx5c2VNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBbmFseXNlTWFuYWdlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTUtMTcuXG4gKi9cbnZhciBDYXB0dXJlTGlzdGVuZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIG9uQ2FwdHVyZUF1ZGlvOiBmdW5jdGlvbiAoYXVkaW9EZWNpYmxlKSB7XG4gICAgfVxufSk7XG5cblxudmFyIENhcHR1cmVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vbkNhcHR1cmVBdWRpbyA9IHRoaXMub25DYXB0dXJlQXVkaW8uYmluZCh0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRDYXB0dXJlTGlzdGVuZXI6IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gICAgfSxcblxuICAgIGNhcHR1cmVBdWRpbzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLmNhcHR1cmVBdWRpbygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEF1ZGlvRGVjaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5nZXRBdWRpb0RlY2libGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9LFxuXG4gICAgb25DYXB0dXJlQXVkaW86IGZ1bmN0aW9uIChhdWRpb0RlY2libGVTdHJpbmcpIHtcbiAgICAgICAgdmFyIGF1ZGlvT2JqID0gSlNPTi5wYXJzZShhdWRpb0RlY2libGVTdHJpbmcpO1xuICAgICAgICB2YXIgYXVkaW9EZWNpYmxlID0gYXVkaW9PYmpbXCJhdWRpb0RlY2libGVcIl07XG4gICAgICAgIGlmICh0aGlzLmxpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyLm9uQ2FwdHVyZUF1ZGlvKGF1ZGlvRGVjaWJsZSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuQ2FwdHVyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuQ2FwdHVyZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkNhcHR1cmVNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChDYXB0dXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIENhcHR1cmVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQ2FwdHVyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQ2FwdHVyZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIENhcHR1cmVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXB0dXJlTWFuYWdlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzgvMjkuXG4gKi9cblxudmFyIEh0dHBDbGllbnQgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL25ldC9IdHRwQ2xpZW50XCIpO1xuXG52YXIgQ3Jvc3NQcm9tRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNjb3JlTGltaXQgPSAwO1xuICAgIHRoaXMuaW1hZ2VVcmwgPSBcIlwiO1xuICAgIHRoaXMuZG93bmxvYWRVcmwgPSBcIlwiO1xuICAgIHRoaXMud2VpZ2h0ID0gMDtcbiAgICB0aGlzLmFwcElkID0gXCJcIjtcbn07XG5cbnZhciBDcm9zc1Byb21NYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBjYWNoZWRUZXh0dXJlOiBudWxsLFxuICAgIGNhY2hlZENvbmZpZzogbnVsbCxcbiAgICBjcm9zc1Byb21zOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgdHJ5VG9Mb2FkRnJvbVJlbW90ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3Jvc3NQcm9tVXJsID0gZ2FtZS5jb25maWcuZ2V0Q3Jvc3NQcm9tVXJsKCk7XG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBIdHRwQ2xpZW50LmRvR2V0KGNyb3NzUHJvbVVybCwgZnVuY3Rpb24gKGVycm9yLCB0ZXh0KSB7XG4gICAgICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvTG9hZEZyb21SZW1vdGUgZG93bmxvYWRlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHRleHQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbiA9IGRhdGEub3BlbiB8fCBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3JlTGltaXQgPSBkYXRhLnNjb3JlTGltaXQgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoIWNjLmlzVW5kZWZpbmVkKGdhbWUucGxheWVyTWFuLnBsYXllci5iZXN0U2NvcmUpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuYmVzdFNjb3JlIDwgc2NvcmVMaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvTG9hZEZyb21SZW1vdGUgZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmJlc3RTY29yZTpcIiArIGdhbWUucGxheWVyTWFuLnBsYXllci5iZXN0U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAvLyAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKGdhbWUucGxheWVyTWFuLnBsYXllci5sZXZlbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIubGV2ZWwgPCBzY29yZUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXhQb3BDb3VudCA9IGRhdGEubWF4UG9wQ291bnQgfHwgMztcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5kb3dubG9hZGVkU2hvdyA9IGRhdGEuZG93bmxvYWRlZFNob3cgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY3Jvc3NQcm9tcyA9IGRhdGFbXCJjcm9zc1Byb21zXCJdO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLm1heFBvcENvdW50ID0gbWF4UG9wQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudHJ5VG9Eb3dubG9hZFByb21vSW1nKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHRyeVRvRG93bmxvYWRQcm9tb0ltZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5tYXhQb3BDb3VudCA8PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2FjaGVkQ29uZmlnIHx8IHRoaXMuY2FjaGVkVGV4dHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWF4UG9wQ291bnQtLTtcbiAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvRG93bmxvYWRQcm9tb0ltZyBjaGVja1wiKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHRoaXMuY3Jvc3NQcm9tcykgJiYgY2MuaXNBcnJheSh0aGlzLmNyb3NzUHJvbXMpICYmIHRoaXMuY3Jvc3NQcm9tcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgcmFuZG9tQ29uZmlnID0gdGhpcy5nZXRSYW5kb21Db25maWcodGhpcy5jcm9zc1Byb21zKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ3Jvc3NQcm9tb0NmZyhyYW5kb21Db25maWcpO1xuICAgICAgICAgICAgLy9nYW1lLnV0aWxzLmRvd25sb2FkXG4gICAgICAgICAgICBjYy5sb2coXCJjcm9zcyBwcm9tb3Rpb24gdHJ5VG9Eb3dubG9hZFByb21vSW1nIHN0YXJ0IGRvd25sb2FkXCIpO1xuICAgICAgICAgICAgZ2FtZS51dGlscy5sb2FkUmVtb3RlSW1nKHJhbmRvbUNvbmZpZy5pbWFnZVVybCwgZnVuY3Rpb24gKGVycm9yLCB0ZXgsIGV4dHJhKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnJvciAmJiB0ZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvRG93bmxvYWRQcm9tb0ltZyBkb3dubG9hZGVkOlwiICsgc2VsZi5kb3dubG9hZGVkU2hvdyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2FjaGVkVGV4dHVyZSA9IHRleDtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWNoZWRUZXh0dXJlLnJldGFpbigpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmNhY2hlZENvbmZpZyA9IHJhbmRvbUNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZG93bmxvYWRlZFNob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZG93bmxvYWRlZFNob3cgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJ5VG9Qb3B1cENyb3NzUHJvbURsZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgbnVsbCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlQ3Jvc3NQcm9tb0NmZzogZnVuY3Rpb24gKGNyb3NzUHJvbUNmZykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY3Jvc3NQcm9tcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3Jvc3NQcm9tc1tpXSA9PT0gY3Jvc3NQcm9tQ2ZnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIGdldFJhbmRvbUNvbmZpZzogZnVuY3Rpb24gKGNyb3NzUHJvbXMpIHtcbiAgICAgICAgdmFyIHRvdGFsV2VpZ2h0ID0gMDtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjcm9zc1Byb21zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0b3RhbFdlaWdodCArPSBjcm9zc1Byb21zW2ldLndlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQodG90YWxXZWlnaHQpO1xuXG4gICAgICAgIHZhciBjdXJXZWlnaHQgPSAwO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3Jvc3NQcm9tcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY3VyV2VpZ2h0ICs9IGNyb3NzUHJvbXNbaV0ud2VpZ2h0O1xuICAgICAgICAgICAgaWYgKGN1cldlaWdodCA+IHJhbmRvbU51bSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjcm9zc1Byb21zW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNyb3NzUHJvbXNbMF07XG4gICAgfSxcblxuICAgIHBvcHVwQ3Jvc3NQcm9tRGxnOiBmdW5jdGlvbiAoY3Jvc3NQcm9tc0NvbmZpZywgdGV4dHVyZSkge1xuICAgICAgICB2YXIgQ3Jvc3NQcm9tQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Nyb3NzUHJvbUNvbnRyb2xsZXJcIik7XG4gICAgICAgIHZhciBjcm9zc1Byb21Ob2RlID0gQ3Jvc3NQcm9tQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKFwicmVzL2Nyb3NzL2Nyb3NzX3Byb21fdmlldy5jY2JpXCIpO1xuICAgICAgICBjcm9zc1Byb21Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY3Jvc3NQcm9tc0NvbmZpZywgdGV4dHVyZSk7XG4gICAgICAgIGNyb3NzUHJvbU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICB0cnlUb1BvcHVwQ3Jvc3NQcm9tRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcImNyb3NzIHByb21vdGlvbiB0cnlUb1BvcHVwQ3Jvc3NQcm9tRGxnIHN0YXJ0XCIpO1xuICAgICAgICBpZiAodGhpcy5jYWNoZWRDb25maWcgJiYgdGhpcy5jYWNoZWRUZXh0dXJlKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJjcm9zcyBwcm9tb3Rpb24gdHJ5VG9Qb3B1cENyb3NzUHJvbURsZyBwb3BlZFwiKTtcbiAgICAgICAgICAgIHRoaXMucG9wdXBDcm9zc1Byb21EbGcodGhpcy5jYWNoZWRDb25maWcsIHRoaXMuY2FjaGVkVGV4dHVyZSk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlZFRleHR1cmUucmVsZWFzZSgpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZWRDb25maWcgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jYWNoZWRUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudHJ5VG9Eb3dubG9hZFByb21vSW1nKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuQ3Jvc3NQcm9tTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG51bGw7XG5Dcm9zc1Byb21NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5Dcm9zc1Byb21NYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChDcm9zc1Byb21NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IpIHtcbiAgICAgICAgQ3Jvc3NQcm9tTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIENyb3NzUHJvbU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQ3Jvc3NQcm9tTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gQ3Jvc3NQcm9tTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBDcm9zc1Byb21NYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIEdDTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGlzR2FtZUNlbnRlckF2YWlsYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5pc0dhbWVDZW50ZXJBdmFpbGFibGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHJlcG9ydFNjb3JlOiBmdW5jdGlvbiAoc2NvcmUsIGxlYWRlckJvYXJkS2V5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucmVwb3J0U2NvcmUoc2NvcmUsIGxlYWRlckJvYXJkS2V5KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaG93TGVhZGVyYm9hcmQ6IGZ1bmN0aW9uIChsZWFkZXJCb2FyZEtleSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dMZWFkZXJib2FyZChsZWFkZXJCb2FyZEtleSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVwb3J0QWNoaWV2ZW1lbnQ6IGZ1bmN0aW9uIChwZXJjZW50Q29tcGxldGVkLCBhcmNoaWV2ZW1lbnRLZXkpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5yZXBvcnRBY2hpZXZlbWVudChwZXJjZW50Q29tcGxldGVkLCBhcmNoaWV2ZW1lbnRLZXkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dBY2hpZXZlbWVudHM6IGZ1bmN0aW9uIChsZWFkZXJCb2FyZGtleSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dBY2hpZXZlbWVudHMobGVhZGVyQm9hcmRrZXkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhpZ2hTY29yZUZvckxlYWRlcmJvYXJkOiBmdW5jdGlvbiAobGVhZGVyQm9hcmRLZXkpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaGlnaFNjb3JlRm9yTGVhZGVyYm9hcmQobGVhZGVyQm9hcmRLZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0sXG5cbiAgICBwcm9ncmVzc0ZvckFjaGlldmVtZW50OiBmdW5jdGlvbiAoYXJjaGlldmVtZW50S2V5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLnByb2dyZXNzRm9yQWNoaWV2ZW1lbnQoYXJjaGlldmVtZW50S2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59KTtcblxuR0NNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcbkdDTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gdHJ1ZTtcblxuR0NNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChHQ01hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBHQ01hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IGZhbHNlO1xuICAgICAgICBHQ01hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgR0NNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBHQ01hbmFnZXIuc2hhcmVkRGlyZWN0b3I7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdDTWFuYWdlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzMvMTEuXG4gKi9cblxudmFyIExvY2FsaXphdGlvbk1hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgX2lzTG9hZGVkOiBmYWxzZSxcbiAgICBjdXJMYW5ndWFnZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5faXNMb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkpIHtcbiAgICAgICAgICAgIHRoaXMuY3VyTGFuZ3VhZ2UgPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9zdHJpbmdzLXpoLmpzb25cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1ckxhbmd1YWdlID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvc3RyaW5ncy1lbi5qc29uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2lzTG9hZGVkID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VyTGFuZ3VhZ2Vba2V5XSB8fCBrZXk7XG4gICAgfSxcblxuICAgIGlzQ2hpbmVzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59KTtcblxuTG9jYWxpemF0aW9uTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG51bGw7XG5Mb2NhbGl6YXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5Mb2NhbGl6YXRpb25NYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChMb2NhbGl6YXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IpIHtcbiAgICAgICAgTG9jYWxpemF0aW9uTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIExvY2FsaXphdGlvbk1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgTG9jYWxpemF0aW9uTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gTG9jYWxpemF0aW9uTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBMb2NhbGl6YXRpb25NYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIE5vdGlmaWNhdGlvbk1hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICByZWdpc3Rlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnJlZ2lzdGVyTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGltZUZyb21Ob3dcbiAgICAgKiBAcGFyYW0gYWxlcnRUZXh0XG4gICAgICogQHBhcmFtIGFsZXJ0QWN0aW9uXG4gICAgICogQHBhcmFtIGJhZGdlTnVtYmVyXG4gICAgICogQHBhcmFtIHNvdW5kXG4gICAgICovXG4gICAgc2NoZWR1bGVOb3RpZmljYXRpb246IGZ1bmN0aW9uICh0aW1lRnJvbU5vdywgYWxlcnRUZXh0LCBhbGVydEFjdGlvbiwgYmFkZ2VOdW1iZXIpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zY2hlZHVsZU5vdGlmaWNhdGlvbih0aW1lRnJvbU5vdywgYWxlcnRUZXh0LCBhbGVydEFjdGlvbiwgYmFkZ2VOdW1iZXIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVuc2NoZWR1bGVOb3RpZmljYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS51bnNjaGVkdWxlTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuTm90aWZpY2F0aW9uTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG51bGw7XG5Ob3RpZmljYXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5Ob3RpZmljYXRpb25NYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChOb3RpZmljYXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IpIHtcbiAgICAgICAgTm90aWZpY2F0aW9uTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIE5vdGlmaWNhdGlvbk1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgTm90aWZpY2F0aW9uTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gTm90aWZpY2F0aW9uTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBOb3RpZmljYXRpb25NYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIFJhdGVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLmluaXRSYXRlUGFyYW1zKDMsIDEsIDAuNSwgMC41LCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UubGF1bmNoUmF0ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGxpa2VJbkZhY2Vib29rOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIGNjLnN5cy5vcGVuVVJMKHVybCk7XG4gICAgfSxcblxuICAgIGxhdW5jaEFwcFJldmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5sYXVuY2hBcHBSZXZpZXcoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG5cblJhdGVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcblJhdGVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5SYXRlTWFuYWdlci5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoUmF0ZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBSYXRlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIFJhdGVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbmV3IFJhdGVNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBSYXRlTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmF0ZU1hbmFnZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG5cbnZhciBTaGFyZU1hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgc2hhcmVXaXRoU3lzdGVtOiBmdW5jdGlvbiAodGlwcykge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB2YXIgZmlsZU5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgICAgIGZpbGVOYW1lID0gZ2FtZS51dGlscy5nZXRTY3JlZW5TaG90KFwiY2FwdHVyZV9zY3JlZW4uanBnXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zeXN0ZW1TaGFyZShmaWxlTmFtZSwgdGlwcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb3BlbkFwcFdpdGhJZGVudGlmaWVyOiBmdW5jdGlvbiAoYXBwSWQpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vcGVuQXBwV2l0aElkZW50aWZpZXIoYXBwSWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNlbmRFbWFpbDogZnVuY3Rpb24gKGFkZHJlc3MsIHRpdGxlLCBib2R5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2VuZEVtYWlsKGFkZHJlc3MsIHRpdGxlLCBib2R5KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5TaGFyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuU2hhcmVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5TaGFyZU1hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFNoYXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIFNoYXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIFNoYXJlTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBTaGFyZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIFNoYXJlTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2hhcmVNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIFBheW1lbnRJbmZvID0gcmVxdWlyZShcIi4uL2VudGl0eS9QYXltZW50SW5mb1wiKTtcbnZhciBQYXltZW50Q29kZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1BheW1lbnRDb2RlXCIpO1xudmFyIFByb2R1Y3RJbmZvID0gcmVxdWlyZShcIi4uL2VudGl0eS9Qcm9kdWN0SW5mb1wiKTtcblxudmFyIFBheW1lbnREZWxlZ2F0ZSA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtQYXltZW50Q29kZX0gZXJyb3JcbiAgICAgKiBAcGFyYW0ge1BheW1lbnRJbmZvfSBwYXltZW50SW5mb1xuICAgICAqL1xuICAgIG9uUGF5bWVudENvbXBsZXRlZDogZnVuY3Rpb24gKGVycm9yLCBwYXltZW50SW5mbykge1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0FycmF5LjxQYXltZW50SW5mbz59IHBheW1lbnRJbmZvTGlzdFxuICAgICAqL1xuICAgIG9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAocGF5bWVudEluZm9MaXN0KSB7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIG9uIGdldCBwcm9kdWN0IGxpc3QuXG4gICAgICogQHBhcmFtIHtBcnJheS48UHJvZHVjdEluZm8+fSBwcm9kdWN0TGlzdFxuICAgICAqL1xuICAgIG9uR2V0UHJvZHVjdExpc3Q6IGZ1bmN0aW9uIChwcm9kdWN0TGlzdCkge1xuICAgIH1cbn0pO1xuXG52YXIgU3RvcmVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7UGF5bWVudERlbGVnYXRlfVxuICAgICAqL1xuICAgIHBheW1lbnREZWxlZ2F0ZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPFBheW1lbnRJbmZvPn0gcGF5bWVudEluZm9MaXN0XG4gICAgICovXG4gICAgcHJvZHVjdExpc3Q6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25HZXRQcm9kdWN0TGlzdCA9IHRoaXMub25HZXRQcm9kdWN0TGlzdC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vblB1cmNoYXNlID0gdGhpcy5vblB1cmNoYXNlLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uQ29uc3VtZSA9IHRoaXMub25Db25zdW1lLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0ID0gdGhpcy5vbkdldFVudmVyaWZpZWRSZWNlaXB0TGlzdC5iaW5kKHRoaXMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHNldCBwYXltZW50IGRlbGVnYXRlLlxuICAgICAqIEBwYXJhbSB7UGF5bWVudERlbGVnYXRlfSBwYXltZW50RGVsZWdhdGVcbiAgICAgKi9cbiAgICBzZXRQYXltZW50RGVsZWdhdGU6IGZ1bmN0aW9uIChwYXltZW50RGVsZWdhdGUpIHtcbiAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUgPSBwYXltZW50RGVsZWdhdGU7XG4gICAgfSxcblxuICAgIG9uR2V0UHJvZHVjdExpc3Q6IGZ1bmN0aW9uIChqc29uUmVzdWx0KSB7XG4gICAgICAgIGNjLmxvZyhcIm9uR2V0UHJvZHVjdExpc3Q6IFwiICsganNvblJlc3VsdCk7XG4gICAgICAgIGlmIChqc29uUmVzdWx0KSB7XG4gICAgICAgICAgICB2YXIgcHJvZHVjdHMgPSBKU09OLnBhcnNlKGpzb25SZXN1bHQpO1xuICAgICAgICAgICAgaWYgKHByb2R1Y3RzICYmIHByb2R1Y3RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdExpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0SW5mbyA9IG5ldyBQcm9kdWN0SW5mbygpO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SW5mby51bm1hcnNoYWwocHJvZHVjdHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5wdXNoKHByb2R1Y3RJbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUub25HZXRQcm9kdWN0TGlzdChwcm9kdWN0TGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0TGlzdCA9IHByb2R1Y3RMaXN0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUHVyY2hhc2U6IGZ1bmN0aW9uIChqc29uUmVzdWx0KSB7XG4gICAgICAgIGNjLmxvZyhcIm9uUHVyY2hhc2U6IFwiICsganNvblJlc3VsdCk7XG4gICAgICAgIHZhciBwdXJjaGFzZVJlc3VsdCA9IEpTT04ucGFyc2UoanNvblJlc3VsdCk7XG4gICAgICAgIHZhciBwdXJjaGFzZURhdGE7XG4gICAgICAgIGlmIChwdXJjaGFzZVJlc3VsdC5lcnJvckNvZGUgPT09IFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9TVUNDRVNTKSB7XG4gICAgICAgICAgICBwdXJjaGFzZURhdGEgPSBKU09OLnBhcnNlKGpzb25SZXN1bHQpO1xuICAgICAgICAgICAgdGhpcy5fcGF5bWVudENvbXBsZXRlZChQYXltZW50Q29kZS5QQVlNRU5UX0NPREVfU1VDQ0VTUywgcHVyY2hhc2VEYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHB1cmNoYXNlRGF0YSA9IEpTT04ucGFyc2UoanNvblJlc3VsdCk7XG4gICAgICAgICAgICB0aGlzLl9wYXltZW50Q29tcGxldGVkKFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9GQUlMLCBwdXJjaGFzZURhdGEpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uQ29uc3VtZTogZnVuY3Rpb24gKGpzb25JbmZvKSB7XG4gICAgICAgIGNjLmxvZyhcIm9uQ29uc3VtZTogXCIgKyBqc29uSW5mbyk7XG4gICAgfSxcblxuICAgIG9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAocHVyY2hhc2VMaXN0U3RyaW5nKSB7XG4gICAgICAgIGNjLmxvZyhcIm9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBcIiArIHB1cmNoYXNlTGlzdFN0cmluZyk7XG4gICAgICAgIGlmIChwdXJjaGFzZUxpc3RTdHJpbmcgJiYgcHVyY2hhc2VMaXN0U3RyaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBwdXJjaGFzZUpzb25MaXN0ID0gSlNPTi5wYXJzZShwdXJjaGFzZUxpc3RTdHJpbmcpO1xuICAgICAgICAgICAgaWYgKHB1cmNoYXNlSnNvbkxpc3QgJiYgcHVyY2hhc2VKc29uTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB1cmNoYXNlSW5mb0xpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHB1cmNoYXNlSnNvbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBheW1lbnRNc2cgPSBwdXJjaGFzZUpzb25MaXN0W2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGF5bWVudEluZm8gPSBuZXcgUGF5bWVudEluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgcGF5bWVudEluZm8udW5tYXJzaGFsKHBheW1lbnRNc2cpO1xuICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZUluZm9MaXN0LnB1c2gocGF5bWVudEluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vbkdldFVudmVyaWZpZWRSZWNlaXB0TGlzdChwdXJjaGFzZUluZm9MaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSxcblxuICAgIF9wYXltZW50Q29tcGxldGVkOiBmdW5jdGlvbiAoZXJyb3IsIHBheW1lbnRNc2cpIHtcbiAgICAgICAgdmFyIHBheW1lbnRJbmZvID0gbmV3IFBheW1lbnRJbmZvKCk7XG4gICAgICAgIHBheW1lbnRJbmZvLnVubWFyc2hhbChwYXltZW50TXNnKTtcbiAgICAgICAgaWYgKGVycm9yID09PSBQYXltZW50Q29kZS5QQVlNRU5UX0NPREVfU1VDQ0VTUykge1xuICAgICAgICAgICAgaWYgKHBheW1lbnRNc2cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vblBheW1lbnRDb21wbGV0ZWQoUGF5bWVudENvZGUuUEFZTUVOVF9DT0RFX1NVQ0NFU1MsIHBheW1lbnRJbmZvKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdCA9IHRoaXMuX2dldFByb2R1Y3RCeUlkKHBheW1lbnRJbmZvLnByb2R1Y3RJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHByb2R1Y3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlID0gdGhpcy5fZ2V0TnVtRnJvbVN0cmluZyhwcm9kdWN0LnByaWNlKSAqIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja1B1cmNoYXNlRXZlbnQocHJpY2UsIHByb2R1Y3QudGl0bGUsIHBheW1lbnRJbmZvLnByb2R1Y3RJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRJbmZvLnJlY2VpcHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUub25QYXltZW50Q29tcGxldGVkKFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9GQUlMLCBwYXltZW50SW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vblBheW1lbnRDb21wbGV0ZWQoUGF5bWVudENvZGUuUEFZTUVOVF9DT0RFX0ZBSUwsIHBheW1lbnRJbmZvKTtcbiAgICAgICAgfVxuICAgICAgICAvL2lmIChjYy5zeXMub3MgIT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgIC8vICAgIHRoaXMuY29uc3VtZShwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgLy99XG4gICAgfSxcblxuICAgIF9nZXROdW1Gcm9tU3RyaW5nOiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bXjAtOS5dL2lnLCBcIlwiKTtcbiAgICB9LFxuXG4gICAgcmVxdWVzdFByb2R1Y3Q6IGZ1bmN0aW9uIChwcm9kdWN0SWRzKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0UHJvZHVjdHNJbmZvKHByb2R1Y3RJZHMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBheUZvclByb2R1Y3Q6IGZ1bmN0aW9uIChwcm9kdWN0SWQpIHtcbiAgICAgICAgY2MubG9nKFwicGF5Rm9yUHJvZHVjdDpcIiArIHByb2R1Y3RJZCk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucHVyY2hhc2UocHJvZHVjdElkKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb25zdW1lOiBmdW5jdGlvbiAodHJhbnNhY3Rpb25JZCkge1xuICAgICAgICBjYy5sb2coXCJjb25zdW1lOlwiICsgdHJhbnNhY3Rpb25JZCk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbklkICYmIHRyYW5zYWN0aW9uSWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuY29uc3VtZSh0cmFuc2FjdGlvbklkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN0b3JlQ29tcGxldGVkVHJhbnNhY3Rpb25zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcInJlc3RvcmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNcIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucmVzdG9yZVRyYW5zYWN0aW9ucygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFVudmVyaWZpZWRSZWNlaXB0TGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2coXCJnZXRVbnZlcmlmaWVkUmVjZWlwdExpc3RcIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2dldFByb2R1Y3RCeUlkOiBmdW5jdGlvbiAocHJvZHVjdElkKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2R1Y3RMaXN0ICYmIHRoaXMucHJvZHVjdExpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnByb2R1Y3RMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSB0aGlzLnByb2R1Y3RMaXN0W2ldO1xuICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0LnByb2R1Y3RJZCA9PT0gcHJvZHVjdElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9kdWN0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59KTtcblxuU3RvcmVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcblN0b3JlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gdHJ1ZTtcblxuU3RvcmVNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChTdG9yZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBTdG9yZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IGZhbHNlO1xuICAgICAgICBTdG9yZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgU3RvcmVNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBTdG9yZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3I7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlTWFuYWdlcjsiLCJ2YXIgREFZX0lOX1NFQ09ORFMgPSAyNCAqIDYwICogNjA7XG5cbnZhciBOT1RJRklDQVRJT05fREFZUyA9IFsxLCAzLCA3LCAxNSwgMzBdO1xudmFyIEFkc1BsYWNlID0gcmVxdWlyZShcIi4uL2VudW0vQWRzUGxhY2VcIik7XG5cbnZhciBMb2dpY01hbiA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgX2lzUmVnaXN0ZXJHYW1lRXZlbnRMaXN0ZW5lcjogZmFsc2UsXG4gICAgX3N0YXJ0OiBmYWxzZSxcbiAgICBjdG9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZSA9IGpzYl9kcC5PbmVTREtKU0JyaWRnZS5nZXRJbnN0YW5jZSgpO1xuICAgICAgICAgICAgaWYgKGpzYl9kcC5Mb2dpY0pTQnJpZGdlICYmIGpzYl9kcC5Mb2dpY0pTQnJpZGdlLmdldEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAganNiX2RwLmxvZ2ljQnJpZGdlID0ganNiX2RwLkxvZ2ljSlNCcmlkZ2UuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBFdmVudERpc3BhdGNoZXIgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50RGlzcGF0Y2hlclwiKTtcbiAgICAgICAgdmFyIE5vdGlmaWNhdGlvbk1hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9Ob3RpZmljYXRpb25NYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgQW5hbHlzZU1hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9BbmFseXNlTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIFN0b3JlTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL1N0b3JlTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIEdDTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL0dDTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIFJhdGVNYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvUmF0ZU1hbmFnZXJcIik7XG4gICAgICAgIHZhciBQbGF5ZXJNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvUGxheWVyTWFuXCIpO1xuICAgICAgICB2YXIgU3RvcmFnZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vc3RvcmFnZS9TdG9yYWdlQ29udHJvbGxlclwiKTtcbiAgICAgICAgdmFyIEFkc01hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9BZHNNYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgQXVkaW9QbGF5ZXIgPSByZXF1aXJlKFwiLi4vYXVkaW8vQXVkaW9QbGF5ZXJcIik7XG4gICAgICAgIHZhciBVdGlscyA9IHJlcXVpcmUoXCIuLi91dGlsL1V0aWxzXCIpO1xuICAgICAgICB2YXIgU2hhcmVNYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvU2hhcmVNYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgRGlhbG9nTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9wb3B1cC9EaWFsb2dNYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgQXNzZXRzTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9hc3NldHMvQXNzZXRzTWFuYWdlclwiKTtcblxuICAgICAgICB2YXIgQmFzZUNDQkNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9CYXNlQ0NCQ29udHJvbGxlclwiKTtcbiAgICAgICAgdmFyIEF1ZGlvSGVscGVyID0gcmVxdWlyZShcIi4uL3V0aWwvQXVkaW9IZWxwZXJcIik7XG4gICAgICAgIHZhciBDYXB0dXJlTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL0NhcHR1cmVNYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgTG9jYWxpemF0aW9uTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL0xvY2FsaXphdGlvbk1hbmFnZXJcIik7XG4gICAgICAgIHZhciBDcm9zc1Byb21NYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvQ3Jvc3NQcm9tTWFuYWdlclwiKTtcblxuICAgICAgICB3aW5kb3cuZ2FtZSA9IHt9O1xuICAgICAgICB3aW5kb3cuZ2FtZS51dGlscyA9IFV0aWxzO1xuICAgICAgICB3aW5kb3cuZ2FtZS5ldmVudERpc3BhdGNoZXIgPSBFdmVudERpc3BhdGNoZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUubG9naWNNYW4gPSB0aGlzO1xuICAgICAgICB3aW5kb3cuZ2FtZS5ub3RpZmljYXRpb25NYW5hZ2VyID0gTm90aWZpY2F0aW9uTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hbmFseXNlTWFuYWdlciA9IEFuYWx5c2VNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnN0b3JlTWFuYWdlciA9IFN0b3JlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5nY01hbmFnZXIgPSBHQ01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUucmF0ZU1hbmFnZXIgPSBSYXRlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5wbGF5ZXJNYW4gPSBQbGF5ZXJNYW4uZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuc3RvcmFnZUNvbnRyb2xsZXIgPSBTdG9yYWdlQ29udHJvbGxlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hZHNNYW5hZ2VyID0gQWRzTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hdWRpb1BsYXllciA9IEF1ZGlvUGxheWVyLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnNoYXJlTWFuYWdlciA9IFNoYXJlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5kaWFsb2dNYW5hZ2VyID0gRGlhbG9nTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hc3NldHNNYW5hZ2VyID0gQXNzZXRzTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5jYXB0dXJlTWFuYWdlciA9IENhcHR1cmVNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLmxvY2FsID0gTG9jYWxpemF0aW9uTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuXG4gICAgICAgIHdpbmRvdy5CYXNlQ0NCQ29udHJvbGxlciA9IEJhc2VDQ0JDb250cm9sbGVyO1xuICAgICAgICB3aW5kb3cuQXVkaW9IZWxwZXIgPSBBdWRpb0hlbHBlcjtcblxuICAgICAgICB2YXIgR2FtZUJyaWRnZSA9IHJlcXVpcmUoXCIuLi9icmlkZ2UvR2FtZUJyaWRnZVwiKTtcbiAgICAgICAgd2luZG93LkdhbWVCcmlkZ2UgPSBHYW1lQnJpZGdlO1xuICAgICAgICB3aW5kb3cuZ2FtZS5jb25maWcgPSBHYW1lQnJpZGdlLmdldENvbmZpZygpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5wb3B1cE1hbiA9IEdhbWVCcmlkZ2UuZ2V0UG9wdXBNYW4oKTtcbiAgICAgICAgd2luZG93LmdhbWUuZ2FtZU1hbiA9IEdhbWVCcmlkZ2UuZ2V0R2FtZU1hbigpO1xuXG4gICAgICAgIHdpbmRvdy5nYW1lLmNyb3NzUHJvbU1hbiA9IENyb3NzUHJvbU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcblxuICAgICAgICBfID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIGdhbWUubG9jYWwuZ2V0VmFsdWUoa2V5KTtcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICByZWdpc3RlckdhbWVFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoIXRoaXMuX2lzUmVnaXN0ZXJHYW1lRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgdGhpcy5faXNSZWdpc3RlckdhbWVFdmVudExpc3RlbmVyID0gdHJ1ZTtcbiAgICAgICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoY2MuZ2FtZS5FVkVOVF9TSE9XLCB0aGlzLmdhbWVPblNob3csIHRoaXMpO1xuICAgICAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihjYy5nYW1lLkVWRU5UX0hJREUsIHRoaXMuZ2FtZU9uSGlkZSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcHVyZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKGNjLmdhbWUuRVZFTlRfU0hPVywgdGhpcy5nYW1lT25TaG93LCB0aGlzKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihjYy5nYW1lLkVWRU5UX0hJREUsIHRoaXMuZ2FtZU9uSGlkZSwgdGhpcyk7XG4gICAgfSxcblxuICAgIGdhbWVPblNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICBnYW1lLm5vdGlmaWNhdGlvbk1hbmFnZXIudW5zY2hlZHVsZU5vdGlmaWNhdGlvbigpO1xuXG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5vbkdhbWVPblNob3coKTtcblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IDQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd0ludGVyc3RpdGlhbChBZHNQbGFjZS5CYWNrR3JvdW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpLCAxMDApO1xuICAgIH0sXG5cbiAgICBnYW1lT25IaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUxvY2FsTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNldEludGVyc3RpdGlhbFNob3dlZChBZHNQbGFjZS5CYWNrR3JvdW5kKTtcbiAgICAgICAgdGhpcy5sYXN0SGlkZVRpbWUgPSBEYXRlLm5vdygpO1xuICAgIH0sXG5cbiAgICByZWdpc3Rlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLm5vdGlmaWNhdGlvbk1hbmFnZXIucmVnaXN0ZXJOb3RpZmljYXRpb24oKTtcbiAgICB9LFxuXG4gICAgc3RhcnRHYW1lOiBmdW5jdGlvbiAobm90SW5pdFBsYXllcikge1xuICAgICAgICBpZiAodGhpcy5fc3RhcnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGFydCA9IHRydWU7XG4gICAgICAgIGdhbWUubm90aWZpY2F0aW9uTWFuYWdlci51bnNjaGVkdWxlTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJHYW1lRXZlbnRMaXN0ZW5lcigpO1xuXG4gICAgICAgIGlmICghbm90SW5pdFBsYXllcikge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uaW5pdERhdGEoKTtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLmFkc01hbmFnZXIuaW5pdCgpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIubG9hZFJlbW90ZURhdGEoKTtcbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5pbml0QW5hbHl0aWNzKCk7XG4gICAgICAgIGdhbWUuZ2NNYW5hZ2VyLmlzR2FtZUNlbnRlckF2YWlsYWJsZSgpO1xuICAgICAgICBnYW1lLnJhdGVNYW5hZ2VyLmluaXQoMywgMSwgMC41LCAwLjUsIHRydWUpO1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrTG9naW5FdmVudCgpO1xuICAgICAgICBnYW1lLmNyb3NzUHJvbU1hbi50cnlUb0xvYWRGcm9tUmVtb3RlKCk7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5zZXRJc05ld1BsYXllcihnYW1lLnBsYXllck1hbi5pc05ld1BsYXllcigpKTtcbiAgICB9LFxuXG4gICAgc2NoZWR1bGVMb2NhbE5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cblxuICAgICAgICB2YXIgbGVmdFRpbWVTZWNvbmRzID0gTWF0aC5mbG9vcihnYW1lLmdhbWVNYW4uZ2V0V2hlZWxMZWZ0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgIGlmIChsZWZ0VGltZVNlY29uZHMgPCA1ICogNjApIHtcbiAgICAgICAgICAgIGxlZnRUaW1lU2Vjb25kcyA9IDUgKiA2MDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW5kZXggPSAxO1xuICAgICAgICAvL3doZWVsIG5vdGlmaWNhdGlvbi5cbiAgICAgICAgZ2FtZS5ub3RpZmljYXRpb25NYW5hZ2VyLnNjaGVkdWxlTm90aWZpY2F0aW9uKGxlZnRUaW1lU2Vjb25kcyxcbiAgICAgICAgICAgIF8oXCJ3aGVlbF9pc19yZWFkeVwiKSwgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImFwcF9uYW1lXCIpLCBpbmRleCsrKTtcblxuICAgICAgICAvL2RhaWx5IGJvbnVzIG5vdGlmaWNhdGlvbi5cbiAgICAgICAgdmFyIGxhc3RDbGFpbURheSA9IGdhbWUucGxheWVyTWFuLnBsYXllci5sYXN0Q2xhaW1EYWlseUJvbnVzRGF5O1xuICAgICAgICB2YXIgY3VycmVudERheUNsYWltZWQgPSAobGFzdENsYWltRGF5ID49IGdhbWUudXRpbHMuZ2V0RGF5QnlUcyhEYXRlLm5vdygpKSk7XG4gICAgICAgIHZhciBkYWlseUJvbnVzU2Vjb25kcyA9IDA7XG4gICAgICAgIGlmIChjdXJyZW50RGF5Q2xhaW1lZCkge1xuICAgICAgICAgICAgdmFyIG5leHREYXlUaW1lID0gKGdhbWUudXRpbHMuZ2V0RGF5QnlUcyhEYXRlLm5vdygpKSArIDEpICogKDI0ICogMzYwMCAqIDEwMDApO1xuICAgICAgICAgICAgZGFpbHlCb251c1NlY29uZHMgPSAobmV4dERheVRpbWUgLSBEYXRlLm5vdygpKSAvIDEwMDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhaWx5Qm9udXNTZWNvbmRzIDw9IDEwICogNjApIHtcbiAgICAgICAgICAgIGRhaWx5Qm9udXNTZWNvbmRzID0gMTAgKiA2MDtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLm5vdGlmaWNhdGlvbk1hbmFnZXIuc2NoZWR1bGVOb3RpZmljYXRpb24oZGFpbHlCb251c1NlY29uZHMsXG4gICAgICAgICAgICBfKFwiZGFpbHlfYm9udXNfaXNfcmVhZHlcIiksIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJhcHBfbmFtZVwiKSwgaW5kZXgrKyk7XG5cbiAgICAgICAgLy9ub3JtYWwgbm90aWZpY2F0aW9uLlxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE5PVElGSUNBVElPTl9EQVlTLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBnYW1lLm5vdGlmaWNhdGlvbk1hbmFnZXIuc2NoZWR1bGVOb3RpZmljYXRpb24oREFZX0lOX1NFQ09ORFMgKiBOT1RJRklDQVRJT05fREFZU1tpXSxcbiAgICAgICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKGdhbWUudXRpbHMuc3ByaW50ZihcIm5vdGlfdGlwcyVkXCIsIGkgKyAxKSksIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJhcHBfbmFtZVwiKSwgaW5kZXgrKyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcnN5bmNVc2VyRGF0YUZyb21HQzogZnVuY3Rpb24gKCkge1xuICAgICAgICAvL3ZhciBoaWdoTGV2ZWwgPSBnYW1lLmdjTWFuYWdlci5oaWdoU2NvcmVGb3JMZWFkZXJib2FyZChnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpKTtcbiAgICAgICAgLy9pZiAoaGlnaExldmVsID4gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSkge1xuICAgICAgICAvLyAgICBnYW1lLnBsYXllck1hbi5zZXRMZXZlbChoaWdoTGV2ZWwpO1xuICAgICAgICAvL31cbiAgICB9XG59KTtcblxuTG9naWNNYW4uX2luc3RhbmNlID0gbnVsbDtcbkxvZ2ljTWFuLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge0xvZ2ljTWFufVxuICovXG5Mb2dpY01hbi5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoTG9naWNNYW4uX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgTG9naWNNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgTG9naWNNYW4uX2luc3RhbmNlID0gbmV3IExvZ2ljTWFuKCk7XG4gICAgfVxuICAgIHJldHVybiBMb2dpY01hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IExvZ2ljTWFuOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzUvMTIuXG4gKi9cbnZhciBQbGF5ZXJJbmZvID0gcmVxdWlyZShcIi4uL2VudGl0eS9QbGF5ZXJJbmZvXCIpO1xuXG52YXIgUExBWUVSX0tFWSA9IFwicGxheWVyX2tleVwiO1xuXG52YXIgUGxheWVyTWFuID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBwbGF5ZXI6IG51bGwsXG4gICAgYmVzdFNjb3JlS2V5OiBudWxsLFxuICAgIGxldmVsQm9hcmRLZXk6IG51bGwsXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBpbml0RGF0YTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGxheWVySW5mb1N0ciA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShQTEFZRVJfS0VZLCBudWxsKTtcbiAgICAgICAgdmFyIHBsYXllcjtcbiAgICAgICAgaWYgKHBsYXllckluZm9TdHIgPT0gbnVsbCB8fCBwbGF5ZXJJbmZvU3RyID09IFwiXCIpIHtcbiAgICAgICAgICAgIHBsYXllciA9IFBsYXllckluZm8uY3JlYXRlRGVmYXVsdCgpO1xuICAgICAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFBMQVlFUl9LRVksIEpTT04uc3RyaW5naWZ5KHBsYXllcikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGxheWVyID0gbmV3IFBsYXllckluZm8oKTtcbiAgICAgICAgICAgIHBsYXllci51bm1hcnNoYWxsKEpTT04ucGFyc2UocGxheWVySW5mb1N0cikpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgIH0sXG5cbiAgICBnZXRCZXN0U2NvcmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmJlc3RTY29yZTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLmlzVW5kZWZpbmVkKHRoaXMucGxheWVyLmxldmVsKSkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIubGV2ZWw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0TGV2ZWw6IGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICB0aGlzLnBsYXllci5sZXZlbCA9IGxldmVsO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVMZXZlbFN0YXI6IGZ1bmN0aW9uIChsZXZlbCwgbGV2ZWxTdGFyKSB7XG4gICAgICAgIGlmIChjYy5pc1VuZGVmaW5lZCh0aGlzLnBsYXllci5sZXZlbE1hcFtsZXZlbF0pIHx8IHRoaXMucGxheWVyLmxldmVsTWFwW2xldmVsXSA8IGxldmVsU3Rhcikge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIubGV2ZWxNYXBbbGV2ZWxdID0gbGV2ZWxTdGFyO1xuICAgICAgICAgICAgZ2FtZS5nY01hbmFnZXIucmVwb3J0U2NvcmUobGV2ZWwsIHRoaXMuZ2V0TGV2ZWxCb2FyZEtleSgpKTtcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmxldmVsTWFwW2xldmVsXSB8fCAwO1xuICAgIH0sXG5cbiAgICBhZGRMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSh0aGlzLnBsYXllci5sZXZlbCwgdGhpcy5nZXRMZXZlbEJvYXJkS2V5KCkpO1xuICAgICAgICB0aGlzLnBsYXllci5sZXZlbCsrO1xuICAgICAgICB0aGlzLnBsYXllci5wcm9ncmVzcyA9IDA7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUJlc3RTY29yZTogZnVuY3Rpb24gKG5ld0Jlc3RTY29yZSkge1xuICAgICAgICBpZiAobmV3QmVzdFNjb3JlID4gdGhpcy5wbGF5ZXIuYmVzdFNjb3JlKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5iZXN0U2NvcmUgPSBuZXdCZXN0U2NvcmU7XG4gICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZShuZXdCZXN0U2NvcmUsIHRoaXMuZ2V0QmVzdFNjb3JlQm9hcmRLZXkoKSk7XG4gICAgICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRMZXZlbEJvYXJkS2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxldmVsQm9hcmRLZXkgfHwgZ2FtZS5jb25maWcuZ2V0TGVhZGVyQm9hcmRLZXkoKTtcbiAgICB9LFxuXG4gICAgZ2V0QmVzdFNjb3JlQm9hcmRLZXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVzdFNjb3JlS2V5IHx8IGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCk7XG4gICAgfSxcblxuICAgIHNldExldmVsQm9hcmRLZXk6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdGhpcy5sZXZlbEJvYXJkS2V5ID0ga2V5O1xuICAgIH0sXG5cbiAgICBzZXRCZXN0U2NvcmVCb2FyZEtleTogZnVuY3Rpb24gKGJlc3RTY29yZUtleSkge1xuICAgICAgICB0aGlzLmJlc3RTY29yZUtleSA9IGJlc3RTY29yZUtleTtcbiAgICB9LFxuXG4gICAgdXBkYXRlUHJvZ3Jlc3M6IGZ1bmN0aW9uIChwcm9ncmVzcykge1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIucHJvZ3Jlc3MgPCBwcm9ncmVzcykge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlZEFkczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5yZW1vdmVkQWRzID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcygpO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRSYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5yYXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIF9mbHVzaFRvU3RvcmFnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oUExBWUVSX0tFWSwgSlNPTi5zdHJpbmdpZnkodGhpcy5wbGF5ZXIpKTtcbiAgICB9XG59KTtcblxuUGxheWVyTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5QbGF5ZXJNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7UGxheWVyTWFufVxuICovXG5QbGF5ZXJNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBQbGF5ZXJNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgUGxheWVyTWFuLl9pbnN0YW5jZSA9IG5ldyBQbGF5ZXJNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIFBsYXllck1hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllck1hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS80LzIyLlxuICovXG52YXIgSHR0cENsaWVudCA9IHtcblxuICAgIC8qKlxuICAgICAqIGdldCByZXF1ZXN0LGpzYiBvayxodG1sNSBzaG93cyAgTm8gJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicgaGVhZGVyIGlzIHByZXNlbnQgb24gdGhlIHJlcXVlc3RlZCByZXNvdXJjZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAqL1xuICAgIGRvR2V0OiBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgeGhyID0gY2MubG9hZGVyLmdldFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG5cbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcInJlYWR5U3RhdGU6XCIreGhyLnJlYWR5U3RhdGUrXCIsc3RhdHVzOlwiK3hoci5zdGF0dXMrXCIsc3RhdHVUZXh0OlwiK3hoci5zdGF0dXNUZXh0K1wiLCwscmVzcG9uc2VUZXh0OlwiK3hoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQgJiYgeGhyLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB2YXIgaHR0cFN0YXR1cyA9IHhoci5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHhoci5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCxyZXNwb25zZSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh4aHIuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHhoci5zZW5kKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbVxuICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsc3RyaW5nPn0gaGVhZGVyc1xuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICovXG4gICAgZG9Qb3N0OiBmdW5jdGlvbiAodXJsLCBwYXJhbXMsIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB4aHIgPSBjYy5sb2FkZXIuZ2V0WE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCk7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBoZWFkZXJzKSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7XG4gICAgICAgIH1cbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPD0gMjA3KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHhoci5zdGF0dXMsIHhoci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB4aHIuc2VuZChwYXJhbXMpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEh0dHBDbGllbnQ7IiwidmFyIE1vZGFsTGF5ZXIgPSByZXF1aXJlKFwiLi9Nb2RhbExheWVyXCIpO1xuXG52YXIgRGlhbG9nTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgRElBTE9HX1pPUkRFUl9CRUdJTjogOTk5LFxuICAgIERJQUxPR19aT1JERVJfU1RFUDogMixcblxuICAgIC8qKlxuICAgICAqIEB0eXBlcyB7TW9kYWxMYXllcn1cbiAgICAgKi9cbiAgICBfb3ZlcmxheTogbnVsbCxcbiAgICBfc2NhbGVGYWN0b3I6IDAsXG4gICAgLyoqXG4gICAgICogQHR5cGVzIHtBcnJheS48TW9kYWxMYXllcj59XG4gICAgICovXG4gICAgX2RpYWxvZ1N0YWNrOiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBjcmVhdGVPdmVybGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX292ZXJsYXkgPSBuZXcgTW9kYWxMYXllcigpO1xuICAgICAgICB0aGlzLl9vdmVybGF5LnNldENvbG9yKGNjLmNvbG9yLkJMQUNLKTtcbiAgICAgICAgdGhpcy5fb3ZlcmxheS5zZXRPcGFjaXR5KDE5MCk7XG4gICAgICAgIHRoaXMuX292ZXJsYXkuc2V0Q29udGVudFNpemUoY2Muc2l6ZShjYy53aW5TaXplLndpZHRoLCBjYy53aW5TaXplLmhlaWdodCkpO1xuICAgICAgICB0aGlzLl9vdmVybGF5LnNldExvY2FsWk9yZGVyKDk5OSk7XG4gICAgICAgIHRoaXMuX292ZXJsYXkucmV0YWluKCk7XG4gICAgICAgIHRoaXMuX3NjYWxlRmFjdG9yID0gMS4wO1xuICAgICAgICB0aGlzLl9kaWFsb2dTdGFjayA9IFtdO1xuICAgIH0sXG5cbiAgICBwb3B1cDogZnVuY3Rpb24gKGRsZywgcGFyYW0pIHtcbiAgICAgICAgZGxnLmlnbm9yZUFuY2hvclBvaW50Rm9yUG9zaXRpb24oZmFsc2UpO1xuICAgICAgICBkbGcuc2V0U2NhbGUodGhpcy5fc2NhbGVGYWN0b3IpO1xuICAgICAgICB2YXIgZGxnTGVuID0gdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoO1xuICAgICAgICBjYy5sb2coXCJkbGdMZW46XCIgKyBkbGdMZW4pO1xuICAgICAgICBpZiAoZGxnTGVuID09IDApIHtcbiAgICAgICAgICAgIGRsZy5zZXRMb2NhbFpPcmRlcih0aGlzLkRJQUxPR19aT1JERVJfQkVHSU4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGxnLnNldExvY2FsWk9yZGVyKHRoaXMuX2RpYWxvZ1N0YWNrW2RsZ0xlbiAtIDFdLmdldExvY2FsWk9yZGVyKCkgKyB0aGlzLkRJQUxPR19aT1JERVJfU1RFUCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZGlhbG9nU3RhY2sucHVzaChkbGcpO1xuICAgICAgICB0aGlzLl9vdmVybGF5LnNldExvY2FsWk9yZGVyKGRsZy5nZXRMb2NhbFpPcmRlcigpIC0gMSk7XG5cbiAgICAgICAgaWYgKHRoaXMuX292ZXJsYXkuZ2V0UGFyZW50KCkgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2hTY2VuZSh0aGlzLl9vdmVybGF5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJhbSAmJiBwYXJhbS5vdmVybGF5Q29sb3IpIHtcbiAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0Q29sb3IocGFyYW0ub3ZlcmxheUNvbG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0Q29sb3IoY2MuY29sb3IuQkxBQ0spO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtLm92ZXJsYXlPcGFjaXR5KSB7XG4gICAgICAgICAgICB0aGlzLl9vdmVybGF5LnNldE9wYWNpdHkocGFyYW0ub3ZlcmxheU9wYWNpdHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fb3ZlcmxheS5zZXRPcGFjaXR5KDE5MCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmF0dGFjaFNjZW5lKGRsZyk7XG5cbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChcImRpYWxvZ19wb3BlZFwiKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoU2NlbmU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFJ1bm5pbmdTY2VuZSgpLmFkZENoaWxkKG5vZGUpO1xuICAgIH0sXG5cbiAgICBjbG9zZTogZnVuY3Rpb24gKGRsZywgZGlzcG9zZSkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQoZGlzcG9zZSkpIHtcbiAgICAgICAgICAgIGRpc3Bvc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjbG9zZUluZGV4O1xuICAgICAgICB2YXIgZGxnTGVuID0gdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoO1xuICAgICAgICBmb3IgKGNsb3NlSW5kZXggPSBkbGdMZW4gLSAxOyBjbG9zZUluZGV4ID49IDA7IC0tY2xvc2VJbmRleCkge1xuICAgICAgICAgICAgaWYgKGRsZyA9PT0gdGhpcy5fZGlhbG9nU3RhY2tbY2xvc2VJbmRleF0pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbG9zZUluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2RpYWxvZ1N0YWNrLnNwbGljZShjbG9zZUluZGV4LCAxKTtcbiAgICAgICAgICAgIGRsZ0xlbiA9IHRoaXMuX2RpYWxvZ1N0YWNrLmxlbmd0aDtcbiAgICAgICAgICAgIGRsZy5yZW1vdmVGcm9tUGFyZW50KGRpc3Bvc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRsZ0xlbiA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fb3ZlcmxheS5yZW1vdmVGcm9tUGFyZW50KGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB0b3BJbmRleCA9IGRsZ0xlbiAtIDE7XG5cbiAgICAgICAgICAgIGlmICh0b3BJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3ZlcmxheS5zZXRMb2NhbFpPcmRlcih0aGlzLl9kaWFsb2dTdGFja1t0b3BJbmRleF0uZ2V0TG9jYWxaT3JkZXIoKSAtIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vdmVybGF5LnJlbW92ZUZyb21QYXJlbnQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RpYWxvZ1N0YWNrLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChcImRpYWxvZ19jbG9zZWRcIik7XG4gICAgfSxcblxuICAgIGNsb3NlQWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBkbGdMZW4gPSB0aGlzLl9kaWFsb2dTdGFjay5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChkbGdMZW4gIT0gMCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsTGF5ZXIgPSB0aGlzLl9kaWFsb2dTdGFja1tkbGdMZW4gLSAxXTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UobW9kYWxMYXllciwgdHJ1ZSk7XG4gICAgICAgICAgICBkbGdMZW4gPSB0aGlzLl9kaWFsb2dTdGFjay5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNUb3Blc3REaWFsb2c6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fZGlhbG9nU3RhY2tbdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoIC0gMV0gPT09IG5vZGUpO1xuICAgIH1cblxufSk7XG5cbkRpYWxvZ01hbmFnZXIuX2luc3RhbmNlID0gbnVsbDtcbkRpYWxvZ01hbmFnZXIuX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7RGlhbG9nTWFuYWdlcn1cbiAqL1xuRGlhbG9nTWFuYWdlci5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoRGlhbG9nTWFuYWdlci5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBEaWFsb2dNYW5hZ2VyLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIERpYWxvZ01hbmFnZXIuX2luc3RhbmNlID0gbmV3IERpYWxvZ01hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIERpYWxvZ01hbmFnZXIuX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBEaWFsb2dNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzQvMjguXG4gKi9cbnZhciBNb2RhbExheWVyID0gY2MuTGF5ZXJDb2xvci5leHRlbmQoe1xuICAgIGN0b3I6ZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgY2MuZXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKHtcbiAgICAgICAgICAgIGV2ZW50OiBjYy5FdmVudExpc3RlbmVyLlRPVUNIX09ORV9CWV9PTkUsXG4gICAgICAgICAgICBzd2FsbG93VG91Y2hlczogdHJ1ZSxcbiAgICAgICAgICAgIG9uVG91Y2hCZWdhbjogdGhpcy5vblRvdWNoQmVnYW4uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIG9uVG91Y2hCZWdhbjpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgaWYoIXRoaXMuaXNWaXNpYmxlKCkgfHwgKCF0aGlzLmlzVG91Y2hJbnNpZGUodGhpcyx0b3VjaCkpKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIGlzVG91Y2hJbnNpZGU6IGZ1bmN0aW9uIChvd25lcix0b3VjaCkge1xuICAgICAgICBpZighb3duZXIgfHwgIW93bmVyLmdldFBhcmVudCgpKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG91Y2hMb2NhdGlvbiA9IHRvdWNoLmdldExvY2F0aW9uKCk7IC8vIEdldCB0aGUgdG91Y2ggcG9zaXRpb25cbiAgICAgICAgdG91Y2hMb2NhdGlvbiA9IG93bmVyLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaExvY2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIGNjLnJlY3RDb250YWluc1BvaW50KG93bmVyLmdldEJvdW5kaW5nQm94KCksIHRvdWNoTG9jYXRpb24pO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1vZGFsTGF5ZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8yMy5cbiAqL1xuXG52YXIgU3RvcmFnZUNvbnRyb2xsZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIHNldEl0ZW06IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldEl0ZW06IGZ1bmN0aW9uIChrZXksIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgaWYgKHZhbHVlID09IFwiXCIgfHwgdmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSxcbiAgICByZW1vdmVJdGVtOiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgIH1cbn0pO1xuXG5TdG9yYWdlQ29udHJvbGxlci5faW5zdGFuY2UgPSBudWxsO1xuU3RvcmFnZUNvbnRyb2xsZXIuX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7U3RvcmFnZUNvbnRyb2xsZXJ9XG4gKi9cblN0b3JhZ2VDb250cm9sbGVyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChTdG9yYWdlQ29udHJvbGxlci5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBTdG9yYWdlQ29udHJvbGxlci5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBTdG9yYWdlQ29udHJvbGxlci5faW5zdGFuY2UgPSBuZXcgU3RvcmFnZUNvbnRyb2xsZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIFN0b3JhZ2VDb250cm9sbGVyLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3RvcmFnZUNvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNi8zLzEyLlxuICovXG5cbnZhciBBdWRpb0hlbHBlciA9IHtcbiAgICBwbGF5QnRuU291bmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEF1ZGlvSGVscGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNC0xOS5cbiAqL1xuXG5cbnZhciBVdGlscyA9IHtcbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHJhbmRvbSBpbnRlZ2VyIHZhbHVlIHdoaWNoIG1lZXRzIFswLCB1cHBlclZhbHVlKVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB1cHBlclZhbHVlXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICByYW5kb21OZXh0SW50OiBmdW5jdGlvbih1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB1cHBlclZhbHVlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZ2VuZXJhdGUgYSByYW5kb20gbnVtYmVyIHZhbHVlIHdoaWNoIG1lZXRzIFswLCB1cHBlclZhbHVlKVxuICAgICAqIEBwYXJhbSB1cHBlclZhbHVlXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICByYW5kb21OZXh0TnVtYmVyOiBmdW5jdGlvbiAodXBwZXJWYWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKSAqIHVwcGVyVmFsdWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHJhbmRvbSBhIGludGVnZXIgZnJvbSBbbWluLCBtYXhdXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1pblxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHJhbmdlTmV4dEludDogZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1pbiArIHRoaXMucmFuZG9tTmV4dEludChtYXggLSBtaW4gKyAxKTtcbiAgICB9LFxuXG4gICAgcmFuZ2VOZXh0TnVtYmVyOiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1pbiArIHRoaXMucmFuZG9tTmV4dE51bWJlcihtYXggLSBtaW4pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHJhbmRvbSBudW1iZXIgdmFsdWUgd2hpY2ggbWVldHMgW2xvd2VyVmFsdWUsIHVwcGVyVmFsdWUpXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyVmFsdWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXJWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcmFuZG9tTmV4dE51bWJlckluUmFuZ2U6IGZ1bmN0aW9uIChsb3dlclZhbHVlLCB1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogKHVwcGVyVmFsdWUgLSBsb3dlclZhbHVlKSArIGxvd2VyVmFsdWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlIGEgcmFuZG9tIGludGVnZXIgdmFsdWUgd2hpY2ggbWVldHMgW2xvd2VyVmFsdWUsIHVwcGVyVmFsdWUpXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyVmFsdWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXJWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcmFuZG9tTmV4dEludEluUmFuZ2U6IGZ1bmN0aW9uIChsb3dlclZhbHVlLCB1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodXBwZXJWYWx1ZSAtIGxvd2VyVmFsdWUpICsgbG93ZXJWYWx1ZSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOagvOW8j+WMluWtl+espuS4slxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgc3ByaW50ZjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSA9IDAsIGEsIGYgPSBhcmd1bWVudHNbaSsrXSwgbyA9IFtdLCBtLCBwLCBjLCB4LCBzID0gJyc7XG4gICAgICAgIHdoaWxlIChmKSB7XG4gICAgICAgICAgICBpZiAobSA9IC9eW15cXHgyNV0rLy5leGVjKGYpKSB7XG4gICAgICAgICAgICAgICAgby5wdXNoKG1bMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobSA9IC9eXFx4MjV7Mn0vLmV4ZWMoZikpIHtcbiAgICAgICAgICAgICAgICBvLnB1c2goJyUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG0gPSAvXlxceDI1KD86KFxcZCspXFwkKT8oXFwrKT8oMHwnW14kXSk/KC0pPyhcXGQrKT8oPzpcXC4oXFxkKykpPyhbYi1mb3N1eFhdKS8uZXhlYyhmKSkge1xuICAgICAgICAgICAgICAgIGlmICgoKGEgPSBhcmd1bWVudHNbbVsxXSB8fCBpKytdKSA9PSBudWxsKSB8fCAoYSA9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93KCdUb28gZmV3IGFyZ3VtZW50cy4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKC9bXnNdLy50ZXN0KG1bN10pICYmICh0eXBlb2YoYSkgIT0gJ251bWJlcicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93KCdFeHBlY3RpbmcgbnVtYmVyIGJ1dCBmb3VuZCAnICsgdHlwZW9mKGEpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3dpdGNoIChtWzddKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2InOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gU3RyaW5nLmZyb21DaGFyQ29kZShhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBwYXJzZUludChhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBtWzZdID8gYS50b0V4cG9uZW50aWFsKG1bNl0pIDogYS50b0V4cG9uZW50aWFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZic6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gbVs2XSA/IHBhcnNlRmxvYXQoYSkudG9GaXhlZChtWzZdKSA6IHBhcnNlRmxvYXQoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gYS50b1N0cmluZyg4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAoKGEgPSBTdHJpbmcoYSkpICYmIG1bNl0gPyBhLnN1YnN0cmluZygwLCBtWzZdKSA6IGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IE1hdGguYWJzKGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYSA9ICgvW2RlZl0vLnRlc3QobVs3XSkgJiYgbVsyXSAmJiBhID49IDAgPyAnKycgKyBhIDogYSk7XG4gICAgICAgICAgICAgICAgYyA9IG1bM10gPyBtWzNdID09ICcwJyA/ICcwJyA6IG1bM10uY2hhckF0KDEpIDogJyAnO1xuICAgICAgICAgICAgICAgIHggPSBtWzVdIC0gU3RyaW5nKGEpLmxlbmd0aCAtIHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHAgPSBtWzVdID8gc3RyX3JlcGVhdChjLCB4KSA6ICcnO1xuICAgICAgICAgICAgICAgIG8ucHVzaChzICsgKG1bNF0gPyBhICsgcCA6IHAgKyBhKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdygnSHVoID8hJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmID0gZi5zdWJzdHJpbmcobVswXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvLmpvaW4oJycpO1xuICAgIH0sXG5cbiAgICBnZXREaXN0YW5jZSA6IGZ1bmN0aW9uKHBvaW50MSxwb2ludDIpe1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KChwb2ludDEueCAtIHBvaW50Mi54KSAqIChwb2ludDEueCAtIHBvaW50Mi54KSArIChwb2ludDEueSAtIHBvaW50Mi55KSAqIChwb2ludDEueSAtIHBvaW50Mi55KSk7XG4gICAgfSxcblxuICAgIGFycmF5Q29udGFpbiA6IGZ1bmN0aW9uIChhcnIsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYoYXJyICYmIGFyci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgaWYoYXJyW2ldID09IGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNjYkZpbGVOYW1lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRyb2xsZXJOYW1lXG4gICAgICogQHBhcmFtIHtvYmplY3QgfCBjYy5Ob2RlfSBjb250cm9sbGVyTm9kZVxuICAgICAqIEByZXR1cm5zIHtjYy5Ob2RlIHwgbnVsbH1cbiAgICAgKi9cbiAgICBsb2FkTm9kZUZyb21DQ0IgOiBmdW5jdGlvbihjY2JGaWxlTmFtZSxjb250YWluZXJOb2RlLGNvbnRyb2xsZXJOYW1lLGNvbnRyb2xsZXJOb2RlKXtcbiAgICAgICAgaWYoIWNjLmlzVW5kZWZpbmVkKGNvbnRyb2xsZXJOYW1lKSAmJiAhY2MuaXNVbmRlZmluZWQoY29udHJvbGxlck5vZGUpKXtcbiAgICAgICAgICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKGNvbnRyb2xsZXJOYW1lLGNvbnRyb2xsZXJOb2RlKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbm9kZSA9IGNjLkJ1aWxkZXJSZWFkZXIubG9hZChjY2JGaWxlTmFtZSwgY29udGFpbmVyTm9kZSk7XG4gICAgICAgIG5vZGUucmV0YWluKCk7XG4gICAgICAgIHRoaXMuZXhlY3V0ZUluTmV4dEZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5vZGUucmVsZWFzZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3ViVHlwZVxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1cGVyVHlwZVxuICAgICAqL1xuICAgIGluaGVyaXRzOiBmdW5jdGlvbihzdWJUeXBlLCBzdXBlclR5cGUpIHtcbiAgICAgICAgdmFyIHN1YlByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJUeXBlLnByb3RvdHlwZSk7XG4gICAgICAgIHN1YlByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHN1YlR5cGU7XG4gICAgICAgIHN1YlR5cGUucHJvdG90eXBlID0gc3ViUHJvdG90eXBlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgICAqL1xuICAgIGxvYWRKc29uOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gY2MubG9hZGVyLmdldFJlcyh1cmwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYoanNiLmZpbGVVdGlscy5pc0ZpbGVFeGlzdCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNiLmZpbGVVdGlscy5nZXRTdHJpbmdGcm9tRmlsZSh1cmwpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbG9hZFBsaXN0OiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gY2MubG9hZGVyLmdldFJlcyh1cmwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYoanNiLmZpbGVVdGlscy5pc0ZpbGVFeGlzdCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLnBsaXN0UGFyc2VyLnBhcnNlKGpzYi5maWxlVXRpbHMuZ2V0U3RyaW5nRnJvbUZpbGUodXJsKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFNjcmVlblNob3Q6IGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICBjYy5sb2coXCJmaWxlTmFtZTpcIiArIGZpbGVOYW1lKTtcbiAgICAgICAgdmFyIHRleCA9IG5ldyBjYy5SZW5kZXJUZXh0dXJlKGNjLndpblNpemUud2lkdGgsIGNjLndpblNpemUuaGVpZ2h0LCBjYy5UZXh0dXJlMkQuUElYRUxfRk9STUFUX1JHQkE4ODg4KTtcbiAgICAgICAgdGV4LnNldFBvc2l0aW9uKGNjLnAoY2Mud2luU2l6ZS53aWR0aCAvIDIsIGNjLndpblNpemUuaGVpZ2h0IC8gMikpO1xuICAgICAgICB0ZXguYmVnaW4oKTtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0UnVubmluZ1NjZW5lKCkudmlzaXQoKTtcbiAgICAgICAgdGV4LmVuZCgpO1xuXG4gICAgICAgIHZhciBpbWdQYXRoID0ganNiLmZpbGVVdGlscy5nZXRXcml0YWJsZVBhdGgoKTtcbiAgICAgICAgaWYgKGltZ1BhdGgubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXN1bHQgPSB0ZXguc2F2ZVRvRmlsZShmaWxlTmFtZSwgY2MuSU1BR0VfRk9STUFUX0pQRUcpO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICBpbWdQYXRoICs9IGZpbGVOYW1lO1xuICAgICAgICAgICAgY2MubG9nKFwic2F2ZSBpbWFnZTpcIiArIGltZ1BhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIGltZ1BhdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSxcblxuICAgIGlzUGFkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB3aW5TaXplID0gY2Mud2luU2l6ZTtcbiAgICAgICAgaWYgKCEhR2FtZUJyaWRnZS5nZXRDb25maWcoKS5ob3Jpem9udGFsR2FtZSkge1xuICAgICAgICAgICAgcmV0dXJuICh3aW5TaXplLndpZHRoIC8gd2luU2l6ZS5oZWlnaHQgPCAxLjUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICh3aW5TaXplLmhlaWdodCAvIHdpblNpemUud2lkdGggPCAxLjUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEZvcm1hdFJvdGF0aW9uOiBmdW5jdGlvbiAocm90YXRpb24pIHtcbiAgICAgICAgcmV0dXJuICgocm90YXRpb24gJSAzNjApICsgMzYwKSAlIDM2MDtcbiAgICB9LFxuXG4gICAgZG9DbGlwcGluZzogZnVuY3Rpb24gKG1hc2tMYXllciwgY2xpcExheWVyKSB7XG4gICAgICAgIGlmKG1hc2tMYXllciAmJiBjbGlwTGF5ZXIpe1xuICAgICAgICAgICAgdmFyIGNsaXBQYXJlbnROb2RlID0gY2xpcExheWVyLmdldFBhcmVudCgpO1xuICAgICAgICAgICAgY2xpcExheWVyLnJldGFpbigpO1xuICAgICAgICAgICAgY2xpcExheWVyLnJlbW92ZUZyb21QYXJlbnQoZmFsc2UpO1xuXG4gICAgICAgICAgICBtYXNrTGF5ZXIucmVtb3ZlRnJvbVBhcmVudChmYWxzZSk7XG4gICAgICAgICAgICBtYXNrTGF5ZXIudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgICAgIHZhciBjbGlwcGluZ05vZGUgPSBuZXcgY2MuQ2xpcHBpbmdOb2RlKG1hc2tMYXllcik7XG4gICAgICAgICAgICBjbGlwcGluZ05vZGUuYWxwaGFUaHJlc2hvbGQgPSAxO1xuICAgICAgICAgICAgY2xpcHBpbmdOb2RlLmFkZENoaWxkKGNsaXBMYXllcik7XG4gICAgICAgICAgICBjbGlwTGF5ZXIucmVsZWFzZSgpO1xuXG4gICAgICAgICAgICBjbGlwUGFyZW50Tm9kZS5hZGRDaGlsZChjbGlwcGluZ05vZGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzUGl4ZWxDb2xsaXNpb246IGZ1bmN0aW9uIChzcHIxLCBzcHIyKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzUGl4ZWxDb2xsaXNpb24oc3ByMSwgc3ByMik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY2MucmVjdEludGVyc2VjdHNSZWN0KHNwcjEuZ2V0Qm91bmRpbmdCb3goKSwgc3ByMi5nZXRCb3VuZGluZ0JveCgpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzY2FsZUNDTGFiZWxCTUZvbnQ6IGZ1bmN0aW9uIChsYWJlbCwgbWF4V2lkdGgpIHtcbiAgICAgICAgaWYgKGxhYmVsLndpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgICAgIHZhciBzY2FsZUZhY3RvciA9IG1heFdpZHRoIC8gbGFiZWwud2lkdGg7XG4gICAgICAgICAgICBsYWJlbC5zY2FsZVggPSBsYWJlbC5zY2FsZVkgPSBzY2FsZUZhY3RvcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxhYmVsLnNjYWxlWCA9IGxhYmVsLnNjYWxlWSA9IDEuMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzY2FsZUNDTGFiZWxCTUZvbnRXaXRoTWF4U2NhbGU6IGZ1bmN0aW9uIChsYWJlbCwgbWF4V2lkdGgsIG1heFNjYWxlKSB7XG4gICAgICAgIGlmIChsYWJlbC53aWR0aCAqIGxhYmVsLnNjYWxlWCA+IG1heFdpZHRoKSB7XG4gICAgICAgICAgICBsYWJlbC5zY2FsZVggPSBsYWJlbC5zY2FsZVkgPSBtYXhXaWR0aCAvIGxhYmVsLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYWJlbC5zY2FsZVggPiBtYXhTY2FsZSkge1xuICAgICAgICAgICAgbGFiZWwuc2NhbGVYID0gbGFiZWwuc2NhbGVZID0gbWF4U2NhbGU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2NjLk5vZGV9IG5vZGVcbiAgICAgKi9cbiAgICB3YWxrTm9kZTogZnVuY3Rpb24gKG5vZGUsIGNiKSB7XG4gICAgICAgIGlmKG5vZGUpIHtcbiAgICAgICAgICAgIHZhciBtb3JlID0gY2Iobm9kZSk7XG4gICAgICAgICAgICBpZihtb3JlKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrIGluIG5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgbW9yZSA9IHRoaXMud2Fsa05vZGUobm9kZS5jaGlsZHJlbltrXSwgY2IpO1xuICAgICAgICAgICAgICAgICAgICBpZighbW9yZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb3JlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNOb2RlQnV0dG9uOiBmdW5jdGlvbihuZCkge1xuICAgICAgICByZXR1cm4gKG5kIGluc3RhbmNlb2YgY2MuQ29udHJvbEJ1dHRvbik7XG4gICAgfSxcblxuICAgIGlzTm9kZU1lbnVJdGVtOiBmdW5jdGlvbihuZCkge1xuICAgICAgICByZXR1cm4gKG5kIGluc3RhbmNlb2YgY2MuTWVudUl0ZW0gfHwgbmQgaW5zdGFuY2VvZiBjYy5NZW51SXRlbUltYWdlKTtcbiAgICB9LFxuXG4gICAgaXNMYWJlbEJNRm9udDpmdW5jdGlvbiAobmQpIHtcbiAgICAgICAgcmV0dXJuIChuZCBpbnN0YW5jZW9mIGNjLkxhYmVsQk1Gb250IHx8IG5kIGluc3RhbmNlb2YgY2MuTGFiZWwpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGFuIGltYWdlIHdpdGggdGhlIGdpdmVuIHVybFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uKGVycm9yLCB0ZXh0dXJlLCBleHRyYSlcbiAgICAgKiBAcGFyYW0geyp9IGV4dHJhXG4gICAgICovXG4gICAgbG9hZFJlbW90ZUltZzogZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGV4dHJhKSB7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBjYy5sb2FkZXIubG9hZEltZyh1cmwsIHtpc0Nyb3NzT3JpZ2luOiB0cnVlfSwgZnVuY3Rpb24gKGVycm9yLCBpbWcpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dHVyZTJkID0gbmV3IGNjLlRleHR1cmUyRCgpO1xuICAgICAgICAgICAgICAgIHRleHR1cmUyZC5pbml0V2l0aEVsZW1lbnQoaW1nKTtcbiAgICAgICAgICAgICAgICB0ZXh0dXJlMmQuaGFuZGxlTG9hZGVkVGV4dHVyZSgpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB0ZXh0dXJlMmQsIGV4dHJhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MubG9hZGVyLmxvYWRJbWcodXJsLCB7aXNDcm9zc09yaWdpbjogdHJ1ZX0sIGZ1bmN0aW9uIChlcnJvciwgdGV4dHVyZTJkKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIHRleHR1cmUyZCwgZXh0cmEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUNDQkFuaW1hdGlvbjogZnVuY3Rpb24obm9kZSwgYW5tTmFtZSl7XG4gICAgICAgIHZhciBhbmltTWdyID0gbm9kZS5hbmltYXRpb25NYW5hZ2VyO1xuICAgICAgICB2YXIgc2VxSWQ7XG4gICAgICAgIGlmKGFubU5hbWUpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpe1xuICAgICAgICAgICAgICAgIHNlcUlkID0gYW5pbU1nci5nZXRTZXF1ZW5jZUlkKGFubU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICBzZXFJZCA9IGFuaW1NZ3IuX2dldFNlcXVlbmNlSWQoYW5tTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXFJZCA9IGFuaW1NZ3IuZ2V0QXV0b1BsYXlTZXF1ZW5jZUlkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2VxSWQgIT0gLTEpe1xuICAgICAgICAgICAgaWYoIWFubU5hbWUpIHtcbiAgICAgICAgICAgICAgICBhbmltTWdyLnJ1bkFuaW1hdGlvbnNGb3JTZXF1ZW5jZUlkVHdlZW5EdXJhdGlvbihzZXFJZCwgMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFuaW1NZ3IucnVuQW5pbWF0aW9uc0ZvclNlcXVlbmNlTmFtZWQoYW5tTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmxvZyhcImFuaW1hdGlvbiBcIiArIGFubU5hbWUgKyBcIiBub3QgZXhpc3RzIVwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYW5kb21TY2FsZUFuaW06IGZ1bmN0aW9uIChzcHIsIHN0YXJ0U2NhbGUsIHRvdGFsVGltZSkge1xuICAgICAgICB0b3RhbFRpbWUgPSB0aGlzLnJhbmRvbU5leHROdW1iZXJJblJhbmdlKHRvdGFsVGltZSAqIDAuOCwgdG90YWxUaW1lICogMS4yKTtcbiAgICAgICAgdmFyIGRlbGF5VGltZSA9IHRoaXMucmFuZG9tTmV4dE51bWJlcih0b3RhbFRpbWUgLyAyKTtcblxuICAgICAgICB2YXIgc2NhbGVCaWdUaW1lID0gMC4zICogKHRvdGFsVGltZSAtIGRlbGF5VGltZSkgKiAyO1xuICAgICAgICB2YXIgc2NhbGVTbWFsbFRpbWUgPSAwLjEgKiAodG90YWxUaW1lIC0gZGVsYXlUaW1lKSAqIDI7XG4gICAgICAgIHZhciBzY2FsZU5vcm1hbFRpbWUgPSAwLjEgKiAodG90YWxUaW1lIC0gZGVsYXlUaW1lKSAqIDI7XG5cbiAgICAgICAgc3ByLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIHNwci5zZXRTY2FsZSgwKTtcbiAgICAgICAgc3ByLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoZGVsYXlUaW1lKSxcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oc2NhbGVCaWdUaW1lLCAxLjEgKiBzdGFydFNjYWxlKS5lYXNpbmcoY2MuZWFzZUluT3V0KDIpKSAsXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNjYWxlU21hbGxUaW1lLCAwLjkgKiBzdGFydFNjYWxlKS5lYXNpbmcoY2MuZWFzZUluT3V0KDIpKSxcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oc2NhbGVOb3JtYWxUaW1lLCAxICogc3RhcnRTY2FsZSkuZWFzaW5nKGNjLmVhc2VJbk91dCgyKSkpKTtcbiAgICB9LFxuXG4gICAgZ2V0Rm9ybWF0VGltZTogZnVuY3Rpb24gKHRpbWUpIHtcbiAgICAgICAgdmFyIGRlY2ltYWxzID0gdGltZSAtIE1hdGguZmxvb3IodGltZSk7XG4gICAgICAgIHRpbWUgPSBNYXRoLmZsb29yKHRpbWUpO1xuICAgICAgICBpZiAodGltZSA8PSA2MCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCIgKyAodGltZSArIGRlY2ltYWxzKS50b0ZpeGVkKDIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRpbWUgPD0gMzYwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGltZSAvIDYwKSArIFwiOlwiICsgKCh0aW1lICUgNjApICsgZGVjaW1hbHMpLnRvRml4ZWQoMik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aW1lIC8gMzYwMCkgKyBcIjpcIiArIE1hdGguZmxvb3IodGltZSAlIDM2MDAgLyA2MCkgKyBcIjpcIiArICgodGltZSAlICgzNjAwICogNjApKSArIGRlY2ltYWxzKS50b0ZpeGVkKDIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldExvbmdGb3JtYXRUaW1lOiBmdW5jdGlvbiAodGltZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aW1lIC8gMzYwMCkgKyBcIjpcIiArIE1hdGguZmxvb3IodGltZSAlIDM2MDAgLyA2MCkgKyBcIjpcIiArICh0aW1lICUgKDM2MDAgKiA2MCkpO1xuICAgIH0sXG5cbiAgICBzZWVrTm9kZUJ5VGFnOiBmdW5jdGlvbiAocm9vdE5vZGUsIHRhZykge1xuICAgICAgICBpZiAobnVsbCA9PT0gcm9vdE5vZGUpe1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYocm9vdE5vZGUuZ2V0VGFnKCkgPT09IHRhZyl7XG4gICAgICAgICAgICByZXR1cm4gcm9vdE5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFycmF5Um9vdENoaWxkcmVuID0gcm9vdE5vZGUuZ2V0Q2hpbGRyZW4oKTtcbiAgICAgICAgaWYoYXJyYXlSb290Q2hpbGRyZW4gJiYgYXJyYXlSb290Q2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Um9vdENoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGFycmF5Um9vdENoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBjaGlsZCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSB0aGlzLnNlZWtOb2RlQnlUYWcoY2hpbGQsIHRhZyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSByZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGF1dG9SZWxlYXNlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIFV0aWxzLmV4ZWN1dGVJbk5leHRGcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBvYmoucmVsZWFzZSgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZXhlY3V0ZUluTmV4dEZyYW1lOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICB9LFxuXG4gICAgaXNJT1M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXREYXlCeVRzOiBmdW5jdGlvbih0cykge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0cyAvICgxMDAwICogMzYwMCAqIDI0KSk7XG4gICAgfSxcblxuICAgIGlzU2VsZkdhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5sYW5ndWFnZSA9PT0gY2Muc3lzLkxBTkdVQUdFX0NISU5FU0UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiLCIvKipcbiAqIENyZWF0ZWQgYnkgWGluQ2hlbmcgb24gOC8xOC8xNi5cbiAqL1xuXG52YXIgRWFzaW5nRnVuY3Rpb25zID0ge1xuICAgIC8vIG5vIGVhc2luZywgbm8gYWNjZWxlcmF0aW9uXG4gICAgbGluZWFyOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdDsgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVhZDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQqdDsgfSxcbiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eVxuICAgIGVhc2VPdXRRdWFkOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCooMi10KTsgfSxcbiAgICAvLyBhY2NlbGVyYXRpb24gdW50aWwgaGFsZndheSwgdGhlbiBkZWNlbGVyYXRpb25cbiAgICBlYXNlSW5PdXRRdWFkOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdDwwLjUgPyAyKnQqdCA6IC0xKyg0LTIqdCkqdDsgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluQ3ViaWM6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0KnQqdDsgfSxcbiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eVxuICAgIGVhc2VPdXRDdWJpYzogZnVuY3Rpb24gKHQpIHsgcmV0dXJuICgtLXQpKnQqdCsxOyB9LFxuICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvblxuICAgIGVhc2VJbk91dEN1YmljOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdDwwLjUgPyA0KnQqdCp0IDogKHQtMSkqKDIqdC0yKSooMip0LTIpKzE7IH0sXG4gICAgLy8gYWNjZWxlcmF0aW5nIGZyb20gemVybyB2ZWxvY2l0eVxuICAgIGVhc2VJblF1YXJ0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCp0KnQqdDsgfSxcbiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eVxuICAgIGVhc2VPdXRRdWFydDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIDEtKC0tdCkqdCp0KnQ7IH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVhcnQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0PDAuNSA/IDgqdCp0KnQqdCA6IDEtOCooLS10KSp0KnQqdDsgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVpbnQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0KnQqdCp0KnQ7IH0sXG4gICAgLy8gZGVjZWxlcmF0aW5nIHRvIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlT3V0UXVpbnQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiAxKygtLXQpKnQqdCp0KnQ7IH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVpbnQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0PDAuNSA/IDE2KnQqdCp0KnQqdCA6IDErMTYqKC0tdCkqdCp0KnQqdDsgfSxcblxuICAgIGVhc2VPdXRFbGFzdGljOiBmdW5jdGlvbih0KXsgIHZhciBwID0gMC40OyByZXR1cm4gTWF0aC5wb3coMiwtMTAqdCkgKiBNYXRoLnNpbigodC1wLzQpKigyKk1hdGguUEkpL3ApICsgMTsgfSxcblxuICAgIGVsYXN0aWM6IGZ1bmN0aW9uKHQsIHgpIHsgcmV0dXJuIE1hdGgucG93KDIsIDEwICogKHQtMSkpICogTWF0aC5jb3MoMjAqTWF0aC5QSSp4LzMqdCk7IH0sXG5cbiAgICAvLyDlvLnot7NcbiAgICBib3VuY2U6IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgZm9yKHZhciBhID0gMCwgYiA9IDE7IDE7IGEgKz0gYiwgYiAvPSAyKSB7XG4gICAgICAgICAgICBpZiAodCA+PSAoNyAtIDQgKiBhKSAvIDExKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1NYXRoLnBvdygoMTEgLSA2ICogYSAtIDExICogdCkgLyA0LCAyKSArIE1hdGgucG93KGIsIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5LiJ5qyh6LSd5aGe5bCU566X5rOVXG4gICAgYnNlQmFzZTogZnVuY3Rpb24odCwgcDAsIHAxLCBwMiwgcDMpe1xuICAgICAgICB2YXIgeCA9IHAwLnggKiAoMSAtIHQpICogKDEgLSB0KSAqICgxIC0gdCkgKyBwMS54ICogMyAqIHQgKiAoMSAtIHQpICogKDEgLSB0KSArIHAyLnggKiAzICogdCAqIHQgKiAoMSAtIHQpICsgcDMueCAqIHQgKiB0ICogdDtcbiAgICAgICAgdmFyIHkgPSBwMC55ICogKDEgLSB0KSAqICgxIC0gdCkgKiAoMSAtIHQpICsgcDEueSAqIDMgKiB0ICogKDEgLSB0KSAqICgxIC0gdCkgKyBwMi55ICogMyAqIHQgKiB0ICogKDEgLSB0KSArIHAzLnkgKiB0ICogdCAqIHQ7XG4gICAgICAgIHJldHVybiB7eDp4LHk6eX07XG4gICAgfSxcblxuICAgIGRvU2hha2luZzogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuIC1NYXRoLnNpbigyICogTWF0aC5QSSAqIDMgKiB0KSAqIE1hdGgucG93KCgxIC0gdCksIDIpO1xuICAgIH1cblxufTtcblxudmFyIFdoZWVsID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICB0YXJnZXQ6IG51bGwsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSB0YXJnZXQgbm9kZSB5b3Ugd2FudCB0byByb3RhdGVcbiAgICBiQ3VydmU6IFswLjQyLCAtMC4wOCwgMC41OCwgMS4xMF0sICAgICAgICAgIC8vIG1hZ2ljIGN1cnZlXG4gICAgZnBzOiAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmcHNcbiAgICBuUm91bmQ6IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgblJvdW5kIHggMzYwXG5cbiAgICBmcmFtZUNvdW50OiAwLFxuICAgIGVsYXBzZWRUaW1lOiAwLFxuICAgIHRvdGFsUm90YXRpb25UaW1lOiAwLFxuICAgIHN0YXJ0Um90YXRpb246IDAsICAgICAgIC8vIHRoZSBzdGFydCByb3RhdGlvblxuICAgIG1vdmVtZW50OiAwLCAgICAgICAgICAgICAvLyB0aGUgbW92ZW1lbnQgZGVncmVlc1xuICAgIGVhc3lGdW5jdGlvbjogbnVsbCxcbiAgICBlbmRDYWxsYmFjazogbnVsbCxcbiAgICB0YXJnZXRSb3RhdGlvbjogMCxcbiAgICB3aGVlbEl0ZW1BbmdsZTogMCxcbiAgICBsYXN0VGltZTogMCxcbiAgICBsYXN0Um90YXRpb246IDAsXG4gICAgc3BlZWQ6IDAsXG5cbiAgICBfbG90dGVyeVJlc2V0aW5nOiBmYWxzZSxcbiAgICBfaXNIaWdoUm90YXRpbmc6IGZhbHNlLFxuICAgIF9zdGFydFVwZGF0ZTogZmFsc2UsXG5cblxuICAgIC8qXG4gICAgICogdGFyZ2V0OiB0aGUgbm9kZSB5b3Ugd2FudCB0byByb3RhdGVcbiAgICAgKiBmcHM6IDMwZnBzIGJ5IGRlZmF1bHRcbiAgICAgKi9cbiAgICBjdG9yOiBmdW5jdGlvbiAodGFyZ2V0LCBmcHMpIHtcbiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgICAgIHRoaXMuZnBzID0gZnBzIHx8IDYwO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiByb3RhdGUgdGhlIHRhcmdldCBub2RlIHRvIHRoZSBzcGVjaWZpZWQgdmFsdWVcbiAgICAgKiB0aGUgaW5kZXggc2hvdWxkIHN0YXJ0IHdpdGggMFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3RhdGlvblRpbWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdGFyZ2V0Um90YXRpb25cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2hlZWxJdGVtQW5nbGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByb2xsRW5kQ2FsbGJhY2tcbiAgICAgKi9cbiAgICByb3RhdGU6IGZ1bmN0aW9uIChyb3RhdGlvblRpbWUsIHRhcmdldFJvdGF0aW9uLCB3aGVlbEl0ZW1BbmdsZSwgcm9sbEVuZENhbGxiYWNrKSB7XG4gICAgICAgIC8vIEkgYW0gbW92aW5nXG4gICAgICAgIGlmICh0aGlzLl9zdGFydFVwZGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50YXJnZXRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uO1xuICAgICAgICB0aGlzLmZyYW1lQ291bnQgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsUm90YXRpb25UaW1lID0gcm90YXRpb25UaW1lO1xuXG4gICAgICAgIHRoaXMuc3RhcnRSb3RhdGlvbiA9IHRoaXMudGFyZ2V0LnJvdGF0aW9uICUgMzYwO1xuICAgICAgICB0aGlzLm1vdmVtZW50ID0gdGFyZ2V0Um90YXRpb24gLSB0aGlzLnN0YXJ0Um90YXRpb247XG4gICAgICAgIHRoaXMud2hlZWxJdGVtQW5nbGUgPSB3aGVlbEl0ZW1BbmdsZTtcblxuICAgICAgICB0aGlzLmxhc3RUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5sYXN0Um90YXRpb24gPSAwO1xuICAgICAgICB0aGlzLl9pc0hpZ2hSb3RhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9sb3R0ZXJ5UmVzZXRpbmcgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmVhc3lGdW5jdGlvbiA9IHRoaXMuZGVmYXVsdEVhc3lGdW5jdGlvbjtcbiAgICAgICAgLy8vLyB1c2UgYmV6aWVyXG4gICAgICAgIC8vaWYgKEFycmF5LmlzQXJyYXkocGFyYW1zLmVhc3lGdW5jdGlvbikpIHtcbiAgICAgICAgLy8gICAgdGhpcy5iQ3VydmUgPSBwYXJhbXMuZWFzeUZ1bmN0aW9uO1xuICAgICAgICAvLyAgICB0aGlzLmVhc3lGdW5jdGlvbiA9IHRoaXMuZGVmYXVsdEVhc3lGdW5jdGlvbjtcbiAgICAgICAgLy99XG4gICAgICAgIC8vLy8gcHJvdmlkZSBhIGZ1bmN0aW9uXG4gICAgICAgIC8vZWxzZSBpZiAodHlwZW9mIGVhc3lGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyAgICB0aGlzLmVhc3lGdW5jdGlvbiA9IHBhcmFtcy5lYXN5RnVuY3Rpb247XG4gICAgICAgIC8vfVxuICAgICAgICAvLy8vIHByb3ZpZGUgYSBmdW5jdGlvbk5hbWVcbiAgICAgICAgLy9lbHNlIHtcbiAgICAgICAgLy8gICAgdGhpcy5lYXN5RnVuY3Rpb24gPSBFYXNpbmdGdW5jdGlvbnNbcGFyYW1zLmVhc3lGdW5jdGlvbl0gfHwgdGhpcy5kZWZhdWx0RWFzeUZ1bmN0aW9uO1xuICAgICAgICAvL31cblxuICAgICAgICB0aGlzLmVuZENhbGxiYWNrID0gcm9sbEVuZENhbGxiYWNrO1xuXG4gICAgICAgIHRoaXMuc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgdGhpcy5fc3RhcnRVcGRhdGUgPSB0cnVlO1xuICAgIH0sXG5cbiAgICBzY2hlZHVsZVVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmVsYXBzZWRUaW1lID0gMDtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkuc2NoZWR1bGVVcGRhdGVGb3JUYXJnZXQodGhpcywgMCwgZmFsc2UpO1xuICAgIH0sXG5cbiAgICB1bnNjaGVkdWxlVXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnVuc2NoZWR1bGVVcGRhdGVGb3JUYXJnZXQodGhpcyk7XG4gICAgICAgIHRoaXMuZWxhcHNlZFRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhcnRVcGRhdGUpIHtcbiAgICAgICAgICAgIHRoaXMubW92ZUJ5RnJhbWUoZHQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qcm90YXRlIHRoZSByZWVsIGZyYW1lIGJ5IGZyYW1lKi9cbiAgICBtb3ZlQnlGcmFtZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIC8vIGNhbGN1bGF0ZSBlbGFwc2VkIHRpbWVcbiAgICAgICAgdGhpcy5lbGFwc2VkVGltZSArPSBkdDtcblxuICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG1vdmluZyBwcm9ncmVzc1xuICAgICAgICB2YXIgcHJvZ3Jlc3MgPSB0aGlzLmVhc3lGdW5jdGlvbih0aGlzLmVsYXBzZWRUaW1lIC8gdGhpcy50b3RhbFJvdGF0aW9uVGltZSk7XG5cbiAgICAgICAgLy8gZG8gdGhlIHJvdGF0aW9uXG4gICAgICAgIHRoaXMudGFyZ2V0LnJvdGF0aW9uID0gcHJvZ3Jlc3MgKiB0aGlzLm1vdmVtZW50ICsgdGhpcy5zdGFydFJvdGF0aW9uO1xuXG4gICAgICAgIC8vdmFyIGhhc1N0b3AgPSBmYWxzZTtcbiAgICAgICAgLy8gc3RvcCBoZXJlXG4gICAgICAgIGlmICh0aGlzLnRhcmdldFJvdGF0aW9uIDw9IHRoaXMudGFyZ2V0LnJvdGF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5yb3RhdGlvbiA9IHRoaXMudGFyZ2V0Um90YXRpb247XG4gICAgICAgICAgICB0aGlzLnVuc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0VXBkYXRlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vZ2FtZS5hdWRpby5zdG9wRWZmZWN0KFwic2xvdHMvcm91bGV0dGUtYmdcIik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVuZENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmRDYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zcGVlZCA9ICh0aGlzLnRhcmdldC5yb3RhdGlvbiAtIHRoaXMubGFzdFJvdGF0aW9uKSAvIChEYXRlLm5vdygpIC0gdGhpcy5sYXN0VGltZSkgKiAxMDAwO1xuXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmxhc3RSb3RhdGlvbiA9IHRoaXMudGFyZ2V0LnJvdGF0aW9uO1xuICAgIH0sXG5cbiAgICAvKiBVc2UgYmV6aWVyIEN1cml2ZSBhcyBkZWZhdWx0ICovXG4gICAgZGVmYXVsdEVhc3lGdW5jdGlvbjogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIGJleiA9IHRoaXMuYkN1cnZlO1xuICAgICAgICB2YXIgY29vcmQgPSBFYXNpbmdGdW5jdGlvbnMuYnNlQmFzZSh0LCB7eDogMCwgeTogMH0sIHt4OiBiZXpbMF0sIHk6IGJlelsxXX0sIHt4OiBiZXpbMl0sIHk6IGJlelszXX0sIHtcbiAgICAgICAgICAgIHg6IDEsXG4gICAgICAgICAgICB5OiAxXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY29vcmQueTtcbiAgICB9LFxuXG4gICAgZ2V0VGFyZ2V0Um90YXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0Um90YXRpb247XG4gICAgfSxcblxuICAgIGdldFNwZWVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNwZWVkO1xuICAgIH1cbn0pO1xuXG5cbm1vZHVsZS5leHBvcnRzID0gV2hlZWw7XG4iLCIvKipcbiAqIEEgYnJpZWYgZXhwbGFuYXRpb24gZm9yIFwicHJvamVjdC5qc29uXCI6XG4gKiBIZXJlIGlzIHRoZSBjb250ZW50IG9mIHByb2plY3QuanNvbiBmaWxlLCB0aGlzIGlzIHRoZSBnbG9iYWwgY29uZmlndXJhdGlvbiBmb3IgeW91ciBnYW1lLCB5b3UgY2FuIG1vZGlmeSBpdCB0byBjdXN0b21pemUgc29tZSBiZWhhdmlvci5cbiAqIFRoZSBkZXRhaWwgb2YgZWFjaCBmaWVsZCBpcyB1bmRlciBpdC5cbiB7XG4gICAgXCJwcm9qZWN0X3R5cGVcIjogXCJqYXZhc2NyaXB0XCIsXG4gICAgLy8gXCJwcm9qZWN0X3R5cGVcIiBpbmRpY2F0ZSB0aGUgcHJvZ3JhbSBsYW5ndWFnZSBvZiB5b3VyIHByb2plY3QsIHlvdSBjYW4gaWdub3JlIHRoaXMgZmllbGRcblxuICAgIFwiZGVidWdNb2RlXCIgICAgIDogMSxcbiAgICAvLyBcImRlYnVnTW9kZVwiIHBvc3NpYmxlIHZhbHVlcyA6XG4gICAgLy8gICAgICAwIC0gTm8gbWVzc2FnZSB3aWxsIGJlIHByaW50ZWQuXG4gICAgLy8gICAgICAxIC0gY2MuZXJyb3IsIGNjLmFzc2VydCwgY2Mud2FybiwgY2MubG9nIHdpbGwgcHJpbnQgaW4gY29uc29sZS5cbiAgICAvLyAgICAgIDIgLSBjYy5lcnJvciwgY2MuYXNzZXJ0LCBjYy53YXJuIHdpbGwgcHJpbnQgaW4gY29uc29sZS5cbiAgICAvLyAgICAgIDMgLSBjYy5lcnJvciwgY2MuYXNzZXJ0IHdpbGwgcHJpbnQgaW4gY29uc29sZS5cbiAgICAvLyAgICAgIDQgLSBjYy5lcnJvciwgY2MuYXNzZXJ0LCBjYy53YXJuLCBjYy5sb2cgd2lsbCBwcmludCBvbiBjYW52YXMsIGF2YWlsYWJsZSBvbmx5IG9uIHdlYi5cbiAgICAvLyAgICAgIDUgLSBjYy5lcnJvciwgY2MuYXNzZXJ0LCBjYy53YXJuIHdpbGwgcHJpbnQgb24gY2FudmFzLCBhdmFpbGFibGUgb25seSBvbiB3ZWIuXG4gICAgLy8gICAgICA2IC0gY2MuZXJyb3IsIGNjLmFzc2VydCB3aWxsIHByaW50IG9uIGNhbnZhcywgYXZhaWxhYmxlIG9ubHkgb24gd2ViLlxuXG4gICAgXCJzaG93RlBTXCIgICAgICAgOiB0cnVlLFxuICAgIC8vIExlZnQgYm90dG9tIGNvcm5lciBmcHMgaW5mb3JtYXRpb24gd2lsbCBzaG93IHdoZW4gXCJzaG93RlBTXCIgZXF1YWxzIHRydWUsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGhpZGUuXG5cbiAgICBcImZyYW1lUmF0ZVwiICAgICA6IDYwLFxuICAgIC8vIFwiZnJhbWVSYXRlXCIgc2V0IHRoZSB3YW50ZWQgZnJhbWUgcmF0ZSBmb3IgeW91ciBnYW1lLCBidXQgdGhlIHJlYWwgZnBzIGRlcGVuZHMgb24geW91ciBnYW1lIGltcGxlbWVudGF0aW9uIGFuZCB0aGUgcnVubmluZyBlbnZpcm9ubWVudC5cblxuICAgIFwiaWRcIiAgICAgICAgICAgIDogXCJnYW1lQ2FudmFzXCIsXG4gICAgLy8gXCJnYW1lQ2FudmFzXCIgc2V0cyB0aGUgaWQgb2YgeW91ciBjYW52YXMgZWxlbWVudCBvbiB0aGUgd2ViIHBhZ2UsIGl0J3MgdXNlZnVsIG9ubHkgb24gd2ViLlxuXG4gICAgXCJyZW5kZXJNb2RlXCIgICAgOiAwLFxuICAgIC8vIFwicmVuZGVyTW9kZVwiIHNldHMgdGhlIHJlbmRlcmVyIHR5cGUsIG9ubHkgdXNlZnVsIG9uIHdlYiA6XG4gICAgLy8gICAgICAwIC0gQXV0b21hdGljYWxseSBjaG9zZW4gYnkgZW5naW5lXG4gICAgLy8gICAgICAxIC0gRm9yY2VkIHRvIHVzZSBjYW52YXMgcmVuZGVyZXJcbiAgICAvLyAgICAgIDIgLSBGb3JjZWQgdG8gdXNlIFdlYkdMIHJlbmRlcmVyLCBidXQgdGhpcyB3aWxsIGJlIGlnbm9yZWQgb24gbW9iaWxlIGJyb3dzZXJzXG5cbiAgICBcImVuZ2luZURpclwiICAgICA6IFwiZnJhbWV3b3Jrcy9jb2NvczJkLWh0bWw1L1wiLFxuICAgIC8vIEluIGRlYnVnIG1vZGUsIGlmIHlvdSB1c2UgdGhlIHdob2xlIGVuZ2luZSB0byBkZXZlbG9wIHlvdXIgZ2FtZSwgeW91IHNob3VsZCBzcGVjaWZ5IGl0cyByZWxhdGl2ZSBwYXRoIHdpdGggXCJlbmdpbmVEaXJcIixcbiAgICAvLyBidXQgaWYgeW91IGFyZSB1c2luZyBhIHNpbmdsZSBlbmdpbmUgZmlsZSwgeW91IGNhbiBpZ25vcmUgaXQuXG5cbiAgICBcIm1vZHVsZXNcIiAgICAgICA6IFtcImNvY29zMmRcIl0sXG4gICAgLy8gXCJtb2R1bGVzXCIgZGVmaW5lcyB3aGljaCBtb2R1bGVzIHlvdSB3aWxsIG5lZWQgaW4geW91ciBnYW1lLCBpdCdzIHVzZWZ1bCBvbmx5IG9uIHdlYixcbiAgICAvLyB1c2luZyB0aGlzIGNhbiBncmVhdGx5IHJlZHVjZSB5b3VyIGdhbWUncyByZXNvdXJjZSBzaXplLCBhbmQgdGhlIGNvY29zIGNvbnNvbGUgdG9vbCBjYW4gcGFja2FnZSB5b3VyIGdhbWUgd2l0aCBvbmx5IHRoZSBtb2R1bGVzIHlvdSBzZXQuXG4gICAgLy8gRm9yIGRldGFpbHMgYWJvdXQgbW9kdWxlcyBkZWZpbml0aW9ucywgeW91IGNhbiByZWZlciB0byBcIi4uLy4uL2ZyYW1ld29ya3MvY29jb3MyZC1odG1sNS9tb2R1bGVzQ29uZmlnLmpzb25cIi5cblxuICAgIFwianNMaXN0XCIgICAgICAgIDogW1xuICAgIF1cbiAgICAvLyBcImpzTGlzdFwiIHNldHMgdGhlIGxpc3Qgb2YganMgZmlsZXMgaW4geW91ciBnYW1lLlxuIH1cbiAqXG4gKi9cblxuY2MuZ2FtZS5vblN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFjYy5zeXMuaXNOYXRpdmUgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb2Nvc0xvYWRpbmdcIikpXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb2Nvc0xvYWRpbmdcIikpO1xuXG4gICAgY2Mudmlldy5lbmFibGVSZXRpbmEoZmFsc2UpO1xuICAgIGNjLnZpZXcuYWRqdXN0Vmlld1BvcnQodHJ1ZSk7XG5cbiAgICB2YXIgTG9naWNNYW4gPSByZXF1aXJlKFwiLi9jb21tb24vbW9kZWwvTG9naWNNYW5cIik7XG4gICAgTG9naWNNYW4uZ2V0SW5zdGFuY2UoKS5pbml0KCk7XG5cbiAgICB2YXIgVXRpbHMgPSByZXF1aXJlKFwiLi9jb21tb24vdXRpbC9VdGlsc1wiKTtcbiAgICBjYy52aWV3LnJlc2l6ZVdpdGhCcm93c2VyU2l6ZSh0cnVlKTtcbiAgICBjYy52aWV3LnNldERlc2lnblJlc29sdXRpb25TaXplKDEwMDAsIDEzMDAsIGNjLlJlc29sdXRpb25Qb2xpY3kuU0hPV19BTEwpO1xuICAgIC8vaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgIC8vICAgIHZhciB3aWR0aCA9IDA7XG4gICAgLy8gICAgdmFyIGhlaWdodCA9IDA7XG4gICAgLy8gICAgaWYgKCEhR2FtZUJyaWRnZS5nZXRDb25maWcoKS5ob3Jpem9udGFsR2FtZSkge1xuICAgIC8vICAgICAgICBoZWlnaHQgPSA2NDA7XG4gICAgLy8gICAgICAgIGlmIChVdGlscy5pc1BhZCgpKSB7XG4gICAgLy8gICAgICAgICAgICBoZWlnaHQgPSA3Njg7XG4gICAgLy8gICAgICAgIH1cbiAgICAvLyAgICAgICAgd2lkdGggPSBoZWlnaHQgKiBjYy53aW5TaXplLndpZHRoIC8gY2Mud2luU2l6ZS5oZWlnaHQ7XG4gICAgLy8gICAgICAgIGNjLmxvZyhcImNjLndpblNpemUud2lkdGg6XCIgKyBjYy53aW5TaXplLndpZHRoKTtcbiAgICAvLyAgICAgICAgY2MubG9nKFwiY2Mud2luU2l6ZS5oZWlnaHQ6XCIgKyBjYy53aW5TaXplLmhlaWdodCk7XG4gICAgLy9cbiAgICAvLyAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICBoZWlnaHQgPSAxMTM2O1xuICAgIC8vICAgICAgICBpZiAoVXRpbHMuaXNQYWQoKSkge1xuICAgIC8vICAgICAgICAgICAgaGVpZ2h0ID0gMTAyNDtcbiAgICAvLyAgICAgICAgfVxuICAgIC8vICAgICAgICB3aWR0aCA9IGhlaWdodCAqIGNjLndpblNpemUud2lkdGggLyBjYy53aW5TaXplLmhlaWdodDtcbiAgICAvLyAgICB9XG4gICAgLy8gICAgY2MubG9nKFwid2lkdGg6XCIgKyB3aWR0aCk7XG4gICAgLy8gICAgY2MubG9nKFwiaGVpZ2h0OlwiICsgaGVpZ2h0KTtcbiAgICAvLyAgICBjYy52aWV3LnNldERlc2lnblJlc29sdXRpb25TaXplKHdpZHRoLCBoZWlnaHQsIGNjLlJlc29sdXRpb25Qb2xpY3kuU0hPV19BTEwpO1xuICAgIC8vfSBlbHNlIHtcbiAgICAvLyAgICBpZiAoISFHYW1lQnJpZGdlLmdldENvbmZpZygpLmhvcml6b250YWxHYW1lKSB7XG4gICAgLy8gICAgICAgIGNjLnZpZXcuc2V0RGVzaWduUmVzb2x1dGlvblNpemUoOTYwLCA2NDAsIGNjLlJlc29sdXRpb25Qb2xpY3kuU0hPV19BTEwpO1xuICAgIC8vICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgIGNjLnZpZXcuc2V0RGVzaWduUmVzb2x1dGlvblNpemUoNjQwLCA5NjAsIGNjLlJlc29sdXRpb25Qb2xpY3kuU0hPV19BTEwpO1xuICAgIC8vICAgIH1cbiAgICAvL31cblxuICAgIC8vIFRoZSBnYW1lIHdpbGwgYmUgcmVzaXplZCB3aGVuIGJyb3dzZXIgc2l6ZSBjaGFuZ2VcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnNldFJlc291cmNlUGF0aChcInJlcy9cIik7XG4gICAgY2Mudmlldy5yZXNpemVXaXRoQnJvd3NlclNpemUodHJ1ZSk7XG5cbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY3JlYXRlT3ZlcmxheSgpO1xuICAgIHdpbmRvdy5pc0VkaXRvciA9IHRydWU7XG5cbiAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgIGdhbWUubG9jYWwucmVsb2FkKCk7XG4gICAgICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKG5ldyBHYW1lQnJpZGdlLmdldE1lbnVTY2VuZSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjYy5sb2FkZXIubG9hZEpzb24oXCJyZXMvcmVzb3VyY2VfbGlzdC9yZXNvdXJjZV9saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGVycm9yLCByZXN1bHQpIHtcbiAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjYy5Mb2FkZXJTY2VuZS5wcmVsb2FkKHJlc3VsdCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmxvY2FsLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgRWRpdG9yU2NlbmUgPSByZXF1aXJlKFwiLi9tYW55X2JyaWNrcy9lZGl0b3Ivc2NlbmUvRWRpdG9yU2NlbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKG5ldyBFZGl0b3JTY2VuZSgpKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufTtcbmNjLmdhbWUucnVuKCk7XG4iLCJcbnZhciBCcmlja0NvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLndpZHRoID0gMDtcbiAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgdGhpcy54ID0gMDtcbiAgICB0aGlzLnkgPSAwO1xuICAgIHRoaXMudHlwZSA9IDA7XG59O1xuXG5Ccmlja0NvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLnggPSBqc29uT2JqWzBdO1xuICAgIHRoaXMueSA9IGpzb25PYmpbMV07XG4gICAgdGhpcy53aWR0aCA9IGpzb25PYmpbMl07XG4gICAgdGhpcy5oZWlnaHQgPSBqc29uT2JqWzNdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbNF07XG59O1xuXG5Ccmlja0NvbmZpZy5wcm90b3R5cGUuZ2V0SGFyZENmZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaGFyZENmZyA9IG5ldyBCcmlja0NvbmZpZygpO1xuICAgIGhhcmRDZmcueCA9IHRoaXMueCAqIDI7XG4gICAgaGFyZENmZy55ID0gdGhpcy55ICogMjtcbiAgICBoYXJkQ2ZnLndpZHRoID0gdGhpcy53aWR0aCAqIDI7XG4gICAgaGFyZENmZy5oZWlnaHQgPSB0aGlzLmhlaWdodCAqIDI7XG4gICAgaGFyZENmZy50eXBlID0gdGhpcy50eXBlO1xuICAgIHJldHVybiBoYXJkQ2ZnO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCcmlja0NvbmZpZzsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE2LzUvMTkuXG4gKi9cbnZhciBDb25maWcgPSB7XG4gICAgaXR1bmVzRG93bmxvYWRVcmw6IFwiaXRtcy1hcHBzOi8vaXR1bmVzLmFwcGxlLmNvbS9hcHAvaWQxMzcyODM3MTIzP2FjdGlvbj13cml0ZS1yZXZpZXdcIixcbiAgICBnb29nbGVQbGF5VXJsOiBcImh0dHA6Ly9iaXQubHkvMk84Rzl2eFwiLFxuICAgIGlvc1Nob3J0VXJsOiBcImh0dHBzOi8vYXBwbGUuY28vMlVQQ3d6NlwiLFxuICAgIGFuZHJvaWRTaG9ydFVybDogXCJodHRwOi8vYml0Lmx5LzJPOEc5dnhcIixcbiAgICBhcHBOYW1lOiBcIkJsYXN0IEJyaWNrc1wiLFxuICAgIGlvc0xlYWRlckJvYXJkS2V5OiBcImNvbS5kb3VhcHAubWFueWJyaWNrcy5yYW5rXCIsXG4gICAgaW9zSGFyZExlYWRlckJvYXJkS2V5OiBcImNvbS5kb3VhcHAubWFueWJyaWNrcy5oYXJkcmFua1wiLFxuICAgIGdvb2dsZVBsYXlMZWFkZXJCb2FyZEtleTogXCJDZ2tJb3VDdDAta0JFQUlRQVFcIixcbiAgICBJU19ERUJVRzogZmFsc2UsXG4gICAgSVNfRU5BQkxFX0hPVF9VUERBVEU6IGZhbHNlLFxuXG4gICAgZ2V0TGVhZGVyQm9hcmRLZXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ29vZ2xlUGxheUxlYWRlckJvYXJkS2V5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW9zTGVhZGVyQm9hcmRLZXk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0SGFyZEJvYXJkS2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdvb2dsZVBsYXlMZWFkZXJCb2FyZEtleTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlvc0hhcmRMZWFkZXJCb2FyZEtleTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRQbGF0Zm9ybURvd25sb2FkVXJsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdvb2dsZVBsYXlVcmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pdHVuZXNEb3dubG9hZFVybDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRTaG9ydFBsYXRmb3JtRG93bmxvYWRVcmw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5kcm9pZFNob3J0VXJsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW9zU2hvcnRVcmw7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldENyb3NzUHJvbVVybDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmRyb2lkQ3Jvc3NQcm9tVXJsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5sYW5ndWFnZSA9PT0gY2Muc3lzLkxBTkdVQUdFX0NISU5FU0UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbkNyb3NzUHJvbVVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyb3NzUHJvbVVybDtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0UGFja2FnZU5hbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiY29tLmRvdWFwcC5tYW55YnJpY2tzXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBcImNvbS5xMS5icmVha2JyaWNrc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiY29tLmRvdWFwcC5tYW55YnJpY2tzXCI7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldEFkVXJsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLnV0aWxzLmlzU2VsZkdhbWUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY25OZXdBZENvbmZpZ1VybDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5hZENvbmZpZ1VybDtcbiAgICB9LFxuICAgIGhvcml6b250YWxHYW1lOiBmYWxzZSxcblxuICAgIC8vYmluZ2NodWFuIGFkIHVybC5cbiAgICBhZENvbmZpZ1VybDogXCJodHRwczovL29uZWdhbWVpbmMuZ2l0aHViLmlvL21hbnlfYnJpY2tzL2dhbWVfYmluZ2NodWFuLmh0bWxcIixcbiAgICAvL2JpbmdjaHVhbiBwcm9tIHVybC5cbiAgICBjcm9zc1Byb21Vcmw6IFwiaHR0cHM6Ly9vbmVnYW1laW5jLmdpdGh1Yi5pby9jcm9zc19wcm9tb3Rpb24vY29uZmlnL21hbnlfYnJpY2tzL2Nyb3NzX3Byb21vdGlvbl9iaW5nY2h1YW4uaHRtbFwiLFxuXG4gICAgLy9vbGQgdmVyc2lvbiBjbiBhZCB1cmwuXG4gICAgY25BZENvbmZpZ1VybDogXCJodHRwczovL29uZWdhbWVpbmMuZ2l0aHViLmlvL21hbnlfYnJpY2tzL2dhbWUuaHRtbFwiLFxuICAgIC8vbmV3IHZlcnNpb24gY24gYWQgdXJsLlxuICAgIGNuTmV3QWRDb25maWdVcmw6IFwiaHR0cHM6Ly9vbmVnYW1laW5jLmdpdGh1Yi5pby9tYW55X2JyaWNrcy9nYW1lX2NuLmh0bWxcIixcbiAgICAvL2NuIHByb20gdXJsLlxuICAgIGNuQ3Jvc3NQcm9tVXJsOiBcImh0dHBzOi8vb25lZ2FtZWluYy5naXRodWIuaW8vY3Jvc3NfcHJvbW90aW9uL2NvbmZpZy9tYW55X2JyaWNrcy9jcm9zc19wcm9tb3Rpb24uaHRtbFwiLFxuXG5cbiAgICBhbmRyb2lkQ3Jvc3NQcm9tVXJsOiBcImh0dHBzOi8vb25lZ2FtZWluYy5naXRodWIuaW8vY3Jvc3NfcHJvbW90aW9uL2NvbmZpZy9tYW55X2JyaWNrc19hbmRyb2lkL2Nyb3NzX3Byb21vdGlvbi5odG1sXCIsXG4gICAgY29ubmVjdEVtYWlsOiBcImJyaWNrcy5jcnVzaC5wbGF5QGdtYWlsLmNvbVwiLFxuXG4gICAgcmV3YXJkQWRNYXhDb3VudFBlckRheTogMTBcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ29uZmlnOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMy8yNS5cbiAqL1xudmFyIExldmVsQ29uZmlnID0gcmVxdWlyZShcIi4vTGV2ZWxDb25maWdcIik7XG4vL3ZhciBQYWNrYWdlQ29uZmlnID0gcmVxdWlyZShcIi4vUGFja2FnZUNvbmZpZ1wiKTtcbnZhciBTdG9yZUNvbmZpZyA9IHJlcXVpcmUoXCIuL1N0b3JlQ29uZmlnXCIpO1xudmFyIFdoZWVsQ29uZmlnID0gcmVxdWlyZShcIi4vV2hlZWxDb25maWdcIik7XG52YXIgU2hhcmVDb25maWcgPSByZXF1aXJlKFwiLi9TaGFyZUNvbmZpZ1wiKTtcbnZhciBTa2luQ29uZmlnID0gcmVxdWlyZShcIi4vU2tpbkNvbmZpZ1wiKTtcbnZhciBEYWlseUJvbnVzQ29uZmlnID0gcmVxdWlyZShcIi4vRGFpbHlCb251c0NvbmZpZ1wiKTtcbnZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG52YXIgVGFza0NvbmZpZyA9IHJlcXVpcmUoXCIuL1Rhc2tDb25maWdcIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIFRhc2tPbGRDb25maWcgPSByZXF1aXJlKFwiLi9UYXNrT2xkQ29uZmlnXCIpO1xuXG52YXIgTGV2ZWxDb25maWdNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgbGV2ZWxMaXN0OiBudWxsLFxuICAgIHN0b3JlTGlzdDogbnVsbCxcbiAgICB3aGVlbExpc3Q6IG51bGwsXG4gICAgc2hhcmVMaXN0OiBudWxsLFxuICAgIHNraW5MaXN0OiBudWxsLFxuICAgIGRhaWx5Qm9udXNMaXN0OiBudWxsLFxuICAgIHN0b3JlTGlzdFdpdGhvdXRGaXJzdFB1cmNoYXNlOiBudWxsLFxuICAgIHRhc2tMaXN0OiBudWxsLFxuICAgIG9sZFRhc2tMaXN0OiBudWxsLFxuICAgIG9yaWdpbmFsTGV2ZWxMaXN0OiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0b3JlTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLmxldmVsTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLndoZWVsTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLnNoYXJlTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLnNraW5MaXN0ID0gW107XG4gICAgICAgIHRoaXMuZGFpbHlCb251c0xpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5zdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZSA9IFtdO1xuICAgICAgICB0aGlzLnRhc2tMaXN0ID0gW107XG4gICAgICAgIHRoaXMub2xkVGFza0xpc3QgPSBbXTtcblxuICAgICAgICB0aGlzLnJlbG9hZCgpO1xuICAgIH0sXG5cbiAgICByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGk7XG5cbiAgICAgICAgdmFyIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9zdG9yZV9jb25maWcuanNvblwiKTtcbiAgICAgICAgdmFyIHN0b3JlQ29uZmlncyA9IGpzb25PYmpbXCJzdG9yZXNcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdG9yZUNvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBzdG9yZUNvbmZpZyA9IG5ldyBTdG9yZUNvbmZpZygpO1xuICAgICAgICAgICAgc3RvcmVDb25maWcudW5tYXJzaGFsKHN0b3JlQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICB0aGlzLnN0b3JlTGlzdC5wdXNoKHN0b3JlQ29uZmlnKTtcblxuICAgICAgICAgICAgaWYgKHN0b3JlQ29uZmlnLnR5cGUgPT09IFN0b3JlVHlwZS5GSVJTVF9QVVJDSEFTRSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lhbE9mZmVyQ2ZnID0gc3RvcmVDb25maWc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2UucHVzaChzdG9yZUNvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBqc29uT2JqID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvbGV2ZWxfY29uZmlncy5qc29uXCIpO1xuICAgICAgICB2YXIgbGV2ZWxDb25maWdzID0ganNvbk9ialtcImxldmVsc1wiXTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbExldmVsTGlzdCA9IGxldmVsQ29uZmlncztcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxldmVsQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlnID0gbmV3IExldmVsQ29uZmlnKCk7XG4gICAgICAgICAgICBsZXZlbENvbmZpZy51bm1hcnNoYWwobGV2ZWxDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMubGV2ZWxMaXN0LnB1c2gobGV2ZWxDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2RhdGFfY29uZmlnLmpzb25cIik7XG4gICAgICAgIHZhciB3aGVlbENvbmZpZ3MgPSBqc29uT2JqW1wid2hlZWxcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB3aGVlbENvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB3aGVlbENvbmZpZyA9IG5ldyBXaGVlbENvbmZpZygpO1xuICAgICAgICAgICAgd2hlZWxDb25maWcudW5tYXJzaGFsKHdoZWVsQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICB0aGlzLndoZWVsTGlzdC5wdXNoKHdoZWVsQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaGFyZUNvbmZpZ3MgPSBqc29uT2JqW1wic2hhcmVcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaGFyZUNvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBzaGFyZUNvbmZpZyA9IG5ldyBTaGFyZUNvbmZpZygpO1xuICAgICAgICAgICAgc2hhcmVDb25maWcudW5tYXJzaGFsKHNoYXJlQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICB0aGlzLnNoYXJlTGlzdC5wdXNoKHNoYXJlQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkYWlseUJvbnVzQ29uZmlncyA9IGpzb25PYmpbXCJkYWlseV9ib251c1wiXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhaWx5Qm9udXNDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgZGFpbHlCb251c0NvbmZpZyA9IG5ldyBEYWlseUJvbnVzQ29uZmlnKCk7XG4gICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLnVubWFyc2hhbChkYWlseUJvbnVzQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICBpZiAoZGFpbHlCb251c0NvbmZpZy50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICAgICAgICAgIHZhciBnZXR0ZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKGRhaWx5Qm9udXNDb25maWcuYXJnMSk7XG4gICAgICAgICAgICAgICAgaWYgKGdldHRlZCkge1xuICAgICAgICAgICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLnR5cGUgPSBkYWlseUJvbnVzQ29uZmlnLmV4dHJhLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGRhaWx5Qm9udXNDb25maWcuY291bnQgPSBkYWlseUJvbnVzQ29uZmlnLmV4dHJhLmNvdW50O1xuICAgICAgICAgICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLmltYWdlID0gZGFpbHlCb251c0NvbmZpZy5leHRyYS5pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZGFpbHlCb251c0xpc3QucHVzaChkYWlseUJvbnVzQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdmFyIHNwZWNpYWxPZmZlckpzb24gPSBqc29uT2JqW1wic3BlY2lhbF9vZmZlclwiXTtcbiAgICAgICAgLy92YXIgc3BlY2lhbE9mZmVyQ29uZmlnID0gbmV3IFN0b3JlQ29uZmlnKCk7XG4gICAgICAgIC8vc3BlY2lhbE9mZmVyQ29uZmlnLnVubWFyc2hhbChzcGVjaWFsT2ZmZXJKc29uKTtcbiAgICAgICAgLy90aGlzLnNwZWNpYWxPZmZlckNmZyA9IHNwZWNpYWxPZmZlckNvbmZpZztcblxuICAgICAgICBqc29uT2JqID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvc2tpbnNfY29uZmlnLmpzb25cIik7XG4gICAgICAgIHZhciBza2luc0NvbmZpZ3MgPSBqc29uT2JqW1wic2tpbnNcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBza2luc0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBza2luQ29uZmlnID0gbmV3IFNraW5Db25maWcoKTtcbiAgICAgICAgICAgIHNraW5Db25maWcudW5tYXJzaGFsKHNraW5zQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICB0aGlzLnNraW5MaXN0LnB1c2goc2tpbkNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBqc29uT2JqID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvdGFza19jb25maWcuanNvblwiKTtcbiAgICAgICAgdmFyIHRhc2tDb25maWdzID0ganNvbk9ialtcInRhc2tzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFza0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB0YXNrQ29uZmlnID0gbmV3IFRhc2tDb25maWcoKTtcbiAgICAgICAgICAgIHRhc2tDb25maWcudW5tYXJzaGFsKHRhc2tDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMudGFza0xpc3QucHVzaCh0YXNrQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy90YXNrX29sZF9jb25maWcuanNvblwiKTtcbiAgICAgICAgdmFyIHRhc2tDb25maWdzID0ganNvbk9ialtcInRhc2tzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFza0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB0YXNrQ29uZmlnID0gbmV3IFRhc2tPbGRDb25maWcoKTtcbiAgICAgICAgICAgIHRhc2tDb25maWcudW5tYXJzaGFsKHRhc2tDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMub2xkVGFza0xpc3QucHVzaCh0YXNrQ29uZmlnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRTdG9yZUxpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmVMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRTdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxldmVsTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxDb25maWc6IGZ1bmN0aW9uIChsZXZlbElkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxldmVsTGlzdFtsZXZlbElkIC0gMV07XG4gICAgfSxcblxuICAgIGdldE9yaWdpbmFsTGV2ZWxDb25maWc6IGZ1bmN0aW9uIChsZXZlbElkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yaWdpbmFsTGV2ZWxMaXN0W2xldmVsSWQgLSAxXTtcbiAgICB9LFxuXG4gICAgZ2V0V2hlZWxMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndoZWVsTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U2hhcmVMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNoYXJlTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U2tpbkxpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2tpbkxpc3Q7XG4gICAgfSxcblxuICAgIGdldFRhc2tMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRPbGRUYXNrTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vbGRUYXNrTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U2tpbkNmZzogZnVuY3Rpb24gKHNraW5JZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2tpbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChza2luSWQgPT0gdGhpcy5za2luTGlzdFtpXS5pZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNraW5MaXN0W2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXREYWlseUJvbnVzTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYWlseUJvbnVzTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U3BlY2lhbE9mZmVyQ2ZnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNwZWNpYWxPZmZlckNmZztcbiAgICB9XG5cbiAgICAvL2dldFBhY2thZ2U6IGZ1bmN0aW9uIChwYWNrYWdlSWQpIHtcbiAgICAvLyAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGFja2FnZUxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAvLyAgICAgICAgaWYgKHRoaXMucGFja2FnZUxpc3RbaV0uaWQgPT09IHBhY2thZ2VJZCkge1xuICAgIC8vICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFja2FnZUxpc3RbaV07XG4gICAgLy8gICAgICAgIH1cbiAgICAvLyAgICB9XG4gICAgLy8gICAgcmV0dXJuIG51bGw7XG4gICAgLy99XG59KTtcblxuTGV2ZWxDb25maWdNYW4uX2luc3RhbmNlID0gbnVsbDtcbkxldmVsQ29uZmlnTWFuLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge0xldmVsQ29uZmlnTWFufVxuICovXG5MZXZlbENvbmZpZ01hbi5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoTGV2ZWxDb25maWdNYW4uX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgTGV2ZWxDb25maWdNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgTGV2ZWxDb25maWdNYW4uX2luc3RhbmNlID0gbmV3IExldmVsQ29uZmlnTWFuKCk7XG4gICAgfVxuICAgIHJldHVybiBMZXZlbENvbmZpZ01hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IExldmVsQ29uZmlnTWFuO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgRGFpbHlCb251c0NvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLnR5cGUgPSAwO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICAgIC8vdGhpcy5wcm9iYWJpbGl0eSA9IDA7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG4gICAgdGhpcy5hcmcxID0gXCJcIjtcbn07XG5cbkRhaWx5Qm9udXNDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLnR5cGUgPSBqc29uT2JqW1widHlwZVwiXTtcbiAgICB0aGlzLmNvdW50ID0ganNvbk9ialtcImNvdW50XCJdO1xuICAgIC8vdGhpcy5wcm9iYWJpbGl0eSA9IGpzb25PYmpbXCJwcm9iYWJpbGl0eVwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMuYXJnMSA9IGpzb25PYmpbXCJhcmcxXCJdO1xuICAgIHRoaXMuZXh0cmEgPSBqc29uT2JqW1wiZXh0cmFcIl07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhaWx5Qm9udXNDb25maWc7XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMy8yNS5cbiAqL1xudmFyIEJyaWNrQ29uZmlnID0gcmVxdWlyZShcIi4vQnJpY2tDb25maWdcIik7XG5cbnZhciBMZXZlbENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxpZmVQcm9iYWJpbGl0eSA9IDA7XG4gICAgdGhpcy5ib29zdFByb2JhYmlsaXR5ID0gMDtcbiAgICB0aGlzLnBpeGVsV2lkdGggPSAwO1xuICAgIHRoaXMucGl4ZWxIZWlnaHQgPSAwO1xuICAgIHRoaXMud2lkdGggPSAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7QXJyYXkuPEJyaWNrQ29uZmlnPn1cbiAgICAgKi9cbiAgICB0aGlzLm9ic3RhY2xlcyA9IFtdO1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48QnJpY2tDb25maWc+fVxuICAgICAqL1xuICAgIHRoaXMuYnJpY2tzID0gW107XG4gICAgdGhpcy5zdGFyVGltZSA9IDA7XG59O1xuXG5MZXZlbENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmxpZmVQcm9iYWJpbGl0eSA9IGpzb25PYmpbXCJsXCJdIHx8IDA7XG4gICAgdGhpcy5ib29zdFByb2JhYmlsaXR5ID0ganNvbk9ialtcImJcIl0gfHwgMDtcbiAgICB0aGlzLnBpeGVsV2lkdGggPSBqc29uT2JqW1wicGl4ZWxXaWR0aFwiXTtcbiAgICB0aGlzLnBpeGVsSGVpZ2h0ID0ganNvbk9ialtcInBpeGVsSGVpZ2h0XCJdO1xuICAgIHRoaXMud2lkdGggPSBqc29uT2JqW1wid2lkdGhcIl07XG4gICAgdGhpcy5oZWlnaHQgPSBqc29uT2JqW1wiaGVpZ2h0XCJdO1xuICAgIHZhciBpO1xuICAgIHZhciBvYnN0YWNsZXMgPSBqc29uT2JqW1wib2JzdGFjbGVzXCJdO1xuICAgIGZvciAoaSA9IDA7IGkgPCBvYnN0YWNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIG9ic3RhY2xlID0gb2JzdGFjbGVzW2ldO1xuICAgICAgICB2YXIgb2JzdGFjbGVDZmcgPSBuZXcgQnJpY2tDb25maWcoKTtcbiAgICAgICAgb2JzdGFjbGVDZmcudW5tYXJzaGFsKG9ic3RhY2xlKTtcbiAgICAgICAgdGhpcy5vYnN0YWNsZXMucHVzaChvYnN0YWNsZUNmZyk7XG4gICAgfVxuXG4gICAgdmFyIGJyaWNrcyA9IGpzb25PYmpbXCJicmlja3NcIl07XG4gICAgZm9yIChpID0gMDsgaSA8IGJyaWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgYnJpY2sgPSBicmlja3NbaV07XG4gICAgICAgIHZhciBicmlja0NmZyA9IG5ldyBCcmlja0NvbmZpZygpO1xuICAgICAgICBicmlja0NmZy51bm1hcnNoYWwoYnJpY2spO1xuICAgICAgICB0aGlzLmJyaWNrcy5wdXNoKGJyaWNrQ2ZnKTtcbiAgICB9XG4gICAgdGhpcy5zdGFyVGltZSA9IGpzb25PYmpbXCJzdGFyVGltZVwiXSB8fCAwO1xufTtcblxuTGV2ZWxDb25maWcucHJvdG90eXBlLmdldEhhcmRDZmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxldmVsQ2ZnID0gbmV3IExldmVsQ29uZmlnKCk7XG4gICAgbGV2ZWxDZmcubGlmZVByb2JhYmlsaXR5ID0gdGhpcy5saWZlUHJvYmFiaWxpdHk7XG4gICAgbGV2ZWxDZmcuYm9vc3RQcm9iYWJpbGl0eSA9IHRoaXMuYm9vc3RQcm9iYWJpbGl0eSAqIDAuODU7XG4gICAgbGV2ZWxDZmcucGl4ZWxXaWR0aCA9IHRoaXMucGl4ZWxXaWR0aDtcbiAgICBsZXZlbENmZy5waXhlbEhlaWdodCA9IHRoaXMucGl4ZWxIZWlnaHQ7XG4gICAgbGV2ZWxDZmcud2lkdGggPSB0aGlzLndpZHRoICogMjtcbiAgICBsZXZlbENmZy5oZWlnaHQgPSB0aGlzLmhlaWdodCAqIDI7XG4gICAgbGV2ZWxDZmcub2JzdGFjbGVzID0gW107XG4gICAgbGV2ZWxDZmcuYnJpY2tzID0gW107XG4gICAgbGV2ZWxDZmcuc3RhclRpbWUgPSB0aGlzLnN0YXJUaW1lO1xuICAgIHZhciBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLm9ic3RhY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICBsZXZlbENmZy5vYnN0YWNsZXMucHVzaCh0aGlzLm9ic3RhY2xlc1tpXS5nZXRIYXJkQ2ZnKCkpO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5icmlja3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgbGV2ZWxDZmcuYnJpY2tzLnB1c2godGhpcy5icmlja3NbaV0uZ2V0SGFyZENmZygpKTtcbiAgICB9XG4gICAgcmV0dXJuIGxldmVsQ2ZnO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMZXZlbENvbmZpZzsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBTaGFyZUNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLmltYWdlID0gXCJcIjtcbiAgICB0aGlzLmRlc2MgPSBcIlwiO1xufTtcblxuU2hhcmVDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMuZGVzYyA9IGpzb25PYmpbXCJkZXNjXCJdO1xufTtcblxuU2hhcmVDb25maWcucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNvbmZpZyA9IG5ldyBTaGFyZUNvbmZpZygpO1xuICAgIGNvbmZpZy5pZCA9IHRoaXMuaWQ7XG4gICAgY29uZmlnLmltYWdlID0gdGhpcy5pbWFnZTtcbiAgICBjb25maWcuZGVzYyA9IHRoaXMuZGVzYztcbiAgICByZXR1cm4gY29uZmlnO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTaGFyZUNvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgU2tpbkNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLmNvdW50ID0gXCJcIjtcbiAgICB0aGlzLmltYWdlID0gMDtcbiAgICB0aGlzLnNjYWxlID0gMTtcbn07XG5cblNraW5Db25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLmNvdW50ID0ganNvbk9ialtcImNvdW50XCJdO1xuICAgIHRoaXMuaW1hZ2UgPSBqc29uT2JqW1wiaW1hZ2VcIl07XG4gICAgdGhpcy5zY2FsZSA9IGpzb25PYmpbXCJzY2FsZVwiXSB8fCAxO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTa2luQ29uZmlnO1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBTdG9yZUNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLnR5cGUgPSAwO1xuICAgIHRoaXMubmFtZSA9IFwiXCI7XG4gICAgdGhpcy5wcmljZSA9IDA7XG4gICAgdGhpcy5jb3VudCA9IDE7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG4gICAgdGhpcy5waWQgPSBcIlwiO1xuICAgIHRoaXMua2V5ID0gXCJcIjtcbiAgICB0aGlzLmhvdCA9IGZhbHNlO1xuICAgIHRoaXMuYmVzdCA9IGZhbHNlO1xuICAgIHRoaXMuZGF0YSA9IG51bGw7XG4gICAgdGhpcy5vcmlnaW5hbF9wcmljZSA9IDA7XG4gICAgdGhpcy5kaXNjb3VudF9tdWx0aSA9IDA7XG4gICAgdGhpcy5leHRyYSA9IDA7XG59O1xuXG5TdG9yZUNvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMubmFtZSA9IGpzb25PYmpbXCJuYW1lXCJdO1xuICAgIHRoaXMucHJpY2UgPSBqc29uT2JqW1wicHJpY2VcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMucGlkID0ganNvbk9ialtcInBpZFwiXTtcbiAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICB0aGlzLnBpZCA9IGpzb25PYmpbXCJwaWRfZ3BcIl07XG4gICAgfVxuICAgIHRoaXMua2V5ID0ganNvbk9ialtcImtleVwiXTtcbiAgICB0aGlzLmhvdCA9IGpzb25PYmpbXCJob3RcIl07XG4gICAgdGhpcy5iZXN0ID0ganNvbk9ialtcImJlc3RcIl07XG4gICAgdGhpcy5kYXRhID0ganNvbk9ialtcImRhdGFcIl0gfHwge307XG4gICAgdGhpcy5vcmlnaW5hbF9wcmljZSA9IGpzb25PYmpbXCJvcmlnaW5hbF9wcmljZVwiXTtcbiAgICB0aGlzLmRpc2NvdW50X211bHRpID0ganNvbk9ialtcImRpc2NvdW50X211bHRpXCJdO1xuICAgIHRoaXMuZXh0cmEgPSBqc29uT2JqW1wiZXh0cmFcIl0gfHwgMDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3RvcmVDb25maWc7XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cblxudmFyIFRhc2tDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbiAgICB0aGlzLmNvdW50ID0gXCJcIjtcbiAgICB0aGlzLnJld2FyZENvdW50ID0gMDtcbn07XG5cblRhc2tDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLnR5cGUgPSBqc29uT2JqW1widHlwZVwiXTtcbiAgICB0aGlzLmNvdW50ID0ganNvbk9ialtcImNvdW50XCJdO1xuICAgIHRoaXMucmV3YXJkQ291bnQgPSBqc29uT2JqW1wicmV3YXJkQ291bnRcIl07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tDb25maWc7XG5cbiIsIlxuLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgVGFza09sZENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLmNvdW50ID0gXCJcIjtcbiAgICB0aGlzLmltYWdlID0gMDtcbiAgICB0aGlzLnNjYWxlID0gMTtcbiAgICB0aGlzLnR5cGUgPSAwO1xufTtcblxuVGFza09sZENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgdGhpcy5pbWFnZSA9IGpzb25PYmpbXCJpbWFnZVwiXTtcbiAgICB0aGlzLnNjYWxlID0ganNvbk9ialtcInNjYWxlXCJdIHx8IDE7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tPbGRDb25maWc7XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cblxudmFyIFdoZWVsQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaWQgPSAwO1xuICAgIHRoaXMudHlwZSA9IDA7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gICAgdGhpcy5wcm9iYWJpbGl0eSA9IDA7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG59O1xuXG5XaGVlbENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgdGhpcy5wcm9iYWJpbGl0eSA9IGpzb25PYmpbXCJwcm9iYWJpbGl0eVwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBXaGVlbENvbmZpZztcblxuIiwidmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBBZHNSZW1pbmRlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BSZW1pbmRlciA9IG51bGw7XG4gICAgdGhpcy5sYlJlbWluZGVyID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQWRzUmVtaW5kZXJDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRVdBUkRFRF9WSURFT19DT1VOVCwgdGhpcy5vblVwZGF0ZVJlbWluZGVyLCB0aGlzKTtcbn07XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRVdBUkRFRF9WSURFT19DT1VOVCwgdGhpcy5vblVwZGF0ZVJlbWluZGVyLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5BZHNSZW1pbmRlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm9uVXBkYXRlUmVtaW5kZXIoKTtcbn07XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVSZW1pbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY291bnQgPSBnYW1lLmNvbmZpZy5yZXdhcmRBZE1heENvdW50UGVyRGF5IC0gZ2FtZS5wbGF5ZXJNYW4uZ2V0UmV3YXJkQWRQbGFjZUNvdW50UGVyRGF5KCk7XG4gICAgaWYgKGNvdW50IDwgMCkge1xuICAgICAgICBjb3VudCA9IDA7XG4gICAgfVxuICAgIHRoaXMubGJSZW1pbmRlci5zZXRTdHJpbmcoY291bnQpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBZHNSZW1pbmRlckNvbnRyb2xsZXI7IiwiLy92YXIgU2tpbkl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vU2tpbkl0ZW1Db250cm9sbGVyXCIpO1xuLy92YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG4vL3ZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuLy9cbi8vdmFyIEdSSURfU0laRSA9IGNjLnNpemUoMzUwLCA1MDApO1xuLy9cbi8vdmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuLy8gICAgZW50aXR5OiBudWxsLFxuLy8gICAgaXRlbU5vZGU6IG51bGwsXG4vLyAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgdGhpcy5fc3VwZXIoKTtcbi8vICAgICAgICB0aGlzLml0ZW1Ob2RlID0gU2tpbkl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbi8vICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuLy8gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbi8vICAgIH0sXG4vL1xuLy8gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCwgaW5pdGVkKSB7XG4vLyAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4vLyAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbi8vICAgIH1cbi8vfSk7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIEJhZ0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQm9vc3ROYW1lMSA9IG51bGw7XG4gICAgdGhpcy5sYkJvb3N0TmFtZTIgPSBudWxsO1xuICAgIHRoaXMubGJCb29zdERlc2MxID0gbnVsbDtcbiAgICB0aGlzLmxiQm9vc3REZXNjMiA9IG51bGw7XG4gICAgdGhpcy5sYlNoYXJlVGlwcyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEJhZ0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkJhZ0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQm9vc3ROYW1lMS5zZXRTdHJpbmcoXyhcImJvb3N0X3NwbGl0X3RpdGxlXCIpICsgXCIgWFwiICsgKGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlNQTElUKSkpO1xuICAgIHRoaXMubGJCb29zdE5hbWUyLnNldFN0cmluZyhfKFwiYm9vc3RfbmV3X3RpdGxlXCIpICsgXCIgWFwiICsgKGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlRIUkVFX0JBTEwpKSk7XG4gICAgdGhpcy5sYkJvb3N0RGVzYzEuc2V0U3RyaW5nKF8oXCJib29zdF9zcGxpdF9kZXNjXCIpKTtcbiAgICB0aGlzLmxiQm9vc3REZXNjMi5zZXRTdHJpbmcoXyhcImJvb3N0X25ld19kZXNjXCIpKTtcbiAgICB0aGlzLmxiU2hhcmVUaXBzLnNldFN0cmluZyhcIlwiKTsvL18oXCJiYWdfc2hhcmVfdGlwc1wiKSk7XG4gICAgdGhpcy5sYlRpdGxlLnNldFN0cmluZyhfKFwiYmFnX3RpdGxlXCIpKTtcbn07XG5cbkJhZ0NvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUuc2hhcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBzaGFyZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTaGFyZUNvbmZpZygpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnd4U2hhcmUoc2hhcmUsIGZ1bmN0aW9uIChzaGFyZWQpIHtcblxuICAgIH0pO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuQmFnQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2JhZ192aWV3LmNjYmlcIiwgbnVsbCwgXCJCYWdDb250cm9sbGVyXCIsIG5ldyBCYWdDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYWdDb250cm9sbGVyOyIsInZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG5cbnZhciBCb2FyZENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BDaXJjbGUgPSBudWxsO1xuICAgIHRoaXMubmRCb2FyZCA9IG51bGw7XG4gICAgdGhpcy5zcEJhbGwgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhCb2FyZENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnVwZGF0ZVNraW4odGhpcy5zcEJhbGwpO1xufTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChiYWxsV2lkdGgpIHtcbiAgICB2YXIgc2NhbGUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0Q3VycmVudFNraW5DZmcoKS5zY2FsZTtcbiAgICB0aGlzLnNwQmFsbC5zY2FsZVggPSBiYWxsV2lkdGggLyB0aGlzLnNwQmFsbC53aWR0aCAqIHNjYWxlO1xuICAgIHRoaXMuc3BCYWxsLnNjYWxlWSA9IGJhbGxXaWR0aCAvIHRoaXMuc3BCYWxsLmhlaWdodCAqIHNjYWxlO1xufTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5oaWRlQmFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNwQmFsbC52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5Cb2FyZENvbnRyb2xsZXIucHJvdG90eXBlLnNob3dCYWxsID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc3BCYWxsLnZpc2libGUgPSB0cnVlO1xufTtcblxuQm9hcmRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbihiYWxsV2lkdGgpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2dhbWUvYm9hcmRfdmlldy5jY2JpXCIsIG51bGwsIFwiQm9hcmRDb250cm9sbGVyXCIsIG5ldyBCb2FyZENvbnRyb2xsZXIoKSk7XG4gICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGJhbGxXaWR0aCk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvYXJkQ29udHJvbGxlcjsiLCJ2YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRGFpbHlCb251c0l0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vRGFpbHlCb251c0l0ZW1Db250cm9sbGVyXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIERhaWx5Qm9udXNDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5EQUlMWV9CT05VU19DT1VOVCA9IDc7XG4gICAgdGhpcy5EQUlMWV9CT05VU19UQUcgPSAyMDA7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG5cbiAgICB0aGlzLmxibFRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMubmREYWlseUJvbnVzID0gbnVsbDtcblxuICAgIHRoaXMuYnRuRG91YmxlID0gbnVsbDtcbiAgICB0aGlzLmJ0bkNsYWltID0gbnVsbDtcblxuICAgIHRoaXMubGJsQ2xhaW0gPSBudWxsO1xuICAgIHRoaXMubGJsRG91YmxlID0gbnVsbDtcblxuICAgIHRoaXMuZGFpbHlCb251c05vZGVzID0gW107XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xuXG4gICAgdGhpcy5jdXJDb25maWcgPSBudWxsO1xuXG4gICAgdGhpcy5jbGFpbWVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKERhaWx5Qm9udXNDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoXyhcImRhaWx5X2JvbnVzX3RpdGxlXCIpKTtcbiAgICB0aGlzLmxibENsYWltLnNldFN0cmluZyhfKFwiY2xhaW1fdGl0bGVcIikpO1xuICAgIHRoaXMubGJsRG91YmxlLnNldFN0cmluZyhfKFwiZG91YmxlX3RpdGxlXCIpKTtcblxuICAgIHRoaXMuY29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldERhaWx5Qm9udXNMaXN0KCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuREFJTFlfQk9OVVNfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMubmREYWlseUJvbnVzLmdldENoaWxkQnlUYWcodGhpcy5EQUlMWV9CT05VU19UQUcgKyBpKTtcbiAgICAgICAgdmFyIGl0ZW1Ob2RlID0gRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5kYWlseUJvbnVzTm9kZXMucHVzaChpdGVtTm9kZSk7XG4gICAgICAgIG5vZGUuYWRkQ2hpbGQoaXRlbU5vZGUpO1xuICAgIH1cblxuICAgIHRoaXMuaW5pdFVJKCk7XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFVJID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsYXN0Q2xhaW1EYXkgPSBnYW1lLnBsYXllck1hbi5wbGF5ZXIubGFzdENsYWltRGFpbHlCb251c0RheTtcbiAgICB2YXIgY29uc2VjdXRpdmVEYXkgPSBnYW1lLnBsYXllck1hbi5jaGVja0NvbnNlY3V0aXZlTG9naW5EYXkoKTtcbiAgICB2YXIgY3VycmVudERheUNsYWltZWQgPSBsYXN0Q2xhaW1EYXkgPj0gZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpO1xuICAgIGNvbnNlY3V0aXZlRGF5ICU9IDc7XG4gICAgY29uc2VjdXRpdmVEYXkgPSBjb25zZWN1dGl2ZURheSB8fCA3O1xuICAgIHRoaXMuY2xhaW1lZCA9IGN1cnJlbnREYXlDbGFpbWVkO1xuXG4gICAgdGhpcy5idG5DbGFpbS5lbmFibGVkID0gIWN1cnJlbnREYXlDbGFpbWVkO1xuICAgIHRoaXMuYnRuRG91YmxlLmVuYWJsZWQgPSAhY3VycmVudERheUNsYWltZWQ7XG5cbiAgICBjYy5sb2coXCJjb25zZWN1dGl2ZURheTpcIiArIGNvbnNlY3V0aXZlRGF5ICsgXCIsZGFpbHlCb251c05vZGVzIGxlbmd0aDpcIiArIHRoaXMuZGFpbHlCb251c05vZGVzLmxlbmd0aCArIFwiLGN1cnJlbnREYXlDbGFpbWVkOlwiICsgY3VycmVudERheUNsYWltZWQpO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDc7ICsraSkge1xuICAgICAgICBjYy5sb2coXCJpbml0VUk6XCIgKyBpKTtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnc1tpIC0gMV07XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5kYWlseUJvbnVzTm9kZXNbaSAtIDFdO1xuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcImRhaWx5IGJvbnVzIG5vZGUgaXMgbnVsbDpcIiArIGkpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBub2RlLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICghY29udHJvbGxlcikge1xuICAgICAgICAgICAgY2MubG9nKFwiZGFpbHkgYm9udXMgY29udHJvbGxlciBpcyBudWxsOlwiICsgaSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA8IGNvbnNlY3V0aXZlRGF5KSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgZmFsc2UsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGkgPT09IGNvbnNlY3V0aXZlRGF5KSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgdHJ1ZSwgY3VycmVudERheUNsYWltZWQpO1xuICAgICAgICAgICAgdGhpcy5jdXJDb25maWcgPSBjb25maWc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb25zZWN1dGl2ZURheSA9PT0gMykge1xuICAgICAgICB0aGlzLmJ0bkRvdWJsZS5lbmFibGVkID0gZmFsc2U7XG4gICAgfVxufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwQ2xhaW1SZXdhcmQgPSBmdW5jdGlvbiAoY29uZmlnLCBkb3VibGUsIGNhbGxiYWNrKSB7XG4gICAgLy92YXIgY291bnQgPSBkb3VibGUgPyBjb25maWcuY291bnQgKiAyIDogY29uZmlnLmNvdW50O1xuICAgIHZhciBwYXJhbSA9IGRvdWJsZSA/IDIgOiAxO1xuICAgIHZhciBjb3VudCA9IGNvbmZpZy5jb3VudDtcbiAgICB2YXIgc3BsaXRDb3VudCA9IDA7XG4gICAgdmFyIHRocmVlQmFsbENvdW50ID0gMDtcbiAgICBpZiAoY29uZmlnLnR5cGUgPT09IEJvb3N0VHlwZS5TUExJVCkge1xuICAgICAgICBzcGxpdENvdW50ID0gY291bnQ7XG4gICAgfSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gQm9vc3RUeXBlLlRIUkVFX0JBTEwpIHtcbiAgICAgICAgdGhyZWVCYWxsQ291bnQgPSBjb3VudDtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSBCb29zdFR5cGUuR0lGVCkge1xuICAgICAgICBzcGxpdENvdW50ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50SW5SYW5nZSgyLCA0KTtcbiAgICAgICAgdGhyZWVCYWxsQ291bnQgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKDIsIDQpO1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09IEJvb3N0VHlwZS5TS0lOKSB7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmROb3RpY2VEbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInNraW5fY2xhaW1lZFwiKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihjb25maWcuYXJnMSk7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgY29uZmlnLmltYWdlLCAxKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09IEJvb3N0VHlwZS5ESUFNT05EKSB7XG4gICAgICAgIHZhciBkaWFtb25kQ291bnQgPSBjb25maWcuY291bnQ7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmROb3RpY2VEbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJld2FyZF92aWRlb19kaWFtb25kc1wiKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyhkaWFtb25kQ291bnQpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGNvbmZpZy5pbWFnZSwgZGlhbW9uZENvdW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzcGxpdENvdW50ID0gc3BsaXRDb3VudCAqIHBhcmFtO1xuICAgIHRocmVlQmFsbENvdW50ID0gdGhyZWVCYWxsQ291bnQgKiBwYXJhbTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwQm9vc3RSZXdhcmREbGcoc3BsaXRDb3VudCwgdGhyZWVCYWxsQ291bnQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICB9KTtcbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5jbGFpbUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKCF0aGlzLmNsYWltZWQpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLnBvcHVwQ2xhaW1SZXdhcmQodGhpcy5jdXJDb25maWcsIGZhbHNlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLnNldENsYWltZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5kb3VibGVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICghdGhpcy5jbGFpbWVkKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInNodWFuZ2JlaWxpYmFvXCIgOiBcImRhaWx5Ym9udXNcIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcHVwQ2xhaW1SZXdhcmQodGhpcy5jdXJDb25maWcsIHRydWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDbGFpbWVkKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5zZXRDbGFpbWVkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUucGxheWVyTWFuLnNldExhc3RDbGFpbURhaWx5Qm9udXNEYXkoZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpKTtcbiAgICB0aGlzLmNsYWltZWQgPSB0cnVlO1xufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKFwiRGFpbHlCb251c0l0ZW1Db250cm9sbGVyXCIsIG5ldyBEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgLy9jYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIlRpdGxlQ29udHJvbGxlclwiLCBuZXcgVGl0bGVDb250cm9sbGVyKCkpO1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9kYWlseV9ib251c192aWV3LmNjYmlcIiwgbnVsbCwgXCJEYWlseUJvbnVzQ29udHJvbGxlclwiLCBuZXcgRGFpbHlCb251c0NvbnRyb2xsZXIoKSk7XG4gICAgY2MuQnVpbGRlclJlYWRlci5fY29udHJvbGxlckNsYXNzQ2FjaGVbXCJEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXJcIl0gPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhaWx5Qm9udXNDb250cm9sbGVyOyIsInZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BCbGFjayA9IG51bGw7XG4gICAgdGhpcy5zcEl0ZW0gPSBudWxsO1xuICAgIHRoaXMuc3BDdXJyZW50ID0gbnVsbDtcbiAgICB0aGlzLnNwQ2xhaW1lZCA9IG51bGw7XG4gICAgdGhpcy5sYmxDb3VudCA9IG51bGw7XG4gICAgdGhpcy5sYmxEYXkgPSBudWxsO1xuXG4gICAgdGhpcy5kYWlseUJvbnVzQ2ZnID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkRhaWx5Qm9udXNJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcbi8qKlxuICogQHBhcmFtIHtEYWlseUJvbnVzQ29uZmlnfSBkYXRhXG4gKiBAcGFyYW0ge251bWJlcn0gZGF5XG4gKiBAcGFyYW0ge2Jvb2xlYW59IGN1cnJlbnRcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xhaW1lZFxuICovXG4vL2RheSwgc3RhdGUsIHJld2FyZE9iaiwgY2xhaW1lZFxuRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBkYXksIGN1cnJlbnQsIGNsYWltZWQpIHtcbiAgICB0aGlzLmRhaWx5Qm9udXNDZmcgPSBkYXRhO1xuXG4gICAgaWYgKGRhdGEudHlwZSA9PT0gQm9vc3RUeXBlLlNLSU4pIHtcbiAgICAgICAgdmFyIGdldHRlZCA9IGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5hcmcxKTtcbiAgICAgICAgaWYgKGdldHRlZCkge1xuICAgICAgICAgICAgZGF0YS50eXBlID0gZGF0YS5leHRyYS50eXBlO1xuICAgICAgICAgICAgZGF0YS5jb3VudCA9IGRhdGEuZXh0cmEuY291bnQ7XG4gICAgICAgICAgICBkYXRhLmltYWdlID0gZGF0YS5leHRyYS5pbWFnZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3BCbGFjay52aXNpYmxlID0gY2xhaW1lZDtcbiAgICB0aGlzLnNwSXRlbS5zZXRTcHJpdGVGcmFtZShkYXRhLmltYWdlKTtcbiAgICAvL2dhbWUudXRpbHMuc2NhbGVDQ0xhYmVsQk1Gb250KHRoaXMuc3BJdGVtLCA1OSk7XG4gICAgaWYgKCFjbGFpbWVkKSB7XG4gICAgICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSBjdXJyZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLnNwQ2xhaW1lZC52aXNpYmxlID0gY2xhaW1lZDtcbiAgICB0aGlzLmxibENvdW50LnNldFN0cmluZyhcInhcIiArIGRhdGEuY291bnQpO1xuICAgIHRoaXMubGJsRGF5LnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImRheV90aXRsZVwiKSwgZGF5KSk7XG59O1xuXG5EYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmdldENvbnRlbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwQmdTZWxlY3RlZC5nZXRDb250ZW50U2l6ZSgpO1xufTtcblxuRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9kYWlseV9ib251c19pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkRhaWx5Qm9udXNJdGVtQ29udHJvbGxlclwiLCBuZXcgRGFpbHlCb251c0l0ZW1Db250cm9sbGVyKCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIEZhaWxDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG5cbiAgICB0aGlzLnNwRmFpbENuID0gbnVsbDtcbiAgICB0aGlzLnNwRmFpbEVuID0gbnVsbDtcblxuICAgIHRoaXMubGJsUmV3YXJkID0gbnVsbDtcbiAgICAvL3RoaXMubGJsUmVsaWZlID0gbnVsbDtcbiAgICB0aGlzLmxibFdoZWVsID0gbnVsbDtcblxuICAgIHRoaXMubGJsU2tpcCA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEZhaWxDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfcG9wZWRcIiwgdGhpcy5vbkRpYWxvZ1BvcGVkLCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKFwiZGlhbG9nX2Nsb3NlZFwiLCB0aGlzLm9uRGlhbG9nQ2xvc2VkLCB0aGlzKTtcbiAgICB0aGlzLnJlbW92ZU5hdGl2ZUFkKCk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgdGhpcy5zaG93TmF0aXZlQWQoKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ1BvcGVkID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlTmF0aXZlQWQoKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ0Nsb3NlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlTmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuZGlhbG9nTWFuYWdlci5pc1RvcGVzdERpYWxvZyh0aGlzLnJvb3ROb2RlKSkge1xuICAgICAgICB0aGlzLnNob3dOYXRpdmVBZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbiAgICB9XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd05hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuYWRzTWFuYWdlci5zaG93TmF0aXZlQWQoXCJmYWlsXCIsIDAsIDApO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLnJlbW92ZU5hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVOYXRpdmVBZChcImZhaWxcIik7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJsV2hlZWwuc2V0U3RyaW5nKF8oXCJsdWNreV93aGVlbF90aXRsZVwiKSk7XG4gICAgdGhpcy5sYmxSZXdhcmQuc2V0U3RyaW5nKF8oXCJ3YXRjaF9hZHNfZ2V0X2Jvb3N0c1wiKSk7XG4gICAgdGhpcy5sYmxTa2lwLnNldFN0cmluZyhfKFwic2tpcF9sZXZlbF90aXRsZVwiKSk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJmYWlsXCIpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHJlcGxheUNhbGxiYWNrLCBza2lwQ2FsbGJhY2spIHtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IHJlcGxheUNhbGxiYWNrO1xuICAgIHRoaXMuX3NraXBDYWxsYmFjayA9IHNraXBDYWxsYmFjaztcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkFuaW1FbmQgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUucmVzdGFydENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd0FkcyhmYWxzZSk7XG4gICAgaWYgKHRoaXMuX3JlcGxheUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5ob21lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zaG93QWRzKGZhbHNlKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLk1FTlUpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIC8vZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcImZhaWxnaWZ0XCIgOiBcImppbGkwNlwiLCBudWxsLCBcIkZhaWxBbmRXYXRjaERpYW1vbmRzQWRzXCIpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLnJlbGlmZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgLy9nYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIC8vdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIC8vU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhmdW5jdGlvbiAoKSB7XG4gICAgLy99KTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5za2lwQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInRpYW9ndW8wMVwiIDogXCJza2lwXCIsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoQWRzVG9Ta2lwTGV2ZWxcIiwge1wibGV2ZWxcIjogR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWR9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9za2lwQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUud2hlZWxDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBXaGVlbERsZygpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2UvZmFpbF92aWV3LmNjYmlcIiwgbnVsbCwgXCJGYWlsQ29udHJvbGxlclwiLCBuZXcgRmFpbENvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZhaWxDb250cm9sbGVyOyIsInZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIEJyaWNrc1ZpZXcgPSByZXF1aXJlKFwiLi4vdmlldy9Ccmlja3NWaWV3XCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgSGVscENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9IZWxwQ29udHJvbGxlclwiKTtcbnZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG5cbnZhciBHYW1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuTElGRV9TVEFSVF9UQUcgPSAxMDA7XG4gICAgdGhpcy5MSUZFX0NPVU5UID0gNjtcblxuICAgIHRoaXMubmRMaWZlTm9kZSA9IG51bGw7XG4gICAgdGhpcy5sYlRpbWUgPSBudWxsO1xuICAgIHRoaXMubGIzTmV3ID0gbnVsbDtcbiAgICB0aGlzLmxiM011bHRpcGxlID0gbnVsbDtcbiAgICB0aGlzLl9nYW1lTm9kZSA9IG51bGw7XG4gICAgdGhpcy5uZEhlbHAgPSBudWxsO1xuXG4gICAgdGhpcy5uZEJvb3N0MSA9IG51bGw7XG4gICAgdGhpcy5uZEJvb3N0MiA9IG51bGw7XG5cbiAgICB0aGlzLm5kTGlmZU5vZGVzID0gbnVsbDtcblxuICAgIHRoaXMuc3BUb3BQcm9ncmVzcyA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93MSA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzIgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3czID0gbnVsbDtcblxuICAgIHRoaXMuc3BCbGFjazEgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazIgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazMgPSBudWxsO1xuXG4gICAgdGhpcy5sYkxldmVsID0gbnVsbDtcblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW107XG4gICAgdGhpcy5zcEJsYWNrcyA9IFtdO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhHYW1lQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0xFVkVMLCB0aGlzLm9uVXBkYXRlTGV2ZWwsIHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRUZSRVNIX0JPT1NULCB0aGlzLm9uVXBkYXRlQm9vc3QsIHRoaXMpO1xuXG4gICAgLy90aGlzLm5kQm9vc3QxLnJ1bkFjdGlvbigpO1xufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuUkVGUkVTSF9CT09TVCwgdGhpcy5vblVwZGF0ZUJvb3N0LCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0xFVkVMLCB0aGlzLm9uVXBkYXRlTGV2ZWwsIHRoaXMpO1xuICAgIHRoaXMuX2dhbWVDb3JlTm9kZSA9IG51bGw7XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5uZExpZmVOb2RlcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5MSUZFX0NPVU5UOyArK2kpIHtcbiAgICAgICAgdmFyIGxpZmVOb2RlID0gdGhpcy5uZExpZmVOb2RlLmdldENoaWxkQnlUYWcodGhpcy5MSUZFX1NUQVJUX1RBRyArIGkpO1xuICAgICAgICB0aGlzLm5kTGlmZU5vZGVzLnB1c2gobGlmZU5vZGUpO1xuICAgIH1cblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuICAgIHRoaXMuc3BCbGFja3MgPSBbdGhpcy5zcEJsYWNrMSwgdGhpcy5zcEJsYWNrMiwgdGhpcy5zcEJsYWNrM107XG5cbiAgICB2YXIgY29uZmlnID0gbnVsbDtcbiAgICB2YXIgbGV2ZWxJZCA9IG51bGw7XG4gICAgaWYgKHdpbmRvdy5pc0VkaXRvcikge1xuICAgICAgICBjb25maWcgPSBnYW1lLmdhbWVNYW4ubGV2ZWxDZmc7XG4gICAgICAgIGxldmVsSWQgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmZpZyA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDdXJDb25maWcoKTtcbiAgICAgICAgbGV2ZWxJZCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5sZXZlbElkO1xuICAgIH1cblxuICAgIHRoaXMuX2dhbWVDb3JlTm9kZSA9IG5ldyBCcmlja3NWaWV3KGNvbmZpZywgdGhpcyk7XG4gICAgdGhpcy5fZ2FtZU5vZGUuYWRkQ2hpbGQodGhpcy5fZ2FtZUNvcmVOb2RlKTtcblxuICAgIHRoaXMubGJMZXZlbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJsZXZlbF90aXRsZVwiKSwgbGV2ZWxJZCkpO1xuXG4gICAgdGhpcy51cGRhdGVMaWZlQ291bnQoKTtcbiAgICB0aGlzLnVwZGF0ZUJvb3N0KCk7XG5cbiAgICB2YXIgZmlyc3RFbnRlciA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImZpcnN0X2VudGVyXCIsIFwidHJ1ZVwiKTtcbiAgICBpZiAoZmlyc3RFbnRlciA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgdGhpcy5uZEhlbHAudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZEhlbHAudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlVGltZSgpO1xufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZUxpZmVDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm93TGlmZUNvdW50ID0gdGhpcy5fZ2FtZUNvcmVOb2RlLmxpZmVDb3VudDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuTElGRV9DT1VOVDsgKytpKSB7XG4gICAgICAgIHZhciBsaWZlTm9kZSA9IHRoaXMubmRMaWZlTm9kZXNbaV07XG4gICAgICAgIGlmIChsaWZlTm9kZSkge1xuICAgICAgICAgICAgbGlmZU5vZGUudmlzaWJsZSA9IChub3dMaWZlQ291bnQgPiBpKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZUJvb3N0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlQm9vc3QoKTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVCb29zdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxiM05ldy5zZXRTdHJpbmcoZ2FtZS5wbGF5ZXJNYW4uZ2V0Qm9vc3RDb3VudChCb29zdFR5cGUuVEhSRUVfQkFMTCkpO1xuICAgIHRoaXMubGIzTXVsdGlwbGUuc2V0U3RyaW5nKGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlNQTElUKSk7XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlVGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY29zdFRpbWUgPSAwO1xuICAgIGlmICh0aGlzLl9nYW1lQ29yZU5vZGUuZWNsaXBzZWRUaW1lKSB7XG4gICAgICAgIGNvc3RUaW1lID0gdGhpcy5fZ2FtZUNvcmVOb2RlLmVjbGlwc2VkVGltZSAvIDEwMDA7XG4gICAgfVxuICAgIHRoaXMubGJUaW1lLnNldFN0cmluZyhnYW1lLnV0aWxzLmdldExvbmdGb3JtYXRUaW1lKGNvc3RUaW1lKSk7XG5cbiAgICB2YXIgcGVyY2VudCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQcm9ncmVzc1BlcmNlbnQoY29zdFRpbWUpO1xuICAgIHRoaXMuc3BUb3BQcm9ncmVzcy5zZXRQcmVmZXJyZWRTaXplKGNjLnNpemUoMTUwICogcGVyY2VudCAqIDAuMDEsIDgpKTtcbiAgICB2YXIgc3RhciA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDdXJyZW50U3Rhcihjb3N0VGltZSk7XG4gICAgdGhpcy51cGRhdGVTdGFyKHN0YXIpO1xufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVN0YXIgPSBmdW5jdGlvbiAoc3Rhcikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgKytpKSB7XG4gICAgICAgIHRoaXMuc3BZZWxsb3dzW2ldLnZpc2libGUgPSAoc3RhciA+PSBpICsgMSk7XG4gICAgICAgIHRoaXMuc3BCbGFja3NbaV0udmlzaWJsZSA9IChzdGFyIDwgaSArIDEpO1xuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5wYXVzZUNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHdpbmRvdy5pc0VkaXRvcikge1xuICAgICAgICB2YXIgRWRpdG9yU2NlbmUgPSByZXF1aXJlKFwiLi4vZWRpdG9yL3NjZW5lL0VkaXRvclNjZW5lXCIpO1xuICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShuZXcgRWRpdG9yU2NlbmUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93UGF1c2UoKTtcbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd1BhdXNlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2dhbWVDb3JlTm9kZS5zdG9wKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBQYXVzZURsZyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuX2dhbWVDb3JlTm9kZS5yZXN1bWUoKTtcbiAgICB9KTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5zdG9yZUNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnN0b3AoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKFN0b3JlVHlwZS5ESUFNT05ELCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuX2dhbWVDb3JlTm9kZS5yZXN1bWUoKTtcbiAgICB9KTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5uZXczQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4udXNlQm9vc3QoQm9vc3RUeXBlLlRIUkVFX0JBTEwpKSB7XG4gICAgICAgIHRoaXMuX2dhbWVDb3JlTm9kZS51c2VOZXczQmFsbEJvb3N0KCk7XG4gICAgICAgIHRoaXMudXBkYXRlQm9vc3QoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgICAgICAvL0dhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zaG93QWRzKCk7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKFN0b3JlVHlwZS5ESUFNT05ELCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLl9nYW1lQ29yZU5vZGUucmVzdW1lKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5tdWx0aXBsZTNDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmIChnYW1lLnBsYXllck1hbi51c2VCb29zdChCb29zdFR5cGUuU1BMSVQpKSB7XG4gICAgICAgIHRoaXMuX2dhbWVDb3JlTm9kZS51c2VTcGxpdEJhbGxCb29zdCgpO1xuICAgICAgICB0aGlzLnVwZGF0ZUJvb3N0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnN0b3AoKTtcbiAgICAgICAgLy9HYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd0FkcygpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5fZ2FtZUNvcmVOb2RlLnJlc3VtZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgY2MuQnVpbGRlclJlYWRlci5yZWdpc3RlckNvbnRyb2xsZXIoXCJIZWxwQ29udHJvbGxlclwiLCBuZXcgSGVscENvbnRyb2xsZXIoKSk7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9nYW1lL2dhbWVfdmlldy5jY2JpXCIsIG51bGwsIFwiR2FtZUNvbnRyb2xsZXJcIiwgbmV3IEdhbWVDb250cm9sbGVyKCkpO1xuICAgIGNjLkJ1aWxkZXJSZWFkZXIuX2NvbnRyb2xsZXJDbGFzc0NhY2hlW1wiSGVscENvbnRyb2xsZXJcIl0gPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVDb250cm9sbGVyOyIsInZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgR2FtZU1vZGUgPSByZXF1aXJlKFwiLi4vZW51bS9HYW1lTW9kZVwiKTtcblxudmFyIEdhbWVPdmVyQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuX2Jlc3RTY29yZUxhYmVsID0gbnVsbDtcbiAgICB0aGlzLl9zY29yZUxhYmVsID0gbnVsbDtcblxuICAgIHRoaXMuX2ljb25FbmdsaXNoID0gbnVsbDtcbiAgICB0aGlzLl9pY29uQ2hpbmVzZSA9IG51bGw7XG4gICAgdGhpcy5fbmV3UmVjb3JkTGFiZWwgPSBudWxsO1xuXG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhHYW1lT3ZlckNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fbmV3UmVjb3JkTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChwZXJjZW50LCBjYWxsYmFjaykge1xuICAgIGlmIChHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2FtZU1vZGUgPT09IEdhbWVNb2RlLkdBTUVfTU9ERV9FTkRMRVNTKSB7XG4gICAgICAgIHRoaXMuX2Jlc3RTY29yZUxhYmVsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImJlc3Rfc2NvcmVfdGl0bGVcIiksIGdhbWUucGxheWVyTWFuLmdldEJlc3RTY29yZSgpKSk7XG4gICAgICAgIHRoaXMuX3Njb3JlTGFiZWwuc2V0U3RyaW5nKHBlcmNlbnQpO1xuICAgICAgICB0aGlzLl9uZXdSZWNvcmRMYWJlbC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIm5ld19yZWNvcmRfdGl0bGVcIikpO1xuICAgICAgICBpZiAoR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmlzTmV3UmVjb3JkKSB7XG4gICAgICAgICAgICB0aGlzLl9uZXdSZWNvcmRMYWJlbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX25ld1JlY29yZExhYmVsLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5mYWRlT3V0KDAuMyksIGNjLmZhZGVJbigwLjMpKS5yZXBlYXRGb3JldmVyKCkpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fYmVzdFNjb3JlTGFiZWwuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihnYW1lLmxvY2FsLmdldFZhbHVlKFwibGV2ZWxfdGl0bGVcIiksIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5sZXZlbENvbmZpZy5pZCkpO1xuICAgICAgICB0aGlzLl9zY29yZUxhYmVsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXCIlZCUlXCIsIHBlcmNlbnQpKTtcbiAgICB9XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUuaG9tZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHJlU2NlbmUgPSBuZXcgY2MuVHJhbnNpdGlvbkZhZGUoMC41LCBHYW1lQnJpZGdlLmdldE1lbnVTY2VuZSgpLCBjYy5jb2xvcigyNTUsIDI1NSwgMjU1KSk7XG4gICAgY2MuZGlyZWN0b3IucnVuU2NlbmUocmVTY2VuZSk7XG59O1xuXG5HYW1lT3ZlckNvbnRyb2xsZXIucHJvdG90eXBlLnJlcGxheUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMuX3JlcGxheUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUucmFua0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5nY01hbmFnZXIuc2hvd0xlYWRlcmJvYXJkKGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5zaGFyZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5zaGFyZU1hbmFnZXIuc2hhcmVXaXRoU3lzdGVtKGdhbWUudXRpbHMuc3ByaW50ZihnYW1lLmxvY2FsLmdldFZhbHVlKFwic2hhcmVfdGlwc1wiKSxcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uZ2V0QmVzdFNjb3JlKCksIGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSkpO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL2dhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbiAgICAvL2dhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7XCJvdmVybGF5T3BhY2l0eVwiOiAxMDB9KTtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge1wib3ZlcmxheUNvbG9yXCI6IGNjLmNvbG9yKDI0MywgMjQzLCAyNDMpLCBcIm92ZXJsYXlPcGFjaXR5XCI6IDIxMH0pO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5HYW1lT3ZlckNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9nYW1lX292ZXJfdmlldy5jY2JpXCIsIG51bGwsIFwiR2FtZU92ZXJDb250cm9sbGVyXCIsIG5ldyBHYW1lT3ZlckNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVPdmVyQ29udHJvbGxlcjsiLCJ2YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xuXG52YXIgR2FtZVdpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLllFTExPV19DT0xPUiA9IGNjLmNvbG9yKDI1NCwgMTc1LCAyNSk7XG5cbiAgICB0aGlzLl9uZXh0Tm9kZSA9IG51bGw7XG5cbiAgICB0aGlzLl9yZXN1bHRMYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoR2FtZVdpbkNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX3Jlc3VsdExhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwibWlzc2lvbl9jb21wbGV0ZWRfdGl0bGVcIikpO1xuICAgIHZhciBoYXNOZXh0TGV2ZWwgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuaGFzTmV4dExldmVsKCk7XG4gICAgaWYgKCFoYXNOZXh0TGV2ZWwpIHtcbiAgICAgICAgdGhpcy5fbmV4dE5vZGUudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB0aGlzLl9uZXh0Q2FsbGJhY2sgPSBuZXh0Q2FsbGJhY2s7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUuaG9tZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHJlU2NlbmUgPSBuZXcgY2MuVHJhbnNpdGlvbkZhZGUoMC41LCBHYW1lQnJpZGdlLmdldE1lbnVTY2VuZSgpLCBjYy5jb2xvcigyNTUsIDI1NSwgMjU1KSk7XG4gICAgY2MuZGlyZWN0b3IucnVuU2NlbmUocmVTY2VuZSk7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUubmV4dENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMuX25leHRDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9uZXh0Q2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLnJlcGxheUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgaWYgKHRoaXMuX3JlcGxheUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5yYW5rQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLmdjTWFuYWdlci5zaG93TGVhZGVyYm9hcmQoZ2FtZS5jb25maWcuZ2V0TGVhZGVyQm9hcmRLZXkoKSk7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUuc2hhcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnNoYXJlV2l0aFN5c3RlbShnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInNoYXJlX3RpcHNcIiksXG4gICAgICAgIGdhbWUucGxheWVyTWFuLmdldEJlc3RTY29yZSgpLCBnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpKTtcbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge1wib3ZlcmxheUNvbG9yXCI6IGNjLmNvbG9yKDI0MywgMjQzLCAyNDMpLCBcIm92ZXJsYXlPcGFjaXR5XCI6IDIxMH0pO1xufTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvZ2FtZV93aW5fdmlldy5jY2JpXCIsIG51bGwsIFwiR2FtZVdpbkNvbnRyb2xsZXJcIiwgbmV3IEdhbWVXaW5Db250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lV2luQ29udHJvbGxlcjsiLCJcblxudmFyIEhlbHBDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYkhlbHBJbmZvID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoSGVscENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuSGVscENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiSGVscEluZm8uc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJoZWxwX2NvbnRlbnRcIikpO1xuICAgIHRoaXMubGJIZWxwSW5mby5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSGVscENvbnRyb2xsZXI7IiwidmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9HYW1lU2NlbmVcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgTXVsdGlDb2xUYWJsZVZpZXcgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2V4dC9NdWx0aUNvbFRhYmxlVmlld1wiKTtcbnZhciBMZXZlbEl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vTGV2ZWxJdGVtQ29udHJvbGxlclwiKTtcbnZhciBMZXZlbENvbmZpZ01hbiA9IHJlcXVpcmUoXCIuLi9jb25maWcvQ29uZmlnTWFuXCIpO1xudmFyIExvY2tTdGF0dXMgPSByZXF1aXJlKFwiLi4vZW51bS9Mb2NrU3RhdHVzXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBUaXRsZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9UaXRsZUNvbnRyb2xsZXJcIik7XG5cbnZhciBHUklEX1NJWkUgPSBbMTM3LjUsIDEyMF07XG5cbnZhciBMZXZlbEl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbiAgICBsZXZlbEVudGl0eTogbnVsbCxcbiAgICBsZXZlbEl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5sZXZlbEl0ZW1Ob2RlID0gTGV2ZWxJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5sZXZlbEl0ZW1Ob2RlKTtcblxuICAgICAgICB0aGlzLmxldmVsSXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkVbMF0gKiAwLjUsIEdSSURfU0laRVsxXSAqIDAuNSkpO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aDogZnVuY3Rpb24gKGxldmVsRW50aXR5LCBpZHgpIHtcbiAgICAgICAgdGhpcy5sZXZlbEVudGl0eSA9IGxldmVsRW50aXR5O1xuICAgICAgICB0aGlzLmxldmVsSXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChsZXZlbEVudGl0eSwgaWR4KTtcbiAgICB9LFxuXG4gICAgc2hvd0FwcGVhckFuaW06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sZXZlbEl0ZW1Ob2RlLmNvbnRyb2xsZXIuc2hvd0FwcGVhckFuaW0oKTtcbiAgICB9LFxuXG4gICAgc2hvd0Rpc2FwcGVhckFuaW06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sZXZlbEl0ZW1Ob2RlLmNvbnRyb2xsZXIuc2hvd0Rpc2FwcGVhckFuaW0oKTtcbiAgICB9XG59KTtcblxudmFyIExldmVsQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRDb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMubGJMZXZlbE5hbWUgPSBudWxsO1xuXG4gICAgLy91c2VyIGRhdGEuXG4gICAgdGhpcy5fbGV2ZWxMaXN0ID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTGV2ZWxDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5fbGV2ZWxMaXN0ID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldExldmVsTGlzdCgpO1xuICAgIHRoaXMuc2hvd0xldmVsVGFibGVWaWV3KCk7XG5cbiAgICB2YXIgdXNlckxldmVsID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFBsYXllckxldmVsKCk7XG4gICAgaWYgKHVzZXJMZXZlbCA+IHRoaXMuX2xldmVsTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgdXNlckxldmVsID0gMTtcbiAgICB9XG4gICAgdmFyIGN1clJvdyA9IDA7XG4gICAgaWYgKHVzZXJMZXZlbCAlIHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbCgpID09PSAwKSB7XG4gICAgICAgIGN1clJvdyA9IE1hdGguZmxvb3IodXNlckxldmVsIC8gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGN1clJvdyA9IE1hdGguZmxvb3IodXNlckxldmVsIC8gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKCkpICsgMTtcbiAgICB9XG5cbiAgICB2YXIgeU9mZnNldCA9IC0odGhpcy5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcoKSAtIGN1clJvdyArIDEpICogdGhpcy5ncmlkU2l6ZUZvclRhYmxlKCkuaGVpZ2h0ICtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LmdldFZpZXdTaXplKCkuaGVpZ2h0O1xuXG4gICAgaWYgKHlPZmZzZXQgPCB0aGlzLl90YWJsZVZpZXcubWluQ29udGFpbmVyT2Zmc2V0KCkueSkge1xuICAgICAgICB5T2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpLnk7XG4gICAgfSBlbHNlIGlmICh5T2Zmc2V0ID49IHRoaXMuX3RhYmxlVmlldy5tYXhDb250YWluZXJPZmZzZXQoKS55KSB7XG4gICAgICAgIHlPZmZzZXQgPSB0aGlzLl90YWJsZVZpZXcubWF4Q29udGFpbmVyT2Zmc2V0KCkueTtcbiAgICB9XG5cbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldChjYy5wKDAsIHlPZmZzZXQpKTtcbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0xldmVsVGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzaXplID0gdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpO1xuICAgIHRoaXMuX3RhYmxlVmlldyA9IG5ldyBNdWx0aUNvbFRhYmxlVmlldyh0aGlzLCBzaXplLCBudWxsKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX1ZFUlRJQ0FMKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgdGhpcy5fdGFibGVWaWV3LnNldE11bHRpVGFibGVWaWV3RGVsZWdhdGUodGhpcyk7XG4gICAgdGhpcy5fdGFibGVWaWV3Lmlnbm9yZUFuY2hvclBvaW50Rm9yUG9zaXRpb24oZmFsc2UpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRoaXMuX3RhYmxlVmlldyk7XG4gICAgdGhpcy5fdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRab29tID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZEF0SW5kZXggPSBmdW5jdGlvbihtdWx0aVRhYmxlLCAgaWR4KSB7XG4gICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICAgIGNlbGwgPSBuZXcgTGV2ZWxJdGVtQ2VsbFZpZXcoKTtcbiAgICB9XG5cbiAgICBpZiAoaWR4IDwgdGhpcy5fbGV2ZWxMaXN0Lmxlbmd0aCkge1xuICAgICAgICB2YXIgbGV2ZWxFbnRpdHkgPSB0aGlzLl9sZXZlbExpc3RbaWR4XTtcbiAgICAgICAgY2VsbC5pbml0V2l0aChsZXZlbEVudGl0eSwgaWR4KTtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2VsbDtcbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3ID0gZnVuY3Rpb24obXVsdGlUYWJsZSkge1xuICAgIHZhciBncmlkc0luQ2VsbCA9IHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbChtdWx0aVRhYmxlKTtcbiAgICBpZiAodGhpcy5fbGV2ZWxMaXN0Lmxlbmd0aCAlIGdyaWRzSW5DZWxsID09PSAwKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMuX2xldmVsTGlzdC5sZW5ndGggLyBncmlkc0luQ2VsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5fbGV2ZWxMaXN0Lmxlbmd0aCAvIGdyaWRzSW5DZWxsKSArIDE7XG4gICAgfVxufTtcblxuTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5udW1iZXJPZkdyaWRzSW5DZWxsID0gZnVuY3Rpb24obXVsdGlUYWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIDQ7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRTaXplRm9yVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIGNjLnNpemUoR1JJRF9TSVpFWzBdLCBHUklEX1NJWkVbMV0pO1xufTtcblxuTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkVG91Y2hlZCA9IGZ1bmN0aW9uKHRhYmxlLCBncmlkKSB7XG4gICAgLy9jb25zb2xlLmxvZyhcImdyaWQgdG91Y2hlZCBhdCBpbmRleDogXCIgKyBncmlkLmdldElkeCgpKTtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAoZ3JpZC5nZXRJZHgoKSA8IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQbGF5ZXJMZXZlbCgpKSB7XG4gICAgICAgIGlmICh0aGlzLmNsaWNrZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsaWNrZWQgPSB0cnVlO1xuICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuY2hvb3NlTGV2ZWwoZ3JpZC5nZXRJZHgoKSArIDEpO1xuICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgIH1cbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbn07XG5cbkxldmVsQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2xldmVsX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkxldmVsQ29udHJvbGxlclwiLCBuZXcgTGV2ZWxDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMZXZlbENvbnRyb2xsZXI7IiwidmFyIExvY2tTdGF0dXMgPSByZXF1aXJlKFwiLi4vZW51bS9Mb2NrU3RhdHVzXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIExldmVsSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJMZXZlbCA9IG51bGw7XG4gICAgdGhpcy5zcFBsYXllZCA9IG51bGw7XG4gICAgdGhpcy5zcExvY2tlZCA9IG51bGw7XG5cbiAgICB0aGlzLnNwQ3VycmVudCA9IG51bGw7XG5cbiAgICB0aGlzLm5kU3RhciA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93MSA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzIgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3czID0gbnVsbDtcblxuICAgIHRoaXMuc3BCbGFjazEgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazIgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazMgPSBudWxsO1xuXG4gICAgdGhpcy5zcFllbGxvd3MgPSBbXTtcbiAgICB0aGlzLnNwQmxhY2tzID0gW107XG5cbiAgICB0aGlzLmlkeCA9IDA7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKExldmVsSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuICAgIHRoaXMuc3BCbGFja3MgPSBbdGhpcy5zcEJsYWNrMSwgdGhpcy5zcEJsYWNrMiwgdGhpcy5zcEJsYWNrM107XG59O1xuXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93QXBwZWFyQW5pbSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLnV0aWxzLnJhbmRvbVNjYWxlQW5pbSh0aGlzLnJvb3ROb2RlLCAxLCAwLjgpO1xufTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0Rpc2FwcGVhckFuaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yb290Tm9kZS5ydW5BY3Rpb24oY2Muc2NhbGVUbygwLjQsIDApKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtMZXZlbENvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICovXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICBjYy5sb2coXCJMZXZlbEl0ZW1Db250cm9sbGVyIGluaXRXaXRoXCIpO1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMubGJMZXZlbC5zZXRTdHJpbmcoaWR4ICsgMSk7XG4gICAgdmFyIGxldmVsID0gaWR4ICsgMTtcblxuICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwTG9ja2VkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwUGxheWVkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kU3Rhci52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5sYkxldmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHZhciBjdXJMZXZlbCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQbGF5ZXJMZXZlbCgpO1xuICAgIGlmIChjdXJMZXZlbCA9PT0gaWR4ICsgMSkge1xuICAgICAgICB0aGlzLnNwQ3VycmVudC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYkxldmVsLnkgPSAwO1xuICAgIH0gZWxzZSBpZiAoY3VyTGV2ZWwgPiBpZHggKyAxKSB7XG4gICAgICAgIHRoaXMuc3BQbGF5ZWQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRTdGFyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB2YXIgc3RhciA9IDA7XG4gICAgICAgIGlmIChHYW1lTWFuLmdldEluc3RhbmNlKCkuaXNIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICBzdGFyID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0SGFyZExldmVsU3RhcihsZXZlbCkgfHwgMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbFN0YXIobGV2ZWwpIHx8IDA7XG4gICAgICAgIH1cbiAgICAgICAgY2MubG9nKFwiTGV2ZWxJdGVtQ29udHJvbGxlciBzdGFyOlwiICsgc3Rhcik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLnNwWWVsbG93c1tpXS52aXNpYmxlID0gKHN0YXIgPj0gaSArIDEpO1xuICAgICAgICAgICAgdGhpcy5zcEJsYWNrc1tpXS52aXNpYmxlID0gKHN0YXIgPCBpICsgMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYkxldmVsLnkgPSAxMTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxiTGV2ZWwueSA9IDA7XG4gICAgICAgIC8vdGhpcy5sYkxldmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zcExvY2tlZC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG59O1xuXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5sZXZlbENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMuaWR4IDwgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFBsYXllckxldmVsKCkpIHtcbiAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmNob29zZUxldmVsKHRoaXMuaWR4ICsgMSk7XG4gICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgfVxufTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q29udGVudFNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BQbGF5ZWQuZ2V0Q29udGVudFNpemUoKTtcbn07XG5cbkxldmVsSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2xldmVsX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiTGV2ZWxJdGVtQ29udHJvbGxlclwiLCBuZXcgTGV2ZWxJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxJdGVtQ29udHJvbGxlcjsiLCJ2YXIgTWVudVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL01lbnVTY2VuZVwiKTtcbnZhciBQbGF5ZXJNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvUGxheWVyTWFuXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9HYW1lU2NlbmVcIik7XG52YXIgU2NlbmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2NlbmVUeXBlXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBTY2VuZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TY2VuZU1hblwiKTtcbnZhciBBZHNSZW1pbmRlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9BZHNSZW1pbmRlckNvbnRyb2xsZXJcIik7XG5cbnZhciBMb2FkaW5nQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuYmdFblNwcml0ZSA9IG51bGw7XG4gICAgdGhpcy5iZ0NuU3ByaXRlID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTG9hZGluZ0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTG9hZGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcblxuICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKFwiQWRzUmVtaW5kZXJDb250cm9sbGVyXCIsIG5ldyBBZHNSZW1pbmRlckNvbnRyb2xsZXIoKSk7XG5cbiAgICBnYW1lLnBsYXllck1hbiA9IFBsYXllck1hbi5nZXRJbnN0YW5jZSgpO1xuICAgIGdhbWUucGxheWVyTWFuLmluaXREYXRhKCk7XG5cbiAgICB2YXIgTG9naWNNYW4gPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL21vZGVsL0xvZ2ljTWFuXCIpO1xuICAgIExvZ2ljTWFuLmdldEluc3RhbmNlKCkuc3RhcnRHYW1lKHRydWUpO1xuXG4gICAgZ2FtZS5zY2VuZU1hbiA9IFNjZW5lTWFuLmdldEluc3RhbmNlKCk7XG4gICAgZ2FtZS5zY2VuZVR5cGUgPSBTY2VuZVR5cGU7XG5cbiAgICBnYW1lLmdhbWVNYW4uaW5pdCgpO1xuICAgIGdhbWUuZ2FtZU1hbi5hZGp1c3RTa2luQ29uZmlncygpO1xuXG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiTG9hZGluZ1wiKTtcbiAgICB2YXIgaXNGaXJzdEVudGVyR2FtZSA9IHRydWU7XG4gICAgdmFyIGZpcnN0T3BlbkdhbWUgPSBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLmdldEl0ZW0oXCJmaXJzdE9wZW5HYW1lXCIsIFwidHJ1ZVwiKTtcbiAgICBpZiAoZmlyc3RPcGVuR2FtZSAhPSBcInRydWVcIikge1xuICAgICAgICBpc0ZpcnN0RW50ZXJHYW1lID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFwiZmlyc3RPcGVuR2FtZVwiLCBcImZhbHNlXCIpO1xuICAgIH1cblxuICAgIHZhciBteUxvZ28gPSBnYW1lLnV0aWxzLmlzU2VsZkdhbWUoKTtcblxuICAgIGNjLmxvZyhcImlzRmlyc3RFbnRlckdhbWU6XCIgKyBpc0ZpcnN0RW50ZXJHYW1lKTtcblxuICAgIHRoaXMuYmdDblNwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5iZ0VuU3ByaXRlLnZpc2libGUgPSBmYWxzZTtcbiAgICB2YXIgc3ByaXRlID0gbXlMb2dvID8gdGhpcy5iZ0NuU3ByaXRlIDogdGhpcy5iZ0VuU3ByaXRlO1xuICAgIHNwcml0ZS52aXNpYmxlID0gdHJ1ZTtcbiAgICBzcHJpdGUub3BhY2l0eSA9IDA7XG4gICAgc3ByaXRlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5mYWRlSW4oMC41KSwgY2MuZGVsYXlUaW1lKDIpLCBjYy5mYWRlT3V0KDAuNSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGlzRmlyc3RFbnRlckdhbWUpIHtcbiAgICAgICAgICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5jaG9vc2VMYXRlc3RMZXZlbCgpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkVudGVyRmlyc3RMZXZlbFwiKTtcbiAgICAgICAgICAgIC8vZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShTY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShuZXcgTWVudVNjZW5lKCkpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5pbml0KCk7XG4gICAgICAgIH0sIDEpO1xuICAgIH0sIHRoaXMpKSk7XG59O1xuXG5Mb2FkaW5nQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkxvYWRpbmdDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5Mb2FkaW5nQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2xvYWRpbmdfdmlldy5jY2JpXCIsIG51bGwsIFwiTG9hZGluZ0NvbnRyb2xsZXJcIiwgbmV3IExvYWRpbmdDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMb2FkaW5nQ29udHJvbGxlcjsiLCIvL3ZhciBQYWNrYWdlU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvUGFja2FnZVNjZW5lXCIpO1xuLy92YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4vL3ZhciBMZXZlbFNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0xldmVsU2NlbmVcIik7XG4vL3ZhciBHYW1lU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvR2FtZVNjZW5lXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG5nYW1lLmZpcnN0RW50ZXIgPSB0cnVlO1xuXG52YXIgTWVudUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BQbGF5RW4gPSBudWxsO1xuICAgIHRoaXMuc3BQbGF5Q24gPSBudWxsO1xuICAgIHRoaXMuc3BMZXZlbHNFbiA9IG51bGw7XG4gICAgdGhpcy5zcExldmVsc0NuID0gbnVsbDtcbiAgICB0aGlzLnNwSWNvbkVuID0gbnVsbDtcbiAgICB0aGlzLnNwSWNvbkNuID0gbnVsbDtcblxuICAgIHRoaXMuX3JhbmtJdGVtID0gbnVsbDtcbiAgICB0aGlzLl9zdXBwb3J0SXRlbSA9IG51bGw7XG4gICAgdGhpcy5fc3RvcmVJdGVtID0gbnVsbDtcbiAgICB0aGlzLl9yYXRlSXRlbSA9IG51bGw7XG4gICAgdGhpcy5fc291bmRJdGVtID0gbnVsbDtcblxuICAgIHRoaXMuc3BIYXJkQ24gPSBudWxsO1xuICAgIHRoaXMuc3BIYXJkRW4gPSBudWxsO1xuXG4gICAgdGhpcy5zcEhhcmRIaW50ID0gbnVsbDtcblxuICAgIHRoaXMuYnRuR2lmdEVuID0gbnVsbDtcbiAgICB0aGlzLmJ0bkdpZnRDbiA9IG51bGw7XG5cbiAgICB0aGlzLmJ0bldoZWVsQ24gPSBudWxsO1xuICAgIHRoaXMuYnRuV2hlZWxFbiA9IG51bGw7XG5cbiAgICB0aGlzLnNwR2lmdEJnID0gbnVsbDtcbiAgICB0aGlzLm5kU3BlY2lhbE9mZmVyID0gbnVsbDtcblxuICAgIHRoaXMubmRHaWZ0cyA9IG51bGw7XG5cbiAgICB0aGlzLnNwU2tpblJlbWluZGVyID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTWVudUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAvKlxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZmlyc3RPcGVuR2FtZSA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImZpcnN0T3BlbkdhbWVcIiwgXCJ0cnVlXCIpO1xuICAgICAgICBpZiAoZmlyc3RPcGVuR2FtZSAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgaWYgKGdhbWUuZmlyc3RFbnRlciAmJiBHYW1lTWFuLmdldEluc3RhbmNlKCkuaXNGcmVlV2hlZWwoKSkge1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBXaGVlbERsZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFwiZmlyc3RPcGVuR2FtZVwiLCBcImZhbHNlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUuZmlyc3RFbnRlciA9IGZhbHNlO1xuICAgIH0sIDMwMCk7XG4gICAgKi9cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGZpcnN0T3BlbkdhbWUgPSBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLmdldEl0ZW0oXCJmaXJzdE9wZW5HYW1lXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgaWYgKGZpcnN0T3BlbkdhbWUgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5jaGVja0F1dG9Qb3B1cCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFwiZmlyc3RPcGVuR2FtZVwiLCBcImZhbHNlXCIpO1xuICAgICAgICB9XG4gICAgfSwgMzAwKTtcbiAgICB0aGlzLnVwZGF0ZVNraW5SZW1pbmRlcigpO1xuICAgIC8vdGhpcy5pbnRlcnZhbEtleSA9IHNldEludGVydmFsKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSwgMTAwMCk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9TUEVDSUFMX09GRkVSLCB0aGlzLnVwZGF0ZVNwZWljaWFsT2ZmZXIsIHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5ESUFNT05EU19VUERBVEUsIHRoaXMub25VcGRhdGVEaWFtb25kcywgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlRBU0tfVVBEQVRFLCB0aGlzLnVwZGF0ZVNraW5SZW1pbmRlciwgdGhpcyk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEtleSk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlRBU0tfVVBEQVRFLCB0aGlzLnVwZGF0ZVNraW5SZW1pbmRlciwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9TUEVDSUFMX09GRkVSLCB0aGlzLnVwZGF0ZVNwZWljaWFsT2ZmZXIsIHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5ESUFNT05EU19VUERBVEUsIHRoaXMub25VcGRhdGVEaWFtb25kcywgdGhpcyk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRW50ZXJNZW51XCIpO1xuICAgIC8vdGhpcy5jcmVhdGVDbHViQnV0dG9uKCk7XG4gICAgdGhpcy51cGRhdGVTb3VuZEl0ZW0oKTtcbiAgICB0aGlzLnVwZGF0ZUdpZnRJdGVtKCk7XG4gICAgdGhpcy5zcFBsYXlFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcFBsYXlDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcExldmVsc0VuLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwTGV2ZWxzQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BJY29uRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BJY29uQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BIYXJkQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BIYXJkRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuYnRuR2lmdEVuLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmJ0bkdpZnRDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5idG5XaGVlbENuLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmJ0bldoZWVsRW4udmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgdGhpcy5zcFBsYXlDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcExldmVsc0NuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwSWNvbkNuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwSGFyZENuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmJ0bkdpZnRDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5idG5XaGVlbENuLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3BQbGF5RW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc3BMZXZlbHNFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcEljb25Fbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcEhhcmRFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5idG5HaWZ0RW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuYnRuV2hlZWxFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5uZEdpZnRzLnZpc2libGUgPSB0cnVlO1xuXG4gICAgdGhpcy5zcEdpZnRCZy5ydW5BY3Rpb24oY2Mucm90YXRlQnkoMywgMzYwKS5yZXBlYXRGb3JldmVyKCkpO1xuICAgIHRoaXMudXBkYXRlU3BlaWNpYWxPZmZlcigpO1xuICAgIHRoaXMub25VcGRhdGVEaWFtb25kcygpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVNwZWljaWFsT2ZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5uZFNwZWNpYWxPZmZlci52aXNpYmxlID0gIUdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5pc1NwZWNpYWxPZmZlclB1cmNoYXNlZCgpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlRGlhbW9uZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYkRpYW1vbmRzLnNldFN0cmluZyhnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZUdpZnRJdGVtKCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlR2lmdEl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKSkge1xuICAgICAgICB0aGlzLm5kR2lmdHMudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZEdpZnRzLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlU291bmRJdGVtID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBpc1NvdW5kT24gPSBnYW1lLmF1ZGlvUGxheWVyLmlzRWZmZWN0T24oKTtcbiAgICBpZiAoaXNTb3VuZE9uKSB7XG4gICAgICAgIHRoaXMuX3NvdW5kSXRlbS5zZXROb3JtYWxJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vbi5wbmdcIikpO1xuICAgICAgICB0aGlzLl9zb3VuZEl0ZW0uc2V0U2VsZWN0ZWRJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vbi5wbmdcIikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3NvdW5kSXRlbS5zZXROb3JtYWxJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vZmYucG5nXCIpKTtcbiAgICAgICAgdGhpcy5fc291bmRJdGVtLnNldFNlbGVjdGVkSW1hZ2UobmV3IGNjLlNwcml0ZShcIiNidG5fc291bmRfb2ZmLnBuZ1wiKSk7XG4gICAgfVxufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnN0b3JlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU3RvcmVUeXBlXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuZGlhbW9uZENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoU3RvcmVUeXBlLkRJQU1PTkQpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnNoYXJlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnNoYXJlTWFuYWdlci5zaGFyZVdpdGhTeXN0ZW0oZ2FtZS51dGlscy5zcHJpbnRmKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJzaGFyZV90aXBzXCIpLFxuICAgICAgICBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpLCBnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5yYW5rQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLmdjTWFuYWdlci5zaG93TGVhZGVyYm9hcmQoZ2FtZS5jb25maWcuZ2V0TGVhZGVyQm9hcmRLZXkoKSk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuc3VwcG9ydENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5zaGFyZU1hbmFnZXIuc2VuZEVtYWlsKGdhbWUuY29uZmlnLmNvbm5lY3RFbWFpbCxcbiAgICAgICAgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImZlZWRfYmFja190aXRsZVwiKSwgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImZlZWRfYmFja19jb250ZW50XCIpKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5yYXRlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBjYy5zeXMub3BlblVSTChnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnBsYXlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLnBsYXllZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucGxheWVkID0gdHJ1ZTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuY2hvb3NlTGF0ZXN0TGV2ZWwoKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnBhY2thZ2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLnBsYXllZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucGxheWVkID0gdHJ1ZTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0SGFyZE1vZGUoZmFsc2UpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTEVWRUwpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnNvdW5kQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnNldEVmZmVjdE9uKCFnYW1lLmF1ZGlvUGxheWVyLmlzRWZmZWN0T24oKSk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5zZXRNdXNpY09uKCFnYW1lLmF1ZGlvUGxheWVyLmlzTXVzaWNPbigpKTtcbiAgICB0aGlzLnVwZGF0ZVNvdW5kSXRlbSgpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLndoZWVsQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2hlZWxEbGcoKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5kYWlseUJvbnVzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwRGFpbHlCb251cygpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmhhcmRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLnBsYXllZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucGxheWVkID0gdHJ1ZTtcbiAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJoYXJkX3JlbWluZGVkXCIsIFwiZmFsc2VcIik7XG4gICAgdGhpcy5zcEhhcmRIaW50LnZpc2libGUgPSBmYWxzZTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0SGFyZE1vZGUodHJ1ZSk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5MRVZFTCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuZ2lmdENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInNob3V5ZVwiIDogXCJqaWxpMDRcIik7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUudGFza0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ2xpY2tUYXNrc1wiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwVGFza0RsZygpO1xuXG4gICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFwiY2xpY2tfdGFza1wiLCBcInRydWVcIik7XG4gICAgdGhpcy51cGRhdGVTa2luUmVtaW5kZXIoKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTa2luUmVtaW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNsaWNrU2tpbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImNsaWNrX3Rhc2tcIiwgXCJmYWxzZVwiKTtcbiAgICBpZiAoY2xpY2tTa2luID09IFwiZmFsc2VcIikge1xuICAgICAgICB0aGlzLnNwU2tpblJlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChHYW1lTWFuLmdldEluc3RhbmNlKCkuaGFzQ29tcGxldGVkVGFzaygpKSB7XG4gICAgICAgICAgICB0aGlzLnNwU2tpblJlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcFNraW5SZW1pbmRlci52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuc3BlY2lhbE9mZmVyQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3BlaWNpYWxPZmZlcigpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnNraW5DbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNsaWNrU2tpbnNcIik7XG4gICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoU3RvcmVUeXBlLlNLSU4pO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnJlbW92ZUFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgdmFyIHJlbW92ZUFkRW50aXR5ID0gU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5nZXRTdG9yZUVudGl0eUJ5VHlwZShTdG9yZVR5cGUuUkVNT1ZFX0FEUyk7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlQcm9kdWN0KHJlbW92ZUFkRW50aXR5KTtcbn07XG5cbk1lbnVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvbWVudV92aWV3LmNjYmlcIiwgbnVsbCwgXCJNZW51Q29udHJvbGxlclwiLCBuZXcgTWVudUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5NZW51Q29udHJvbGxlci50aW1lID0gMDtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51Q29udHJvbGxlcjsiLCJcblxudmFyIE5vdGljZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9va0l0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2NhbmNlbEl0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2NvbmZpcm1JdGVtID0gbnVsbDtcbiAgICB0aGlzLl9jbG9zZUl0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2luZm9MYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLl9va0xhYmVsID0gbnVsbDtcbiAgICB0aGlzLl9jYW5jZWxMYWJlbCA9IG51bGw7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsID0gbnVsbDtcblxuICAgIHRoaXMubmRSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLm5kUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDJJbmZvID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmRJbmZvID0gbnVsbDtcblxuICAgIHRoaXMuc3ByQWQgPSBudWxsO1xuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG51bGw7XG4gICAgdGhpcy5fZmFpbENhbGxGdW5jID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTm90aWNlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgLy9nYW1lLmFkc01hbmFnZXIuc2hvd05hdGl2ZUFkKFwibm90aWNlXCIsIDAsIDApO1xufTtcblxuTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZU5hdGl2ZUFkKFwibm90aWNlXCIpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl90aXRsZUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwibm90aWNlX3RpdGxlXCIpKTtcbiAgICB0aGlzLm5kUmV3YXJkMS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZFJld2FyZDIudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuX2luZm9MYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcHJBZC52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aFllcyA9IGZ1bmN0aW9uIChpbmZvLCBva0NhbGxGdW5jKSB7XG4gICAgdGhpcy5faW5mb0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoaW5mbyk7XG4gICAgdGhpcy5faW5mb0xhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xuICAgIHRoaXMuX2NvbmZpcm1JdGVtLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX29rSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2FuY2VsSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fb2tMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuX2Nsb3NlSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2NvbmZpcm1MYWJlbC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImNvbmZpcm1faW5mb1wiKSk7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xufTtcblxuTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGhZZXNObyA9IGZ1bmN0aW9uIChpbmZvLCB5ZXNJbmZvLCBjYW5jZWxJbmZvLCBva0NhbGxGdW5jLCBmYWlsQ2FsbEZ1bmMsIHNob3dDbG9zZSwgaXNTaG93QWRzKSB7XG4gICAgdGhpcy5faW5mb0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoaW5mbyk7XG4gICAgdGhpcy5faW5mb0xhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xuICAgIHRoaXMuX2ZhaWxDYWxsRnVuYyA9IGZhaWxDYWxsRnVuYztcbiAgICBpZiAodGhpcy5fY29uZmlybUl0ZW0pIHtcbiAgICAgICAgdGhpcy5fY29uZmlybUl0ZW0udmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLl9va0l0ZW0udmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fY2FuY2VsSXRlbS52aXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLl9va0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2NhbmNlbExhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIGlmICh0aGlzLl9jb25maXJtTGFiZWwpIHtcbiAgICAgICAgdGhpcy5fY29uZmlybUxhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5fb2tMYWJlbC5zZXRTdHJpbmcoeWVzSW5mbyk7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwuc2V0U3RyaW5nKGNhbmNlbEluZm8pO1xuICAgIHRoaXMuX29rTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgdGhpcy5fY2xvc2VJdGVtLnZpc2libGUgPSBzaG93Q2xvc2U7XG4gICAgdGhpcy5zcHJBZC52aXNpYmxlID0gISFpc1Nob3dBZHM7XG4gICAgaWYgKGlzU2hvd0Fkcykge1xuICAgICAgICB0aGlzLnJvb3ROb2RlLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJsb29wXCIpO1xuICAgICAgICB9LmJpbmQodGhpcyksIDEpO1xuICAgIH1cbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoUmV3YXJkWWVzID0gZnVuY3Rpb24gKGluZm8sIG9rQ2FsbEZ1bmMsIHJld2FyZDFTcHJpdGUsIHJld2FyZDFDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCkge1xuICAgIHRoaXMuX2luZm9MYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdmFyIHNwcml0ZUZyYW1lO1xuICAgIGlmIChyZXdhcmQxU3ByaXRlICYmIHJld2FyZDJTcHJpdGUpIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRTdHJpbmcoaW5mbyk7XG4gICAgICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbiAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKHJld2FyZDFTcHJpdGUpO1xuICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3BSZXdhcmQxLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkMS5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMlNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZDIuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcInhcIiArIHJld2FyZDJDb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDEudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJSZXdhcmRJbmZvLnNldFN0cmluZyhpbmZvKTtcbiAgICAgICAgdGhpcy5sYlJld2FyZEluZm8uc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgICAgIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShyZXdhcmQxU3ByaXRlKTtcbiAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICB0aGlzLnNwUmV3YXJkLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkLnNldFN0cmluZyhcInhcIiArIHJld2FyZDFDb3VudCk7XG4gICAgfVxuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG9rQ2FsbEZ1bmM7XG4gICAgdGhpcy5fY29uZmlybUl0ZW0udmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fb2tJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jYW5jZWxJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9va0xhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jYW5jZWxMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2xvc2VJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jb25maXJtTGFiZWwudmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY29uZmlybV9pbmZvXCIpKTtcbiAgICB0aGlzLl9jb25maXJtTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5va0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMuX29rQ2FsbEZ1bmMpIHtcbiAgICAgICAgdGhpcy5fb2tDYWxsRnVuYygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5jYW5jZWxDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9mYWlsQ2FsbEZ1bmMpIHtcbiAgICAgICAgdGhpcy5fZmFpbENhbGxGdW5jKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5jb25maXJtQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAodGhpcy5fb2tDYWxsRnVuYykge1xuICAgICAgICB0aGlzLl9va0NhbGxGdW5jKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblxuTm90aWNlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2Uvbm90aWNlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIk5vdGljZUNvbnRyb2xsZXJcIiwgbmV3IE5vdGljZUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLmNyZWF0ZUd1aWRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL25ld190aXBfdmlldy5jY2JpXCIsIG51bGwsIFwiTm90aWNlQ29udHJvbGxlclwiLCBuZXcgTm90aWNlQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTm90aWNlQ29udHJvbGxlcjsiLCJ2YXIgR2FtZVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0dhbWVTY2VuZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBNdWx0aUNvbFRhYmxlVmlldyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZXh0L011bHRpQ29sVGFibGVWaWV3XCIpO1xudmFyIFBhY2thZ2VJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1BhY2thZ2VJdGVtQ29udHJvbGxlclwiKTtcbnZhciBMZXZlbENvbmZpZ01hbiA9IHJlcXVpcmUoXCIuLi9jb25maWcvQ29uZmlnTWFuXCIpO1xudmFyIExvY2tTdGF0dXMgPSByZXF1aXJlKFwiLi4vZW51bS9Mb2NrU3RhdHVzXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBMZXZlbFNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0xldmVsU2NlbmVcIik7XG52YXIgVGl0bGVDb250cm9sbGVyID0gcmVxdWlyZShcIi4vVGl0bGVDb250cm9sbGVyXCIpO1xuXG4vL3ZhciBDRUxMX1dJRFRIID0gNTIwO1xuXG52YXIgUGFja2FnZUl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbiAgICBwYWNrYWdlRW50aXR5OiBudWxsLFxuICAgIHBhY2thZ2VJdGVtTm9kZTogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wYWNrYWdlSXRlbU5vZGUgPSBQYWNrYWdlSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMucGFja2FnZUl0ZW1Ob2RlKTtcbiAgICAgICAgdmFyIHNpemUgPSB0aGlzLnBhY2thZ2VJdGVtTm9kZS5jb250cm9sbGVyLmdldENvbnRlbnRTaXplKCk7XG4gICAgICAgIHRoaXMucGFja2FnZUl0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSwgc2l6ZS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChwYWNrYWdlRW50aXR5LCBpZHgpIHtcbiAgICAgICAgY2MubG9nKFwiUGFja2FnZUl0ZW1DZWxsVmlldyBpbml0V2l0aDppZHg6XCIgKyBpZHgpO1xuICAgICAgICB0aGlzLnBhY2thZ2VFbnRpdHkgPSBwYWNrYWdlRW50aXR5O1xuICAgICAgICB0aGlzLnBhY2thZ2VJdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHBhY2thZ2VFbnRpdHksIGlkeCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wYWNrYWdlSXRlbU5vZGUuY29udHJvbGxlci5yZWZyZXNoKCk7XG4gICAgfSxcblxuICAgIHNob3dBcHBlYXJBbmltOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGFja2FnZUl0ZW1Ob2RlLmNvbnRyb2xsZXIuc2hvd0FwcGVhckFuaW0oZmFsc2UpO1xuICAgIH0sXG5cbiAgICBzaG93RGlzYXBwZWFyQW5pbTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBhY2thZ2VJdGVtTm9kZS5jb250cm9sbGVyLnNob3dEaXNhcHBlYXJBbmltKCk7XG4gICAgfVxufSk7XG5cbnZhciBQYWNrYWdlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJDaGFwdGVyTmFtZSA9IG51bGw7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5sYkxldmVsTmFtZSA9IG51bGw7XG4gICAgdGhpcy5fdGFibGVWaWV3ID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMucGFja2FnZUNvbmZpZ3MgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhQYWNrYWdlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5wYWNrYWdlQ29uZmlncyA9IExldmVsQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0UGFja2FnZUxpc3QoKTtcblxuICAgIHRoaXMuc2hvd0xldmVsVGFibGVWaWV3KCk7XG5cbiAgICB2YXIgcGFja2FnZUlkID0gMTtcbiAgICB2YXIgcGFja2FnZUluZm8gPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0TWluVW5Db21wbGV0ZWRQYWNrYWdlKCk7XG4gICAgaWYgKCFwYWNrYWdlSW5mbyB8fCAocGFja2FnZUluZm8uaWQgPiB0aGlzLnBhY2thZ2VDb25maWdzLmxlbmd0aCkpIHtcbiAgICAgICAgcGFja2FnZUlkID0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBwYWNrYWdlSWQgPSBwYWNrYWdlSW5mby5pZDtcbiAgICB9XG4gICAgY2MubG9nKFwicGFja2FnZUlkOlwiICsgcGFja2FnZUlkKTtcbiAgICB2YXIgY3VyUm93ID0gMDtcbiAgICBpZiAocGFja2FnZUlkICUgdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKCkgPT09IDApIHtcbiAgICAgICAgY3VyUm93ID0gTWF0aC5mbG9vcihwYWNrYWdlSWQgLyB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3VyUm93ID0gTWF0aC5mbG9vcihwYWNrYWdlSWQgLyB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwoKSkgKyAxO1xuICAgIH1cblxuICAgIHZhciB5T2Zmc2V0ID0gLSh0aGlzLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldygpIC0gY3VyUm93ICsgMSkgKiB0aGlzLmdyaWRTaXplRm9yVGFibGUoKS5oZWlnaHQgK1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuZ2V0Vmlld1NpemUoKS5oZWlnaHQ7XG5cbiAgICBpZiAoeU9mZnNldCA8IHRoaXMuX3RhYmxlVmlldy5taW5Db250YWluZXJPZmZzZXQoKS55KSB7XG4gICAgICAgIHlPZmZzZXQgPSB0aGlzLl90YWJsZVZpZXcubWluQ29udGFpbmVyT2Zmc2V0KCkueTtcbiAgICB9IGVsc2UgaWYgKHlPZmZzZXQgPj0gdGhpcy5fdGFibGVWaWV3Lm1heENvbnRhaW5lck9mZnNldCgpLnkpIHtcbiAgICAgICAgeU9mZnNldCA9IHRoaXMuX3RhYmxlVmlldy5tYXhDb250YWluZXJPZmZzZXQoKS55O1xuICAgIH1cblxuICAgIHRoaXMuX3RhYmxlVmlldy5zZXRDb250ZW50T2Zmc2V0KGNjLnAoMCwgeU9mZnNldCkpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldygpOyArK2kpIHtcbiAgICAgICAgdmFyIGNlbGwgPSB0aGlzLl90YWJsZVZpZXcuZ2V0R3JpZEF0SW5kZXgoaSk7XG4gICAgICAgIGlmIChjZWxsKSB7XG4gICAgICAgICAgICBjZWxsLnNob3dBcHBlYXJBbmltKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmxiTGV2ZWxOYW1lLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicGFja2FnZV90aXRsZVwiKSk7XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0xldmVsVGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3RhYmxlVmlldyA9IG5ldyBNdWx0aUNvbFRhYmxlVmlldyh0aGlzLCB0aGlzLm5kQ29udGFpbmVyLmdldENvbnRlbnRTaXplKCksIG51bGwpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZSh0aGlzKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgdGhpcy5fdGFibGVWaWV3LnNldEFuY2hvclBvaW50KGNjLnAoMCwgMCkpO1xuICAgIHRoaXMubmRDb250YWluZXIuYWRkQ2hpbGQodGhpcy5fdGFibGVWaWV3KTtcbiAgICB0aGlzLl90YWJsZVZpZXcucmVsb2FkRGF0YSgpO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRTY3JvbGwgPSBmdW5jdGlvbiAodmlldykge1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRab29tID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkQXRJbmRleCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsICBpZHgpIHtcbiAgICB2YXIgY2VsbCA9IG11bHRpVGFibGUuZGVxdWV1ZUdyaWQoKTtcbiAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgY2VsbCA9IG5ldyBQYWNrYWdlSXRlbUNlbGxWaWV3KCk7XG4gICAgfVxuXG4gICAgaWYgKGlkeCA8IHRoaXMucGFja2FnZUNvbmZpZ3MubGVuZ3RoKSB7XG4gICAgICAgIHZhciBwYWNrYWdlQ29uZmlnID0gdGhpcy5wYWNrYWdlQ29uZmlnc1tpZHhdO1xuICAgICAgICBjZWxsLmluaXRXaXRoKHBhY2thZ2VDb25maWcsIGlkeCwgdGhpcy5pbml0ZWQpO1xuICAgICAgICBjZWxsLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiBjZWxsO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldyA9IGZ1bmN0aW9uKG11bHRpVGFibGUpIHtcbiAgICByZXR1cm4gdGhpcy5wYWNrYWdlQ29uZmlncy5sZW5ndGg7XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAxO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRTaXplRm9yVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIGNjLnNpemUoY2Mud2luU2l6ZS53aWR0aCwgMTQzKTtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkVG91Y2hlZCA9IGZ1bmN0aW9uKHRhYmxlLCBncmlkKSB7XG4gICAgY2MubG9nKFwiZ3JpZCB0b3VjaGVkIGF0IGluZGV4OiBcIiArIGdyaWQuZ2V0SWR4KCkpO1xuICAgIHZhciBwYWNrYWdlRW50aXR5ID0gZ3JpZC5wYWNrYWdlRW50aXR5O1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmIChwYWNrYWdlRW50aXR5LmlzTG9ja2VkKCkpIHtcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKGdhbWUudXRpbHMuc3ByaW50ZihnYW1lLmxvY2FsLmdldFZhbHVlKFwidW5sb2NrX2luZm9cIiksIHBhY2thZ2VFbnRpdHkudW5sb2NrQ291bnQpLFxuICAgICAgICAgICAgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInVubG9ja190aXRsZVwiKSxcbiAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjYW5jZWxfdGl0bGVcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmNvaW5zID49IHBhY2thZ2VFbnRpdHkudW5sb2NrQ291bnQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRDb2lucygtcGFja2FnZUVudGl0eS51bmxvY2tDb3VudCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0UGFja2FnZVVubG9ja2VkKHBhY2thZ2VFbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIGdyaWQucmVmcmVzaCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93Q2xvc2VBbmltKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zZXRQYWNrYWdlRW50aXR5KHBhY2thZ2VFbnRpdHkpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5MRVZFTCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLnNob3dDbG9zZUFuaW0oZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLk1FTlUpO1xuICAgIH0pO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dDbG9zZUFuaW0gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3KCk7ICsraSkge1xuICAgICAgICB2YXIgY2VsbCA9IHRoaXMuX3RhYmxlVmlldy5nZXRHcmlkQXRJbmRleChpKTtcbiAgICAgICAgaWYgKGNlbGwpIHtcbiAgICAgICAgICAgIGNlbGwuc2hvd0Rpc2FwcGVhckFuaW0oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnJvb3ROb2RlLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSwgMC44KTtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIlRpdGxlQ29udHJvbGxlclwiLCBuZXcgVGl0bGVDb250cm9sbGVyKCkpO1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9wYWNrYWdlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlBhY2thZ2VDb250cm9sbGVyXCIsIG5ldyBQYWNrYWdlQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLl9jb250cm9sbGVyQ2xhc3NDYWNoZVtcIlRpdGxlQ29udHJvbGxlclwiXSA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGFja2FnZUNvbnRyb2xsZXI7IiwidmFyIExvY2tTdGF0dXMgPSByZXF1aXJlKFwiLi4vZW51bS9Mb2NrU3RhdHVzXCIpO1xuXG52YXIgUGFja2FnZUl0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYk5hbWUgPSBudWxsO1xuICAgIHRoaXMubGJDb3VudCA9IG51bGw7XG5cbiAgICB0aGlzLnNwQmcgPSBudWxsO1xuXG4gICAgdGhpcy5zcENvbXBsZXRlZCA9IG51bGw7XG4gICAgdGhpcy5zcFVuQ29tcGxldGVkID0gbnVsbDtcblxuICAgIHRoaXMubmRMb2NrID0gbnVsbDtcbiAgICB0aGlzLmxiVW5sb2NrQ291bnQgPSBudWxsO1xuXG4gICAgdGhpcy5wYWNrYWdlRW50aXR5ID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUGFja2FnZUl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblBhY2thZ2VJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuUGFja2FnZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93QXBwZWFyQW5pbSA9IGZ1bmN0aW9uIChpbml0ZWQpIHtcbiAgICAvL2lmICghaW5pdGVkKSB7XG4gICAgICAgIHRoaXMucm9vdE5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwibGVmdFwiKTtcbiAgICAgICAgdGhpcy5yb290Tm9kZS5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwibm9ybWFsXCIpO1xuICAgICAgICB9LmJpbmQodGhpcyksIHRoaXMuaWR4ICogMC4wNSk7XG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIm5vbmVcIik7XG4gICAgLy99XG59O1xuXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dEaXNhcHBlYXJBbmltID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucm9vdE5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICB0aGlzLnJvb3ROb2RlLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcImRpc2FwcGVhclwiKTtcbiAgICB9LmJpbmQodGhpcyksIHRoaXMuaWR4ICogMC4wNSk7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7UGFja2FnZUNvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICovXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGlkeCkge1xuICAgIHRoaXMucGFja2FnZUVudGl0eSA9IGRhdGE7XG4gICAgdGhpcy5pZHggPSBpZHg7XG4gICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwibm9uZVwiKTtcbn07XG5cblBhY2thZ2VJdGVtQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxiTmFtZS5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShnYW1lLnV0aWxzLnNwcmludGYoXCJwYWNrYWdlXyVkXCIsIHRoaXMuaWR4ICsgMSkpKTtcbiAgICB2YXIgbWF4TGV2ZWwgPSBnYW1lLnBsYXllck1hbi5nZXRQYWNrYWdlVW5sb2NrTGV2ZWwodGhpcy5wYWNrYWdlRW50aXR5LmlkKSArIDE7XG4gICAgaWYgKG1heExldmVsID4gdGhpcy5wYWNrYWdlRW50aXR5LmNvdW50KSB7XG4gICAgICAgIG1heExldmVsID0gdGhpcy5wYWNrYWdlRW50aXR5LmNvdW50O1xuICAgIH1cbiAgICB0aGlzLmxiQ291bnQuc2V0U3RyaW5nKG1heExldmVsICsgXCIvXCIgKyB0aGlzLnBhY2thZ2VFbnRpdHkuY291bnQpO1xuICAgIHRoaXMuc3BCZy5zZXRTcHJpdGVGcmFtZShjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKHRoaXMucGFja2FnZUVudGl0eS5pbWFnZSkpO1xuICAgIHRoaXMuc3BDb21wbGV0ZWQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BVbkNvbXBsZXRlZC52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKG1heExldmVsID09PSB0aGlzLnBhY2thZ2VFbnRpdHkuY291bnQpIHtcbiAgICAgICAgdGhpcy5zcENvbXBsZXRlZC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwVW5Db21wbGV0ZWQudmlzaWJsZSA9IHRydWU7XG4gICAgfVxuICAgIGlmICh0aGlzLnBhY2thZ2VFbnRpdHkuaXNMb2NrZWQoKSkge1xuICAgICAgICB0aGlzLm5kTG9jay52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYlVubG9ja0NvdW50LnNldFN0cmluZyh0aGlzLnBhY2thZ2VFbnRpdHkudW5sb2NrQ291bnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmRMb2NrLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIWdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgdGhpcy5sYk5hbWUuc2V0U2NhbGUoMS4wKTtcbiAgICB9XG59O1xuXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmdldENvbnRlbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwQmcuZ2V0Q29udGVudFNpemUoKTtcbn07XG5cblBhY2thZ2VJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvcGFja2FnZV9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlBhY2thZ2VJdGVtQ29udHJvbGxlclwiLCBuZXcgUGFja2FnZUl0ZW1Db250cm9sbGVyKCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYWNrYWdlSXRlbUNvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIFBhc3NDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG5cbiAgICAvL3RoaXMuc3BXaW5DbiA9IG51bGw7XG4gICAgLy90aGlzLnNwV2luRW4gPSBudWxsO1xuXG4gICAgdGhpcy5uZFdoZWVsID0gbnVsbDtcblxuICAgIHRoaXMubGJsUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLmxibFdoZWVsID0gbnVsbDtcblxuICAgIHRoaXMuc3BZZWxsb3cxID0gbnVsbDtcbiAgICB0aGlzLnNwWWVsbG93MiA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzMgPSBudWxsO1xuXG4gICAgdGhpcy5zcEJsYWNrMSA9IG51bGw7XG4gICAgdGhpcy5zcEJsYWNrMiA9IG51bGw7XG4gICAgdGhpcy5zcEJsYWNrMyA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93cyA9IFtdO1xuICAgIC8vdGhpcy5zcEJsYWNrcyA9IFtdO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhQYXNzQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLl9uZXh0Q2FsbGJhY2sgPSBudWxsO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfcG9wZWRcIiwgdGhpcy5vbkRpYWxvZ1BvcGVkLCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKFwiZGlhbG9nX2Nsb3NlZFwiLCB0aGlzLm9uRGlhbG9nQ2xvc2VkLCB0aGlzKTtcbiAgICB0aGlzLnJlbW92ZU5hdGl2ZUFkKCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgdGhpcy5zaG93TmF0aXZlQWQoKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ1BvcGVkID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlTmF0aXZlQWQoKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ0Nsb3NlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlTmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuZGlhbG9nTWFuYWdlci5pc1RvcGVzdERpYWxvZyh0aGlzLnJvb3ROb2RlKSkge1xuICAgICAgICB0aGlzLnNob3dOYXRpdmVBZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbiAgICB9XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd05hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuYWRzTWFuYWdlci5zaG93TmF0aXZlQWQoXCJwYXNzXCIsIDAsIDApO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLnJlbW92ZU5hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVOYXRpdmVBZChcInBhc3NcIik7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYmxSZXdhcmQuc2V0U3RyaW5nKF8oXCJ3YXRjaF9hZHNfZ2V0X2Jvb3N0c1wiKSk7XG4gICAgdGhpcy5sYmxXaGVlbC5zZXRTdHJpbmcoXyhcImx1Y2t5X3doZWVsX3RpdGxlXCIpKTtcblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuXG4gICAgdmFyIHN0YXIgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuY3VycmVudFN0YXI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgdGhpcy5zcFllbGxvd3NbaV0udmlzaWJsZSA9IChzdGFyID49IGkgKyAxKTtcbiAgICB9XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgc3RhcjsgKytpKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwic3Rhcl9cIiArIChpbmRleCArIDEpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oaSksIDI1MCAqIChpICsgMSkpO1xuICAgIH1cbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSByZXBsYXlDYWxsYmFjaztcbiAgICB0aGlzLl9uZXh0Q2FsbGJhY2sgPSBuZXh0Q2FsbGJhY2s7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUub25BbmltRW5kID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zaG93QWRzQW5kUmF0ZSh0cnVlKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5uZXh0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zaG93QWRzQW5kUmF0ZSh0cnVlKTtcbiAgICBpZiAodGhpcy5fbmV4dENhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX25leHRDYWxsYmFjaygpO1xuICAgIH1cbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd1JlZ2lzdGVyTm90aWZpY2F0aW9uKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLnJlc3RhcnRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNob3dBZHNBbmRSYXRlKHRydWUpO1xuICAgIGlmICh0aGlzLl9yZXBsYXlDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9yZXBsYXlDYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuaG9tZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd0Fkc0FuZFJhdGUodHJ1ZSk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcIndpbmdpZnRcIiA6IFwiamlsaTA1XCIsIG51bGwsIFwiV2luQW5kV2F0Y2hEaWFtb25kc0Fkc1wiKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS53aGVlbENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblBhc3NDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9wYXNzX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlBhc3NDb250cm9sbGVyXCIsIG5ldyBQYXNzQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGFzc0NvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEFkc1BsYWNlID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9lbnVtL0Fkc1BsYWNlXCIpO1xuXG52YXIgUGF1c2VDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxSZXdhcmQgPSBudWxsO1xuXG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFBhdXNlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9yZXN1bWVDYWxsYmFjayA9IG51bGw7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19wb3BlZFwiLCB0aGlzLm9uRGlhbG9nUG9wZWQsIHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfY2xvc2VkXCIsIHRoaXMub25EaWFsb2dDbG9zZWQsIHRoaXMpO1xuICAgIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgdGhpcy5zaG93TmF0aXZlQWQoKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWFsb2dQb3BlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlhbG9nQ2xvc2VkID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlTmF0aXZlQWQoKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlTmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuZGlhbG9nTWFuYWdlci5pc1RvcGVzdERpYWxvZyh0aGlzLnJvb3ROb2RlKSkge1xuICAgICAgICB0aGlzLnNob3dOYXRpdmVBZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbiAgICB9XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmFkc01hbmFnZXIuc2hvd05hdGl2ZUFkKFwicGF1c2VcIiwgMCwgOTkpO1xufTtcblxuUGF1c2VDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlTmF0aXZlQWQoXCJwYXVzZVwiKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJsUmV3YXJkLnNldFN0cmluZyhfKFwid2F0Y2hfYWRzX2dldF9ib29zdHNcIikpO1xufTtcblxuUGF1c2VDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXN1bWVDYWxsYmFjaykge1xuICAgIHRoaXMuX3Jlc3VtZUNhbGxiYWNrID0gcmVzdW1lQ2FsbGJhY2s7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLnJlc3VtZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBpZiAodGhpcy5fcmVzdW1lQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcmVzdW1lQ2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUGF1c2VDb250cm9sbGVyLnByb3RvdHlwZS5ob21lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIlBhdXNlSG9tZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImV4aXRfZ2FtZV9jb25maXJtXCIpLCBfKFwieWVzX3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsKCkgPj0gNCkge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dJbnRlcnN0aXRpYWwoQWRzUGxhY2UuSG9tZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUucmVzdGFydENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgIGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKEFkc1BsYWNlLlJlZnJlc2gpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIlBhdXNlUmV0cnlcIik7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIHZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKGdhbWUudXRpbHMuaXNJT1MoKSA/IFwicGF1c2VcIiA6IFwicGF1c2VcIik7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUGF1c2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9wYXVzZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJQYXVzZUNvbnRyb2xsZXJcIiwgbmV3IFBhdXNlQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGF1c2VDb250cm9sbGVyOyIsIi8vdmFyIFNraW5JdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1NraW5JdGVtQ29udHJvbGxlclwiKTtcbi8vdmFyIENvbmZpZ01hbiA9IHJlcXVpcmUoXCIuLi9jb25maWcvQ29uZmlnTWFuXCIpO1xuLy92YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbi8vXG4vL3ZhciBHUklEX1NJWkUgPSBjYy5zaXplKDM1MCwgNTAwKTtcbi8vXG4vL3ZhciBTdG9yZUl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbi8vICAgIGVudGl0eTogbnVsbCxcbi8vICAgIGl0ZW1Ob2RlOiBudWxsLFxuLy8gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuLy8gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4vLyAgICAgICAgdGhpcy5pdGVtTm9kZSA9IFNraW5JdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4vLyAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLml0ZW1Ob2RlKTtcbi8vICAgICAgICB0aGlzLml0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoR1JJRF9TSVpFLndpZHRoICogMC41LCBHUklEX1NJWkUuaGVpZ2h0ICogMC41KSk7XG4vLyAgICB9LFxuLy9cbi8vICAgIGluaXRXaXRoOiBmdW5jdGlvbiAoZW50aXR5LCBpZHgsIGluaXRlZCkge1xuLy8gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xuLy8gICAgICAgIHRoaXMuaXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChlbnRpdHksIGlkeCk7XG4vLyAgICB9XG4vL30pO1xudmFyIFJhbmtUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vUmFua1R5cGVcIik7XG5cbnZhciBSYW5rQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRDb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMubGJsVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5yYW5rVHlwZSA9IDA7XG5cbiAgICB0aGlzLnVwZGF0ZUNvdW50ID0gMDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUmFua0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAvL3RoaXMucm9vdE5vZGUuc2NoZWR1bGUodGhpcy5vblVwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmludGVydmFsS2V5ID0gc2V0SW50ZXJ2YWwodGhpcy5vblVwZGF0ZS5iaW5kKHRoaXMpLCA1MDApO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL3RoaXMucm9vdE5vZGUudW5zY2hlZHVsZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEtleSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIC8vLy9vbmV3eC5zb2NpYWwubG9hZFNoYXJlQ2FudmFzKHRoaXMubmRDb250YWluZXIpO1xuICAgIC8vdGhpcy5vblVwZGF0ZSgwKTtcbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHJhbmtUeXBlLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5yYW5rVHlwZSA9IHJhbmtUeXBlO1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNsb3NlQ2FsbGJhY2s7XG4gICAgaWYgKHJhbmtUeXBlID09PSBSYW5rVHlwZS5GcmllbmRzKSB7XG4gICAgICAgIHRoaXMubGJsVGl0bGUuc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJmcmllbmRzX3JhbmtfdGl0bGVcIikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubGJsVGl0bGUuc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJncm91cF9yYW5rX3RpdGxlXCIpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmFua1R5cGUgPT09IFJhbmtUeXBlLkZyaWVuZHMpIHtcbiAgICAgICAgb25ld3guc29jaWFsLmluaXRGcmllbmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBvbmV3eC5zb2NpYWwuaW5pdEdyb3VwKCk7XG4gICAgfVxuICAgIHRoaXMucmVmcmVzaFJhbmsoKTtcbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoUmFuayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZUNvdW50ID0gMDtcbiAgICB0aGlzLm9uVXBkYXRlKDApO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLnVwZGF0ZUNvdW50IDw9IDEwKSB7XG4gICAgICAgIG9uZXd4LnNvY2lhbC5sb2FkU2hhcmVDYW52YXModGhpcy5uZENvbnRhaW5lcik7XG4gICAgICAgIHRoaXMudXBkYXRlQ291bnQrKztcbiAgICB9XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUucHJldkNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgb25ld3guc29jaWFsLm9uUGFnZUNoYW5nZSh0aGlzLm5kQ29udGFpbmVyLCAtMSk7XG4gICAgdGhpcy5yZWZyZXNoUmFuaygpO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLm5leHRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIG9uZXd4LnNvY2lhbC5vblBhZ2VDaGFuZ2UodGhpcy5uZENvbnRhaW5lciwgMSk7XG4gICAgdGhpcy5yZWZyZXNoUmFuaygpO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLmNoYWxsZW5nZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmFua0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9yYW5rX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlJhbmtDb250cm9sbGVyXCIsIG5ldyBSYW5rQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmFua0NvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgUmV3YXJkRG91YmxlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5fdGl0bGVMYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLmxiUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLnNwUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLnNwUmV3YXJkQmcgPSBudWxsO1xuXG4gICAgdGhpcy5idG5DbG9zZUNuID0gbnVsbDtcbiAgICB0aGlzLmJ0bkNsb3NlRW4gPSBudWxsO1xuXG4gICAgdGhpcy5sYkRvdWJsZSA9IG51bGw7XG5cbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuXG4gICAgdGhpcy5kb3VibGVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZERvdWJsZUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMuYnRuQ2xvc2VDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuc3BUaXRsZUNuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuc3BUaXRsZUVuLnZpc2libGUgPSBmYWxzZTtcbiAgICBpZiAoZ2FtZS5sb2NhbC5pc0NoaW5lc2UoKSkge1xuICAgICAgICB0aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5zcFRpdGxlQ24udmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuc3BUaXRsZUVuLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICB0aGlzLmxiRG91YmxlLnNldFN0cmluZyhfKFwiZG91YmxlX3Jld2FyZHNcIikpO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChpbWFnZSwgY291bnQsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICBjb25zb2xlLmxvZyhcIlJld2FyZERvdWJsZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRcIik7XG4gICAgdGhpcy5zcFJld2FyZC5zZXRTcHJpdGVGcmFtZShpbWFnZSk7XG4gICAgdGhpcy5sYlJld2FyZC5zZXRTdHJpbmcoXCJYXCIgKyBjb3VudCk7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcblxuICAgIHRoaXMuc3BSZXdhcmRCZy5ydW5BY3Rpb24oY2Mucm90YXRlQnkoMiwgMzYwKS5yZXBlYXRGb3JldmVyKCkpO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblJld2FyZERvdWJsZUNvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInpodWFucGFuMDJcIiA6IFwiamlsaTAyXCIsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIHNlbGYuZG91YmxlZCA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG5cblJld2FyZERvdWJsZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7b3ZlcmxheU9wYWNpdHk6IDIxMH0pO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKHRoaXMuZG91YmxlZCk7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG4gICAgfVxufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2UvcmV3YXJkX2RvdWJsZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmREb3VibGVDb250cm9sbGVyXCIsIG5ldyBSZXdhcmREb3VibGVDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXdhcmREb3VibGVDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xuXG52YXIgUmV3YXJkR2lmdENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJUaXRsZSA9IG51bGw7XG5cbiAgICB0aGlzLmxiVGlwcyA9IG51bGw7XG4gICAgdGhpcy5sYkJ1dHRvbiA9IG51bGw7XG5cbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhSZXdhcmRHaWZ0Q29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZXdhcmRHaWZ0Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJUaXRsZS5zZXRTdHJpbmcoXyhcImdpZnRfdGl0bGVcIikpO1xuICAgIHRoaXMubGJUaXBzLnNldFN0cmluZyhfKFwiZ2lmdF90aXBzXCIpKTtcbiAgICB0aGlzLmxiQnV0dG9uLnNldFN0cmluZyhfKFwiZ2lmdF9idXR0b25cIikpO1xuXG4gICAgLy90aGlzLmxiVGlwcy5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbn07XG5cblJld2FyZEdpZnRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGNsb3NlQ2FsbGJhY2spIHtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xufTtcblxuUmV3YXJkR2lmdENvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5SZXdhcmRHaWZ0Q29udHJvbGxlci5wcm90b3R5cGUuZ2lmdENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBzaGFyZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTaGFyZUNvbmZpZygpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnd4R3JvdXBTaGFyZShzaGFyZSwgXCJnaWZ0X3NoYXJlXCIsIGZ1bmN0aW9uIChzaGFyZWQpIHtcbiAgICAgICAgaWYgKHNoYXJlZCkge1xuICAgICAgICAgICAgdmFyIHNwbGl0Q291bnQgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKDIsIDMpO1xuICAgICAgICAgICAgdmFyIHRocmVlQmFsbENvdW50ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50SW5SYW5nZSgyLCAzKTtcbiAgICAgICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkucG9wdXBCb29zdFJld2FyZERsZyhzcGxpdENvdW50LCB0aHJlZUJhbGxDb3VudCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS51dGlscy5zaG93V1hUb2FzdChcIumcgOimgeWIhuS6q+WIsOe+pFwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcblxuUmV3YXJkR2lmdENvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7b3ZlcmxheU9wYWNpdHk6IDIxMH0pO1xufTtcblxuUmV3YXJkR2lmdENvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblJld2FyZEdpZnRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9yZXdhcmRfZ2lmdF92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRHaWZ0Q29udHJvbGxlclwiLCBuZXcgUmV3YXJkR2lmdENvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJld2FyZEdpZnRDb250cm9sbGVyOyIsIlxuXG52YXIgUmV3YXJkTm90aWNlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLm5kUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkID0gbnVsbDtcblxuICAgIHRoaXMubGJsT2sgPSBudWxsO1xuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZE5vdGljZUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRSZXdhcmQxLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kUmV3YXJkMi52aXNpYmxlID0gZmFsc2U7XG5cbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImdldF9kaWFtb25kc1wiKTtcblxuICAgIC8vdGhpcy5zcEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG59O1xuXG5SZXdhcmROb3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aFJld2FyZFllcyA9IGZ1bmN0aW9uIChpbmZvLCBva0NhbGxGdW5jLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmQyU3ByaXRlLCByZXdhcmQyQ291bnQpIHtcbiAgICB2YXIgc3ByaXRlRnJhbWU7XG4gICAgaWYgKHJld2FyZDFTcHJpdGUgJiYgcmV3YXJkMlNwcml0ZSkge1xuICAgICAgICB0aGlzLm5kUmV3YXJkMi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgLy90aGlzLmxiUmV3YXJkMkluZm8uc2V0U3RyaW5nKGluZm8pO1xuICAgICAgICAvL3RoaXMubGJSZXdhcmQySW5mby5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbiAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKHJld2FyZDFTcHJpdGUpO1xuICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3BSZXdhcmQxLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkMS5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMlNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZDIuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcInhcIiArIHJld2FyZDJDb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDEudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5sYlJld2FyZEluZm8uc2V0U3RyaW5nKGluZm8pO1xuICAgICAgICAvL3RoaXMubGJSZXdhcmRJbmZvLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMVNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZC5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYlJld2FyZC5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgIH1cblxuICAgIHRoaXMubGJsT2suc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjb25maXJtX2luZm9cIikpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9va0NhbGxGdW5jKSB7XG4gICAgICAgIHRoaXMuX29rQ2FsbEZ1bmMoKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2UvcmV3YXJkX25vdGljZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmROb3RpY2VDb250cm9sbGVyXCIsIG5ldyBSZXdhcmROb3RpY2VDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXdhcmROb3RpY2VDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFJld2FyZFZpZGVvQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5fdGl0bGVMYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDJJbmZvID0gbnVsbDtcbiAgICB0aGlzLmxibEZyZWUgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUmV3YXJkVmlkZW9Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJSZXdhcmQxLnNldFN0cmluZyhcIlgxXCIpO1xuICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcIlgxXCIpO1xuICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIndhdGNoX2Fkc190aXBzXCIpKTtcbiAgICB0aGlzLl90aXRsZUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwid2F0Y2hfYWRzX3RpdGxlXCIpKTtcbiAgICB0aGlzLmxibEZyZWUuc2V0U3RyaW5nKF8oXCJmcmVlX2NvaW5zX3RpdGxlXCIpKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJqaWxpMDMtSU9TXCIgOiBcImppbGkwM1wiKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkVmlkZW9Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5SZXdhcmRWaWRlb0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3Jld2FyZF92aWRlb192aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRWaWRlb0NvbnRyb2xsZXJcIiwgbmV3IFJld2FyZFZpZGVvQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmV3YXJkVmlkZW9Db250cm9sbGVyOyIsInZhciBTa2luSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Ta2luSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBNdWx0aUNvbFRhYmxlVmlldyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZXh0L011bHRpQ29sVGFibGVWaWV3XCIpO1xuXG52YXIgR1JJRF9TSVpFID0gY2Muc2l6ZSgyNzAsIDIwMCk7XG5cbnZhciBTdG9yZUl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbiAgICBlbnRpdHk6IG51bGwsXG4gICAgaXRlbU5vZGU6IG51bGwsXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlID0gU2tpbkl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLml0ZW1Ob2RlKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5zZXRQb3NpdGlvbihjYy5wKEdSSURfU0laRS53aWR0aCAqIDAuNSwgR1JJRF9TSVpFLmhlaWdodCAqIDAuNSkpO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aDogZnVuY3Rpb24gKGVudGl0eSwgaWR4KSB7XG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoZW50aXR5LCBpZHgpO1xuICAgIH1cbn0pO1xuXG52YXIgU2tpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyID0gbnVsbDtcblxuICAgIHRoaXMubGJsVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5fdGFibGVWaWV3ID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMuY29uZmlncyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFNraW5Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9TS0lOLCB0aGlzLm9uVXBkYXRlU2tpbiwgdGhpcyk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoXyhcInNraW5fdGl0bGVcIikpO1xuXG4gICAgdGhpcy5jb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U2tpbkxpc3QoKTtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVNraW4gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5zaG93VGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5fdGFibGVWaWV3KSB7XG4gICAgICAgIHZhciBzaXplID0gdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgc2l6ZSwgbnVsbCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICAgICAgdGhpcy5uZENvbnRhaW5lci5hZGRDaGlsZCh0aGlzLl90YWJsZVZpZXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IHRoaXMuX3RhYmxlVmlldy5nZXRDb250ZW50T2Zmc2V0KCk7XG4gICAgfVxuICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG4gICAgaWYgKHRoaXMuX29mZnNldCkge1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldCh0aGlzLl9vZmZzZXQpO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBudWxsO1xuICAgIH1cbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkU2Nyb2xsID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZEF0SW5kZXggPSBmdW5jdGlvbihtdWx0aVRhYmxlLCAgaWR4KSB7XG4gICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICAgIGNlbGwgPSBuZXcgU3RvcmVJdGVtQ2VsbFZpZXcoKTtcbiAgICB9XG5cbiAgICBpZiAoaWR4IDwgdGhpcy5jb25maWdzLmxlbmd0aCkge1xuICAgICAgICB2YXIgc2tpbkNmZyA9IHRoaXMuY29uZmlnc1tpZHhdO1xuICAgICAgICBjZWxsLmluaXRXaXRoKHNraW5DZmcsIGlkeCk7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNlbGw7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3ID0gZnVuY3Rpb24obXVsdGlUYWJsZSkge1xuICAgIHZhciBncmlkc0luQ2VsbCA9IHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbChtdWx0aVRhYmxlKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKHRoaXMuY29uZmlncy5sZW5ndGggLyBncmlkc0luQ2VsbCk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAyO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRTaXplRm9yVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIGNjLnNpemUoMjcwLCAyMjApO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRUb3VjaGVkID0gZnVuY3Rpb24odGFibGUsIGdyaWQpIHtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcblxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL2lmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAvLyAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAvLyAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIC8vfVxufTtcblxuU2tpbkNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9za2luX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlNraW5Db250cm9sbGVyXCIsIG5ldyBTa2luQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpbkNvbnRyb2xsZXI7IiwidmFyIFNraW5SZXdhcmRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblJld2FyZFR5cGVcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIFNraW5JdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5uZFB1cmNoYXNlID0gbnVsbDtcbiAgICB0aGlzLm5kT3duZWQgPSBudWxsO1xuXG4gICAgdGhpcy5sYkRpYW1vbmRQcmljZSA9IG51bGw7XG4gICAgdGhpcy5sYlVzaW5nID0gbnVsbDtcblxuICAgIHRoaXMuc3BTa2luID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLnNraW5DZmcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhTa2luSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbigpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX1NLSU4sIHRoaXMub25VcGRhdGVTa2luLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge1NraW5Db25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICB0aGlzLmlkeCA9IGlkeDtcbiAgICB0aGlzLnNraW5DZmcgPSBkYXRhO1xuICAgIC8vdmFyIGNvbXBsZXRlZCA9IGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShkYXRhLmltYWdlICsgXCIucG5nXCIpO1xuICAgICAgICB0aGlzLnNwU2tpbi5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG5cbiAgICAgICAgdGhpcy5uZFB1cmNoYXNlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB2YXIgb3duZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKHRoaXMuc2tpbkNmZy5pZCk7XG4gICAgICAgIGlmIChvd25lZCkge1xuICAgICAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGRhdGEuaWQgPT09IGdhbWUucGxheWVyTWFuLmdldEN1cnJlbnRTa2luSWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJVc2luZy5zZXRTdHJpbmcoXyhcInNlbGVjdGVkX3RpdGxlXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYlVzaW5nLnNldFN0cmluZyhfKFwic2VsZWN0X3RpdGxlXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJEaWFtb25kUHJpY2Uuc2V0U3RyaW5nKHRoaXMuc2tpbkNmZy5jb3VudCk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgICBjYy5lcnJvcihleCk7XG4gICAgfVxufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVNraW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pbml0V2l0aCh0aGlzLnNraW5DZmcsIHRoaXMuaWR4KTtcbn07XG5cblNraW5JdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q29udGVudFNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BCZ1NlbGVjdGVkLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnB1cmNoYXNlQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlTa2luKHRoaXMuc2tpbkNmZyk7XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnNlbGVjdENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudFNraW5JZCh0aGlzLnNraW5DZmcuaWQpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5VUERBVEVfU0tJTik7XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L3NraW5faXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJTa2luSXRlbUNvbnRyb2xsZXJcIiwgbmV3IFNraW5JdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpbkl0ZW1Db250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgU3BlY2lhbE9mZmVyQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYlRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMSA9IG51bGw7XG4gICAgLy90aGlzLnNwUmV3YXJkMiA9IG51bGw7XG4gICAgLy90aGlzLmxiUmV3YXJkMiA9IG51bGw7XG4gICAgdGhpcy5sYkxlZnRUaW1lID0gbnVsbDtcblxuICAgIHRoaXMubGJsT3JpZ2luYWxQcmljZSA9IG51bGw7XG4gICAgdGhpcy5sYlByaWNlID0gbnVsbDtcbiAgICB0aGlzLmxibERpc2NvdW50ID0gbnVsbDtcblxuICAgIHRoaXMuYnRuUHVyY2hhc2UgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1N0b3JlQ29uZmlnfVxuICAgICAqL1xuICAgIHRoaXMuc3BlY2lhbE9mZmVyQ2ZnID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoU3BlY2lhbE9mZmVyQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlBVUkNIQVNFX0VORCwgdGhpcy5vblB1cmNoYXNlRW5kLCB0aGlzKTtcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuUFVSQ0hBU0VfRU5ELCB0aGlzLm9uUHVyY2hhc2VFbmQsIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLnNwZWNpYWxPZmZlckNmZyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNwZWNpYWxPZmZlckNmZygpO1xuICAgIHRoaXMubGJUaXRsZS5zZXRTdHJpbmcoXyhcInNwZWNpYWxfb2ZmZXJfdGl0bGVcIikpO1xuICAgIHRoaXMubGJSZXdhcmQxLnNldFN0cmluZyhcInhcIiArIHRoaXMuc3BlY2lhbE9mZmVyQ2ZnLmRhdGEuZGlhbW9uZHMpO1xuXG4gICAgdGhpcy5sYlByaWNlLnNldFN0cmluZyh0aGlzLnNwZWNpYWxPZmZlckNmZy5wcmljZSk7XG4gICAgdGhpcy5sYmxPcmlnaW5hbFByaWNlLnNldFN0cmluZyh0aGlzLnNwZWNpYWxPZmZlckNmZy5vcmlnaW5hbF9wcmljZSk7XG4gICAgdGhpcy5sYmxEaXNjb3VudC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJtb3JlX3RpdGxlXCIpLCBcIlwiICsgKHRoaXMuc3BlY2lhbE9mZmVyQ2ZnLmRpc2NvdW50X211bHRpICogMTAwKSkpO1xufTtcblxuU3BlY2lhbE9mZmVyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5vblB1cmNoYXNlRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIHN1Y2Nlc3MgPSBldmVudC5nZXRVc2VyRGF0YSgpO1xuICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmJ0blB1cmNoYXNlLmVuYWJsZWQgPSB0cnVlO1xuICAgIH1cbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uUHVyY2hhc2UgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5idG5QdXJjaGFzZS5lbmFibGVkID0gZmFsc2U7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlQcm9kdWN0KHRoaXMuc3BlY2lhbE9mZmVyQ2ZnKTtcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvc3RvcmUvc3BlY2lhbF9vZmZlcl92aWV3LmNjYmlcIiwgbnVsbCwgXCJTcGVjaWFsT2ZmZXJDb250cm9sbGVyXCIsIG5ldyBTcGVjaWFsT2ZmZXJDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTcGVjaWFsT2ZmZXJDb250cm9sbGVyOyIsInZhciBNdWx0aUNvbFRhYmxlVmlldyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZXh0L011bHRpQ29sVGFibGVWaWV3XCIpO1xudmFyIFN0b3JlSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9TdG9yZUl0ZW1Db250cm9sbGVyXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIFNraW5JdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1NraW5JdGVtQ29udHJvbGxlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIFN0b3JlVGFiID0ge1xuICAgIERJQU1PTkRTOiAwLFxuICAgIFNLSU5TOiAxXG59O1xuXG52YXIgVGFiVmlzdWFsQ29uZmlnID0ge307XG5UYWJWaXN1YWxDb25maWdbU3RvcmVUYWIuRElBTU9ORFNdID0ge1xuICAgIHRhYk5vZGU6IFwidGFiRGlhbW9uZHNMaWdodFwiLFxuICAgIHVuc2VsZWN0Tm9kZTogXCJ0YWJEaWFtb25kc0RhcmtcIixcbiAgICBjb250ZW50Tm9kZTpcImRpYW1vbmRzQ29udGVudE5vZGVcIlxufTtcblRhYlZpc3VhbENvbmZpZ1tTdG9yZVRhYi5TS0lOU10gPSB7XG4gICAgdGFiTm9kZTpcInRhYlNraW5MaWdodFwiLFxuICAgIHVuc2VsZWN0Tm9kZTpcInRhYlNraW5EYXJrXCIsXG4gICAgY29udGVudE5vZGU6XCJza2luQ29udGVudE5vZGVcIlxufTtcblxudmFyIFN0b3JlU2l6ZSA9IGNjLnNpemUoNTcxLCAxMTApO1xudmFyIFNraW5TaXplID0gY2Muc2l6ZSgyODUsIDIwMCk7XG5cbnZhciBTdG9yZUl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbiAgICBlbnRpdHk6IG51bGwsXG4gICAgaXRlbU5vZGU6IG51bGwsXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlID0gU3RvcmVJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChTdG9yZVNpemUud2lkdGggKiAwLjUsIFN0b3JlU2l6ZS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCkge1xuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbiAgICB9XG59KTtcblxudmFyIFNraW5JdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgZW50aXR5OiBudWxsLFxuICAgIGl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZSA9IFNraW5JdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChTa2luU2l6ZS53aWR0aCAqIDAuNSwgU2tpblNpemUuaGVpZ2h0ICogMC41KSk7XG4gICAgfSxcblxuICAgIGluaXRXaXRoOiBmdW5jdGlvbiAoZW50aXR5LCBpZHgpIHtcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChlbnRpdHksIGlkeCk7XG4gICAgfVxufSk7XG5cbnZhciBTdG9yZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICAvL3RoaXMubGJDaGFwdGVyTmFtZSA9IG51bGw7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG5cbiAgICB0aGlzLm5kVGl0bGUgPSBudWxsO1xuICAgIHRoaXMubGJTdG9yZU5hbWUgPSBudWxsO1xuXG4gICAgdGhpcy5sYkRpYW1vbmRzID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMuY29uZmlncyA9IG51bGw7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoU3RvcmVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5ESUFNT05EU19VUERBVEUsIHRoaXMub25VcGRhdGVEaWFtb25kcywgdGhpcyk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLkRJQU1PTkRTX1VQREFURSwgdGhpcy5vblVwZGF0ZURpYW1vbmRzLCB0aGlzKTtcbiAgICAvL3RoaXMucmVmcmVzaFVJKCk7XG4gICAgdGhpcy5vblVwZGF0ZURpYW1vbmRzKCk7XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlRGlhbW9uZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYkRpYW1vbmRzLnNldFN0cmluZyhnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJTdG9yZU5hbWUuc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJzdG9yZV90aXRsZVwiKSk7XG4gICAgdGhpcy5pbml0U3RvcmVVSSgpO1xufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0U3RvcmVVSSA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL3ZhciBvcmlnaW5hbFRhYiA9IHRoaXMuY3VycmVudFRhYjtcbiAgICB2YXIgc2tpbkNvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTa2luTGlzdCgpO1xuICAgIGNjLmxvZyhcInNraW5Db25maWdzIGxlbmd0aDpcIiArIHNraW5Db25maWdzLmxlbmd0aCk7XG4gICAgLy90aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5TS0lOUztcbiAgICB0aGlzW1RhYlZpc3VhbENvbmZpZ1tTdG9yZVRhYi5TS0lOU10uY29udGVudE5vZGVdID0gdGhpcy5nZXRUYWJsZVZpZXcoe1xuICAgICAgICBncmlkQXRJbmRleDogZnVuY3Rpb24gKG11bHRpVGFibGUsIGlkeCkge1xuICAgICAgICAgICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgICAgICAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgICAgICAgICBjZWxsID0gbmV3IFNraW5JdGVtQ2VsbFZpZXcoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlkeCA8IHNraW5Db25maWdzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSBza2luQ29uZmlnc1tpZHhdO1xuICAgICAgICAgICAgICAgIGNlbGwuaW5pdFdpdGgoY29uZmlnLCBpZHgpO1xuICAgICAgICAgICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY2VsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBudW1iZXJPZkNlbGxzSW5UYWJsZVZpZXc6IGZ1bmN0aW9uIChtdWx0aVRhYmxlKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKHNraW5Db25maWdzLmxlbmd0aCAvIGdyaWRzSW5DZWxsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBudW1iZXJPZkdyaWRzSW5DZWxsOiBmdW5jdGlvbiAobXVsdGlUYWJsZSwgY29sSWR4KSB7XG4gICAgICAgICAgICByZXR1cm4gMjtcbiAgICAgICAgfSxcblxuICAgICAgICBncmlkU2l6ZUZvclRhYmxlOiBmdW5jdGlvbiAodGFibGUsIGNvbElkeCkge1xuICAgICAgICAgICAgLy9yZXR1cm4gY2Muc2l6ZSgyMDAsIDIwMCk7XG4gICAgICAgICAgICByZXR1cm4gY2Muc2l6ZShTa2luU2l6ZS53aWR0aCwgU2tpblNpemUuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAgZ3JpZFRvdWNoZWQ6IGZ1bmN0aW9uICh0YWJsZSwgZ3JpZCkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJncmlkIHRvdWNoZWQgYXQgaW5kZXg6IFwiICsgZ3JpZC5nZXRJZHgoKSk7XG4gICAgICAgICAgICAvL3ZhciBlbnRpdHkgPSBncmlkLmVudGl0eTtcbiAgICAgICAgICAgIC8vQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgICAgICAgICAvL1N0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5U2tpbihlbnRpdHkpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZGlhbW9uZENvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZSgpO1xuICAgIC8vdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuRElBTU9ORFM7XG4gICAgdGhpc1tUYWJWaXN1YWxDb25maWdbU3RvcmVUYWIuRElBTU9ORFNdLmNvbnRlbnROb2RlXSA9IHRoaXMuZ2V0VGFibGVWaWV3KHtcbiAgICAgICAgZ3JpZEF0SW5kZXg6IGZ1bmN0aW9uIChtdWx0aVRhYmxlLCBpZHgpIHtcbiAgICAgICAgICAgIHZhciBjZWxsID0gbXVsdGlUYWJsZS5kZXF1ZXVlR3JpZCgpO1xuICAgICAgICAgICAgaWYgKCFjZWxsKSB7XG4gICAgICAgICAgICAgICAgY2VsbCA9IG5ldyBTdG9yZUl0ZW1DZWxsVmlldygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaWR4IDwgZGlhbW9uZENvbmZpZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGRpYW1vbmRDb25maWdzW2lkeF07XG4gICAgICAgICAgICAgICAgY2VsbC5pbml0V2l0aChjb25maWcsIGlkeCk7XG4gICAgICAgICAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2VsbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjZWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIG51bWJlck9mQ2VsbHNJblRhYmxlVmlldzogZnVuY3Rpb24gKG11bHRpVGFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiBkaWFtb25kQ29uZmlncy5sZW5ndGg7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbnVtYmVyT2ZHcmlkc0luQ2VsbDogZnVuY3Rpb24gKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ3JpZFNpemVGb3JUYWJsZTogZnVuY3Rpb24gKHRhYmxlLCBjb2xJZHgpIHtcbiAgICAgICAgICAgIHJldHVybiBTdG9yZVNpemU7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGdyaWRUb3VjaGVkOiBmdW5jdGlvbiAodGFibGUsIGdyaWQpIHtcbiAgICAgICAgICAgIC8vY2MubG9nKFwiZ3JpZCB0b3VjaGVkIGF0IGluZGV4OiBcIiArIGdyaWQuZ2V0SWR4KCkpO1xuICAgICAgICAgICAgLy92YXIgZW50aXR5ID0gZ3JpZC5lbnRpdHk7XG4gICAgICAgICAgICAvL0F1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgICAgICAgICAgLy9TdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmJ1eVByb2R1Y3QoZW50aXR5KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy90aGlzLmN1cnJlbnRUYWIgPSBvcmlnaW5hbFRhYjtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaFVJID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jdXJyZW50VGFiID0gdGhpcy5jdXJyZW50VGFiIHx8IFN0b3JlVGFiLkRJQU1PTkRTO1xuICAgIGNjLmxvZyhcIlN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaFVJOlwiICsgdGhpcy5jdXJyZW50VGFiKTtcbiAgICAvL3RoaXMuY3VycmVudFRhYiA9IFN0b3JlVGFiLlNLSU5TO1xuICAgIGZvcih2YXIgaSBpbiBUYWJWaXN1YWxDb25maWcpIHtcbiAgICAgICAgLy92YXIgdGFiTm9kZSA9IHRoaXNbVGFiVmlzdWFsQ29uZmlnW2ldLnRhYk5vZGVdO1xuICAgICAgICB2YXIgdW5TZWxlY3ROb2RlID0gdGhpc1tUYWJWaXN1YWxDb25maWdbaV0udW5zZWxlY3ROb2RlXTtcbiAgICAgICAgdmFyIGNvbnRlbnROb2RlID0gdGhpc1tUYWJWaXN1YWxDb25maWdbaV0uY29udGVudE5vZGVdO1xuICAgICAgICAvL3RhYk5vZGUgJiYgdGFiTm9kZS5zZXRWaXNpYmxlKE51bWJlcihpKSA9PT0gdGhpcy5jdXJyZW50VGFiKTtcbiAgICAgICAgY29udGVudE5vZGUgJiYgY29udGVudE5vZGUuc2V0VmlzaWJsZShOdW1iZXIoaSkgPT09IHRoaXMuY3VycmVudFRhYik7XG4gICAgICAgIHVuU2VsZWN0Tm9kZSAmJiB1blNlbGVjdE5vZGUuc2V0VmlzaWJsZShOdW1iZXIoaSkgIT09IHRoaXMuY3VycmVudFRhYik7XG4gICAgfVxufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uICh0eXBlLCBjYWxsYmFjaykge1xuICAgIGNjLmxvZyhcIlN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGg6XCIgKyB0eXBlKTtcbiAgICBpZiAodHlwZSA9PT0gU3RvcmVUeXBlLlNLSU4pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuU0tJTlM7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBTdG9yZVR5cGUuRElBTU9ORCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5ESUFNT05EUztcbiAgICB9XG4gICAgdGhpcy5yZWZyZXNoVUkoKTtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0VGFibGVWaWV3ID0gZnVuY3Rpb24gKGRhdGFTb3VyY2UsIGRlbGVnYXRlKSB7XG4gICAgdmFyIHRhYmxlVmlldyA9IG5ldyBNdWx0aUNvbFRhYmxlVmlldyhkYXRhU291cmNlLCB0aGlzLm5kQ29udGFpbmVyLmdldENvbnRlbnRTaXplKCksIG51bGwpO1xuICAgIHRhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgIHRhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKTtcbiAgICB0YWJsZVZpZXcuc2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZShkZWxlZ2F0ZSk7XG4gICAgdGFibGVWaWV3Lmlnbm9yZUFuY2hvclBvaW50Rm9yUG9zaXRpb24oZmFsc2UpO1xuICAgIHRhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICB0YWJsZVZpZXcucmVsb2FkRGF0YSgpO1xuICAgIHRoaXMubmRDb250YWluZXIuYWRkQ2hpbGQodGFibGVWaWV3KTtcbiAgICByZXR1cm4gdGFibGVWaWV3O1xufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5vbkNsaWNrU2tpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5TS0lOUztcbiAgICB0aGlzLnJlZnJlc2hVSSgpO1xufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5vbkNsaWNrRGlhbW9uZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuRElBTU9ORFM7XG4gICAgdGhpcy5yZWZyZXNoVUkoKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuU3RvcmVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL3N0b3JlL3N0b3JlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlN0b3JlQ29udHJvbGxlclwiLCBuZXcgU3RvcmVDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZUNvbnRyb2xsZXI7IiwidmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgU3RvcmVJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgLy9wcmljZVxuICAgIHRoaXMubGJQcmljZSA9IG51bGw7XG4gICAgdGhpcy5zcFJld2FyZGVkVmlkZW8gPSBudWxsO1xuICAgIHRoaXMubmREaWFtb25kUHJpY2UgPSBudWxsO1xuICAgIHRoaXMubGJEaWFtb25kUHJpY2UgPSBudWxsO1xuXG4gICAgLy9ub2RlXG4gICAgdGhpcy5uZFJlc3RvcmUgPSBudWxsO1xuICAgIHRoaXMubmRCb29zdHMgPSBudWxsO1xuICAgIHRoaXMubmREaWFtb25kID0gbnVsbDtcbiAgICB0aGlzLm5kUHVyY2hhc2UgPSBudWxsO1xuXG4gICAgLy9cbiAgICB0aGlzLmxiU3BsaXQgPSBudWxsO1xuICAgIHRoaXMubGJOZXdUaHJlZSA9IG51bGw7XG4gICAgdGhpcy5sYkRpYW1vbmQgPSBudWxsO1xuICAgIHRoaXMuc3BEaWFtb25kID0gbnVsbDtcblxuICAgIC8vdGFnXG4gICAgdGhpcy5zcEhvdFRhZyA9IG51bGw7XG4gICAgdGhpcy5zcEZyZWVUYWcgPSBudWxsO1xuICAgIHRoaXMuc3BQZXJjZW50VGFnID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZWRCZyA9IG51bGw7XG5cbiAgICB0aGlzLmxiVGFnID0gbnVsbDtcblxuICAgIHRoaXMuYnRuQ2xhaW0gPSBudWxsO1xuXG4gICAgdGhpcy5uZFJlbWluZGVyID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoU3RvcmVJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5TdG9yZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7U3RvcmVDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuU3RvcmVJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoZGF0YSwgaWR4KSB7XG4gICAgdGhpcy5zdG9yZUVudGl0eSA9IGRhdGE7XG4gICAgdGhpcy5pZHggPSBpZHg7XG4gICAgdGhpcy5sYlByaWNlLnNldFN0cmluZyhkYXRhLnByaWNlKTtcblxuICAgIHRyeSB7XG5cbiAgICAgICAgdGhpcy5uZFJlc3RvcmUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kQm9vc3RzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZERpYW1vbmQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kUHVyY2hhc2UudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5sYlByaWNlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZERpYW1vbmRQcmljZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3BSZXdhcmRlZFZpZGVvLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnNwSG90VGFnLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zcEZyZWVUYWcudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNwUGVyY2VudFRhZy52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5sYlRhZy52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5zcFJlZEJnLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmJ0bkNsYWltLmVuYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMubmRSZW1pbmRlci52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHNwcml0ZUZyYW1lO1xuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuRlJFRTpcbiAgICAgICAgICAgICAgICB0aGlzLm5kRGlhbW9uZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiRGlhbW9uZC5zZXRTdHJpbmcoZGF0YS5jb3VudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zcFJld2FyZGVkVmlkZW8udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UpO1xuICAgICAgICAgICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwRGlhbW9uZC5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vdGFnXG4gICAgICAgICAgICAgICAgdGhpcy5zcEZyZWVUYWcudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5sYlRhZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiVGFnLnNldFN0cmluZyhfKFwiZnJlZV9jb2luc190aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5uZFJlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuUkVNT1ZFX0FEUzpcbiAgICAgICAgICAgICAgICB0aGlzLm5kRGlhbW9uZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiRGlhbW9uZC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJlbW92ZV9hZHNfdGl0bGVcIikpO1xuICAgICAgICAgICAgICAgIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShkYXRhLmltYWdlKTtcbiAgICAgICAgICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcERpYW1vbmQuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxiUHJpY2UudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zcEhvdFRhZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiVGFnLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJUYWcuc2V0U3RyaW5nKF8oXCJob3RfdGl0bGVcIikpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuUkVTVE9SRTpcbiAgICAgICAgICAgICAgICB0aGlzLm5kUmVzdG9yZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5kUHVyY2hhc2UudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BSZWRCZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLk5FV19BTkRfU1BMSVQ6XG4gICAgICAgICAgICAgICAgdGhpcy5uZEJvb3N0cy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiU3BsaXQuc2V0U3RyaW5nKFwieFwiICsgZGF0YS5kYXRhLm11bHRpcGxlXzMpO1xuICAgICAgICAgICAgICAgIHRoaXMubGJOZXdUaHJlZS5zZXRTdHJpbmcoXCJ4XCIgKyBkYXRhLmRhdGEubXVsdGlwbGVfMyk7XG4gICAgICAgICAgICAgICAgdGhpcy5uZERpYW1vbmRQcmljZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiRGlhbW9uZFByaWNlLnNldFN0cmluZyhkYXRhLmNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLkRJQU1PTkQ6XG4gICAgICAgICAgICAgICAgdGhpcy5uZERpYW1vbmQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5sYkRpYW1vbmQuc2V0U3RyaW5nKGRhdGEuY291bnQpO1xuICAgICAgICAgICAgICAgIHRoaXMubGJQcmljZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BEaWFtb25kLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy90YWdcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5leHRyYSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcFBlcmNlbnRUYWcudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGJUYWcudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGJUYWcuc2V0U3RyaW5nKFwiK1wiICsgKGRhdGEuZXh0cmEgKiAxMDApICsgXCIlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIGNjLmVycm9yKGV4KTtcbiAgICB9XG59O1xuXG5TdG9yZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5nZXRDb250ZW50U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zcEJnLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5TdG9yZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5wdXJjaGFzZUNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5UHJvZHVjdCh0aGlzLnN0b3JlRW50aXR5KTtcbn07XG5cblN0b3JlSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvc3RvcmUvc3RvcmVfaXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJTdG9yZUl0ZW1Db250cm9sbGVyXCIsIG5ldyBTdG9yZUl0ZW1Db250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZUl0ZW1Db250cm9sbGVyOyIsInZhciBUYXNrSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9UYXNrSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBNdWx0aUNvbFRhYmxlVmlldyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZXh0L011bHRpQ29sVGFibGVWaWV3XCIpO1xuXG52YXIgR1JJRF9TSVpFID0gY2Muc2l6ZSgyNzAsIDIwMCk7XG5cbnZhciBTdG9yZUl0ZW1DZWxsVmlldyA9IGNjLlRhYmxlVmlld0NlbGwuZXh0ZW5kKHtcbiAgICBlbnRpdHk6IG51bGwsXG4gICAgaXRlbU5vZGU6IG51bGwsXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlID0gVGFza0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLml0ZW1Ob2RlKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5zZXRQb3NpdGlvbihjYy5wKEdSSURfU0laRS53aWR0aCAqIDAuNSwgR1JJRF9TSVpFLmhlaWdodCAqIDAuNSkpO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aDogZnVuY3Rpb24gKGVudGl0eSwgaWR4KSB7XG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoZW50aXR5LCBpZHgpO1xuICAgIH1cbn0pO1xuXG52YXIgVGFza0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyID0gbnVsbDtcblxuICAgIHRoaXMubGJsVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5fdGFibGVWaWV3ID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMuY29uZmlncyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFRhc2tDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9TS0lOLCB0aGlzLm9uVXBkYXRlU2tpbiwgdGhpcyk7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoXyhcInRhc2tfdGl0bGVcIikpO1xuXG4gICAgdGhpcy5jb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0VGFza0xpc3QoKTtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVNraW4gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zaG93VGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5fdGFibGVWaWV3KSB7XG4gICAgICAgIHZhciBzaXplID0gdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgc2l6ZSwgbnVsbCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICAgICAgdGhpcy5uZENvbnRhaW5lci5hZGRDaGlsZCh0aGlzLl90YWJsZVZpZXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IHRoaXMuX3RhYmxlVmlldy5nZXRDb250ZW50T2Zmc2V0KCk7XG4gICAgfVxuICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG4gICAgaWYgKHRoaXMuX29mZnNldCkge1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldCh0aGlzLl9vZmZzZXQpO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBudWxsO1xuICAgIH1cbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkU2Nyb2xsID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZEF0SW5kZXggPSBmdW5jdGlvbihtdWx0aVRhYmxlLCAgaWR4KSB7XG4gICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICAgIGNlbGwgPSBuZXcgU3RvcmVJdGVtQ2VsbFZpZXcoKTtcbiAgICB9XG5cbiAgICBpZiAoaWR4IDwgdGhpcy5jb25maWdzLmxlbmd0aCkge1xuICAgICAgICB2YXIgc2tpbkNmZyA9IHRoaXMuY29uZmlnc1tpZHhdO1xuICAgICAgICBjZWxsLmluaXRXaXRoKHNraW5DZmcsIGlkeCk7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNlbGw7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3ID0gZnVuY3Rpb24obXVsdGlUYWJsZSkge1xuICAgIHZhciBncmlkc0luQ2VsbCA9IHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbChtdWx0aVRhYmxlKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKHRoaXMuY29uZmlncy5sZW5ndGggLyBncmlkc0luQ2VsbCk7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAyO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRTaXplRm9yVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIGNjLnNpemUoMjcwLCAyMjApO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRUb3VjaGVkID0gZnVuY3Rpb24odGFibGUsIGdyaWQpIHtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcblxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL2lmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAvLyAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAvLyAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIC8vfVxufTtcblxuVGFza0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS90YXNrX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlRhc2tDb250cm9sbGVyXCIsIG5ldyBUYXNrQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGFza0NvbnRyb2xsZXI7IiwidmFyIFNraW5SZXdhcmRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblJld2FyZFR5cGVcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBUYXNrSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJsR29hbCA9IG51bGw7XG4gICAgdGhpcy5sYmxHb2FsSW5mbyA9IG51bGw7XG4gICAgLy90aGlzLnNwU2tpbiA9IG51bGw7XG4gICAgdGhpcy5zcEJnU2VsZWN0ZWQgPSBudWxsO1xuXG4gICAgdGhpcy5sYmxTZWxlY3QgPSBudWxsO1xuICAgIHRoaXMuYnRuU2VsZWN0ID0gbnVsbDtcbiAgICB0aGlzLm5kU2VsZWN0ID0gbnVsbDtcblxuICAgIHRoaXMubGJsRGlhbW9uZHMgPSBudWxsO1xuXG4gICAgLy90aGlzLmxibFVzaW5nID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLnRhc2tDZmcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhUYXNrSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuVGFza0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge1Rhc2tDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuVGFza0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICB0aGlzLmlkeCA9IGlkeDtcbiAgICB0aGlzLnRhc2tDZmcgPSBkYXRhO1xuICAgIHRoaXMucmVmcmVzaCgpO1xufTtcblxuVGFza0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYXRhID0gdGhpcy50YXNrQ2ZnO1xuICAgIHZhciBjb21wbGV0ZWQgPSBmYWxzZTtcbiAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLk5vbmU6XG4gICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuTGV2ZWxDb3VudDpcbiAgICAgICAgICAgIHRoaXMubGJsR29hbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibEdvYWwuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihnYW1lLmxvY2FsLmdldFZhbHVlKFwibGV2ZWxfY291bnRfdGl0bGVcIiksIGRhdGEuY291bnQpKTtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY29tcGxldGVkX3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXCIlZC8lZFwiLCBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpLCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5XYXRjaEFkQ291bnQ6XG4gICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIndhdGNoX2FkX2NvdW50X3RpdGxlXCIpLCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmludGVyc3RpdGlhbEFkQ291bnQgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8uc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjb21wbGV0ZWRfdGl0bGVcIikpO1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8uc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihcIiVkLyVkXCIsIGdhbWUucGxheWVyTWFuLnBsYXllci5pbnRlcnN0aXRpYWxBZENvdW50LCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5XYXRjaFJld2FyZEFkQ291bnQ6XG4gICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIndhdGNoX3Jld2FyZF9hZF9jb3VudF90aXRsZVwiKSwgZGF0YS5jb3VudCkpO1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5yZXdhcmRlZEFkQ291bnQgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8uc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjb21wbGV0ZWRfdGl0bGVcIikpO1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8uc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihcIiVkLyVkXCIsIGdhbWUucGxheWVyTWFuLnBsYXllci5yZXdhcmRlZEFkQ291bnQsIGRhdGEuY291bnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLkNsYWltZWQ6XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihkYXRhLmlkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnNldFN0cmluZyhfKFwic2tpbl9naWZ0X3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhcIi0tXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuUHVyY2hhc2U6XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihkYXRhLmlkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnNldFN0cmluZyhfKFwic2tpbl9wdXJjaGFzZV90aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby5zZXRTdHJpbmcoXCItLVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRoaXMubGJsRGlhbW9uZHMuc2V0U3RyaW5nKFwieFwiICsgZGF0YS5yZXdhcmRDb3VudCk7XG5cbiAgICAvL3ZhciBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSArIFwiLnBuZ1wiKTtcbiAgICAvL3RoaXMuc3BTa2luLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAvL3RoaXMubGJsVXNpbmcuc2V0U3RyaW5nKF8oXCJzZWxlY3RlZF90aXRsZVwiKSk7XG5cbiAgICAvL3RoaXMubGJsVXNpbmcudmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5uZFNlbGVjdC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5idG5TZWxlY3QuZW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgdmFyIGNsYWltZWQgPSBnYW1lLnBsYXllck1hbi5pc1Rhc2tDbGFpbWVkKHRoaXMudGFza0NmZy5pZCk7XG4gICAgdGhpcy5uZFNlbGVjdC52aXNpYmxlID0gdHJ1ZTtcblxuICAgIGlmIChjb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKCFjbGFpbWVkKSB7XG4gICAgICAgICAgICB0aGlzLmJ0blNlbGVjdC5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJsU2VsZWN0LnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY2xhaW1fdGl0bGVcIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYmxTZWxlY3Quc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjbGFpbWVkX3RpdGxlXCIpKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubGJsU2VsZWN0LnNldFN0cmluZyhfKFwidW5jb21wbGV0ZWRfdGl0bGVcIikpO1xuICAgIH1cbn07XG5cblRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q29udGVudFNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BCZ1NlbGVjdGVkLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5UYXNrSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnNlbGVjdENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgY2MubG9nKFwidGFzayBjbGFpbWVkOlwiICsgZ2FtZS5wbGF5ZXJNYW4uaXNUYXNrQ2xhaW1lZCh0aGlzLnRhc2tDZmcuaWQpKTtcbiAgICBpZiAoIWdhbWUucGxheWVyTWFuLmlzVGFza0NsYWltZWQodGhpcy50YXNrQ2ZnLmlkKSkge1xuICAgICAgICBjYy5sb2coXCJ0YXNrIHNldCBjbGFpbWVkOlwiICsgdGhpcy50YXNrQ2ZnLmlkKTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0VGFza0NsYWltZWQodGhpcy50YXNrQ2ZnLmlkKTtcbiAgICAgICAgdmFyIHJld2FyZENvdW50ID0gdGhpcy50YXNrQ2ZnLnJld2FyZENvdW50O1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyZXdhcmRfdmlkZW9fZGlhbW9uZHNcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMocmV3YXJkQ291bnQpO1xuICAgICAgICAgICAgfSwgXCJpY29uX2RpYW1vbmRfMS5wbmdcIiwgcmV3YXJkQ291bnQpO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlRBU0tfVVBEQVRFKTtcbiAgICB9XG59O1xuXG5UYXNrSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L3Rhc2tfaXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJUYXNrSXRlbUNvbnRyb2xsZXJcIiwgbmV3IFRhc2tJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGFza0l0ZW1Db250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgQ29sb3JMaXN0ID0gW1xuICAgIGNjLmNvbG9yKDI1NSwgMTA2LCAxMDcpLFxuICAgIGNjLmNvbG9yKDkwLCAxODEsIDExMCksXG4gICAgY2MuY29sb3IoODMsIDE4MywgMjA5KSxcbiAgICBjYy5jb2xvcigyNDMsIDc3LCAxNTEpLFxuICAgIGNjLmNvbG9yKDE1MywgOTUsIDIwNiksXG4gICAgY2MuY29sb3IoNTcsIDEwMywgMjQ5KSxcbiAgICBjYy5jb2xvcigyNDksIDExMiwgNDkpLFxuICAgIGNjLmNvbG9yKDIzMiwgNTksIDIwKSxcbiAgICBjYy5jb2xvcig4NCwgMjM1LCA0MyksXG4gICAgY2MuY29sb3IoNTAsIDg0LCAxMTcpLFxuICAgIGNjLmNvbG9yKDEyNywgMTI3LCAxMjcpXG5dO1xuXG5cbnZhciBUaXRsZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQ29pbnMgPSBudWxsO1xuXG4gICAgdGhpcy5zcENvaW5zQWRkID0gbnVsbDtcbiAgICB0aGlzLmJ0bkFkZCA9IG51bGw7XG5cbiAgICB0aGlzLmJnTm9kZSA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFRpdGxlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLkNPSU5TX1VQREFURSwgdGhpcy5yZWZyZXNoLCB0aGlzKTtcbn07XG5cblRpdGxlQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5DT0lOU19VUERBVEUsIHRoaXMucmVmcmVzaCwgdGhpcyk7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB0aGlzLnJhbmRvbVNxdWFyZXMoKTtcblxuICAgIGlmIChUaXRsZUNvbnRyb2xsZXIudGltZSA+IDApIHtcbiAgICAgICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwiRGVmYXVsdCBUaW1lbGluZVwiKTtcbiAgICB9XG4gICAgVGl0bGVDb250cm9sbGVyLnRpbWUgKys7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLnJhbmRvbVNxdWFyZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyMDsgKytpKSB7XG4gICAgICAgIHZhciBzcXVhcmUgPSBuZXcgY2MuU3ByaXRlKFwiI3NxdWFyZV9jaXJjbGUucG5nXCIpO1xuXG4gICAgICAgIHNxdWFyZS5zZXRQb3NpdGlvbih0aGlzLmdldFJhbmRvbVBvcygpKTtcbiAgICAgICAgc3F1YXJlLnNldENvbG9yKENvbG9yTGlzdFtnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoQ29sb3JMaXN0Lmxlbmd0aCAtIDEpXSk7XG4gICAgICAgIHNxdWFyZS5zZXRPcGFjaXR5KDE1KTtcbiAgICAgICAgc3F1YXJlLnNldFNjYWxlKDEuNCk7XG5cbiAgICAgICAgdmFyIHBvczEgPSB0aGlzLmdldFJhbmRvbVBvcygpO1xuICAgICAgICBzcXVhcmUuc2V0UG9zaXRpb24ocG9zMSk7XG4gICAgICAgIHZhciBwb3MyID0gdGhpcy5nZXRSYW5kb21Qb3MoKTtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmdldFRpbWUocG9zMSwgcG9zMik7XG4gICAgICAgIHZhciBtb3ZlVG8xID0gY2MubW92ZVRvKHQsIHBvczIpO1xuICAgICAgICB2YXIgbW92ZVRvMiA9IGNjLm1vdmVUbyh0LCBwb3MxKTtcbiAgICAgICAgdmFyIGFjdGlvbiA9IGNjLnNlcXVlbmNlKG1vdmVUbzEsIG1vdmVUbzIpLnJlcGVhdEZvcmV2ZXIoKTtcbiAgICAgICAgc3F1YXJlLnJ1bkFjdGlvbihhY3Rpb24pO1xuICAgICAgICBzcXVhcmUucnVuQWN0aW9uKGNjLnJvdGF0ZUJ5KDIwLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG4gICAgICAgIHRoaXMuYmdOb2RlLmFkZENoaWxkKHNxdWFyZSk7XG4gICAgfVxufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5nZXRUaW1lID0gZnVuY3Rpb24gKHBvczEsIHBvczIpIHtcbiAgICByZXR1cm4gY2MucERpc3RhbmNlKHBvczEsIHBvczIpIC8gMjA7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLmdldFJhbmRvbVBvcyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gY2MucChnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoY2Mud2luU2l6ZS53aWR0aCAqIDEuNSkgLSBjYy53aW5TaXplLndpZHRoICogMC4yNSxcbiAgICAgICAgZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KGNjLndpblNpemUuaGVpZ2h0ICogMS41KSAtIGNjLndpblNpemUuaGVpZ2h0ICogMC4yNSk7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHJlcGxheUNhbGxiYWNrLCBuZXh0Q2FsbGJhY2spIHtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IHJlcGxheUNhbGxiYWNrO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG5leHRDYWxsYmFjaztcbn07XG5cblRpdGxlQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxiQ29pbnMuc2V0U3RyaW5nKGdhbWUucGxheWVyTWFuLnBsYXllci5jb2lucyk7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLmRpc2FibGVBZGRDb2lucyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNwQ29pbnNBZGQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuYnRuQWRkLmVuYWJsZWQgPSBmYWxzZTtcbiAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJub25lXCIpO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5zdG9yZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKCk7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS90aXRsZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJUaXRsZUNvbnRyb2xsZXJcIiwgbmV3IFRpdGxlQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cblRpdGxlQ29udHJvbGxlci50aW1lID0gMDtcblxubW9kdWxlLmV4cG9ydHMgPSBUaXRsZUNvbnRyb2xsZXI7IiwidmFyIFdoZWVsID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi93aGVlbC9XaGVlbFwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xuXG52YXIgV2hlZWxDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5XSEVFTF9USU1FID0gNTtcbiAgICB0aGlzLldIRUVMX0lURU1fQU5HTEUgPSA5MDtcblxuICAgIHRoaXMuV0hFRUxfSUNPTl9UQUcgPSAxMDA7XG4gICAgdGhpcy5XSEVFTF9OVU1fVEFHID0gMjAwO1xuXG4gICAgdGhpcy5XSEVFTF9DT1VOVCA9IDQ7XG5cbiAgICB0aGlzLm5kV2hlZWwgPSBudWxsO1xuICAgIHRoaXMubGJsTGVmdCA9IG51bGw7XG4gICAgdGhpcy5sYmxSaWdodCA9IG51bGw7XG4gICAgdGhpcy5idG5MZWZ0ID0gbnVsbDtcbiAgICB0aGlzLmJ0blJpZ2h0ID0gbnVsbDtcblxuICAgIHRoaXMuYnRuQ2xvc2UgPSBudWxsO1xuXG4gICAgdGhpcy5sYmxMZWZ0VGlwcyA9IG51bGw7XG4gICAgdGhpcy5sYmxSaWdodFRpcHMgPSBudWxsO1xuXG4gICAgdGhpcy5zcFRpdGxlQ24gPSBudWxsO1xuICAgIHRoaXMuc3BUaXRsZUVuID0gbnVsbDtcblxuICAgIC8vdGhpcy5idG5DbG9zZUNuID0gbnVsbDtcbiAgICAvL3RoaXMuYnRuQ2xvc2VFbiA9IG51bGw7XG5cblxuXG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7V2hlZWx9XG4gICAgICovXG4gICAgdGhpcy53aGVlbCA9IG51bGw7XG5cbiAgICB0aGlzLndoZWVsSWNvbnMgPSBudWxsO1xuICAgIHRoaXMud2hlZWxOdW1zID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoV2hlZWxDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuaW50ZXJ2YWxLZXkgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcyksIDEwMDApO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgLy90aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwVGl0bGVDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcFRpdGxlRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIGlmIChnYW1lLmxvY2FsLmlzQ2hpbmVzZSgpKSB7XG4gICAgICAgIC8vdGhpcy5idG5DbG9zZUNuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwVGl0bGVDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvL3RoaXMuYnRuQ2xvc2VFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcFRpdGxlRW4udmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy53aGVlbEljb25zID0gW107XG4gICAgdGhpcy53aGVlbE51bXMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuV0hFRUxfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIgd2hlZWxJY29uID0gZ2FtZS51dGlscy5zZWVrTm9kZUJ5VGFnKHRoaXMubmRXaGVlbCwgdGhpcy5XSEVFTF9JQ09OX1RBRyArIGkpO1xuICAgICAgICB2YXIgd2hlZWxOdW0gPSBnYW1lLnV0aWxzLnNlZWtOb2RlQnlUYWcodGhpcy5uZFdoZWVsLCB0aGlzLldIRUVMX05VTV9UQUcgKyBpKTtcbiAgICAgICAgdGhpcy53aGVlbEljb25zLnB1c2god2hlZWxJY29uKTtcbiAgICAgICAgdGhpcy53aGVlbE51bXMucHVzaCh3aGVlbE51bSk7XG4gICAgfVxuXG4gICAgdGhpcy5pbml0V2hlZWxVSSgpO1xuICAgIHRoaXMudXBkYXRlV2hlZWxJdGVtcygpO1xuICAgIHRoaXMud2hlZWwgPSBuZXcgV2hlZWwodGhpcy5uZFdoZWVsKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdoZWVsVUkgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdoZWVscyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFdoZWVsTGlzdCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2hlZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciB3aGVlbEljb24gPSB0aGlzLndoZWVsSWNvbnNbaV07XG4gICAgICAgIHZhciB3aGVlbE51bSA9IHRoaXMud2hlZWxOdW1zW2ldO1xuICAgICAgICB3aGVlbEljb24uc2V0U3ByaXRlRnJhbWUod2hlZWxzW2ldLmltYWdlKTtcbiAgICAgICAgd2hlZWxOdW0uc2V0U3RyaW5nKFwieFwiICsgd2hlZWxzW2ldLmNvdW50KTtcbiAgICB9XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLmlzU2hvd1Jld2FyZGVkVmlkZW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51cGRhdGVXaGVlbEl0ZW1zKCk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLmlzRnJlZVdoZWVsID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsZWZ0VGltZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRXaGVlbExlZnRUaW1lKCk7XG4gICAgaWYgKGxlZnRUaW1lIDw9IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0TGVmdEhvdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxlZnRUaW1lID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFdoZWVsTGVmdFRpbWUoKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKGxlZnRUaW1lIC8gKDYwICogNjAgKiAxMDAwKSk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVdoZWVsSXRlbXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYmxMZWZ0LnNldFN0cmluZyhfKFwid2hlZWxfcmV3YXJkX3ZpZGVvX2J0blwiKSk7XG4gICAgdGhpcy5sYmxMZWZ0VGlwcy5zZXRTdHJpbmcoXyhcIndoZWVsX3Jld2FyZF92aWRlb190aXBzXCIpKTtcbiAgICAvL2lmICh0aGlzLmlzU2hvd1Jld2FyZGVkVmlkZW8oKSkge1xuICAgIC8vICAgIHRoaXMuYnRuTGVmdC5lbmFibGVkID0gdHJ1ZTtcbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgdGhpcy5idG5MZWZ0LmVuYWJsZWQgPSBmYWxzZTtcbiAgICAvL31cbiAgICAvLyAgICB0aGlzLmxibExlZnQuc2V0U3RyaW5nKF8oXCJ3aGVlbF9zaGFyZV9idG5cIikpO1xuICAgIC8vICAgIHRoaXMubGJsTGVmdFRpcHMuc2V0U3RyaW5nKF8oXCJ3aGVlbF9zaGFyZV90aXBzXCIpKTtcbiAgICAvL31cbiAgICAvL3RoaXMubGJsTGVmdC5zZXRTdHJpbmcoXyhcIndoZWVsX3NoYXJlX2J0blwiKSk7XG4gICAgLy90aGlzLmxibExlZnRUaXBzLnNldFN0cmluZyhcIlwiKTsvL18oXCJ3aGVlbF9zaGFyZV90aXBzXCIpKTtcblxuICAgIHRoaXMubGJsUmlnaHQuc2V0U3RyaW5nKF8oXCJ3aGVlbF9mcmVlX2J0blwiKSk7XG4gICAgdmFyIGZyZWVXaGVlbCA9IHRoaXMuaXNGcmVlV2hlZWwoKTtcbiAgICB0aGlzLmJ0blJpZ2h0LmVuYWJsZWQgPSBmcmVlV2hlZWw7XG4gICAgaWYgKGZyZWVXaGVlbCkge1xuICAgICAgICB0aGlzLmxibFJpZ2h0VGlwcy5zZXRTdHJpbmcoXCJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYmxSaWdodFRpcHMuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwid2hlZWxfZnJlZV90aXBzXCIpLCB0aGlzLmdldExlZnRIb3VyKCkpKTtcbiAgICB9XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLmdldFJhbmRvbVdoZWVsID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB3aGVlbHMgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRXaGVlbExpc3QoKTtcbiAgICB2YXIgcmFuZG9tTnVtID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDEwMCk7XG4gICAgY29uc29sZS5sb2coXCJyYW5kb21OdW06XCIgKyByYW5kb21OdW0pO1xuICAgIHZhciBzdW1Qcm9iYWJpbGl0eSA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aGVlbHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKHN1bVByb2JhYmlsaXR5ICsgd2hlZWxzW2ldLnByb2JhYmlsaXR5ID4gcmFuZG9tTnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gd2hlZWxzW2ldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VtUHJvYmFiaWxpdHkgKz0gd2hlZWxzW2ldLnByb2JhYmlsaXR5O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5zdGFydFdoZWVsID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMud2hlZWxDb25maWcgPSB0aGlzLmdldFJhbmRvbVdoZWVsKCk7XG4gICAgdmFyIHdoZWVsSWQgPSB0aGlzLndoZWVsQ29uZmlnLmlkO1xuICAgIGNvbnNvbGUubG9nKFwicmFuZG9tIHdoZWVsIGlkOlwiICsgd2hlZWxJZCk7XG4gICAgdGhpcy53aGVlbC5yb3RhdGUodGhpcy5XSEVFTF9USU1FLCAzNjAgKiAzICsgKHdoZWVsSWQgLSAxKSAqIDkwLCB0aGlzLldIRUVMX0lURU1fQU5HTEUsIHRoaXMub25Sb3RhdGVFbmQuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5idG5DbG9zZS5lbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy53aGVlbEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIndoZWVsX3BpblwiKTtcbiAgICB9LCAxMDApO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vblJvdGF0ZUVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMud2hlZWxJbnRlcnZhbCk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJ3aGVlbF9zdG9wXCIpO1xuICAgIHNldFRpbWVvdXQodGhpcy5vblNob3dSZXdhcmQuYmluZCh0aGlzKSwgMTAwMCk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLm9uU2hvd1Jld2FyZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgd2hlZWwgPSB0aGlzLndoZWVsQ29uZmlnO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmREb3VibGVUaXBEbGcod2hlZWwuaW1hZ2UsIHdoZWVsLmNvdW50LCBmdW5jdGlvbiAoZG91YmxlKSB7XG4gICAgICAgIHZhciBjb3VudCA9IGRvdWJsZSA/IHdoZWVsLmNvdW50ICogMiA6IHdoZWVsLmNvdW50O1xuICAgICAgICB2YXIgc3BsaXRDb3VudCA9IDA7XG4gICAgICAgIHZhciB0aHJlZUJhbGxDb3VudCA9IDA7XG4gICAgICAgIGlmICh3aGVlbC50eXBlID09PSBCb29zdFR5cGUuU1BMSVQpIHtcbiAgICAgICAgICAgIHNwbGl0Q291bnQgPSBjb3VudDtcbiAgICAgICAgfSBlbHNlIGlmICh3aGVlbC50eXBlID09PSBCb29zdFR5cGUuVEhSRUVfQkFMTCkge1xuICAgICAgICAgICAgdGhyZWVCYWxsQ291bnQgPSBjb3VudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG91YmxlKSB7XG4gICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwQm9vc3RSZXdhcmREbGcoc3BsaXRDb3VudCwgdGhyZWVCYWxsQ291bnQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQm9vc3QoQm9vc3RUeXBlLlNQTElULCBzcGxpdENvdW50KTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idG5DbG9zZS5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy51cGRhdGVXaGVlbEl0ZW1zKCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUubGVmdENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmICh0aGlzLmlzU2hvd1Jld2FyZGVkVmlkZW8oKSkge1xuICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiemh1YW5wYW4wMVwiIDogXCJqaWxpMDFcIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0V2hlZWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYudXBkYXRlV2hlZWxJdGVtcygpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvL3NoYXJlXG4gICAgICAgIC8vdmFyIHNoYXJlID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFNoYXJlQ29uZmlnKCk7XG4gICAgICAgIC8vZ2FtZS5zaGFyZU1hbmFnZXIud3hHcm91cFNoYXJlKHNoYXJlLCBcIndoZWVsX3NoYXJlXCIsIGZ1bmN0aW9uIChzaGFyZWQpIHtcbiAgICAgICAgLy8gICAgaWYgKHNoYXJlZCkge1xuICAgICAgICAvLyAgICAgICAgc2VsZi5zdGFydFdoZWVsKCk7XG4gICAgICAgIC8vICAgIH0gZWxzZSB7XG4gICAgICAgIC8vICAgICAgICBnYW1lLnV0aWxzLnNob3dXWFRvYXN0KFwi6ZyA6KaB6L2s5Y+R5Yiw576kXCIpO1xuICAgICAgICAvLyAgICB9XG4gICAgICAgIC8vfSk7XG4gICAgfVxufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5yaWdodENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TGFzdFdoZWVsVGltZShEYXRlLm5vdygpKTtcbiAgICB0aGlzLnVwZGF0ZVdoZWVsSXRlbXMoKTtcbiAgICB0aGlzLmJ0blJpZ2h0LmVuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXJ0V2hlZWwoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjY2JpTmFtZSA9IGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpID8gXCJyZXMvd2hlZWwvd2hlZWxfdmlldy5jY2JpXCIgOiBcInJlcy93aGVlbC93aGVlbF92aWV3X25ldy5jY2JpXCI7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihjY2JpTmFtZSwgbnVsbCwgXCJXaGVlbENvbnRyb2xsZXJcIiwgbmV3IFdoZWVsQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2hlZWxDb250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgR3JpZCA9IGNjLkxheWVyQ29sb3IuZXh0ZW5kKHtcblxuICAgIGNvbDogMCxcbiAgICByb3c6IDAsXG5cbiAgICBlZGl0aW5nOiBmYWxzZSxcbiAgICB1c2VkOiBmYWxzZSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCwgY29sLCByb3cpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY29sb3IsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB0aGlzLmlnbm9yZUFuY2hvciA9IGZhbHNlO1xuICAgICAgICAvL3RoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMuY29sID0gY29sO1xuICAgICAgICB0aGlzLnJvdyA9IHJvdztcbiAgICB9LFxuXG4gICAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICB0aGlzLl9zdXBlcihjb2xvcik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gR3JpZDsiLCJ2YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uLy4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgUGxheWVyTWFuID0gcmVxdWlyZShcIi4uLy4uL21vZGVsL1BsYXllck1hblwiKTtcbnZhciBMZXZlbENvbmZpZyA9IHJlcXVpcmUoXCIuLi8uLi9jb25maWcvTGV2ZWxDb25maWdcIik7XG4vL3ZhciBBZHNSZW1pbmRlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vLi4vY29udHJvbGxlci9BZHNSZW1pbmRlckNvbnRyb2xsZXJcIik7XG5cbnZhciBDb2xvckNvbmZpZ3MgPSBbXG4gICAgY2MuY29sb3IoMjUyLCAxNzgsIDApLFxuICAgIGNjLmNvbG9yKDgxLCAyMjksIDEyKSxcbiAgICBjYy5jb2xvcigyNywgMjI2LCAyNTUpLFxuICAgIGNjLmNvbG9yKDI1NSwgMjUyLCAyOSksXG4gICAgY2MuY29sb3IoMjU1LCA1NiwgNTYpLFxuICAgIGNjLmNvbG9yKDI0OCwgNzAsIDI1NSksXG4gICAgY2MuY29sb3IoMjU1LCAxMjksIDE3KSxcbiAgICBjYy5jb2xvcig1NywgMTAzLCAyNDkpLFxuICAgIGNjLmNvbG9yKDkwLCAxODEsIDExMCksXG5cbiAgICBjYy5jb2xvcigyNTUsIDkwLCAxNDEpLFxuICAgIGNjLmNvbG9yKDI0MiwgODYsIDkpLFxuICAgIGNjLmNvbG9yKDY2LCA0NiwgMTc2KSxcbiAgICBjYy5jb2xvcigxNDQsIDg1LCAyMjIpLFxuICAgIGNjLmNvbG9yKDIzLCAxNjcsIDEwNCksXG4gICAgY2MuY29sb3IoMTc2LCA3MiwgMjA2KSxcbiAgICBjYy5jb2xvcigxNDcsIDE5MiwgMjYpLFxuICAgIGNjLmNvbG9yKDU1LCA3MCwgMjE5KVxuXTtcblxudmFyIEdyYXlDb2xvciA9IGNjLmNvbG9yLkdSQVk7XG52YXIgTGlnaHRHcmF5Q29sb3IgPSBjYy5jb2xvcigxMzAsIDEzMCwgMTMwKTtcbnZhciBTdGF0dXNMaXN0ID0gW1wiYnJpY2tcIiwgXCJvYnN0YWNsZVwiLCBcImRlbGV0ZVwiXTtcblxudmFyIEVkaXRvclNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIENPTlRFTlRfV0lEVEg6IDYwMCxcbiAgICBDT05URU5UX0hFSUdIVDogNjAwLFxuXG4gICAgQ09MOiA1MCxcbiAgICBST1c6IDUwLFxuXG4gICAgR1JJRF9XSURUSDogOSxcbiAgICBHUklEX0hFSUdIVDogOSxcblxuICAgIEdBUF9XSURUSDogMyxcbiAgICBHQVBfSEVJR0hUOiAzLFxuXG4gICAgYnJpY2tSZWN0czogbnVsbCxcblxuICAgIG9ic3RhY2xlUmVjdHM6IG51bGwsXG5cbiAgICAvL19pc0JyaWNrOiB0cnVlLFxuICAgIF9zdGF0dXM6IFwiYnJpY2tcIixcblxuICAgIF9icmlja0l0ZW06IG51bGwsXG5cbiAgICBfbGV2ZWxFZGl0Qm94OiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnBsYXllck1hbiA9IFBsYXllck1hbi5nZXRJbnN0YW5jZSgpO1xuICAgICAgICBnYW1lLnBsYXllck1hbi5pbml0RGF0YSgpO1xuXG4gICAgICAgIC8vdmFyIExvZ2ljTWFuID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi9tb2RlbC9Mb2dpY01hblwiKTtcbiAgICAgICAgLy9Mb2dpY01hbi5nZXRJbnN0YW5jZSgpLnN0YXJ0R2FtZSh0cnVlKTtcbiAgICAgICAgLy9jYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIkFkc1JlbWluZGVyQ29udHJvbGxlclwiLCBuZXcgQWRzUmVtaW5kZXJDb250cm9sbGVyKCkpO1xuXG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgICAgdmFyIHNjYWxlID0gMS41O1xuICAgICAgICB0aGlzLnhPZmZzZXQgPSAoY2Mud2luU2l6ZS53aWR0aCAtIHRoaXMuQ09OVEVOVF9XSURUSCAqIHNjYWxlKSAqIDAuNTtcbiAgICAgICAgdGhpcy55T2Zmc2V0ID0gKGNjLndpblNpemUuaGVpZ2h0IC0gdGhpcy5DT05URU5UX0hFSUdIVCAqIHNjYWxlKSAqIDAuNTtcblxuICAgICAgICB0aGlzLmJyaWNrUmVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5vYnN0YWNsZVJlY3RzID0gW107XG5cbiAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSB0aGlzLmJyaWNrUmVjdHM7XG4gICAgICAgIHRoaXMuc2VsZWN0Q29sb3IgPSBDb2xvckNvbmZpZ3NbMF07XG4gICAgICAgIHRoaXMuc2VsZWN0Q29sb3JJbmRleCA9IDA7XG5cbiAgICAgICAgdGhpcy5ncmlkTm9kZSA9IG5ldyBjYy5Ob2RlKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5ncmlkTm9kZSk7XG4gICAgICAgIHRoaXMuZ3JpZE5vZGUueCA9IHRoaXMueE9mZnNldDtcbiAgICAgICAgdGhpcy5ncmlkTm9kZS55ID0gdGhpcy55T2Zmc2V0O1xuICAgICAgICB0aGlzLmdyaWROb2RlLnNjYWxlID0gc2NhbGU7XG5cbiAgICAgICAgdGhpcy5pbml0R3JpZHMoKTtcbiAgICAgICAgdGhpcy5pbml0QnV0dG9ucygpO1xuICAgICAgICB0aGlzLmluaXRDb2xvckJ1dHRvbnMoKTtcbiAgICAgICAgdGhpcy5pbml0RWRpdEJveCgpO1xuXG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4ubGV2ZWxDZmcpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZENvbmZpZyhnYW1lLmdhbWVNYW4ubGV2ZWxDZmcub3JpZ2luYWxDb25maWcpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRFZGl0Qm94OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB4T2Zmc2V0ID0gMjAwO1xuICAgICAgICB0aGlzLl9sZXZlbEVkaXRCb3ggPSB0aGlzLmNyZWF0ZUVkaXRCb3goXCJcIiwgXCJJbnB1dCBMZXZlbElkXCIsIGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSAtIHhPZmZzZXQsIDEwMCkpO1xuICAgICAgICB0aGlzLl9ib29zdEVkaXRCb3ggPSB0aGlzLmNyZWF0ZUVkaXRCb3goXCIxXCIsIFwiSW5wdXQgQm9vc3QgUHJvYmFiaWxpdHlcIiwgY2MucChjYy53aW5TaXplLndpZHRoICogMC41LCAxMDApKTtcbiAgICAgICAgdGhpcy5fc3RhcjNFZGl0Qm94ID0gdGhpcy5jcmVhdGVFZGl0Qm94KFwiOTBcIiwgXCJJbnB1dCAzU3RhciBUaW1lXCIsIGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSArIHhPZmZzZXQsIDEwMCkpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVFZGl0Qm94OiBmdW5jdGlvbiAoY29udGVudCwgcGxhY2VIb2xkZXIsIHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBlZGl0Qm94ID0gbmV3IGNjLkVkaXRCb3goY2Muc2l6ZSgyNzAsIDEwMCksIG5ldyBjYy5TY2FsZTlTcHJpdGUoXCJyZXMvY29tbW9uL2JsYW5rLnBuZ1wiKSxcbiAgICAgICAgICAgIG5ldyBjYy5TY2FsZTlTcHJpdGUoXCJyZXMvY29tbW9uL2JsYW5rLnBuZ1wiKSk7XG4gICAgICAgIGVkaXRCb3guc2V0U3RyaW5nKGNvbnRlbnQpO1xuICAgICAgICBlZGl0Qm94LnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgICAgZWRpdEJveC5zZXRGb250Q29sb3IoY2MuY29sb3IoMjU1LCAyNTUsIDI1NSkpO1xuICAgICAgICAvL2VkaXRCb3guc2V0SGludENvXG4gICAgICAgIGVkaXRCb3guc2V0UGxhY2Vob2xkZXJGb250Q29sb3IoY2MuY29sb3IoMjU1LCAwLCAwKSk7XG4gICAgICAgIGVkaXRCb3guc2V0UGxhY2VIb2xkZXIocGxhY2VIb2xkZXIpO1xuICAgICAgICBlZGl0Qm94LnNldERlbGVnYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKGVkaXRCb3gpO1xuICAgICAgICByZXR1cm4gZWRpdEJveDtcbiAgICB9LFxuXG4gICAgaW5pdEJ1dHRvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gQnVncyBJdGVtXG4gICAgICAgIHZhciBicmlja0l0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiQnJpY2tcIiwgdGhpcy5vbkJyaWNrVHlwZUNoYW5nZSwgdGhpcyk7XG4gICAgICAgIHZhciBzYXZlSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJTYXZlXCIsIHRoaXMub25TYXZlLCB0aGlzKTtcbiAgICAgICAgdmFyIGRlbGV0ZUl0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiQmFja1wiLCB0aGlzLm9uRGVsZXRlLCB0aGlzKTtcbiAgICAgICAgLy92YXIgcmVmcmVzaEl0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiUmVmcmVzaFwiLCB0aGlzLm9uUmVmcmVzaCwgdGhpcyk7XG4gICAgICAgIHZhciBhZGRJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIkFkZFwiLCB0aGlzLm9uQWRkLCB0aGlzKTtcbiAgICAgICAgdmFyIHJlZHVjZUl0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiUmVkdWNlXCIsIHRoaXMub25SZWR1Y2UsIHRoaXMpO1xuICAgICAgICB2YXIgbG9hZEl0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiTG9hZFwiLCB0aGlzLm9uTG9hZCwgdGhpcyk7XG4gICAgICAgIHZhciBwcmV2aWV3SXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJQcmV2aWV3XCIsIHRoaXMub25QcmV2aWV3LCB0aGlzKTtcbiAgICAgICAgdmFyIG1lbnUgPSBuZXcgY2MuTWVudShicmlja0l0ZW0sIHNhdmVJdGVtLCBkZWxldGVJdGVtLCBhZGRJdGVtLCByZWR1Y2VJdGVtLCBsb2FkSXRlbSwgcHJldmlld0l0ZW0pO1xuXG4gICAgICAgIG1lbnUuYWxpZ25JdGVtc0hvcml6b250YWxseSgpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKG1lbnUpO1xuICAgICAgICBtZW51LnNldFBvc2l0aW9uKGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSwgY2Mud2luU2l6ZS5oZWlnaHQgLSAyMCkpO1xuICAgICAgICB0aGlzLl9icmlja0l0ZW0gPSBicmlja0l0ZW07XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsID0gbmV3IGNjLkxhYmVsVFRGKFwiXCIsIFwiQXJpYWxcIiwgNDApO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuX2dyaWRMYWJlbCk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldEFuY2hvclBvaW50KGNjLnAoMCwgMC41KSk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldFBvc2l0aW9uKGNjLnAoMTAwLCBjYy53aW5TaXplLmhlaWdodCAtIDgwKSk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldFN0cmluZyh0aGlzLkNPTCArIFwieFwiICsgdGhpcy5ST1cpO1xuICAgIH0sXG5cbiAgICBpbml0Q29sb3JCdXR0b25zOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ29sb3JDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY29sb3JJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIiBPIFwiLCB0aGlzLm9uU2VsZWN0Q29sb3IsIHRoaXMpO1xuICAgICAgICAgICAgY29sb3JJdGVtLnNldENvbG9yKENvbG9yQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICBjb2xvckl0ZW0uc2V0VGFnKGkpO1xuICAgICAgICAgICAgaXRlbXMucHVzaChjb2xvckl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtZW51ID0gbmV3IGNjLk1lbnUoaXRlbXMuc2xpY2UoMCwgaXRlbXMubGVuZ3RoIC8gMiArIDEpKTtcbiAgICAgICAgbWVudS5hbGlnbkl0ZW1zSG9yaXpvbnRhbGx5KCk7XG4gICAgICAgIG1lbnUuc2V0UG9zaXRpb24oY2MucChjYy53aW5TaXplLndpZHRoICogMC41LCBjYy53aW5TaXplLmhlaWdodCAtIDU1KSk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQobWVudSk7XG5cbiAgICAgICAgdmFyIGJvdHRvbU1lbnUgPSBuZXcgY2MuTWVudShpdGVtcy5zbGljZShpdGVtcy5sZW5ndGggLyAyICsgMSkpO1xuICAgICAgICBib3R0b21NZW51LmFsaWduSXRlbXNIb3Jpem9udGFsbHkoKTtcbiAgICAgICAgYm90dG9tTWVudS5zZXRQb3NpdGlvbihjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUsIGNjLndpblNpemUuaGVpZ2h0IC0gOTApKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChib3R0b21NZW51KTtcbiAgICB9LFxuXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgICAgIHZhciBsZXZlbFN0cmluZyA9IHRoaXMuX2xldmVsRWRpdEJveC5nZXRTdHJpbmcoKTtcbiAgICAgICAgdmFyIGxldmVsSWQgPSBwYXJzZUludChsZXZlbFN0cmluZyk7XG4gICAgICAgIGlmIChpc05hTihsZXZlbElkKSkge1xuICAgICAgICAgICAgYWxlcnQoXCJsZXZlbCBpZCBub3QgZm91bmQ6XCIgKyBsZXZlbFN0cmluZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbGV2ZWxDb25maWcgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRPcmlnaW5hbExldmVsQ29uZmlnKGxldmVsSWQpO1xuICAgICAgICAgICAgaWYgKCFsZXZlbENvbmZpZykge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwibGV2ZWwgaWQgbm90IGZvdW5kOlwiICsgbGV2ZWxTdHJpbmcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRDb25maWcobGV2ZWxDb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUHJldmlldzogZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICB2YXIgb2JqID0gdGhpcy5nZW5lcmF0ZUxldmVsT2JqKCk7XG4gICAgICAgIHZhciBsZXZlbENvbmZpZyA9IG5ldyBMZXZlbENvbmZpZygpO1xuICAgICAgICBsZXZlbENvbmZpZy51bm1hcnNoYWwob2JqKTtcbiAgICAgICAgbGV2ZWxDb25maWcub3JpZ2luYWxDb25maWcgPSBvYmo7XG4gICAgICAgIGdhbWUuZ2FtZU1hbi5sZXZlbENmZyA9IGxldmVsQ29uZmlnO1xuICAgICAgICAvL3ZhciBzY2VuZSA9IG5ldyBHYW1lU2NlbmUoKTtcbiAgICAgICAgdmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuL0dhbWVTY2VuZVwiKTtcbiAgICAgICAgLy9jYy53aW5TaXplLndpZHRoID0gY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjU7XG4gICAgICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKG5ldyBHYW1lU2NlbmUoKSk7XG4gICAgfSxcblxuICAgIGdlbmVyYXRlTGV2ZWxPYmo6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGJvb3N0UHJvYmFiaWxpdHkgPSBOdW1iZXIodGhpcy5fYm9vc3RFZGl0Qm94LmdldFN0cmluZygpKTtcbiAgICAgICAgaWYgKGlzTmFOKGJvb3N0UHJvYmFiaWxpdHkpKSB7XG4gICAgICAgICAgICBib29zdFByb2JhYmlsaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzdGFyVGltZSA9IE51bWJlcih0aGlzLl9zdGFyM0VkaXRCb3guZ2V0U3RyaW5nKCkpO1xuICAgICAgICBpZiAoaXNOYU4oc3RhclRpbWUpKSB7XG4gICAgICAgICAgICBzdGFyVGltZSA9IDkwO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlkID0gcGFyc2VJbnQodGhpcy5fbGV2ZWxFZGl0Qm94LmdldFN0cmluZygpKTtcbiAgICAgICAgaWYgKGlzTmFOKGlkKSkge1xuICAgICAgICAgICAgaWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgYjogYm9vc3RQcm9iYWJpbGl0eSxcbiAgICAgICAgICAgIHN0YXJUaW1lOiBzdGFyVGltZSxcbiAgICAgICAgICAgIHBpeGVsV2lkdGg6IHRoaXMuQ09OVEVOVF9XSURUSCxcbiAgICAgICAgICAgIHBpeGVsSGVpZ2h0OiB0aGlzLkNPTlRFTlRfSEVJR0hULFxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuQ09MLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLlJPVyxcbiAgICAgICAgICAgIGJyaWNrczogdGhpcy5icmlja1JlY3RzLFxuICAgICAgICAgICAgb2JzdGFjbGVzOiB0aGlzLm9ic3RhY2xlUmVjdHNcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgbG9hZENvbmZpZzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICB0aGlzLnJlc2V0T2xkVmlldygpO1xuXG4gICAgICAgIHRoaXMuQ09OVEVOVF9XSURUSCA9IGNvbmZpZy5waXhlbFdpZHRoO1xuICAgICAgICB0aGlzLkNPTlRFTlRfSEVJR0hUID0gY29uZmlnLnBpeGVsSGVpZ2h0O1xuICAgICAgICB0aGlzLkNPTCA9IGNvbmZpZy53aWR0aDtcbiAgICAgICAgdGhpcy5ST1cgPSBjb25maWcuaGVpZ2h0O1xuICAgICAgICB0aGlzLmJyaWNrUmVjdHMgPSBjb25maWcuYnJpY2tzO1xuICAgICAgICB0aGlzLm9ic3RhY2xlUmVjdHMgPSBjb25maWcub2JzdGFjbGVzO1xuXG4gICAgICAgIC8vdGhpcy51cGRhdGVWaWV3KCk7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMuQ09OVEVOVF9XSURUSCAvIHRoaXMuQ09MO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5DT05URU5UX0hFSUdIVCAvIHRoaXMuUk9XO1xuICAgICAgICB0aGlzLkdSSURfV0lEVEggPSB3aWR0aCAqIDAuNzU7XG4gICAgICAgIHRoaXMuR1JJRF9IRUlHSFQgPSBoZWlnaHQgKiAwLjc1O1xuICAgICAgICB0aGlzLkdBUF9XSURUSCA9IHdpZHRoIC0gdGhpcy5HUklEX1dJRFRIO1xuICAgICAgICB0aGlzLkdBUF9IRUlHSFQgPSBoZWlnaHQgLSB0aGlzLkdSSURfSEVJR0hUO1xuXG4gICAgICAgIHRoaXMuaW5pdEdyaWRzKCk7XG5cbiAgICAgICAgLy90aGlzLmJyaWNrUmVjdHMgPSBbXTtcbiAgICAgICAgLy90aGlzLm9ic3RhY2xlUmVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSB0aGlzLmJyaWNrUmVjdHM7XG4gICAgICAgIC8vdGhpcy5faXNCcmljayA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5fc3RhdHVzID0gXCJicmlja1wiO1xuICAgICAgICAvL3RoaXMuX2JyaWNrSXRlbS5zZXRTdHJpbmcoXCJCcmlja1wiKTtcbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldFN0cmluZyh0aGlzLkNPTCArIFwieFwiICsgdGhpcy5ST1cpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5icmlja1JlY3RzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgYnJpY2tSZWN0ID0gdGhpcy5icmlja1JlY3RzW2ldO1xuICAgICAgICAgICAgdGhpcy5tYXJrT2NjdXBpZWRXaXRoUmVjdChicmlja1JlY3QsIENvbG9yQ29uZmlnc1ticmlja1JlY3RbNF0gLSAxXSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm9ic3RhY2xlUmVjdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBicmlja1JlY3QgPSB0aGlzLm9ic3RhY2xlUmVjdHNbaV07XG4gICAgICAgICAgICB0aGlzLm1hcmtPY2N1cGllZFdpdGhSZWN0KGJyaWNrUmVjdCwgIGNjLmNvbG9yLldISVRFKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9ib29zdEVkaXRCb3guc2V0U3RyaW5nKGNvbmZpZy5iKTtcbiAgICAgICAgdGhpcy5fc3RhcjNFZGl0Qm94LnNldFN0cmluZyhjb25maWcuc3RhclRpbWUpO1xuICAgICAgICAvL3RoaXMuY3VycmVudFJlY3RzID1cbiAgICB9LFxuXG4gICAgb25TZWxlY3RDb2xvcjogZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICB0aGlzLnNlbGVjdENvbG9yID0gQ29sb3JDb25maWdzW3NlbmRlci5nZXRUYWcoKV07XG4gICAgICAgIHRoaXMuc2VsZWN0Q29sb3JJbmRleCA9IHNlbmRlci5nZXRUYWcoKTtcbiAgICB9LFxuXG4gICAgcmVzZXRPbGRWaWV3OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZm9yRWFjaEdyaWRzKGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgICAgICBncmlkLnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ3JpZHMgPSBbXTtcbiAgICB9LFxuXG4gICAgdXBkYXRlVmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd2lkdGggPSB0aGlzLkNPTlRFTlRfV0lEVEggLyB0aGlzLkNPTDtcbiAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuQ09OVEVOVF9IRUlHSFQgLyB0aGlzLlJPVztcbiAgICAgICAgdGhpcy5HUklEX1dJRFRIID0gd2lkdGggKiAwLjc1O1xuICAgICAgICB0aGlzLkdSSURfSEVJR0hUID0gaGVpZ2h0ICogMC43NTtcbiAgICAgICAgdGhpcy5HQVBfV0lEVEggPSB3aWR0aCAtIHRoaXMuR1JJRF9XSURUSDtcbiAgICAgICAgdGhpcy5HQVBfSEVJR0hUID0gaGVpZ2h0IC0gdGhpcy5HUklEX0hFSUdIVDtcblxuICAgICAgICB0aGlzLmluaXRHcmlkcygpO1xuXG4gICAgICAgIHRoaXMuYnJpY2tSZWN0cyA9IFtdO1xuICAgICAgICB0aGlzLm9ic3RhY2xlUmVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSB0aGlzLmJyaWNrUmVjdHM7XG4gICAgICAgIC8vdGhpcy5faXNCcmljayA9IHRydWU7XG4gICAgICAgIHRoaXMuX3N0YXR1cyA9IFwiYnJpY2tcIjtcbiAgICAgICAgdGhpcy5fYnJpY2tJdGVtLnNldFN0cmluZyhcIkJyaWNrXCIpO1xuXG4gICAgICAgIHRoaXMuX2dyaWRMYWJlbC5zZXRTdHJpbmcodGhpcy5DT0wgKyBcInhcIiArIHRoaXMuUk9XKTtcbiAgICB9LFxuXG4gICAgb25BZGQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZXNldE9sZFZpZXcoKTtcbiAgICAgICAgdGhpcy5DT0wgKz0gNDtcbiAgICAgICAgdGhpcy5ST1cgKz0gNDtcbiAgICAgICAgdGhpcy51cGRhdGVWaWV3KCk7XG4gICAgfSxcblxuICAgIG9uUmVkdWNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVzZXRPbGRWaWV3KCk7XG4gICAgICAgIHRoaXMuQ09MIC09IDQ7XG4gICAgICAgIHRoaXMuUk9XIC09IDQ7XG4gICAgICAgIHRoaXMudXBkYXRlVmlldygpO1xuICAgIH0sXG5cblxuICAgIG9uU2F2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqID0gdGhpcy5nZW5lcmF0ZUxldmVsT2JqKCk7XG5cbiAgICAgICAgY2MubG9nKFwicmVzdWx0czpcIiArIEpTT04uc3RyaW5naWZ5KG9iaikpO1xuXG4gICAgICAgIC8vYWxlcnQoSlNPTi5zdHJpbmdpZnkob2JqKSk7XG4gICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW0pTT04uc3RyaW5naWZ5KG9iaildKTtcbiAgICAgICAgdmFyIHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICB0YWcuZG93bmxvYWQgPSBcImxldmVsLmpzb25cIjtcbiAgICAgICAgdGFnLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICB0YWcuY2xpY2soKTtcbiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChibG9iKTtcbiAgICB9LFxuXG4gICAgb25EZWxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kZWxldGVMYXRlc3RSZWN0KCk7XG4gICAgfSxcblxuICAgIG9uUmVmcmVzaDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcblxuICAgIG9uQnJpY2tUeXBlQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N0YXR1cyA9IFN0YXR1c0xpc3RbKFN0YXR1c0xpc3QuaW5kZXhPZih0aGlzLl9zdGF0dXMpICsgMSkgJSBTdGF0dXNMaXN0Lmxlbmd0aF07XG4gICAgICAgIC8vdGhpcy5faXNCcmljayA9ICF0aGlzLl9pc0JyaWNrO1xuICAgICAgICB0aGlzLl9icmlja0l0ZW0uc2V0U3RyaW5nKHRoaXMuX3N0YXR1cyk7XG4gICAgICAgIGlmICh0aGlzLl9zdGF0dXMgPT09IFwib2JzdGFjbGVcIikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSB0aGlzLm9ic3RhY2xlUmVjdHM7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fc3RhdHVzID09PSBcImJyaWNrXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlY3RzID0gdGhpcy5icmlja1JlY3RzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRHcmlkczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdyaWRzID0gW107XG4gICAgICAgIHZhciBHcmlkID0gcmVxdWlyZShcIi4uL2VudGl0eS9HcmlkXCIpO1xuICAgICAgICBmb3IgKHZhciBsb2NhbENvbCA9IDA7IGxvY2FsQ29sIDwgdGhpcy5DT0w7ICsrbG9jYWxDb2wpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZHMucHVzaChbXSk7XG4gICAgICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IDA7IGxvY2FsUm93IDwgdGhpcy5ST1c7ICsrbG9jYWxSb3cpIHtcbiAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IG5ldyBHcmlkKExpZ2h0R3JheUNvbG9yLCB0aGlzLkdSSURfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQsIGxvY2FsQ29sLCBsb2NhbFJvdyk7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkTm9kZS5hZGRDaGlsZChncmlkKTtcbiAgICAgICAgICAgICAgICBncmlkLnNldFBvc2l0aW9uKHRoaXMuZ2V0R3JpZFBvcyhsb2NhbENvbCwgbG9jYWxSb3cpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRzW2xvY2FsQ29sXS5wdXNoKGdyaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMubWFya0dyYXlIaW50KGdyaWQsIGxvY2FsQ29sLCBsb2NhbFJvdyk7XG4gICAgICAgICAgICAgICAgZ3JpZC5fY29sb3IgPSBncmlkLmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG1hcmtHcmF5SGludDogZnVuY3Rpb24gKGdyaWQsIGxvY2FsQ29sLCBsb2NhbFJvdykge1xuICAgICAgICB2YXIgZ3JheUNvbG9yID0gR3JheUNvbG9yO1xuICAgICAgICB2YXIgaXNMZWZ0ID0gKHRoaXMuQ09MIC8gbG9jYWxDb2wpID4gMjtcbiAgICAgICAgdmFyIGlzQm90dG9tID0gKHRoaXMuUk9XIC8gbG9jYWxSb3cpID4gMjtcbiAgICAgICAgaWYgKGxvY2FsQ29sID09PSBNYXRoLmZsb29yKHRoaXMuQ09MIC8gMikgfHxcbiAgICAgICAgICAgIGxvY2FsQ29sID09PSBNYXRoLmZsb29yKHRoaXMuQ09MIC8gMikgLSAxIHx8XG4gICAgICAgICAgICBsb2NhbFJvdyA9PT0gTWF0aC5mbG9vcih0aGlzLlJPVyAvIDIpIHx8XG4gICAgICAgICAgICBsb2NhbFJvdyA9PT0gTWF0aC5mbG9vcih0aGlzLlJPVyAvIDIpIC0gMVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IoZ3JheUNvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpaWkgPSBpc0xlZnQgPyA0IDogMDtcblxuICAgICAgICBpZiAobG9jYWxDb2wgJSA1ID09PSBpaWkpIHtcbiAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IoZ3JheUNvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBqamogPSBpc0JvdHRvbSA/IDQgOiAwO1xuXG4gICAgICAgIGlmIChsb2NhbFJvdyAlIDUgPT09IGpqaikge1xuICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmF5Q29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9paWkgPSBpc0xlZnQgPyA5IDogMDtcbiAgICAgICAgLy9qamogPSBpc0JvdHRvbSA/IDkgOiAwO1xuICAgICAgICAvL1xuICAgICAgICAvL2lmIChsb2NhbENvbCAlIDEwID09PSBpaWkgJiYgbG9jYWxSb3cgJSAxMCA9PT0gampqKSB7XG4gICAgICAgIC8vICAgIGdyaWQuc2V0Q29sb3IoY2MuY29sb3IuWUVMTE9XKTtcbiAgICAgICAgLy99XG4gICAgfSxcblxuICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gMDsgbG9jYWxDb2wgPCB0aGlzLkNPTDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSAwOyBsb2NhbFJvdyA8IHRoaXMuUk9XOyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLmVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10uc2V0Q29sb3IoTGlnaHRHcmF5Q29sb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS51c2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtHcmF5SGludCh0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10sIGxvY2FsQ29sLCBsb2NhbFJvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5icmlja1JlY3RzID0gW107XG4gICAgICAgIHRoaXMub2JzdGFjbGVSZWN0cyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRSZWN0cyA9IHRoaXMuYnJpY2tSZWN0cztcbiAgICAgICAgLy90aGlzLl9pc0JyaWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fc3RhdHVzID0gXCJicmlja1wiO1xuICAgICAgICB0aGlzLl9icmlja0l0ZW0uc2V0U3RyaW5nKFwiQnJpY2tcIik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuVE9VQ0hfT05FX0JZX09ORSxcbiAgICAgICAgICAgIHN3YWxsb3dUb3VjaGVzOiB0cnVlLFxuICAgICAgICAgICAgb25Ub3VjaEJlZ2FuOiB0aGlzLm9uVG91Y2hCZWdhbi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaE1vdmVkOiB0aGlzLm9uVG91Y2hNb3ZlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaEVuZGVkOiB0aGlzLm9uVG91Y2hFbmRlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaENhbmNlbGxlZDogdGhpcy5vblRvdWNoQ2FuY2VsbGVkLmJpbmQodGhpcylcbiAgICAgICAgfSwgdGhpcy5ncmlkTm9kZSk7XG5cbiAgICAgICAgLy9jYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAvLyAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgLy8gICAgb25LZXlSZWxlYXNlZDogZnVuY3Rpb24gKGtleUNvZGUsIGV2ZW50KSB7XG4gICAgICAgIC8vICAgICAgICBpZiAoa2V5Q29kZSA9PT0gY2MuS0VZLmJhY2tzcGFjZSkge1xuICAgICAgICAvLyAgICAgICAgICAgIC8vY2MuZGlyZWN0b3IuZW5kKCk7XG4gICAgICAgIC8vICAgICAgICAgICAgdGhpcy5kZWxldGVMYXRlc3RSZWN0KCk7XG4gICAgICAgIC8vICAgICAgICB9XG4gICAgICAgIC8vICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAvL30sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgZ2V0R3JpZFBvczogZnVuY3Rpb24gKGxvY2FsQ29sLCBsb2NhbFJvdykge1xuICAgICAgICB2YXIgZ3JpZFNpemUgPSB0aGlzLmdldEdyaWRTaXplKCk7XG4gICAgICAgIHJldHVybiBjYy5wKChncmlkU2l6ZS53aWR0aCArIHRoaXMuR0FQX1dJRFRIKSAqIChsb2NhbENvbCArIDAuNSksXG4gICAgICAgICAgICAoZ3JpZFNpemUuaGVpZ2h0ICsgdGhpcy5HQVBfSEVJR0hUKSAqIChsb2NhbFJvdyArIDAuNSkpO1xuICAgIH0sXG5cbiAgICBnZXRHcmlkU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2Muc2l6ZSh0aGlzLkdSSURfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQpO1xuICAgIH0sXG5cbiAgICBnZXRGdWxsR3JpZFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNjLnNpemUodGhpcy5HUklEX1dJRFRIICsgdGhpcy5HQVBfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQgKyB0aGlzLkdBUF9IRUlHSFQpO1xuICAgIH0sXG5cbiAgICBvblRvdWNoQmVnYW46ZnVuY3Rpb24odG91Y2gsIGV2ZW50KSB7XG4gICAgICAgIHZhciBncmlkID0gdGhpcy5nZXRDbG9zZXN0R3JpZCh0b3VjaCk7XG4gICAgICAgIGlmICghZ3JpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9zdGF0dXMgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RHcmlkID0gZ3JpZDtcbiAgICAgICAgICAgIC8vIGdyaWQuc2V0Q29sb3IoZ3JpZC5fY29sb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGdyaWQudXNlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZmlyc3RHcmlkID0gZ3JpZDtcbiAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IodGhpcy5nZXRDdXJyZW50Q29sb3IoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIG9uVG91Y2hNb3ZlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgdGhpcy50b3VjaERlbGV0ZSh0b3VjaCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRvdWNoRHJhdyh0b3VjaCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIG9uVG91Y2hFbmRlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgdGhpcy50b3VjaERlbGV0ZSh0b3VjaCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRvdWNoRHJhdyh0b3VjaCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5maXJzdEdyaWQgJiYgdGhpcy5sYXN0R3JpZCkge1xuICAgICAgICAgICAgdmFyIHJlZ2lvbiA9IHRoaXMuZ2V0UmVnaW9uKHRoaXMuZmlyc3RHcmlkLCB0aGlzLmxhc3RHcmlkKTtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMuc2VsZWN0Q29sb3JJbmRleCArIDE7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdHVzICE9PSBcImJyaWNrXCIpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVjdCA9IFtyZWdpb24ubWluQ29sLCByZWdpb24ubWluUm93LFxuICAgICAgICAgICAgICAgIHJlZ2lvbi5tYXhDb2wgLSByZWdpb24ubWluQ29sICsgMSwgcmVnaW9uLm1heFJvdyAtIHJlZ2lvbi5taW5Sb3cgKyAxLCBpbmRleF07XG4gICAgICAgICAgICB2YXIgY2NSZWN0ID0gY2MucmVjdChyZWN0WzBdLCByZWN0WzFdLCByZWN0WzJdLCByZWN0WzNdKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0dXMgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVJlY3RGcm9tUmVjdHMoY2NSZWN0LCB0aGlzLmJyaWNrUmVjdHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlUmVjdEZyb21SZWN0cyhjY1JlY3QsIHRoaXMub2JzdGFjbGVSZWN0cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JFYWNoR3JpZHMoZnVuY3Rpb24gKGdyaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5kZWxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJlY3RzLnB1c2gocmVjdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXJrT2NjdXBpZWRXaXRoUmVjdChyZWN0LCBudWxsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvckVhY2hHcmlkcyhmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICAgICAgICAgICAgICBncmlkLmVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyc3RHcmlkID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0R3JpZCA9IG51bGw7XG4gICAgfSxcblxuICAgIGRlbGV0ZVJlY3RGcm9tUmVjdHM6IGZ1bmN0aW9uIChjY1JlY3QsIHJlY3RzKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSByZWN0cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgdmFyIGJyaWNrUmVjdCA9IHJlY3RzW2ldO1xuICAgICAgICAgICAgdmFyIGNjQnJpY2tSZWN0ID0gY2MucmVjdChicmlja1JlY3RbMF0sIGJyaWNrUmVjdFsxXSwgYnJpY2tSZWN0WzJdLCBicmlja1JlY3RbM10pO1xuICAgICAgICAgICAgdmFyIG92ZXJsYXBzUmVjdCA9IGNjLnJlY3RJbnRlcnNlY3Rpb24oY2NSZWN0LCBjY0JyaWNrUmVjdCk7XG4gICAgICAgICAgICBpZiAob3ZlcmxhcHNSZWN0LndpZHRoIDw9IDAgfHwgb3ZlcmxhcHNSZWN0LmhlaWdodCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzdWx0UmVjdHMgPSB0aGlzLmdldE92ZXJsYXBzUmVjdHMob3ZlcmxhcHNSZWN0LCBjY0JyaWNrUmVjdCk7XG4gICAgICAgICAgICByZWN0cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlc3VsdFJlY3RzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgcmVjdHMucHVzaCh0aGlzLmNvbnZlcnRUb0pzb25MaXN0KHJlc3VsdFJlY3RzW2pdLCBicmlja1JlY3RbNF0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb252ZXJ0VG9Kc29uTGlzdDogZnVuY3Rpb24gKHJlY3QsIGNvbG9yKSB7XG4gICAgICAgIHJldHVybiBbcmVjdC54LCByZWN0LnksIHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0LCBjb2xvcl07XG4gICAgfSxcblxuICAgIGdldE92ZXJsYXBzUmVjdHM6IGZ1bmN0aW9uIChvdmVybGFwc1JlY3QsIGJyaWNrUmVjdCkge1xuICAgICAgICB2YXIgcmVzdWx0cyA9IFtcbiAgICAgICAgICAgIGNjLnJlY3QoYnJpY2tSZWN0LngsIGJyaWNrUmVjdC55LCBicmlja1JlY3Qud2lkdGgsIG92ZXJsYXBzUmVjdC55IC0gYnJpY2tSZWN0LnkpLFxuICAgICAgICAgICAgY2MucmVjdChicmlja1JlY3QueCwgY2MucmVjdEdldE1heFkob3ZlcmxhcHNSZWN0KSwgYnJpY2tSZWN0LndpZHRoLCBjYy5yZWN0R2V0TWF4WShicmlja1JlY3QpIC0gY2MucmVjdEdldE1heFkob3ZlcmxhcHNSZWN0KSksXG4gICAgICAgICAgICBjYy5yZWN0KGJyaWNrUmVjdC54LCBvdmVybGFwc1JlY3QueSwgb3ZlcmxhcHNSZWN0LnggLSBicmlja1JlY3QueCwgb3ZlcmxhcHNSZWN0LmhlaWdodCksXG4gICAgICAgICAgICBjYy5yZWN0KGNjLnJlY3RHZXRNYXhYKG92ZXJsYXBzUmVjdCksIG92ZXJsYXBzUmVjdC55LCBjYy5yZWN0R2V0TWF4WChicmlja1JlY3QpIC0gY2MucmVjdEdldE1heFgob3ZlcmxhcHNSZWN0KSwgb3ZlcmxhcHNSZWN0LmhlaWdodClcbiAgICAgICAgXTtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHRzOlwiICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0cykpO1xuICAgICAgICB2YXIgcmVjdHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHJlc3VsdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIHZhciByZWN0ID0gcmVzdWx0c1tpXTtcbiAgICAgICAgICAgIGlmIChyZWN0LndpZHRoIDw9IDAgfHwgcmVjdC5oZWlnaHQgPD0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjdHMucHVzaChyZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVjdHM7XG4gICAgfSxcblxuICAgIC8vbWFya09jY3VwaWVkOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgdmFyIHJlZ2lvbiA9IHRoaXMuZ2V0UmVnaW9uKHRoaXMuZmlyc3RHcmlkLCB0aGlzLmxhc3RHcmlkKTtcbiAgICAvL1xuICAgIC8vICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVnaW9uLm1pbkNvbDsgbG9jYWxDb2wgPD0gcmVnaW9uLm1heENvbDsgKytsb2NhbENvbCkge1xuICAgIC8vICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IHJlZ2lvbi5taW5Sb3c7IGxvY2FsUm93IDw9IHJlZ2lvbi5tYXhSb3c7ICsrbG9jYWxSb3cpIHtcbiAgICAvLyAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS51c2VkID0gdHJ1ZTtcbiAgICAvLyAgICAgICAgfVxuICAgIC8vICAgIH1cbiAgICAvL30sXG5cbiAgICBtYXJrT2NjdXBpZWRXaXRoUmVjdDogZnVuY3Rpb24gKHJlY3QsIGNvbG9yKSB7XG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVjdFswXTsgbG9jYWxDb2wgPCByZWN0WzBdICsgcmVjdFsyXTsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSByZWN0WzFdOyBsb2NhbFJvdyA8IHJlY3RbMV0gKyByZWN0WzNdOyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLmVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10udXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS5zZXRDb2xvcihjb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzT2NjdXBpZWQ6IGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgIHZhciByZWdpb24gPSB0aGlzLmdldFJlZ2lvbih0aGlzLmZpcnN0R3JpZCwgZ3JpZCk7XG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVnaW9uLm1pbkNvbDsgbG9jYWxDb2wgPD0gcmVnaW9uLm1heENvbDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSByZWdpb24ubWluUm93OyBsb2NhbFJvdyA8PSByZWdpb24ubWF4Um93OyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS51c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHRvdWNoRHJhdzogZnVuY3Rpb24gKHRvdWNoKSB7XG4gICAgICAgIGlmICghdGhpcy5maXJzdEdyaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ2V0Q2xvc2VzdEdyaWQodG91Y2gpO1xuXG4gICAgICAgIGlmICghZ3JpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdyaWQgPT09IHRoaXMubGFzdEdyaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT2NjdXBpZWQoZ3JpZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhc3RHcmlkID0gZ3JpZDtcbiAgICAgICAgdGhpcy5jbGVhclJlY3QoKTtcbiAgICAgICAgdGhpcy5kcmF3UmVjdChncmlkKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIHRvdWNoRGVsZXRlOiBmdW5jdGlvbiAodG91Y2gpIHtcbiAgICAgICBpZiAoIXRoaXMuZmlyc3RHcmlkKSB7XG4gICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICB9XG4gICAgICAgdmFyIGdyaWQgPSB0aGlzLmdldENsb3Nlc3RHcmlkKHRvdWNoKTtcblxuICAgICAgIGlmICghZ3JpZCkge1xuICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgfVxuXG4gICAgICAgaWYgKGdyaWQgPT09IHRoaXMubGFzdEdyaWQpIHtcbiAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgIH1cblxuICAgICAgIC8vIGlmICh0aGlzLmlzT2NjdXBpZWQoZ3JpZCkpIHtcbiAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgIC8vIH1cbiAgICAgICB0aGlzLmxhc3RHcmlkID0gZ3JpZDtcbiAgICAgICAvLyB0aGlzLmNsZWFyUmVjdCgpO1xuICAgICAgIC8vIHRoaXMuZHJhd1JlY3QoZ3JpZCk7XG4gICAgICAgIHRoaXMuZHJhd0RlbGV0ZVJlY3QoZ3JpZCk7XG4gICAgfSxcblxuICAgIGRlbGV0ZUxhdGVzdFJlY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlY3QgPSB0aGlzLmN1cnJlbnRSZWN0cy5wb3AoKTtcbiAgICAgICAgaWYgKHJlY3QpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVjdFswXTsgbG9jYWxDb2wgPCByZWN0WzBdICsgcmVjdFsyXTsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gcmVjdFsxXTsgbG9jYWxSb3cgPCByZWN0WzFdICsgcmVjdFszXTsgKytsb2NhbFJvdykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmlkLl9jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgIGdyaWQudXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjbGVhclJlY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoR3JpZHMoZnVuY3Rpb24gKGdyaWQpIHtcbiAgICAgICAgICAgIGlmIChncmlkLmVkaXRpbmcgJiYgIWdyaWQudXNlZCkge1xuICAgICAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IoZ3JpZC5fY29sb3IpO1xuICAgICAgICAgICAgICAgIGdyaWQuZWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZHJhd1JlY3Q6IGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgIHZhciByZWdpb24gPSB0aGlzLmdldFJlZ2lvbih0aGlzLmZpcnN0R3JpZCwgZ3JpZCk7XG5cbiAgICAgICAgZm9yICh2YXIgbG9jYWxDb2wgPSByZWdpb24ubWluQ29sOyBsb2NhbENvbCA8PSByZWdpb24ubWF4Q29sOyArK2xvY2FsQ29sKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IHJlZ2lvbi5taW5Sb3c7IGxvY2FsUm93IDw9IHJlZ2lvbi5tYXhSb3c7ICsrbG9jYWxSb3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10uZWRpdGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLnNldENvbG9yKHRoaXMuZ2V0Q3VycmVudENvbG9yKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZvckVhY2hHcmlkczogZnVuY3Rpb24gKGNiKSB7XG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gMDsgbG9jYWxDb2wgPCB0aGlzLkNPTDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSAwOyBsb2NhbFJvdyA8IHRoaXMuUk9XOyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd107XG4gICAgICAgICAgICAgICAgY2IoZ3JpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZHJhd0RlbGV0ZVJlY3Q6IGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgIHZhciByZWdpb24gPSB0aGlzLmdldFJlZ2lvbih0aGlzLmZpcnN0R3JpZCwgZ3JpZCk7XG5cbiAgICAgICAgdGhpcy5mb3JFYWNoR3JpZHMoZnVuY3Rpb24gKGdyaWQpIHtcbiAgICAgICAgICAgIGlmIChncmlkLmRlbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICBncmlkLnNldENvbG9yKGdyaWQuX3Nob3dDb2xvcik7XG4gICAgICAgICAgICAgICAgZ3JpZC5kZWxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVnaW9uLm1pbkNvbDsgbG9jYWxDb2wgPD0gcmVnaW9uLm1heENvbDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSByZWdpb24ubWluUm93OyBsb2NhbFJvdyA8PSByZWdpb24ubWF4Um93OyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd107XG4gICAgICAgICAgICAgICAgLy8gZ3JpZC5lZGl0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZ3JpZC51c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZ3JpZC5kZWxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBncmlkLl9zaG93Q29sb3IgPSBncmlkLmdldENvbG9yKCk7XG4gICAgICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmlkLl9jb2xvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZ3JpZDEsIGdyaWQyKSB7XG4gICAgICAgIHZhciBtaW5Sb3cgPSBNYXRoLm1pbihncmlkMS5yb3csIGdyaWQyLnJvdyk7XG4gICAgICAgIHZhciBtYXhSb3cgPSBNYXRoLm1heChncmlkMS5yb3csIGdyaWQyLnJvdyk7XG4gICAgICAgIHZhciBtaW5Db2wgPSBNYXRoLm1pbihncmlkMS5jb2wsIGdyaWQyLmNvbCk7XG4gICAgICAgIHZhciBtYXhDb2wgPSBNYXRoLm1heChncmlkMS5jb2wsIGdyaWQyLmNvbCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtaW5Sb3c6IG1pblJvdyxcbiAgICAgICAgICAgIG1heFJvdzogbWF4Um93LFxuICAgICAgICAgICAgbWluQ29sOiBtaW5Db2wsXG4gICAgICAgICAgICBtYXhDb2w6IG1heENvbFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBvblRvdWNoQ2FuY2VsbGVkOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgIH0sXG5cbiAgICBnZXRDbG9zZXN0R3JpZDogZnVuY3Rpb24gKHRvdWNoKSB7XG4gICAgICAgIHZhciBsb2NhbFBvcyA9IHRoaXMuZ3JpZE5vZGUuY29udmVydFRvTm9kZVNwYWNlKHRvdWNoLmdldExvY2F0aW9uKCkpO1xuICAgICAgICB2YXIgZ3JpZFNpemUgPSB0aGlzLmdldEZ1bGxHcmlkU2l6ZSgpO1xuXG4gICAgICAgIGNjLmxvZyhcImxvY2FsUG9zOlwiICsgSlNPTi5zdHJpbmdpZnkobG9jYWxQb3MpKTtcblxuICAgICAgICB2YXIgcm93ID0gTWF0aC5mbG9vcihsb2NhbFBvcy54IC8gZ3JpZFNpemUud2lkdGgpO1xuICAgICAgICB2YXIgY29sID0gTWF0aC5mbG9vcihsb2NhbFBvcy55IC8gZ3JpZFNpemUuaGVpZ2h0KTtcblxuICAgICAgICBjYy5sb2coXCJyb3c6XCIgKyByb3cgKyBcIixjb2w6XCIgKyBjb2wpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRzW3Jvd11bY29sXTtcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9zdGF0dXMgPT09IFwiYnJpY2tcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0Q29sb3I7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY2MuY29sb3IuV0hJVEU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9cbiAgICAvL2RyYXdSZWN0OiBmdW5jdGlvbihyZWdpb24sIGNvbG9yLCBjbGVhcikge1xuICAgIC8vICAgIGlmIChjbGVhcil7XG4gICAgLy8gICAgICAgIHRoaXMuX2RyYXdOb2RlLmNsZWFyKCk7XG4gICAgLy8gICAgfVxuICAgIC8vICAgIGlmIChyZWdpb24gPT0gbnVsbCkge1xuICAgIC8vICAgICAgICByZXR1cm47XG4gICAgLy8gICAgfVxuICAgIC8vICAgIHZhciBtaW4gPSByZWdpb24uZ2V0TWluKCk7XG4gICAgLy8gICAgdmFyIG1heCA9IHJlZ2lvbi5nZXRNYXgoKTtcbiAgICAvLyAgICBtYXgueCArPSAxO1xuICAgIC8vICAgIG1heC55ICs9IDE7XG4gICAgLy8gICAgdGhpcy5fZHJhd05vZGUuZHJhd1NlZ21lbnQoY2MucChtaW4ueCwgbWluLnkpLFxuICAgIC8vICAgICAgICBjYy5wKG1pbi54LCBtYXgueSksIDEsIGNvbG9yKTtcbiAgICAvLyAgICB0aGlzLl9kcmF3Tm9kZS5kcmF3U2VnbWVudChjYy5wKG1pbi54LCBtYXgueSksXG4gICAgLy8gICAgICAgIGNjLnAobWF4LngsIG1heC55KSwgMSwgY29sb3IpO1xuICAgIC8vICAgIHRoaXMuX2RyYXdOb2RlLmRyYXdTZWdtZW50KGNjLnAobWF4LngsIG1heC55KSxcbiAgICAvLyAgICAgICAgY2MucChtYXgueCwgbWluLnkpLCAxLCBjb2xvcik7XG4gICAgLy8gICAgdGhpcy5fZHJhd05vZGUuZHJhd1NlZ21lbnQoY2MucChtYXgueCwgbWluLnkpLFxuICAgIC8vICAgICAgICBjYy5wKG1pbi54LCBtaW4ueSksIDEsIGNvbG9yKTtcbiAgICAvL30sXG4gICAgLy9cbiAgICAvL2RyYXdSZWN0RmlsbDogZnVuY3Rpb24gKHJlZ2lvbiwgY29sb3IpIHtcbiAgICAvLyAgICBpZiAocmVnaW9uID09IG51bGwpIHtcbiAgICAvLyAgICAgICAgcmV0dXJuO1xuICAgIC8vICAgIH1cbiAgICAvLyAgICB0aGlzLl9kcmF3Tm9kZS5kcmF3UmVjdChyZWdpb24uZ2V0TWluKCksIHJlZ2lvbi5nZXRNYXgoKSwgY29sb3IsIDEsIGNvbG9yKTtcbiAgICAvL31cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRvclNjZW5lOyIsInZhciBHYW1lQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi8uLi9jb250cm9sbGVyL0dhbWVDb250cm9sbGVyXCIpO1xuXG52YXIgR2FtZVNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdmFyIGdhbWVOb2RlID0gR2FtZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKGdhbWVOb2RlKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lU2NlbmU7XG4iLCJ2YXIgR3JpZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9HcmlkVHlwZVwiKTtcbnZhciBTaGFwZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TaGFwZVR5cGVcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xuXG52YXIgQmFsbCA9IGNjLk5vZGUuZXh0ZW5kKHtcblxuICAgIHR5cGU6IEdyaWRUeXBlLkJBTEwsXG4gICAgYm9keTogbnVsbCxcbiAgICBzcHJpdGU6IG51bGwsXG4gICAgYWRkU2NhbGU6IDEsXG4gICAgY3RvcjogZnVuY3Rpb24gKHdpZHRoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBza2luQ2ZnID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldEN1cnJlbnRTa2luQ2ZnKCk7XG4gICAgICAgIHZhciBpbWFnZSA9IHNraW5DZmcuaW1hZ2UgKyBcIi5wbmdcIjtcbiAgICAgICAgdmFyIHNwcml0ZSA9IG5ldyBjYy5TcHJpdGUoXCIjXCIgKyBpbWFnZSk7XG4gICAgICAgIHRoaXMuYWRkU2NhbGUgPSBza2luQ2ZnLnNjYWxlO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHNwcml0ZSk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gc3ByaXRlO1xuICAgICAgICB0aGlzLnJlc2V0KHdpZHRoKTtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uICh3aWR0aCkge1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSB3aWR0aCAvIHRoaXMuc3ByaXRlLndpZHRoICogdGhpcy5hZGRTY2FsZTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVZID0gd2lkdGggLyB0aGlzLnNwcml0ZS53aWR0aCAqIHRoaXMuYWRkU2NhbGU7XG4gICAgfSxcblxuICAgIG9uRXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLnJlbW92ZUJvZHkoKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYgKHRoaXMuYm9keSkge1xuICAgICAgICAgICAgdmFyIGJvZHlQb3MgPSB0aGlzLmJvZHkuZ2V0UG9zKCk7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRQb3NpdGlvbihib2R5UG9zKTtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldFJvdGF0aW9uKHRoaXMuZ2V0Qm9keUFuZ2xlKCkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldEFuZ2xlVmVsOiBmdW5jdGlvbiAodykge1xuICAgICAgICB0aGlzLmJvZHkuc2V0QW5nVmVsKC1jYy5yYWRpYW5zVG9EZWdyZWVzKHcpKTtcbiAgICB9LFxuXG4gICAgZ2V0Qm9keUFuZ2xlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAtY2MucmFkaWFuc1RvRGVncmVlcyh0aGlzLmJvZHkuYSk7XG4gICAgfSxcblxuICAgIGluaXRCb2R5OiBmdW5jdGlvbiAoc3BhY2UsIHBvcykge1xuICAgICAgICB0aGlzLnNwYWNlID0gc3BhY2U7XG4gICAgICAgIHZhciBib2R5ID0gbmV3IGNwLkJvZHkoMSwgY3AubW9tZW50Rm9yQ2lyY2xlKDEsIDAsIHRoaXMuc3ByaXRlLndpZHRoICogdGhpcy5zcHJpdGUuc2NhbGVYLCBjcC52KDAsIDApKSk7XG4gICAgICAgIHZhciBzaGFwZSA9IG5ldyBjcC5DaXJjbGVTaGFwZShib2R5LCB0aGlzLnNwcml0ZS53aWR0aCAqIHRoaXMuc3ByaXRlLnNjYWxlWCAvIDIsIGNwLnYoMCwgMCkpO1xuICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICBzaGFwZS5zZXRGcmljdGlvbigwKTtcbiAgICAgICAgdGhpcy5zcGFjZS5hZGRTaGFwZShzaGFwZSk7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkQm9keShib2R5KTtcbiAgICAgICAgc2hhcGUuc2V0Q29sbGlzaW9uVHlwZShTaGFwZVR5cGUuQkFMTCk7XG4gICAgICAgIHNoYXBlLmdyb3VwID0gMTtcbiAgICAgICAgYm9keS51c2VyRGF0YSA9IHRoaXM7XG4gICAgICAgIHRoaXMuYm9keSA9IGJvZHk7XG4gICAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTtcbiAgICAgICAgdGhpcy5ib2R5LnNldFBvcyhwb3MpO1xuICAgICAgICBib2R5LnNldEFuZ1ZlbCgzKTtcbiAgICAgICAgdGhpcy51cGRhdGUoMCk7XG4gICAgICAgIC8vdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24ocG9zKTtcbiAgICB9LFxuXG4gICAgZ2V0UG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmdldFBvc2l0aW9uKCk7XG4gICAgfSxcblxuICAgIHJlbW92ZUJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIkJhbGwgcmVtb3ZlQm9keVwiKTtcbiAgICAgICAgaWYgKHRoaXMuYm9keSkge1xuICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVCb2R5KHRoaXMuYm9keSk7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLnJlbW92ZVNoYXBlKHRoaXMuc2hhcGUpO1xuICAgICAgICAgICAgdGhpcy5ib2R5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuc2hhcGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldFZlbDogZnVuY3Rpb24gKGRpcmVjdGlvblBvcykge1xuICAgICAgICB0aGlzLmJvZHkuc2V0VmVsKGRpcmVjdGlvblBvcyk7XG4gICAgfSxcblxuICAgIGdldFZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ib2R5LmdldFZlbCgpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhbGw7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMS84LlxuICovXG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3V0aWwvVXRpbHNcIik7XG5cbnZhciBCYWxsUG9vbCA9IHtcbiAgICBNQVhfUE9PTF9TSVpFOiAzMDAsXG4gICAgX3Bvb2w6IHt9LFxuXG4gICAgcHV0SW5Qb29sOiBmdW5jdGlvbiAobmFtZSwgb2JqKSB7XG4gICAgICAgIGlmICghdGhpcy5fcG9vbFtuYW1lXSkge1xuICAgICAgICAgICAgdGhpcy5fcG9vbFtuYW1lXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wb29sW25hbWVdLmxlbmd0aCA8IHRoaXMuTUFYX1BPT0xfU0laRSkge1xuICAgICAgICAgICAgb2JqLnJldGFpbiAmJiBvYmoucmV0YWluKCk7XG4gICAgICAgICAgICB0aGlzLl9wb29sW25hbWVdLnB1c2gob2JqKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmxvZyhcIlN5bWJvbCBwb29sIGlzIGZ1bGwsIHRocm93IGF3YXkgdGhpcyBzeW1ib2w6XCIgKyBuYW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNPYmplY3Q6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fcG9vbFtuYW1lXSAmJiB0aGlzLl9wb29sW25hbWVdLmxlbmd0aCA+IDApO1xuICAgIH0sXG5cbiAgICByZW1vdmVPYmplY3Q6IGZ1bmN0aW9uIChuYW1lLCBvYmopIHtcbiAgICAgICAgdmFyIGxpc3QgPSB0aGlzLl9wb29sW25hbWVdO1xuICAgICAgICBpZiAobGlzdCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iaiA9PT0gbGlzdFtpXSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBKU0IgcmVsZWFzZSB0byBhdm9pZCBtZW1vcnkgbGVha1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVsZWFzZSAmJiBvYmoucmVsZWFzZSgpO1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0RnJvbVBvb2w6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc09iamVjdChuYW1lKSkge1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuX3Bvb2xbbmFtZV0ucG9wKCk7XG4gICAgICAgICAgICBjYy5zeXMuaXNOYXRpdmUgJiYgb2JqLnJlbGVhc2UgJiYgVXRpbHMuYXV0b1JlbGVhc2Uob2JqKTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZHJhaW5BbGxQb29sczogZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuX3Bvb2wpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wb29sLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLl9wb29sW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLl9wb29sW2ldW2pdO1xuICAgICAgICAgICAgICAgICAgICAvLyBKU0IgcmVsZWFzZSB0byBhdm9pZCBtZW1vcnkgbGVha1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVsZWFzZSAmJiBvYmoucmVsZWFzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wb29sID0ge307XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYWxsUG9vbDsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzIuXG4gKi9cblxudmFyIEdyaWRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vR3JpZFR5cGVcIik7XG52YXIgQm9hcmRDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQm9hcmRDb250cm9sbGVyXCIpO1xudmFyIFNoYXBlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NoYXBlVHlwZVwiKTtcblxudmFyIEJvYXJkID0gY2MuTm9kZS5leHRlbmQoe1xuXG4gICAgdHlwZTogR3JpZFR5cGUuQk9BUkQsXG5cbiAgICBub2RlOiBudWxsLFxuXG4gICAgc2hhcGU6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAod2lkdGgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5ub2RlID0gQm9hcmRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0Iod2lkdGgpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMubm9kZSk7XG5cbiAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMubm9kZS5jb250cm9sbGVyLm5kQm9hcmQud2lkdGggKyAxNjtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLm5vZGUuY29udHJvbGxlci5uZEJvYXJkLmhlaWdodDtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQm9keSgpO1xuICAgIH0sXG5cbiAgICByZW1vdmVCb2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJCb2FyZCByZW1vdmVCb2R5XCIpO1xuICAgICAgICBpZiAodGhpcy5ib2R5KSB7XG4gICAgICAgICAgICAvL3RoaXMuc3BhY2UucmVtb3ZlQm9keSh0aGlzLmJvZHkpO1xuICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVTdGF0aWNTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgICAgIHRoaXMuYm9keSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnNoYXBlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0Qm9keTogZnVuY3Rpb24gKHNwYWNlLCBwb3MpIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICB0aGlzLnNwYWNlID0gc3BhY2U7XG5cbiAgICAgICAgdmFyIGJvZHkgPSBuZXcgY3AuQm9keShJbmZpbml0eSwgSW5maW5pdHkpO1xuICAgICAgICB2YXIgc2hhcGUgPSBuZXcgY3AuQm94U2hhcGUoYm9keSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICBzaGFwZS5zZXRGcmljdGlvbigwKTtcbiAgICAgICAgc2hhcGUuc2V0Q29sbGlzaW9uVHlwZShTaGFwZVR5cGUuQk9BUkQpO1xuICAgICAgICB0aGlzLnNwYWNlLmFkZFN0YXRpY1NoYXBlKHNoYXBlKTtcbiAgICAgICAgYm9keS5zZXRQb3MocG9zKTtcbiAgICAgICAgYm9keS51c2VyRGF0YSA9IHRoaXM7XG4gICAgICAgIHRoaXMuYm9keSA9IGJvZHk7XG4gICAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTtcbiAgICAgICAgdGhpcy5zcGFjZS5yZWluZGV4U2hhcGUodGhpcy5zaGFwZSk7XG4gICAgfSxcblxuICAgIHNldFBvc1g6IGZ1bmN0aW9uIChwb3NYKSB7XG4gICAgICAgIHRoaXMueCA9IHBvc1g7XG4gICAgICAgIHRoaXMuYm9keS5zZXRQb3MoY2MucCh0aGlzLngsIHRoaXMueSkpO1xuICAgICAgICB0aGlzLnNwYWNlLnJlaW5kZXhTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICB9LFxuXG4gICAgZ2V0Qm91bmRpbmdCb3g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5jb250cm9sbGVyLm5kQm9hcmQuZ2V0Qm91bmRpbmdCb3hUb1dvcmxkKCk7XG4gICAgfSxcblxuICAgIGhpZGVCYWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubm9kZS5jb250cm9sbGVyLmhpZGVCYWxsKCk7XG4gICAgfSxcblxuICAgIHNob3dCYWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubm9kZS5jb250cm9sbGVyLnNob3dCYWxsKCk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQm9hcmQ7IiwidmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcblxudmFyIEJvb3N0ID0gY2MuU3ByaXRlLmV4dGVuZCh7XG5cbiAgICB0eXBlOiAwLFxuICAgIGN0b3I6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuTElGRTpcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihcIiNpY29uX25ld19saWZlLnBuZ1wiKTtcbiAgICAgICAgICAgICAgICAvL3RoaXMuc2V0Q29sb3IoY2MuY29sb3IuUkVEKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNQTElUOlxuICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKFwiI2ljb25fM19tdWx0aXBsZS5wbmdcIik7XG4gICAgICAgICAgICAgICAgLy90aGlzLnNldENvbG9yKGNjLmNvbG9yLkJMVUUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuVEhSRUVfQkFMTDpcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihcIiNpY29uXzNfbmV3LnBuZ1wiKTtcbiAgICAgICAgICAgICAgICAvL3RoaXMuc2V0Q29sb3IoY2MuY29sb3IuR1JFRU4pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vc3Q7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8yLlxuICovXG5cbnZhciBTaGFwZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TaGFwZVR5cGVcIik7XG5cbnZhciBHcmlkID0gY2MuTm9kZS5leHRlbmQoe1xuXG4gICAgaXNHaWZ0OiBmYWxzZSxcbiAgICB0eXBlOiAwLFxuICAgIHJlbW92ZWFibGU6IGZhbHNlLFxuXG4gICAgc3ByaXRlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCwgdHlwZSkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLmlnbm9yZUFuY2hvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IG5ldyBjYy5TcHJpdGUoXCIjZ3JpZC5wbmdcIik7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5zcHJpdGUpO1xuICAgICAgICB0aGlzLnJlc2V0KGNvbG9yLCB3aWR0aCwgaGVpZ2h0LCB0eXBlKTtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCwgdHlwZSkge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSB3aWR0aCAvIHRoaXMuc3ByaXRlLndpZHRoO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVkgPSBoZWlnaHQgLyB0aGlzLnNwcml0ZS5oZWlnaHQ7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldENvbG9yKGNvbG9yKTtcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQm9keSgpO1xuICAgIH0sXG5cbiAgICBzZXRHaWZ0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXNHaWZ0ID0gdHJ1ZTtcbiAgICAgICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShcImdyaWRfZ2lmdC5wbmdcIik7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0Q29sb3IoY2MuY29sb3IuV0hJVEUpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSAodGhpcy53aWR0aCArIDQpIC8gdGhpcy5zcHJpdGUud2lkdGg7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWSA9ICh0aGlzLmhlaWdodCArIDQpIC8gdGhpcy5zcHJpdGUuaGVpZ2h0O1xuICAgIH0sXG5cbiAgICBzZXRDb2xvcjogZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGlmICghdGhpcy5pc0dpZnQpIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldENvbG9yKGNvbG9yKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0Qm9keTogZnVuY3Rpb24gKHNwYWNlLCBwb3MpIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICB0aGlzLnNwYWNlID0gc3BhY2U7XG5cbiAgICAgICAgdmFyIGJvZHkgPSBuZXcgY3AuQm9keShJbmZpbml0eSwgSW5maW5pdHkpO1xuICAgICAgICB2YXIgc2hhcGUgPSBuZXcgY3AuQm94U2hhcGUoYm9keSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICBzaGFwZS5zZXRGcmljdGlvbigwKTtcbiAgICAgICAgdGhpcy5zcGFjZS5hZGRTdGF0aWNTaGFwZShzaGFwZSk7XG4gICAgICAgIHNoYXBlLnNldENvbGxpc2lvblR5cGUoU2hhcGVUeXBlLkJSSUNLKTtcbiAgICAgICAgYm9keS5zZXRQb3MocG9zKTtcbiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTtcbiAgICAgICAgYm9keS51c2VyRGF0YSA9IHRoaXM7XG4gICAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTtcbiAgICAgICAgdGhpcy5zcGFjZS5yZWluZGV4U2hhcGUoc2hhcGUpO1xuICAgIH0sXG5cbiAgICByZW1vdmVCb2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJHcmlkIHJlbW92ZUJvZHlcIik7XG4gICAgICAgIGlmICh0aGlzLnNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLnJlbW92ZVN0YXRpY1NoYXBlKHRoaXMuc2hhcGUpO1xuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVhYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHcmlkOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgT2JzdGFjbGUgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoY29sb3IsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY29sb3IsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB0aGlzLmlnbm9yZUFuY2hvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IG5ldyBjYy5TcHJpdGUoXCIjZ3JpZC5wbmdcIik7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5zcHJpdGUpO1xuICAgICAgICB0aGlzLnJlc2V0KGNvbG9yLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSB3aWR0aCAvIHRoaXMuc3ByaXRlLndpZHRoO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVkgPSBoZWlnaHQgLyB0aGlzLnNwcml0ZS5oZWlnaHQ7XG4gICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldENvbG9yKGNvbG9yKTtcbiAgICB9LFxuXG4gICAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRDb2xvcihjb2xvcik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gT2JzdGFjbGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xuXG52YXIgUGxheWVySW5mbyA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5wbGF5ZXJJZCA9IFwiXCI7XG4gICAgdGhpcy5iZXN0U2NvcmUgPSAwO1xuICAgIHRoaXMucmVtb3ZlZEFkcyA9IGZhbHNlO1xuICAgIHRoaXMubGV2ZWwgPSAwO1xuICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xuICAgIHRoaXMubGV2ZWxNYXAgPSBudWxsO1xuICAgIHRoaXMucmF0ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuYm9vc3RNYXAgPSBudWxsO1xuICAgIHRoaXMuY29pbnMgPSAwO1xuICAgIHRoaXMuZ3VpZGVkID0gZmFsc2U7XG5cbiAgICB0aGlzLmhhcmRMZXZlbCA9IDA7XG4gICAgdGhpcy5sYXN0V2hlZWxUaW1lID0gMDtcbiAgICB0aGlzLmN1cnJlbnRTa2luSWQgPSAwO1xuICAgIHRoaXMuaW50ZXJzdGl0aWFsQWRDb3VudCA9IDA7XG4gICAgdGhpcy5yZXdhcmRlZEFkQ291bnQgPSAwO1xuXG4gICAgdGhpcy5jcmVhdGVEdCA9IDA7XG5cbiAgICB0aGlzLmxldmVsc01hcCA9IHt9O1xuXG4gICAgdGhpcy5sYXN0TG9naW5EYXkgPSAwO1xuICAgIHRoaXMuY29uc2VjdXRpdmVMb2dpbkRheXMgPSAxO1xuICAgIHRoaXMubGFzdENsYWltRGFpbHlCb251c0RheSA9IDA7XG4gICAgdGhpcy5uZXh0RGF5VGlwcyA9IGZhbHNlO1xuXG4gICAgdGhpcy5za2luTWFwID0ge307XG4gICAgdGhpcy5zcGVjaWFsT2ZmZXJNYXAgPSB7fTtcblxuICAgIHRoaXMuZGlhbW9uZHMgPSAwO1xuXG4gICAgdGhpcy50YXNrTWFwID0ge307XG4gICAgdGhpcy5za2luQWRqdXN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3RTaG93UmF0ZVRpbWUgPSAwO1xuXG4gICAgdGhpcy5yZXdhcmRBZENvdW50UGVyRGF5ID0ge307XG4gICAgdGhpcy5yZXdhcmRBZFJlY29yZERheSA9IDA7XG4gICAgdGhpcy5pYXBDb3VudCA9IDA7XG59O1xuXG5QbGF5ZXJJbmZvLnByb3RvdHlwZS51bm1hcnNoYWxsID0gZnVuY3Rpb24gKGpzb24pIHtcbiAgICB0aGlzLnBsYXllcklkID0ganNvbltcInBsYXllcklkXCJdO1xuICAgIHRoaXMuYmVzdFNjb3JlID0ganNvbltcImJlc3RTY29yZVwiXSB8fCAwO1xuICAgIHRoaXMucmVtb3ZlZEFkcyA9IGpzb25bXCJyZW1vdmVkQWRzXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMubGV2ZWwgPSBqc29uW1wibGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLnByb2dyZXNzID0ganNvbltcInByb2dyZXNzXCJdIHx8IDA7XG4gICAgdGhpcy5sZXZlbE1hcCA9IGpzb25bXCJsZXZlbE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLnJhdGVkID0ganNvbltcInJhdGVkXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMuY29pbnMgPSBqc29uW1wiY29pbnNcIl0gfHwgMDtcbiAgICB0aGlzLmd1aWRlZCA9IGpzb25bXCJndWlkZWRcIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5ib29zdE1hcCA9IGpzb25bXCJib29zdE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLmhhcmRMZXZlbCA9IGpzb25bXCJoYXJkTGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLmxhc3RXaGVlbFRpbWUgPSBqc29uW1wibGFzdFdoZWVsVGltZVwiXSB8fCAwO1xuICAgIHRoaXMuY3VycmVudFNraW5JZCA9IGpzb25bXCJjdXJyZW50U2tpbklkXCJdIHx8IDA7XG4gICAgdGhpcy5pbnRlcnN0aXRpYWxBZENvdW50ID0ganNvbltcImludGVyc3RpdGlhbEFkQ291bnRcIl0gfHwgMDtcbiAgICB0aGlzLnJld2FyZGVkQWRDb3VudCA9IGpzb25bXCJyZXdhcmRlZEFkQ291bnRcIl0gfHwgMDtcbiAgICB0aGlzLmNyZWF0ZUR0ID0ganNvbltcImNyZWF0ZUR0XCJdIHx8IERhdGUubm93KCk7XG4gICAgdGhpcy5sZXZlbHNNYXAgPSBqc29uW1wibGV2ZWxzTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMubGFzdExvZ2luRGF5ID0ganNvbltcImxhc3RMb2dpbkRheVwiXSB8fCAwO1xuICAgIHRoaXMuY29uc2VjdXRpdmVMb2dpbkRheXMgPSBqc29uW1wiY29uc2VjdXRpdmVMb2dpbkRheXNcIl0gfHwgMTtcbiAgICB0aGlzLmxhc3RDbGFpbURhaWx5Qm9udXNEYXkgPSBqc29uW1wibGFzdENsYWltRGFpbHlCb251c0RheVwiXSB8fCAwO1xuICAgIHRoaXMubmV4dERheVRpcHMgPSBqc29uW1wibmV4dERheVRpcHNcIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5za2luTWFwID0ganNvbltcInNraW5NYXBcIl0gfHwge1xuICAgICAgICBcIjBcIjogdHJ1ZVxuICAgIH07XG4gICAgdGhpcy5zcGVjaWFsT2ZmZXJNYXAgPSBqc29uW1wic3BlY2lhbE9mZmVyTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMuZGlhbW9uZHMgPSBqc29uW1wiZGlhbW9uZHNcIl0gfHwgNTA7XG4gICAgdGhpcy50YXNrTWFwID0ganNvbltcInRhc2tNYXBcIl0gfHwge307XG4gICAgdGhpcy5za2luQWRqdXN0ZWQgPSBqc29uW1wic2tpbkFkanVzdGVkXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMubGFzdFNob3dSYXRlVGltZSA9IGpzb25bXCJsYXN0U2hvd1JhdGVUaW1lXCJdIHx8IDA7XG4gICAgdGhpcy5yZXdhcmRBZENvdW50UGVyRGF5ID0ganNvbltcInJld2FyZEFkQ291bnRQZXJEYXlcIl0gfHwgMDtcbiAgICB0aGlzLnJld2FyZEFkUmVjb3JkRGF5ID0ganNvbltcInJld2FyZEFkUmVjb3JkRGF5XCJdIHx8IDA7XG4gICAgdGhpcy5pYXBDb3VudCA9IGpzb25bXCJpYXBDb3VudFwiXSB8fCAwO1xufTtcblxuUGxheWVySW5mby5jcmVhdGVEZWZhdWx0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwbGF5ZXJJbmZvID0gbmV3IFBsYXllckluZm8oKTtcbiAgICBwbGF5ZXJJbmZvLmhpbnRzQ291bnQgPSA1O1xuICAgIHBsYXllckluZm8uYmVzdFNjb3JlID0gMDtcbiAgICBwbGF5ZXJJbmZvLnJlbW92ZWRBZHMgPSBmYWxzZTtcbiAgICBwbGF5ZXJJbmZvLmxldmVsID0gMTtcbiAgICBwbGF5ZXJJbmZvLnByb2dyZXNzID0gMDtcbiAgICBwbGF5ZXJJbmZvLmxldmVsTWFwID0ge307XG4gICAgcGxheWVySW5mby5yYXRlZCA9IGZhbHNlO1xuICAgIHBsYXllckluZm8uY29pbnMgPSAwO1xuICAgIHBsYXllckluZm8uZ3VpZGVkID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5ib29zdE1hcCA9IHt9O1xuICAgIHBsYXllckluZm8uYm9vc3RNYXBbQm9vc3RUeXBlLlNQTElUXSA9IDU7XG4gICAgcGxheWVySW5mby5ib29zdE1hcFtCb29zdFR5cGUuVEhSRUVfQkFMTF0gPSA1O1xuICAgIHBsYXllckluZm8uaGFyZExldmVsID0gMTtcbiAgICBwbGF5ZXJJbmZvLmxhc3RXaGVlbFRpbWUgPSAwO1xuICAgIHBsYXllckluZm8uY3VycmVudFNraW5JZCA9IDA7XG4gICAgcGxheWVySW5mby5pbnRlcnN0aXRpYWxBZENvdW50ID0gMDtcbiAgICBwbGF5ZXJJbmZvLnJld2FyZGVkQWRDb3VudCA9IDA7XG4gICAgcGxheWVySW5mby5jcmVhdGVEdCA9IERhdGUubm93KCk7XG4gICAgcGxheWVySW5mby5sZXZlbHNNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmRhaWx5Qm9udXNEdCA9IERhdGUubm93KCk7XG4gICAgcGxheWVySW5mby5sYXN0TG9naW5EYXkgPSAwO1xuICAgIHBsYXllckluZm8uY29uc2VjdXRpdmVMb2dpbkRheXMgPSAxO1xuICAgIHBsYXllckluZm8ubGFzdENsYWltRGFpbHlCb251c0RheSA9IDA7XG4gICAgcGxheWVySW5mby5uZXh0RGF5VGlwcyA9IGZhbHNlO1xuICAgIHBsYXllckluZm8uc2tpbk1hcCA9IHtcbiAgICAgICAgXCIwXCI6IHRydWVcbiAgICB9O1xuICAgIHBsYXllckluZm8uc3BlY2lhbE9mZmVyTWFwID0ge307XG4gICAgcGxheWVySW5mby5kaWFtb25kcyA9IDUwO1xuICAgIHBsYXllckluZm8udGFza01hcCA9IHt9O1xuICAgIHBsYXllckluZm8uc2tpbkFkanVzdGVkID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5sYXN0U2hvd1JhdGVUaW1lID0gMDtcbiAgICBwbGF5ZXJJbmZvLnJld2FyZEFkQ291bnRQZXJEYXkgPSAwO1xuICAgIHBsYXllckluZm8ucmV3YXJkQWRSZWNvcmREYXkgPSAwO1xuICAgIHBsYXllckluZm8uaWFwQ291bnQgPSAwO1xuICAgIHJldHVybiBwbGF5ZXJJbmZvO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJJbmZvO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8yLlxuICovXG5cbnZhciBTaGFwZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TaGFwZVR5cGVcIik7XG5cbnZhciBXYWxsID0gY2MuTm9kZS5leHRlbmQoe1xuXG4gICAgaW5pdEJvZHk6IGZ1bmN0aW9uIChzcGFjZSwgcG9zKSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocG9zKTtcbiAgICAgICAgdGhpcy5zcGFjZSA9IHNwYWNlO1xuXG4gICAgICAgIHZhciBib2R5ID0gbmV3IGNwLkJvZHkoSW5maW5pdHksIEluZmluaXR5KTtcbiAgICAgICAgdmFyIHNoYXBlID0gbmV3IGNwLkJveFNoYXBlKGJvZHksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgc2hhcGUuc2V0RWxhc3RpY2l0eSgxKTtcbiAgICAgICAgc2hhcGUuc2V0RnJpY3Rpb24oMCk7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkU3RhdGljU2hhcGUoc2hhcGUpO1xuICAgICAgICBzaGFwZS5zZXRDb2xsaXNpb25UeXBlKFNoYXBlVHlwZS5XQUxMKTtcbiAgICAgICAgYm9keS5zZXRQb3MoY2MucEFkZChwb3MsIGNjLnAodGhpcy53aWR0aCAqIDAuNSwgdGhpcy5oZWlnaHQgKiAwLjUpKSk7XG4gICAgICAgIGJvZHkudXNlckRhdGEgPSB0aGlzO1xuICAgICAgICB0aGlzLnNwYWNlLnJlaW5kZXhTaGFwZShzaGFwZSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gV2FsbDsiLCJcbnZhciBCb29zdFR5cGUgPSB7XG4gICAgTElGRTogMSxcbiAgICBUSFJFRV9CQUxMOiAyLFxuICAgIFNQTElUOiAzLFxuICAgIEdJRlQ6IDQsXG4gICAgU0tJTjogNSxcbiAgICBESUFNT05EOiA2LFxuICAgIE5VTTogNlxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb29zdFR5cGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy81LzcuXG4gKi9cblxudmFyIEdhbWVNb2RlID0ge1xuICAgIEdBTUVfTU9ERV9FTkRMRVNTOiAwLFxuICAgIEdBTUVfTU9ERV9MRVZFTDogMVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lTW9kZTsiLCJcbnZhciBHcmlkVHlwZSA9IHtcbiAgICBPQlNUQUNMRTogMCxcbiAgICBCUklDSzogMSxcbiAgICBCQUxMOiAyLFxuICAgIEJPQVJEOiAzXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdyaWRUeXBlOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMy8yNS5cbiAqL1xuXG52YXIgTG9ja1N0YXR1cyA9IHtcbiAgICBMT0NLX1NUQVRVU19MT0NLOiAwLFxuICAgIExPQ0tfU1RBVFVTX1VOTE9DSzogMSxcbiAgICBMT0NLX1NUQVRVU19ET0lORzogMlxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMb2NrU3RhdHVzOyIsIlxudmFyIFJhbmtUeXBlID0ge1xuICAgIEZyaWVuZHM6IDAsXG4gICAgR3JvdXA6IDEsXG4gICAgR2xvYmFsOjJcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmFua1R5cGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxOC8xLzEuXG4gKi9cblxuXG52YXIgU2NlbmVUeXBlID0ge1xuICAgIE5PTkU6IC0xLFxuICAgIExPQURJTkc6IDAsXG4gICAgTUVOVTogMSxcbiAgICBQQUNLQUdFOiAyLFxuICAgIExFVkVMOiAzLFxuICAgIEdBTUU6IDRcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2NlbmVUeXBlOyIsIlxudmFyIFNoYXBlVHlwZSA9IHtcbiAgICBCQUxMOiAxLFxuICAgIEJSSUNLOiAyLFxuICAgIEJPQVJEOiAzLFxuICAgIFdBTEw6IDRcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2hhcGVUeXBlOyIsIlxudmFyIFNraW5SZXdhcmRUeXBlID0ge1xuICAgIE5vbmU6IDAsXG4gICAgTGV2ZWxDb3VudDogMSxcbiAgICBXYXRjaEFkQ291bnQ6IDIsXG4gICAgV2F0Y2hSZXdhcmRBZENvdW50OiAzLFxuICAgIENsYWltZWQ6IDQsXG4gICAgUHVyY2hhc2U6IDVcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpblJld2FyZFR5cGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNi5cbiAqL1xuXG52YXIgU3RvcmVUeXBlID0ge1xuICAgIEZSRUU6IDEsXG4gICAgTkVXXzM6IDIsXG4gICAgU1BMSVQ6IDMsXG4gICAgUkVNT1ZFX0FEUzogNCxcbiAgICBSRVNUT1JFOiA1LFxuICAgIEZJUlNUX1BVUkNIQVNFOiA2LFxuICAgIE5FV19BTkRfU1BMSVQ6IDcsXG4gICAgRElBTU9ORDogOCxcbiAgICBTS0lOOiA5XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlVHlwZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LzExLzIxLlxuICovXG5cbnZhciBFdmVudHNOYW1lID0ge1xuICAgIEVWRU5UX05BTUVfR0FNRV9TVEFSVDogXCJldmVudF9uYW1lX3N0YXJ0XCIsXG4gICAgRVZFTlRfTkFNRV9HQU1FX09WRVI6IFwiZXZlbnRfbmFtZV9nYW1lX292ZXJcIixcbiAgICBFVkVOVF9OQU1FX1VQREFURV9TQ09SRTogXCJldmVudF9uYW1lX3VwZGF0ZV9zY29yZVwiLFxuICAgIEVWRU5UX05BTUVfVVBEQVRFX0xFRlRfQlVMTEVUOiBcImV2ZW50X25hbWVfdXBkYXRlX2xlZnRfYnVsbGV0XCIsXG4gICAgRVZFTlRfTkFNRV9VUERBVEVfQkVTVF9TQ09SRTogXCJldmVudF9uYW1lX3VwZGF0ZV9iZXN0X3Njb3JlXCIsXG4gICAgRVZFTlRfTkFNRV9VUERBVEVfQVVESU86IFwiZXZlbnRfbmFtZV91cGRhdGVfYXVkaW9cIixcbiAgICBVUERBVEVfTEVWRUw6IFwidXBkYXRlX2xldmVsXCIsXG4gICAgQ09JTlNfVVBEQVRFOiBcImNvaW5zX3VwZGF0ZVwiLFxuICAgIFJFRlJFU0hfQk9PU1Q6IFwicmVmcmVzaF9ib29zdFwiLFxuICAgIFVQREFURV9TS0lOOiBcInVwZGF0ZV9za2luXCIsXG4gICAgVVBEQVRFX1NQRUNJQUxfT0ZGRVI6IFwidXBkYXRlX3NwZWNpYWxfb2ZmZXJcIixcbiAgICBQVVJDSEFTRV9FTkQ6IFwicHVyY2hhc2VfZW5kXCIsXG4gICAgRElBTE9HX1BPUEVEOiBcImRpYWxvZ19wb3BlZFwiLFxuICAgIERJQUxPR19DTE9TRUQ6IFwiZGlhbG9nX2Nsb3NlZFwiLFxuICAgIERJQU1PTkRTX1VQREFURTogXCJkaWFtb25kc191cGRhdGVcIixcbiAgICBUQVNLX1VQREFURTogXCJ0YXNrX3VwZGF0ZVwiLFxuICAgIFJFV0FSREVEX1ZJREVPX0NPVU5UOiBcInJld2FyZGVkX3ZpZGVvX2NvdW50XCJcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRzTmFtZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS81LzEyLlxuICovXG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBTaGFyZUNvbmZpZyA9IHJlcXVpcmUoXCIuLi9jb25maWcvU2hhcmVDb25maWdcIik7XG4vL3ZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcblxuXG52YXIgR2FtZU1hbiA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgRlJFRV9XSEVFTF9IT1VSUzogMTIsXG5cbiAgICBPTkVfSE9VUl9TRUNPTkRTOiA2MCAqIDYwICogMTAwMCxcbiAgICBzdGFydFRpbWU6IDAsXG4gICAgcmVzdWx0Q291bnQ6IDAsXG4gICAgcmF0ZWQ6IGZhbHNlLFxuICAgIGVuZFRpbWU6IDAsXG4gICAgY2FuUmVMaWZlOiB0cnVlLFxuICAgIGRpc3RhbmNlOiAwLFxuICAgIGxldmVsSWQ6IDEsXG4gICAgaGFyZE1vZGU6IGZhbHNlLFxuICAgIGdpZnRDb3VudDogMCxcbiAgICBsYXN0U2hvd0xldmVsOiAwLFxuXG4gICAgdG90YWxGYWlsQ291bnQ6IDAsXG4gICAgcG9wZWQzU3RhclRpcHM6IGZhbHNlLFxuXG4gICAgc2V0SGFyZE1vZGU6IGZ1bmN0aW9uIChoYXJkTW9kZSkge1xuICAgICAgICB0aGlzLmhhcmRNb2RlID0gaGFyZE1vZGU7XG4gICAgfSxcblxuICAgIGNhblBvcDNTdGFyVGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMucG9wZWQzU3RhclRpcHM7XG4gICAgfSxcblxuICAgIHNldFBvcDNTdGFyVGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBvcGVkM1N0YXJUaXBzID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgaXNIYXJkTW9kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXJkTW9kZTtcbiAgICB9LFxuXG4gICAgZ2V0UGxheWVyTGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZS5wbGF5ZXJNYW4uZ2V0SGFyZExldmVsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yYXRlZCA9IGdhbWUucGxheWVyTWFuLnBsYXllci5yYXRlZDtcbiAgICAgICAgdGhpcy5jaG9vc2VMYXRlc3RMZXZlbCgpO1xuICAgIH0sXG5cbiAgICBjaG9vc2VMYXRlc3RMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5sZXZlbElkID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0SGFyZE1vZGUodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmxldmVsSWQgPSBnYW1lLnBsYXllck1hbi5nZXRIYXJkTGV2ZWwoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRMZXZlbExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldExldmVsTGlzdCgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVTY29yZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuRVZFTlRfTkFNRV9VUERBVEVfU0NPUkUpO1xuICAgIH0sXG5cbiAgICBnYW1lT3ZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2dhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tGYWlsZWRQcm9ncmVzc2lvbkV2ZW50KFwibGV2ZWxcIiwgZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSk7XG4gICAgICAgIHRoaXMucmVzdWx0Q291bnQrKztcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudFN0YXI6IGZ1bmN0aW9uIChjb3N0VGltZSkge1xuICAgICAgICAvL2NjLmxvZyhcImNvc3RUaW1lOlwiICsgY29zdFRpbWUpO1xuICAgICAgICB2YXIgbGV2ZWxDZmcgPSB0aGlzLmdldEN1ckNvbmZpZygpO1xuICAgICAgICB2YXIgc3RhciA9IDE7XG4gICAgICAgIGlmIChjb3N0VGltZSA8PSBsZXZlbENmZy5zdGFyVGltZSkge1xuICAgICAgICAgICAgc3RhciA9IDM7XG4gICAgICAgIH0gZWxzZSBpZiAoY29zdFRpbWUgPD0gbGV2ZWxDZmcuc3RhclRpbWUgKiAyKSB7XG4gICAgICAgICAgICBzdGFyID0gMjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhcjtcbiAgICB9LFxuXG4gICAgZ2V0UHJvZ3Jlc3NQZXJjZW50OiBmdW5jdGlvbiAoY29zdFRpbWUpIHtcbiAgICAgICAgdmFyIGxldmVsQ2ZnID0gdGhpcy5nZXRDdXJDb25maWcoKTtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIDEgLSAoY29zdFRpbWUgLyBsZXZlbENmZy5zdGFyVGltZSAvIDMpKSAqIDEwMDtcbiAgICB9LFxuXG4gICAgZ2FtZVdpbjogZnVuY3Rpb24gKGNvc3RUaW1lKSB7XG4gICAgICAgIHZhciBzdGFyID0gdGhpcy5nZXRDdXJyZW50U3Rhcihjb3N0VGltZSk7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXIgPSBzdGFyO1xuICAgICAgICB2YXIgaGFzUHNzZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGxldmVsSWRBbmRTdGFyID0gdGhpcy5sZXZlbElkICsgXCItXCIgKyBzdGFyO1xuICAgICAgICBpZiAoIXRoaXMuaXNIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWxTdGFyKHRoaXMubGV2ZWxJZCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgaGFzUHNzZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVMZXZlbFN0YXIodGhpcy5sZXZlbElkLCBzdGFyKTtcbiAgICAgICAgICAgIGlmICghaGFzUHNzZWQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJsZXZlbF9wYXNzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiB0aGlzLmxldmVsSWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJsZXZlbF9wYXNzX3N0YXJcIiwge1xuICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IGxldmVsSWRBbmRTdGFyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwidHJhY2sgZXZlbnQgbGV2ZWxfcGFzczpcIiArIHRoaXMubGV2ZWxJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlc3VsdENvdW50Kys7XG4gICAgICAgICAgICB0aGlzLmxldmVsSWQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgPD0gdGhpcy5nZXRMZXZlbExpc3QoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSh0aGlzLmxldmVsSWQsIGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldExldmVsKHRoaXMubGV2ZWxJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0SGFyZExldmVsU3Rhcih0aGlzLmxldmVsSWQpID4gMCkge1xuICAgICAgICAgICAgICAgIGhhc1Bzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlSGFyZExldmVsU3Rhcih0aGlzLmxldmVsSWQsIHN0YXIpO1xuICAgICAgICAgICAgaWYgKCFoYXNQc3NlZCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcImxldmVsX3Bhc3NfaGFyZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIFwibGV2ZWxcIjogdGhpcy5sZXZlbElkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwibGV2ZWxfcGFzc19oYXJkX3N0YXJcIiwge1xuICAgICAgICAgICAgICAgICAgICBsZXZlbFN0YXJLZXk6IGxldmVsSWRBbmRTdGFyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwidHJhY2sgZXZlbnQgbGV2ZWxfcGFzc19oYXJkOlwiICsgdGhpcy5sZXZlbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzdWx0Q291bnQrKztcbiAgICAgICAgICAgIHRoaXMubGV2ZWxJZCsrO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWxJZCA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGdhbWUuZ2NNYW5hZ2VyLnJlcG9ydFNjb3JlKHRoaXMubGV2ZWxJZCwgZ2FtZS5jb25maWcuZ2V0SGFyZEJvYXJkS2V5KCkpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldEhhcmRMZXZlbCh0aGlzLmxldmVsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNraXBMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsSWQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgPD0gdGhpcy5nZXRMZXZlbExpc3QoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRMZXZlbCh0aGlzLmxldmVsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sZXZlbElkKys7XG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbElkIDw9IHRoaXMuZ2V0TGV2ZWxMaXN0KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0SGFyZExldmVsKHRoaXMubGV2ZWxJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlTGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwsIHN0YXIpIHtcbiAgICAgICAgdmFyIG9sZFN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbERhdGEodGhpcy5sZXZlbElkLCBcInN0YXJcIikgfHwgMDtcbiAgICAgICAgaWYgKHN0YXIgPiBvbGRTdGFyKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJ1cGRhdGVMZXZlbFN0YXI6b2xkU3RhcjpcIiArIG9sZFN0YXIgKyBcIixzdGFyOlwiICsgc3Rhcik7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi51cGRhdGVMZXZlbERhdGEobGV2ZWwsIFwic3RhclwiLCBzdGFyKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVIYXJkTGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwsIHN0YXIpIHtcbiAgICAgICAgdmFyIG9sZFN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbERhdGEodGhpcy5sZXZlbElkLCBcImhhcmRTdGFyXCIpIHx8IDA7XG4gICAgICAgIGlmIChzdGFyID4gb2xkU3Rhcikge1xuICAgICAgICAgICAgY2MubG9nKFwidXBkYXRlSGFyZExldmVsU3RhcjpvbGRTdGFyOlwiICsgb2xkU3RhciArIFwiLHN0YXI6XCIgKyBzdGFyKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnVwZGF0ZUxldmVsRGF0YShsZXZlbCwgXCJoYXJkU3RhclwiLCBzdGFyKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN1bWVHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxJZC0tO1xuICAgIH0sXG5cbiAgICBjaG9vc2VMZXZlbDogZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICAgICAgdGhpcy5sZXZlbElkID0gbGV2ZWxJZDtcbiAgICB9LFxuXG4gICAgZ2V0RGlzcGxheUxldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxldmVsSWQ7XG4gICAgfSxcblxuICAgIGdldEN1ckNvbmZpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGV2ZWxMaXN0ID0gdGhpcy5nZXRMZXZlbExpc3QoKTtcbiAgICAgICAgaWYgKGxldmVsTGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIGxldmVsTGlzdFt0aGlzLmxldmVsSWQgLSAxXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgaGFzTmV4dExldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBsZXZlbExpc3QgPSB0aGlzLmdldExldmVsTGlzdCgpO1xuICAgICAgICBpZiAodGhpcy5sZXZlbElkID4gbGV2ZWxMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBzd2l0Y2hGYWlsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudG90YWxGYWlsQ291bnQrKztcbiAgICB9LFxuXG4gICAgc2hvd0FkczogZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcbiAgICAgICAgY2MubG9nKFwiR2FtZU1hbiBzaG93QWRzOlwiICsgc3VjY2VzcyArIFwiLGlzTmV3UGxheWVyOlwiICsgZ2FtZS5wbGF5ZXJNYW4uaXNOZXdQbGF5ZXIoKSk7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5pc05ld1BsYXllcigpKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgPiA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dJbnRlcnN0aXRpYWxBZHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvdGFsRmFpbENvdW50ICUgMiA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93SW50ZXJzdGl0aWFsQWRzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc2hvd0ludGVyc3RpdGlhbEFkcygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9zaG93SW50ZXJzdGl0aWFsQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IDMpIHtcbiAgICAgICAgICAgIHZhciBBZHNQbGFjZSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZW51bS9BZHNQbGFjZVwiKTtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKEFkc1BsYWNlLlBhc3MpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dSZWdpc3Rlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5yZXN1bHRDb3VudCA+IDAgJiYgdGhpcy5yZXN1bHRDb3VudCAlIDMgPT09IDApIHtcbiAgICAgICAgICAgIGdhbWUubG9naWNNYW4ucmVnaXN0ZXJOb3RpZmljYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaG93QWRzQW5kUmF0ZTogZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gNDtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgIGNvdW50ID0gNTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGFzdFNob3dlZFJhdGVEYXkgPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmxhc3RTaG93UmF0ZVRpbWUpIC8gKDI0ICogMzYwMCAqIDEwMDApKTtcbiAgICAgICAgaWYgKCF0aGlzLnJhdGVkICYmICh0aGlzLnJlc3VsdENvdW50ID4gMCAmJiB0aGlzLnJlc3VsdENvdW50ICUgY291bnQgPT09IDApICYmIGxhc3RTaG93ZWRSYXRlRGF5ID49IDIpIHtcbiAgICAgICAgICAgIGlmICghZ2FtZS5yYXRlTWFuYWdlci5sYXVuY2hBcHBSZXZpZXcoKSkge1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSYXRlRGxnKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldFJhdGVkKHRydWUpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93QWRzKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TGFzdFNob3dSYXRlVGltZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG93QWRzKHN1Y2Nlc3MpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlc3RhcnRHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUubG9naWNNYW4ucmVnaXN0ZXJOb3RpZmljYXRpb24oKTtcbiAgICAgICAgdGhpcy5zdGFydEdhbWUoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLkVWRU5UX05BTUVfVVBEQVRFX1NDT1JFKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLkVWRU5UX05BTUVfVVBEQVRFX0JHX1NQUklURSk7XG4gICAgfSxcblxuICAgIHN0YXJ0R2FtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2dhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tTdGFydFByb2dyZXNzaW9uRXZlbnQoXCJsZXZlbFwiLCBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpKTtcbiAgICB9LFxuXG4gICAgZW50ZXJHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja1N0YXJ0UHJvZ3Jlc3Npb25FdmVudChcImxldmVsXCIsIGdhbWUucGxheWVyTWFuLmdldExldmVsKCkpO1xuICAgIH0sXG5cbiAgICBsZWF2ZUdhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmRpc3RhbmNlID0gMDtcbiAgICB9LFxuXG4gICAgY2FuU2hvd1Jld2FyZGVkVmlkZW86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmNhblJlTGlmZSAmJiBnYW1lLmFkc01hbmFnZXIuaXNSZXdhcmRWaWRlb1JlYWR5KCkpO1xuICAgIH0sXG5cbiAgICBnZXRTaGFyZUNvbmZpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2hhcmVMaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U2hhcmVMaXN0KCk7XG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoc2hhcmVMaXN0Lmxlbmd0aCk7XG4gICAgICAgIHJldHVybiBzaGFyZUxpc3RbcmFuZG9tTnVtXTtcbiAgICB9LFxuXG4gICAgZ2V0RnJpZW5kSGVscFNoYXJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBkZXNjID0gZ2FtZS51dGlscy5zcHJpbnRmKFwi56CW5Z2X56C05Z2P6ICF5oiR5bey57uPJWTlhbPkuobvvIzluK7miJHnu6fnu63njqnvvIzorqnmiJHlhrLkuIrmppzpppbjgIJcIiwgZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSk7XG4gICAgICAgIHZhciBzaGFyZUNvbmZpZyA9IHRoaXMuZ2V0U2hhcmVDb25maWcoKTtcbiAgICAgICAgdmFyIHNoYXJlID0gc2hhcmVDb25maWcuY29weSgpO1xuICAgICAgICBzaGFyZS5kZXNjID0gZGVzYztcbiAgICAgICAgcmV0dXJuIHNoYXJlO1xuICAgIH0sXG5cbiAgICBnZXRGcmllbmRDaGFsbGVuZ2VTaGFyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGVzYyA9IGdhbWUudXRpbHMuc3ByaW50ZihcIuegluWdl+egtOWdj+iAheaIkeW3sue7jyVk5YWz5LqG77yM5L2g6IO96LaF6LaK5oiR5ZCX77yfXCIsIGdhbWUucGxheWVyTWFuLmdldExldmVsKCkpO1xuICAgICAgICB2YXIgc2hhcmVDb25maWcgPSB0aGlzLmdldFNoYXJlQ29uZmlnKCk7XG4gICAgICAgIHZhciBzaGFyZSA9IHNoYXJlQ29uZmlnLmNvcHkoKTtcbiAgICAgICAgc2hhcmUuZGVzYyA9IGRlc2M7XG4gICAgICAgIHJldHVybiBzaGFyZTtcbiAgICB9LFxuXG4gICAgZ2V0V2hlZWxMZWZ0VGltZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGFzdFdoZWVsVGltZSA9IGdhbWUucGxheWVyTWFuLmdldExhc3RXaGVlbFRpbWUoKTtcbiAgICAgICAgcmV0dXJuIChsYXN0V2hlZWxUaW1lICsgdGhpcy5GUkVFX1dIRUVMX0hPVVJTICogdGhpcy5PTkVfSE9VUl9TRUNPTkRTIC0gRGF0ZS5ub3coKSk7XG4gICAgfSxcblxuICAgIGlzRnJlZVdoZWVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBsZWZ0VGltZSA9IHRoaXMuZ2V0V2hlZWxMZWZ0VGltZSgpO1xuICAgICAgICBpZiAobGVmdFRpbWUgPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBhZGRHaWZ0Q291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5naWZ0Q291bnQrKztcbiAgICB9LFxuXG4gICAgY2FuU2hvd0dpZnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5sZXZlbElkID49IDkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgJSAzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2lmdENvdW50IDwgMykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RTaG93TGV2ZWwgPSB0aGlzLmxldmVsSWQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRTa2luQ2ZnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50U2tpbklkID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0Q3VycmVudFNraW5JZCgpO1xuICAgICAgICB2YXIgc2tpbkNmZyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNraW5DZmcoY3VycmVudFNraW5JZCk7XG4gICAgICAgIHJldHVybiBza2luQ2ZnO1xuICAgICAgICAvL3JldHVybiBza2luQ2ZnLmltYWdlICsgXCIucG5nXCI7XG4gICAgfSxcblxuICAgIHVwZGF0ZVNraW46IGZ1bmN0aW9uIChzcHJpdGUpIHtcbiAgICAgICAgdmFyIHNraW5DZmcgPSB0aGlzLmdldEN1cnJlbnRTa2luQ2ZnKCk7XG4gICAgICAgIHZhciBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoc2tpbkNmZy5pbWFnZSArIFwiLnBuZ1wiKTtcbiAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICBzcHJpdGUuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGRlZmF1bHRTcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoXCJza2luXzAucG5nXCIpO1xuICAgICAgICAgICAgc3ByaXRlLnNldFNwcml0ZUZyYW1lKGRlZmF1bHRTcHJpdGVGcmFtZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hlY2tBdXRvUG9wdXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNoZWNrRGFpbHlCb251cygpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tTcGVjaWFsT2ZmZXIoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tOZXh0RGF5VGlwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hlY2tOZXh0RGF5VGlwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3VsdENvdW50ID49IDMpIHtcbiAgICAgICAgICAgIGlmICghZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLm5leHREYXlUaXBzKSB7XG4gICAgICAgICAgICAgICAgLy9nYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKF8oXCJuZXh0X2RheV90aXBzXCIpKTtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKF8oXCJuZXh0X2RheV90aXBzXCIpLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIH0sIFwiaWNvbl9naWZ0cy5wbmdcIiwgMSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TmV4dERheVRpcHMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGNoZWNrRGFpbHlCb251czogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGFzdENsYWltRGF5ID0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmxhc3RDbGFpbURhaWx5Qm9udXNEYXk7XG4gICAgICAgIHZhciBjdXJyZW50RGF5Q2xhaW1lZCA9IGxhc3RDbGFpbURheSA+PSBnYW1lLnV0aWxzLmdldERheUJ5VHMoRGF0ZS5ub3coKSk7XG4gICAgICAgIGlmICghY3VycmVudERheUNsYWltZWQpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcImdhbWUucG9wdXBNYW4ucG9wdXBEYWlseUJvbnVzXCIpO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cERhaWx5Qm9udXMoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY2hlY2tTcGVjaWFsT2ZmZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTcGVjaWFsT2ZmZXJQdXJjaGFzZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5zaG93ZWRTcGVjaWFsT2ZmZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd2VkU3BlY2lhbE9mZmVyID0gdHJ1ZTtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTcGVpY2lhbE9mZmVyKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGlzU3BlY2lhbE9mZmVyUHVyY2hhc2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzcGVjaWFsT2ZmZXIgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTcGVjaWFsT2ZmZXJDZmcoKTtcbiAgICAgICAgdmFyIHB1cmNoYXNlZCA9IGdhbWUucGxheWVyTWFuLmlzU3BlY2lhbE9mZmVyUHVyY2hhc2VkKHNwZWNpYWxPZmZlci5waWQpO1xuICAgICAgICBjYy5sb2coXCJpc1NwZWNpYWxPZmZlclB1cmNoYXNlZDpcIiArIHB1cmNoYXNlZCk7XG4gICAgICAgIHJldHVybiBwdXJjaGFzZWQ7XG4gICAgfSxcblxuICAgIGFkanVzdFNraW5Db25maWdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuc2tpbkFkanVzdGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0U2tpbkFkanVzdGVkKCk7XG4gICAgICAgIHZhciBvbGRUYXNrQ29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldE9sZFRhc2tMaXN0KCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkVGFza0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBvbGRUYXNrQ29uZmlnID0gb2xkVGFza0NvbmZpZ3NbaV07XG4gICAgICAgICAgICB0aGlzLmFkanVzdE9sZFRhc2tDb25maWcob2xkVGFza0NvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRqdXN0T2xkVGFza0NvbmZpZzogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIFNraW5SZXdhcmRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblJld2FyZFR5cGVcIik7XG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBmYWxzZTtcbiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuTm9uZTpcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5MZXZlbENvdW50OlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLldhdGNoQWRDb3VudDpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmludGVyc3RpdGlhbEFkQ291bnQgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuV2F0Y2hSZXdhcmRBZENvdW50OlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIucmV3YXJkZWRBZENvdW50ID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLkNsYWltZWQ6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLlB1cmNoYXNlOlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5oYXNTa2luKGRhdGEuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbXBsZXRlZCkge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2xhaW1lZFNraW4oZGF0YS5pZCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRUYXNrQ2xhaW1lZChkYXRhLmlkKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNDb21wbGV0ZWRUYXNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0YXNrQ29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFRhc2tMaXN0KCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFza0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB0YXNrQ29uZmlnID0gdGFza0NvbmZpZ3NbaV07XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaXNUYXNrQ2xhaW1lZCh0YXNrQ29uZmlnLmlkKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNUYXNrQ29tcGxldGVkKHRhc2tDb25maWcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc1Rhc2tDb21wbGV0ZWQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBTa2luUmV3YXJkVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5SZXdhcmRUeXBlXCIpO1xuICAgICAgICB2YXIgY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLk5vbmU6XG4gICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuTGV2ZWxDb3VudDpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA+PSBkYXRhLmNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5XYXRjaEFkQ291bnQ6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5pbnRlcnN0aXRpYWxBZENvdW50ID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLldhdGNoUmV3YXJkQWRDb3VudDpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLnJld2FyZGVkQWRDb3VudCA+PSBkYXRhLmNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5DbGFpbWVkOlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5oYXNTa2luKGRhdGEuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5QdXJjaGFzZTpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihkYXRhLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tcGxldGVkO1xuICAgIH1cbn0pO1xuXG5HYW1lTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5HYW1lTWFuLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge0dhbWVNYW59XG4gKi9cbkdhbWVNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdhbWVNYW4uX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgR2FtZU1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBHYW1lTWFuLl9pbnN0YW5jZSA9IG5ldyBHYW1lTWFuKCk7XG4gICAgfVxuICAgIHJldHVybiBHYW1lTWFuLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZU1hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS81LzEyLlxuICovXG52YXIgUGxheWVySW5mbyA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvUGxheWVySW5mb1wiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgUExBWUVSX0tFWSA9IFwicGxheWVyX2tleVwiO1xuXG52YXIgUGxheWVyTWFuID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBwbGF5ZXI6IG51bGwsXG4gICAgYmVzdFNjb3JlS2V5OiBudWxsLFxuICAgIGxldmVsQm9hcmRLZXk6IG51bGwsXG5cbiAgICBpbml0ZWQ6IGZhbHNlLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgaW5pdERhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbml0ZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIHBsYXllckluZm9TdHIgPSBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLmdldEl0ZW0oUExBWUVSX0tFWSwgbnVsbCk7XG4gICAgICAgIHZhciBwbGF5ZXI7XG4gICAgICAgIGlmIChwbGF5ZXJJbmZvU3RyID09IG51bGwgfHwgcGxheWVySW5mb1N0ciA9PSBcIlwiKSB7XG4gICAgICAgICAgICBwbGF5ZXIgPSBQbGF5ZXJJbmZvLmNyZWF0ZURlZmF1bHQoKTtcbiAgICAgICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShQTEFZRVJfS0VZLCBKU09OLnN0cmluZ2lmeShwbGF5ZXIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBsYXllciA9IG5ldyBQbGF5ZXJJbmZvKCk7XG4gICAgICAgICAgICBwbGF5ZXIudW5tYXJzaGFsbChKU09OLnBhcnNlKHBsYXllckluZm9TdHIpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcbiAgICB9LFxuXG4gICAgcmVtb3ZlZEFkczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5yZW1vdmVkQWRzID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcInRvcFwiKTtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcImJvdHRvbVwiKTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0UmF0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIucmF0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBnZXRMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIubGV2ZWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllci5sZXZlbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRMZXZlbDogZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllci5sZXZlbCA8IGxldmVsKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5sZXZlbCA9IGxldmVsO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVMZXZlbERhdGE6IGZ1bmN0aW9uIChsZXZlbCwgbmFtZSwgZGF0YSkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIubGV2ZWxzTWFwW2xldmVsXSkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmxldmVsc01hcFtsZXZlbF0gPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5sZXZlbHNNYXBbbGV2ZWxdW25hbWVdID0gZGF0YTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxEYXRhOiBmdW5jdGlvbiAobGV2ZWwsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnBsYXllci5sZXZlbHNNYXBbbGV2ZWxdIHx8IHt9KVtuYW1lXTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGV2ZWxEYXRhKGxldmVsLCBcInN0YXJcIikgfHwgMDtcbiAgICB9LFxuXG4gICAgZ2V0SGFyZExldmVsU3RhcjogZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldExldmVsRGF0YShsZXZlbCwgXCJoYXJkU3RhclwiKSB8fCAwO1xuICAgIH0sXG5cbiAgICBhZGRJbnRlcnN0aXRpYWxBZENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmludGVyc3RpdGlhbEFkQ291bnQrKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgYWRkUmV3YXJkZWRBZENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnJld2FyZGVkQWRDb3VudCsrO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRIYXJkTGV2ZWw6IGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIuaGFyZExldmVsIDwgbGV2ZWwpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmhhcmRMZXZlbCA9IGxldmVsO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRIYXJkTGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLmlzVW5kZWZpbmVkKHRoaXMucGxheWVyLmhhcmRMZXZlbCkpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmhhcmRMZXZlbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRCb29zdENvdW50OiBmdW5jdGlvbiAoYm9vc3RUeXBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5ib29zdE1hcFtib29zdFR5cGVdIHx8IDA7XG4gICAgfSxcblxuICAgIHVzZUJvb3N0OiBmdW5jdGlvbiAoYm9vc3RUeXBlKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEJvb3N0Q291bnQoYm9vc3RUeXBlKSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmJvb3N0TWFwW2Jvb3N0VHlwZV0tLTtcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGFkZEJvb3N0OiBmdW5jdGlvbiAoYm9vc3RUeXBlLCBjb3VudCkge1xuICAgICAgICB0aGlzLnBsYXllci5ib29zdE1hcFtib29zdFR5cGVdICs9IGNvdW50O1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuUkVGUkVTSF9CT09TVCk7XG4gICAgfSxcblxuICAgIGFkZERpYW1vbmRzOiBmdW5jdGlvbiAoZGlhbW9uZHMpIHtcbiAgICAgICAgaWYgKGlzTmFOKGRpYW1vbmRzKSkge1xuICAgICAgICAgICAgY2MuZXJyb3IoXCJkaWFtb25kcyBpcyBOQU5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpYW1vbmRzID4gMCkge1xuICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJkaWFtb25kX2FkZFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5kaWFtb25kcyArPSBkaWFtb25kcztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLkRJQU1PTkRTX1VQREFURSk7XG4gICAgfSxcblxuICAgIGdldERpYW1vbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5kaWFtb25kcztcbiAgICB9LFxuXG4gICAgc2V0VGFza0NsYWltZWQ6IGZ1bmN0aW9uICh0YXNrSWQpIHtcbiAgICAgICAgY2MubG9nKFwiUGxheWVyTWFuIHNldFRhc2tDbGFpbWVkOlwiICsgdGFza0lkKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudGFza01hcFt0YXNrSWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaXNUYXNrQ2xhaW1lZDogZnVuY3Rpb24gKHRhc2tJZCkge1xuICAgICAgICBjYy5sb2coXCJQbGF5ZXJNYW4gaXNUYXNrQ2xhaW1lZDpcIiArIHRhc2tJZCk7XG4gICAgICAgIHJldHVybiAhIXRoaXMucGxheWVyLnRhc2tNYXBbdGFza0lkXTtcbiAgICB9LFxuXG4gICAgc2V0R3VpZGVkOiBmdW5jdGlvbiAoZ3VpZGVkKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmd1aWRlZCA9IGd1aWRlZDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0TGFzdFdoZWVsVGltZTogZnVuY3Rpb24gKHdoZWVsVGltZSkge1xuICAgICAgICB0aGlzLnBsYXllci5sYXN0V2hlZWxUaW1lID0gd2hlZWxUaW1lO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBnZXRMYXN0V2hlZWxUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5sYXN0V2hlZWxUaW1lO1xuICAgIH0sXG5cbiAgICAvL2FkZFBsYXlDb3VudDogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgIHRoaXMucGxheWVyLnBsYXlDb3VudCsrO1xuICAgIC8vICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgLy99LFxuICAgIC8vXG4gICAgLy9nZXRQbGF5Q291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICByZXR1cm4gdGhpcy5wbGF5ZXIucGxheUNvdW50O1xuICAgIC8vfSxcblxuICAgIHNldEN1cnJlbnRTa2luSWQ6IGZ1bmN0aW9uIChza2luSWQpIHtcbiAgICAgICAgaWYgKHNraW5JZCA9PT0gdGhpcy5wbGF5ZXIuY3VycmVudFNraW5JZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBCYWxsUG9vbCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvQmFsbFBvb2xcIik7XG4gICAgICAgIEJhbGxQb29sLmRyYWluQWxsUG9vbHMoKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuY3VycmVudFNraW5JZCA9IHNraW5JZDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudFNraW5JZDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIuY3VycmVudFNraW5JZDtcbiAgICB9LFxuXG4gICAgc2V0Q2xhaW1lZFNraW46IGZ1bmN0aW9uIChza2luSWQpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuc2tpbk1hcFtza2luSWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaGFzU2tpbjogZnVuY3Rpb24gKHNraW5JZCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnBsYXllci5za2luTWFwW3NraW5JZF07XG4gICAgfSxcblxuICAgIGlzTmV3UGxheWVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoRGF0ZS5ub3coKSAtIHRoaXMucGxheWVyLmNyZWF0ZUR0IDwgMjQgKiAzNjAwICogMTAwMCk7XG4gICAgfSxcblxuICAgIGdldFJlZ2lzdGVyRGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gdGhpcy5wbGF5ZXIuY3JlYXRlRHQpIC8gKDI0ICogMzYwMCAqIDEwMDApKSArIDE7XG4gICAgfSxcblxuICAgIGN1cnJlbnREYXk6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBnYW1lLnV0aWxzLmdldERheUJ5VHMoRGF0ZS5ub3coKSk7XG4gICAgfSxcblxuICAgIGNoZWNrQ29uc2VjdXRpdmVMb2dpbkRheTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b2RheSA9IHRoaXMuY3VycmVudERheSgpO1xuICAgICAgICB2YXIgZGF5cyA9IHRvZGF5IC0gdGhpcy5wbGF5ZXIubGFzdExvZ2luRGF5O1xuICAgICAgICBpZiAoZGF5cyA8IDApIHtcbiAgICAgICAgICAgIGNjLmVycm9yKFwiY29uc2VjdXRpdmUgbG9naW4gZGF5IGVycm9yLCB0b2RheSBpcyBzbWFsbGVyIHRoYW4gbGFzdExvZ2luRGF5LCBtYXliZSB5b3UgaGF2ZSBhZGp1c3QgdGhlIHRpbWUuXCIpO1xuICAgICAgICAgICAgZGF5cyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRheXMgPD0gMSl7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cyArPSBkYXlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cyA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBsYXllci5sYXN0TG9naW5EYXkgPSB0b2RheTtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmNvbnNlY3V0aXZlTG9naW5EYXlzIDwgMSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuY29uc2VjdXRpdmVMb2dpbkRheXMgPSAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cztcbiAgICB9LFxuXG4gICAgc2V0TGFzdENsYWltRGFpbHlCb251c0RheTogZnVuY3Rpb24gKGRheSkge1xuICAgICAgICB0aGlzLnBsYXllci5sYXN0Q2xhaW1EYWlseUJvbnVzRGF5ID0gZGF5O1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXROZXh0RGF5VGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5uZXh0RGF5VGlwcyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGlzU3BlY2lhbE9mZmVyUHVyY2hhc2VkOiBmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5zcGVjaWFsT2ZmZXJNYXBbcGlkXSB8fCBmYWxzZTtcbiAgICB9LFxuXG4gICAgc2V0U3BlY2lhbE9mZmVyUHVyY2hhc2VkOiBmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnNwZWNpYWxPZmZlck1hcFtwaWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlVQREFURV9TUEVDSUFMX09GRkVSKTtcbiAgICB9LFxuXG4gICAgc2V0U2tpbkFkanVzdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnNraW5BZGp1c3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHNldExhc3RTaG93UmF0ZVRpbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIubGFzdFNob3dSYXRlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGFkZFJld2FyZEFkQ291bnRQZXJEYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cnlDbGVhclByZXZpb3VzQWRDb3VudFBlckRheSgpO1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIucmV3YXJkQWRDb3VudFBlckRheSkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkrKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlJFV0FSREVEX1ZJREVPX0NPVU5UKTtcbiAgICB9LFxuXG4gICAgZ2V0UmV3YXJkQWRQbGFjZUNvdW50UGVyRGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudHJ5Q2xlYXJQcmV2aW91c0FkQ291bnRQZXJEYXkoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgfHwgMDtcbiAgICB9LFxuXG4gICAgdHJ5Q2xlYXJQcmV2aW91c0FkQ291bnRQZXJEYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLnJld2FyZEFkUmVjb3JkRGF5ICE9PSB0aGlzLmdldFJlZ2lzdGVyRGF5KCkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgPSAwO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucmV3YXJkQWRSZWNvcmREYXkgPSB0aGlzLmdldFJlZ2lzdGVyRGF5KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkSWFwQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaWFwQ291bnQrKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgX2ZsdXNoVG9TdG9yYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShQTEFZRVJfS0VZLCBKU09OLnN0cmluZ2lmeSh0aGlzLnBsYXllcikpO1xuICAgIH1cbn0pO1xuXG5QbGF5ZXJNYW4uX2luc3RhbmNlID0gbnVsbDtcblBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtQbGF5ZXJNYW59XG4gKi9cblBsYXllck1hbi5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoUGxheWVyTWFuLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBQbGF5ZXJNYW4uX2luc3RhbmNlID0gbmV3IFBsYXllck1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gUGxheWVyTWFuLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyTWFuOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUvMTEvMjEuXG4gKi9cblxudmFyIE5vdGljZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9Ob3RpY2VDb250cm9sbGVyXCIpO1xudmFyIEdhbWVPdmVyQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0dhbWVPdmVyQ29udHJvbGxlclwiKTtcbnZhciBIZWxwQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0hlbHBDb250cm9sbGVyXCIpO1xudmFyIEdhbWVXaW5Db250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvR2FtZVdpbkNvbnRyb2xsZXJcIik7XG52YXIgUGFzc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9QYXNzQ29udHJvbGxlclwiKTtcbnZhciBTdG9yZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9TdG9yZUNvbnRyb2xsZXJcIik7XG52YXIgUGF1c2VDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUGF1c2VDb250cm9sbGVyXCIpO1xudmFyIEZhaWxDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvRmFpbENvbnRyb2xsZXJcIik7XG52YXIgUmFua0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9SYW5rQ29udHJvbGxlclwiKTtcbnZhciBSZXdhcmRWaWRlb0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9SZXdhcmRWaWRlb0NvbnRyb2xsZXJcIik7XG52YXIgV2hlZWxDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvV2hlZWxDb250cm9sbGVyXCIpO1xudmFyIFJld2FyZERvdWJsZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9SZXdhcmREb3VibGVDb250cm9sbGVyXCIpO1xudmFyIEJhZ0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9CYWdDb250cm9sbGVyXCIpO1xudmFyIFJld2FyZEdpZnRDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUmV3YXJkR2lmdENvbnRyb2xsZXJcIik7XG52YXIgU2tpbkNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9Ta2luQ29udHJvbGxlclwiKTtcbnZhciBEYWlseUJvbnVzQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0RhaWx5Qm9udXNDb250cm9sbGVyXCIpO1xudmFyIFNwZWNpYWxPZmZlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9TcGVjaWFsT2ZmZXJDb250cm9sbGVyXCIpO1xudmFyIFJld2FyZE5vdGljZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9SZXdhcmROb3RpY2VDb250cm9sbGVyXCIpO1xudmFyIFRhc2tDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvVGFza0NvbnRyb2xsZXJcIik7XG5cbnZhciBQb3B1cE1hbiA9IHtcblxuICAgIHBvcHVwQ29tbW9uRGxnOiBmdW5jdGlvbiAoaW5mbywgeWVzQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vdGljZU5vZGUgPSBOb3RpY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLmluaXRXaXRoWWVzKGluZm8sIHllc0NhbGxiYWNrLCBudWxsKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwWWVzTm9Db21tb25EbGc6IGZ1bmN0aW9uIChpbmZvLCB5ZXNJbmZvLCBjYW5jZWxJbmZvLCB5ZXNDYWxsYmFjaywgbm9DYWxsYmFjaywgaXNTaG93Q2xvc2UsIGlzU2hvd0Fkcykge1xuICAgICAgICB2YXIgbm90aWNlTm9kZSA9IE5vdGljZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub3RpY2VOb2RlLmNvbnRyb2xsZXIuaW5pdFdpdGhZZXNObyhpbmZvLCB5ZXNJbmZvLCBjYW5jZWxJbmZvLCB5ZXNDYWxsYmFjaywgbm9DYWxsYmFjaywgaXNTaG93Q2xvc2UsIGlzU2hvd0Fkcyk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJld2FyZERsZzogZnVuY3Rpb24gKGluZm8sIHllc0NhbGxiYWNrLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCkge1xuICAgICAgICB2YXIgbm90aWNlTm9kZSA9IE5vdGljZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub3RpY2VOb2RlLmNvbnRyb2xsZXIuaW5pdFdpdGhSZXdhcmRZZXMoaW5mbywgeWVzQ2FsbGJhY2ssIHJld2FyZDFTcHJpdGUsIHJld2FyZDFDb3VudCwgcmV3YXJkMlNwcml0ZSwgcmV3YXJkMkNvdW50KTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwTmV3VGlwQ29tbW9uRGxnOiBmdW5jdGlvbiAoaW5mbywgeWVzSW5mbywgY2FuY2VsSW5mbywgeWVzQ2FsbGJhY2ssIG5vQ2FsbGJhY2ssIGlzU2hvd0Nsb3NlKSB7XG4gICAgICAgIHZhciBub3RpY2VOb2RlID0gTm90aWNlQ29udHJvbGxlci5jcmVhdGVHdWlkZUZyb21DQ0IoKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLmluaXRXaXRoWWVzTm8oaW5mbywgeWVzSW5mbywgY2FuY2VsSW5mbywgeWVzQ2FsbGJhY2ssIG5vQ2FsbGJhY2ssIGlzU2hvd0Nsb3NlKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwR2FtZU92ZXJEbGc6IGZ1bmN0aW9uIChwZXJjZW50LCByZXBsYXlDYWxsYmFjaykge1xuICAgICAgICB2YXIgZ2FtZU92ZXJOb2RlID0gR2FtZU92ZXJDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgZ2FtZU92ZXJOb2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocGVyY2VudCwgcmVwbGF5Q2FsbGJhY2spO1xuICAgICAgICBnYW1lT3Zlck5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJhdGVEbGc6IGZ1bmN0aW9uIChyYXRlZENhbGxiYWNrLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciByYXRlSW5mbyA9IGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyYXRlX2luZm9cIik7XG4gICAgICAgIHRoaXMucG9wdXBZZXNOb0NvbW1vbkRsZyhyYXRlSW5mbyxcbiAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyYXRlX2NvbmZpcm1cIiksIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyYXRlX2NhbmNlbFwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vY2Muc3lzLm9wZW5VUkwoZ2FtZS5jb25maWcuZ2V0UGxhdGZvcm1Eb3dubG9hZFVybCgpKTtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS51dGlscy5pc0lPUygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5vcGVuVVJMKGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vcGVuQXBwbGljYXRpb25NYXJrZXQoZ2FtZS5jb25maWcuZ2V0UGFja2FnZU5hbWUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5yYXRlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhdGVkQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgcmF0ZWRDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICB9LFxuXG4gICAgcG9wdXBIZWxwRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoZWxwTm9kZSA9IEhlbHBDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgaGVscE5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cEdhbWVXaW5EbGc6IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgICAgIHZhciBnYW1lT3Zlck5vZGUgPSBHYW1lV2luQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIGdhbWVPdmVyTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHJlcGxheUNhbGxiYWNrLCBuZXh0Q2FsbGJhY2spO1xuICAgICAgICBnYW1lT3Zlck5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFBhc3NEbGc6IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUGFzc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cEZhaWxEbGc6IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gRmFpbENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmVwbGF5Q2FsbGJhY2ssIHNraXBDYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFN0b3JlRGxnOiBmdW5jdGlvbiAodHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBTdG9yZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgodHlwZSwgY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBQYXVzZURsZzogZnVuY3Rpb24gKHJlc3VlbUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUGF1c2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHJlc3VlbUNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcbiAgICBwb3B1cFJhbmtEbGc6IGZ1bmN0aW9uIChyYW5rVHlwZSwgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFJhbmtDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXQocmFua1R5cGUsIGNsb3NlQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSxcbiAgICBwb3B1cEdyb3VwUmFua0RsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5sYXN0R3JvdXBSYW5rTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZS5jb250cm9sbGVyLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZS5jb250cm9sbGVyLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIFJhbmtUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vUmFua1R5cGVcIik7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZSA9IHRoaXMucG9wdXBSYW5rRGxnKFJhbmtUeXBlLkdyb3VwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmxhc3RHcm91cFJhbmtOb2RlID0gbnVsbDtcbiAgICAgICAgfSk7XG5cbiAgICB9LFxuICAgIHBvcHVwUmV3YXJkVmlkZW86IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUmV3YXJkVmlkZW9Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXQoY2xvc2VDYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFdoZWVsRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub2RlID0gV2hlZWxDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwUmV3YXJkRG91YmxlVGlwRGxnOiBmdW5jdGlvbiAoaW1hZ2UsIGNvdW50LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFJld2FyZERvdWJsZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdChpbWFnZSwgY291bnQsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwQmFnRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub2RlID0gQmFnQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJld2FyZEdpZnQ6IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUmV3YXJkR2lmdENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdChjbG9zZUNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU2tpbkRsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IFNraW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwRGFpbHlCb251czogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IERhaWx5Qm9udXNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU3BlaWNpYWxPZmZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IFNwZWNpYWxPZmZlckNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBSZXdhcmROb3RpY2VEbGc6IGZ1bmN0aW9uIChpbmZvLCB5ZXNDYWxsYmFjaywgcmV3YXJkMVNwcml0ZSwgcmV3YXJkMUNvdW50LCByZXdhcmQyU3ByaXRlLCByZXdhcmQyQ291bnQpIHtcbiAgICAgICAgdmFyIG5vdGljZU5vZGUgPSBSZXdhcmROb3RpY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLmluaXRXaXRoUmV3YXJkWWVzKGluZm8sIHllc0NhbGxiYWNrLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFRhc2tEbGc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBUYXNrQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUG9wdXBNYW47IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxOC8xLzEuXG4gKi9cblxudmFyIFNjZW5lVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NjZW5lVHlwZVwiKTtcbnZhciBNZW51U2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvTWVudVNjZW5lXCIpO1xudmFyIExldmVsU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvTGV2ZWxTY2VuZVwiKTtcbnZhciBQYWNrYWdlU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvUGFja2FnZVNjZW5lXCIpO1xudmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9HYW1lU2NlbmVcIik7XG52YXIgR2FtZUJyaWRnZSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vYnJpZGdlL0dhbWVCcmlkZ2VcIik7XG5cbnZhciBTY2VuZU1hbiA9IGNjLkNsYXNzLmV4dGVuZCh7XG5cbiAgICBzY2VuZU1hcDogbnVsbCxcblxuICAgIGxhc3RTY2VuZTogbnVsbCxcbiAgICBjdXJTY2VuZTogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zY2VuZU1hcCA9IHt9O1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKCk7XG4gICAgICAgIHRoaXMubGFzdFNjZW5lID0gU2NlbmVUeXBlLk5PTkU7XG4gICAgICAgIHRoaXMuY3VyU2NlbmUgPSBTY2VuZVR5cGUuTUVOVTtcbiAgICB9LFxuXG4gICAgc2V0Q3VyU2NlbmU6IGZ1bmN0aW9uIChzY2VuZSkge1xuICAgICAgICB0aGlzLmN1clNjZW5lID0gc2NlbmU7XG4gICAgfSxcblxuICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLk1FTlVdID0gR2FtZUJyaWRnZS5nZXRNZW51U2NlbmU7XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLlBBQ0tBR0VdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWNrYWdlU2NlbmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zY2VuZU1hcFtTY2VuZVR5cGUuTEVWRUxdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBMZXZlbFNjZW5lKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLkdBTUVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBHYW1lU2NlbmUoKTtcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgc3dpdGNoU2NlbmU6IGZ1bmN0aW9uIChzY2VuZVR5cGUpIHtcbiAgICAgICAgdGhpcy5sYXN0U2NlbmUgPSB0aGlzLmN1clNjZW5lO1xuICAgICAgICB0aGlzLmN1clNjZW5lID0gc2NlbmVUeXBlO1xuICAgICAgICB2YXIgc2NlbmUgPSB0aGlzLnNjZW5lTWFwW3RoaXMuY3VyU2NlbmVdO1xuICAgICAgICBpZiAoc2NlbmUpIHtcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKHNjZW5lKCkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHN3aXRjaExhc3RTY2VuZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN3aXRjaFNjZW5lKHRoaXMubGFzdFNjZW5lKTtcbiAgICB9XG59KTtcblxuU2NlbmVNYW4uX2luc3RhbmNlID0gbnVsbDtcblNjZW5lTWFuLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge1NjZW5lTWFufVxuICovXG5TY2VuZU1hbi5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoU2NlbmVNYW4uX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgU2NlbmVNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgU2NlbmVNYW4uX2luc3RhbmNlID0gbmV3IFNjZW5lTWFuKCk7XG4gICAgfVxuICAgIHJldHVybiBTY2VuZU1hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjZW5lTWFuOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMS8yMy5cbiAqL1xuXG52YXIgUGF5bWVudEluZm8gPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudGl0eS9QYXltZW50SW5mb1wiKTtcbnZhciBQYXltZW50Q29kZSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZW51bS9QYXltZW50Q29kZVwiKTtcbnZhciBQcm9kdWN0SW5mbyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZW50aXR5L1Byb2R1Y3RJbmZvXCIpO1xudmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIFN0b3JlSGVscGVyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48UHJvZHVjdEluZm8+fVxuICAgICAqL1xuICAgIHByb2R1Y3RMaXN0OiBudWxsLFxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48U3RvcmVDb25maWc+fVxuICAgICAqL1xuICAgIHN0b3JlTGlzdDogbnVsbCxcblxuICAgIGluaXRlZDogZmFsc2UsXG5cbiAgICBfcmV3YXJkQ0I6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnNldFBheW1lbnREZWxlZ2F0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5zdG9yZUxpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTdG9yZUxpc3QoKTtcblxuICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2V0QWRMaXN0ZW5lcih0aGlzKTtcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pbml0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluaXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMucmVxdWVzdFByb2R1Y3RzKCk7XG4gICAgICAgIHRoaXMuZ2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0KCk7XG4gICAgfSxcblxuICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5zZXRBZExpc3RlbmVyKG51bGwpO1xuICAgIH0sXG5cbiAgICBvblJld2FyZGVkVmlkZW9GaW5pc2hlZDogZnVuY3Rpb24gKGlzUmV3YXJkZWQpIHtcbiAgICAgICAgY2MubG9nKFwib25SZXdhcmRlZFZpZGVvRmluaXNoZWQ6XCIgKyBpc1Jld2FyZGVkKTtcbiAgICAgICAgdGhpcy5faXNSZXdhcmRlZCA9IGlzUmV3YXJkZWQ7XG4gICAgICAgIGlmIChpc1Jld2FyZGVkICYmIGNjLnN5cy5vcyAhPT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgIHRoaXMub25SZXdhcmRlZFZpZGVvUmV3YXJkKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TaG93VmlkZW9BZEJlZ2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcIkdhbWVOb2RlIG9uU2hvd1ZpZGVvQWRCZWdpblwiKTtcbiAgICAgICAgdGhpcy5faXNSZXdhcmRlZCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBvblNob3dWaWRlb0FkRW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcIkdhbWVOb2RlIG9uU2hvd1ZpZGVvQWRFbmRcIik7XG4gICAgICAgIHZhciB0aW1lID0gMTAwO1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgdGltZSA9IDEwMDA7XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNSZXdhcmRlZCAmJiBjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblJld2FyZGVkVmlkZW9SZXdhcmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5faXNSZXdhcmRlZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZXdhcmRDQikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXdhcmRDQihmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jld2FyZENCID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSwgdGltZSk7XG4gICAgfSxcblxuICAgIG9uUmV3YXJkZWRWaWRlb1Jld2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fcmV3YXJkQ0IpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jld2FyZENCKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5fcmV3YXJkQ0IgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRSZXdhcmRBZFBsYWNlQ291bnRQZXJEYXkoKSA+IGdhbWUuY29uZmlnLnJld2FyZEFkTWF4Q291bnRQZXJEYXkpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcIlN0b3JlSGVscGVyIG9uUmV3YXJkZWRWaWRlb1Jld2FyZCBoYXMgcmVhY2hlZCBtYXggY291bnQ6XCIgKyBnYW1lLnBsYXllck1hbi5nZXRSZXdhcmRBZFBsYWNlQ291bnRQZXJEYXkoKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYWRQYXJhbTEpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudCh0aGlzLmFkUGFyYW0xKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmVycm9yKFwiU3RvcmVIZWxwZXIgYWRQYXJhbSBpcyBudWxsOlwiICsgdGhpcy5hZFBhcmFtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkUmV3YXJkQWRDb3VudFBlckRheSgpO1xuICAgICAgICB2YXIgZnJlZUVudGl0eSA9IHRoaXMuZ2V0U3RvcmVFbnRpdHlCeVR5cGUoU3RvcmVUeXBlLkZSRUUpO1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyZXdhcmRfdmlkZW9fZGlhbW9uZHNcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoZnJlZUVudGl0eS5jb3VudCk7XG4gICAgICAgICAgICB9LCB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLkRJQU1PTkQpLCBmcmVlRW50aXR5LmNvdW50KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHBpZFxuICAgICAqIEByZXR1cm5zIHtTdG9yZUNvbmZpZyB8IG51bGx9XG4gICAgICovXG4gICAgZ2V0U3RvcmVFbnRpdHk6IGZ1bmN0aW9uIChwaWQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RvcmVMaXN0W2ldLnBpZCA9PT0gcGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmVMaXN0W2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXRTdG9yZUVudGl0eUJ5VHlwZTogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RvcmVMaXN0W2ldLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdG9yZUxpc3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEJvb3N0SW1hZ2U6IGZ1bmN0aW9uIChib29zdFR5cGUpIHtcbiAgICAgICAgc3dpdGNoIChib29zdFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNQTElUOlxuICAgICAgICAgICAgICAgIHJldHVybiBcInN0b3JlXzNfbXVsdGlwbGUucG5nXCI7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgIHJldHVybiBcInN0b3JlXzNfbmV3LnBuZ1wiO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpY29uX2RpYW1vbmRfMS5wbmdcIjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfZ2V0TnVtRnJvbVN0cmluZzogZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvW14wLTkuXS9pZywgXCJcIik7XG4gICAgfSxcblxuICAgIHVwZGF0ZVByaWNlOiBmdW5jdGlvbiAocHJvZHVjdCkge1xuICAgICAgICB2YXIgc3RvcmVQcm9kdWN0ID0gdGhpcy5nZXRTdG9yZUVudGl0eShwcm9kdWN0LnByb2R1Y3RJZCk7XG4gICAgICAgIGlmIChzdG9yZVByb2R1Y3QpIHtcbiAgICAgICAgICAgIHN0b3JlUHJvZHVjdC5wcmljZSA9IHByb2R1Y3QucHJpY2U7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChzdG9yZVByb2R1Y3Qub3JpZ2luYWxfcHJpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlU3RyID0gdGhpcy5fZ2V0TnVtRnJvbVN0cmluZyhwcm9kdWN0LnByaWNlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlTnVtID0gTnVtYmVyKHByaWNlU3RyKTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmVQcm9kdWN0Lm9yaWdpbmFsX3ByaWNlID0gcHJvZHVjdC5wcmljZS5yZXBsYWNlKHByaWNlU3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgKHByaWNlTnVtICogKHN0b3JlUHJvZHVjdC5kaXNjb3VudF9tdWx0aSArIDEpKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgIGNjLmVycm9yKFwidXBkYXRlIHByaWNlOlwiICsgZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvOiBmdW5jdGlvbiAobmFtZSwgY2IsIHBhcmFtMSkge1xuICAgICAgICB0aGlzLmFkUGFyYW0xID0gcGFyYW0xO1xuICAgICAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpKSB7XG4gICAgICAgICAgICB0aGlzLl9yZXdhcmRDQiA9IGNiO1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dSZXdhcmRWaWRlb0FkKG5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MubG9nKFwicmV3YXJkIHZpZGVvIG5vdCByZWFkeVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0b3JlQ29uZmlnfSBzdG9yZUVudGl0eVxuICAgICAqL1xuICAgIGJ1eVByb2R1Y3Q6IGZ1bmN0aW9uIChzdG9yZUVudGl0eSkge1xuICAgICAgICBzd2l0Y2ggKHN0b3JlRW50aXR5LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLk5FV18zOlxuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuU1BMSVQ6XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5GSVJTVF9QVVJDSEFTRTpcbiAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5wYXlGb3JQcm9kdWN0KHN0b3JlRW50aXR5LnBpZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5ESUFNT05EOlxuICAgICAgICAgICAgICAgIC8vZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUHVyY2hhc2VEaWFtb25kc1wiLCB7XCJwaWRcIjogc3RvcmVFbnRpdHkucGlkfSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIucGF5Rm9yUHJvZHVjdChzdG9yZUVudGl0eS5waWQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuRlJFRTpcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiZGFvanUwMVwiIDogXCJzdG9yZVwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLlJFTU9WRV9BRFM6XG4gICAgICAgICAgICAgICAgdGhpcy5idXlSZW1vdmVBZHMoc3RvcmVFbnRpdHkucGlkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLlJFU1RPUkU6XG4gICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIucmVzdG9yZUNvbXBsZXRlZFRyYW5zYWN0aW9ucygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuTkVXX0FORF9TUExJVDpcbiAgICAgICAgICAgICAgICB0aGlzLmJ1eUJvb3N0cyhzdG9yZUVudGl0eSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYnV5UmVtb3ZlQWRzOiBmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIucmVtb3ZlZEFkcykge1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicmVtb3ZlZF9hbGxfYWRzX3RpcHNcIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX25vX2FkX3RpcHNcIiksXG4gICAgICAgICAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJidXlfdGl0bGVcIiksIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjYW5jZWxfdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnBheUZvclByb2R1Y3QocGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCwgZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX25vX2FkX3RpcHNcIiksXG4gICAgICAgICAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJidXlfdGl0bGVcIiksIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyZXN0b3JlX3RpdGxlXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnBheUZvclByb2R1Y3QocGlkKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnJlc3RvcmVDb21wbGV0ZWRUcmFuc2FjdGlvbnMoKTtcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBidXlTa2luOiBmdW5jdGlvbiAoc2tpbkNmZykge1xuICAgICAgICBpZiAoIWdhbWUucGxheWVyTWFuLmhhc1NraW4oc2tpbkNmZy5pZCkpIHtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpID49IHNraW5DZmcuY291bnQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50U2tpbklkKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKC1za2luQ2ZnLmNvdW50KTtcbiAgICAgICAgICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX1NLSU4pO1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRpYW1vbmRQdXJjaGFzZVNraW5cIiwge1wic2tpbklkXCI6IHNraW5DZmcuaWR9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhfKFwiZGlhbW9uZF9ub3RfZW5vdWdoXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1c2VTa2luOiBmdW5jdGlvbiAoc2tpbkNmZykge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50U2tpbklkKHNraW5DZmcuaWQpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX1NLSU4pO1xuICAgIH0sXG5cbiAgICBidXlCb29zdHM6IGZ1bmN0aW9uIChzdG9yZUVudGl0eSkge1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0RGlhbW9uZHMoKSA+PSBzdG9yZUVudGl0eS5jb3VudCkge1xuICAgICAgICAgICAgLy9nYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJQdXJjaGFzZUJvb3N0c1wiLCB7XCJkaWFtb25kc1wiOiBzdG9yZUVudGl0eS5jb3VudH0pO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoLXN0b3JlRW50aXR5LmNvdW50KTtcbiAgICAgICAgICAgIHZhciBzcGxpdENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5tdWx0aXBsZV8zO1xuICAgICAgICAgICAgdmFyIHRocmVlQmFsbENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5uZXdfMztcbiAgICAgICAgICAgIHZhciBzcGxpdEltYWdlID0gdGhpcy5nZXRCb29zdEltYWdlKEJvb3N0VHlwZS5TUExJVCk7XG4gICAgICAgICAgICB2YXIgbmV3M0ltYWdlID0gdGhpcy5nZXRCb29zdEltYWdlKEJvb3N0VHlwZS5USFJFRV9CQUxMKTtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRpYW1vbmRQdXJjaGFzZUJvb3N0c1wiLCB7XCJkaWFtb25kc1wiOiBzdG9yZUVudGl0eS5jb3VudH0pO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfYm9vc3Rfc3VjY2Vzc1wiKSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5TUExJVCwgc3BsaXRDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgICAgICAgICAgfSwgc3BsaXRJbWFnZSwgc3BsaXRDb3VudCwgbmV3M0ltYWdlLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKF8oXCJkaWFtb25kX25vdF9lbm91Z2hcIikpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlcXVlc3RQcm9kdWN0czogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcHJvZHVjdElkcyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RvcmVMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgZW50aXR5ID0gdGhpcy5zdG9yZUxpc3RbaV07XG4gICAgICAgICAgICBpZiAoZW50aXR5ICYmIGVudGl0eS5waWQpIHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0SWRzLnB1c2goZW50aXR5LnBpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2MubG9nKFwicmVxdWVzdHByb2R1Y3RzOlwiICsgSlNPTi5zdHJpbmdpZnkocHJvZHVjdElkcykpO1xuICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5yZXF1ZXN0UHJvZHVjdChwcm9kdWN0SWRzKTtcbiAgICB9LFxuXG4gICAgZ2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLmdldFVudmVyaWZpZWRSZWNlaXB0TGlzdCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1BheW1lbnRDb2RlfSBlcnJvclxuICAgICAqIEBwYXJhbSB7UGF5bWVudEluZm99IHBheW1lbnRJbmZvXG4gICAgICovXG4gICAgb25QYXltZW50Q29tcGxldGVkOiBmdW5jdGlvbiAoZXJyb3IsIHBheW1lbnRJbmZvKSB7XG4gICAgICAgIHZhciBwYXltZW50U3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICBpZiAoZXJyb3IgPT09IFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9TVUNDRVNTKSB7XG4gICAgICAgICAgICB0aGlzLl9vblBheW1lbnRTdWNjZXNzKHBheW1lbnRJbmZvLCB0cnVlKTtcbiAgICAgICAgICAgIHBheW1lbnRTdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX2ZhaWxcIikpO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5QVVJDSEFTRV9FTkQsIHBheW1lbnRTdWNjZXNzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBcnJheS48UGF5bWVudEluZm8+fSBwYXltZW50SW5mb0xpc3RcbiAgICAgKi9cbiAgICBvbkdldFVudmVyaWZpZWRSZWNlaXB0TGlzdDogZnVuY3Rpb24gKHBheW1lbnRJbmZvTGlzdCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBheW1lbnRJbmZvTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5fb25QYXltZW50U3VjY2VzcyhwYXltZW50SW5mb0xpc3RbaV0sIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBvbiBnZXQgcHJvZHVjdCBsaXN0LlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPFByb2R1Y3RJbmZvPn0gcHJvZHVjdExpc3RcbiAgICAgKi9cbiAgICBvbkdldFByb2R1Y3RMaXN0OiBmdW5jdGlvbiAocHJvZHVjdExpc3QpIHtcbiAgICAgICAgdGhpcy5wcm9kdWN0TGlzdCA9IHByb2R1Y3RMaXN0O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb2R1Y3RMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgcHJvZHVjdCA9IHByb2R1Y3RMaXN0W2ldO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcmljZShwcm9kdWN0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1BheW1lbnRJbmZvfSBwYXltZW50SW5mb1xuICAgICAqIEBwYXJhbSBoYXNOb3RpY2VcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9vblBheW1lbnRTdWNjZXNzOiBmdW5jdGlvbiAocGF5bWVudEluZm8sIGhhc05vdGljZSkge1xuICAgICAgICB2YXIgc3RvcmVFbnRpdHkgPSB0aGlzLmdldFN0b3JlRW50aXR5KHBheW1lbnRJbmZvLnByb2R1Y3RJZCk7XG4gICAgICAgIHZhciBzcGxpdEltYWdlID0gdGhpcy5nZXRCb29zdEltYWdlKEJvb3N0VHlwZS5TUExJVCk7XG4gICAgICAgIHZhciBuZXczSW1hZ2UgPSB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLlRIUkVFX0JBTEwpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHN3aXRjaCAoc3RvcmVFbnRpdHkudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuUkVNT1ZFX0FEUzpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5yZW1vdmVkQWRzKCk7XG4gICAgICAgICAgICAgICAgaWYgKGhhc05vdGljZSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ub19hZF9zdWNjZXNzXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5jb25zdW1lKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWxmLmFkZElhcENvdW50KHN0b3JlRW50aXR5KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLk5FV18zOlxuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuU1BMSVQ6XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfYm9vc3Rfc3VjY2Vzc1wiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChzdG9yZUVudGl0eS50eXBlLCBzdG9yZUVudGl0eS5jb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLmNvbnN1bWUocGF5bWVudEluZm8ucHVyY2hhc2VJZCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWRkSWFwQ291bnQoc3RvcmVFbnRpdHkpO1xuICAgICAgICAgICAgICAgIH0sIHN0b3JlRW50aXR5LmltYWdlLCBzdG9yZUVudGl0eS5jb3VudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5GSVJTVF9QVVJDSEFTRTpcbiAgICAgICAgICAgICAgICB2YXIgZGlhbW9uZENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5kaWFtb25kcztcbiAgICAgICAgICAgICAgICB2YXIgc2tpbklkID0gc3RvcmVFbnRpdHkuZGF0YS5za2luO1xuICAgICAgICAgICAgICAgIHZhciBza2luSW1hZ2UgPSBzdG9yZUVudGl0eS5kYXRhLnNraW5faW1hZ2U7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfZGlhbW9uZF9zdWNjZXNzXCIpLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyhkaWFtb25kQ291bnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2xhaW1lZFNraW4oc2tpbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLmNvbnN1bWUocGF5bWVudEluZm8ucHVyY2hhc2VJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRTcGVjaWFsT2ZmZXJQdXJjaGFzZWQocGF5bWVudEluZm8ucHJvZHVjdElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIlB1cmNoYXNlU3BlY2lhbE9mZmVyXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZGRJYXBDb3VudChzdG9yZUVudGl0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJza2luX2NsYWltZWRcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHNraW5JbWFnZSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZ2V0Qm9vc3RJbWFnZShCb29zdFR5cGUuRElBTU9ORCksIGRpYW1vbmRDb3VudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5ORVdfQU5EX1NQTElUOlxuICAgICAgICAgICAgICAgIHZhciBzcGxpdENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5tdWx0aXBsZV8zO1xuICAgICAgICAgICAgICAgIHZhciB0aHJlZUJhbGxDb3VudCA9IHN0b3JlRW50aXR5LmRhdGEubmV3XzM7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfYm9vc3Rfc3VjY2Vzc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQm9vc3QoQm9vc3RUeXBlLlNQTElULCBzcGxpdENvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5jb25zdW1lKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZGRJYXBDb3VudChzdG9yZUVudGl0eSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHNwbGl0SW1hZ2UsIHNwbGl0Q291bnQsIG5ldzNJbWFnZSwgdGhyZWVCYWxsQ291bnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSBzdG9yZUVudGl0eS5jb3VudDtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9kaWFtb25kX3N1Y2Nlc3NcIiksXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKGNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLmNvbnN1bWUocGF5bWVudEluZm8ucHVyY2hhc2VJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFkZElhcENvdW50KHN0b3JlRW50aXR5KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgc3RvcmVFbnRpdHkuaW1hZ2UsIGNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRJYXBDb3VudDogZnVuY3Rpb24gKHN0b3JlRW50aXR5KSB7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLmFkZElhcENvdW50KCk7XG4gICAgICAgIHZhciBpYXBDb3VudCA9IGdhbWUucGxheWVyTWFuLnBsYXllci5pYXBDb3VudDtcbiAgICAgICAgaWYgKGlhcENvdW50ID09PSAxKSB7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJGaXJzdFB1cmNoYXNlXCIsIHtcInBpZFwiOiBzdG9yZUVudGl0eS5waWR9KTtcbiAgICAgICAgfSBlbHNlIGlmIChpYXBDb3VudCA9PT0gMikge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiU2Vjb25kUHVyY2hhc2VcIiwge1wicGlkXCI6IHN0b3JlRW50aXR5LnBpZH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpYXBDb3VudCA+PSAyKSB7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJNdWx0aVB1cmNoYXNlXCIsIHtcInBpZFwiOiBzdG9yZUVudGl0eS5waWR9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwb3B1cEJvb3N0UmV3YXJkRGxnOiBmdW5jdGlvbiAoc3BsaXRDb3VudCwgdGhyZWVCYWxsQ291bnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBuZXczSW1hZ2UgPSB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLlRIUkVFX0JBTEwpO1xuICAgICAgICB2YXIgc3BsaXRJbWFnZSA9IHRoaXMuZ2V0Qm9vc3RJbWFnZShCb29zdFR5cGUuU1BMSVQpO1xuXG4gICAgICAgIHZhciBpbWFnZTEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBjb3VudDEgPSAwO1xuICAgICAgICB2YXIgaW1hZ2UyID0gdW5kZWZpbmVkO1xuICAgICAgICB2YXIgY291bnQyID0gMDtcbiAgICAgICAgaWYgKHRocmVlQmFsbENvdW50ID4gMCkge1xuICAgICAgICAgICAgaW1hZ2UxID0gbmV3M0ltYWdlO1xuICAgICAgICAgICAgY291bnQxID0gdGhyZWVCYWxsQ291bnQ7XG4gICAgICAgICAgICBpZiAoc3BsaXRDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICBpbWFnZTIgPSBzcGxpdEltYWdlO1xuICAgICAgICAgICAgICAgIGNvdW50MiA9IHNwbGl0Q291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbWFnZTEgPSBzcGxpdEltYWdlO1xuICAgICAgICAgICAgY291bnQxID0gc3BsaXRDb3VudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmROb3RpY2VEbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJld2FyZF92aWRlb19ib29zdHNcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQm9vc3QoQm9vc3RUeXBlLlNQTElULCBzcGxpdENvdW50KTtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCwgdGhyZWVCYWxsQ291bnQpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGltYWdlMSwgY291bnQxLCBpbWFnZTIsIGNvdW50Mik7XG4gICAgfVxufSk7XG5cblN0b3JlSGVscGVyLl9pbnN0YW5jZSA9IG51bGw7XG5TdG9yZUhlbHBlci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtTdG9yZUhlbHBlcn1cbiAqL1xuU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFN0b3JlSGVscGVyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFN0b3JlSGVscGVyLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIFN0b3JlSGVscGVyLl9pbnN0YW5jZSA9IG5ldyBTdG9yZUhlbHBlcigpO1xuICAgIH1cbiAgICByZXR1cm4gU3RvcmVIZWxwZXIuX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZUhlbHBlcjsiLCJ2YXIgR2FtZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9HYW1lQ29udHJvbGxlclwiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG5cbnZhciBHYW1lU2NlbmUgPSBjYy5TY2VuZS5leHRlbmQoe1xuICAgIF9nYW1lVHlwZTogMCxcbiAgICBfaXNCYWNrQ2xpY2tlZDogZmFsc2UsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJib3R0b21cIik7XG4gICAgICAgIHZhciBnYW1lTm9kZSA9IEdhbWVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChnYW1lTm9kZSk7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIC8vY2MuZXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKHtcbiAgICAgICAgLy8gICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuS0VZQk9BUkQsXG4gICAgICAgIC8vICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAvLyAgICAgICAgaWYgKGtleUNvZGUgPT09IGNjLktFWS5iYWNrKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0JhY2tDbGlja2VkKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaExhc3RTY2VuZSgpO1xuICAgICAgICAvLyAgICAgICAgICAgIH1cbiAgICAgICAgLy8gICAgICAgIH1cbiAgICAgICAgLy8gICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIC8vfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIG9uRXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2VBbGwoKTtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lU2NlbmU7XG4iLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBMZXZlbENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9MZXZlbENvbnRyb2xsZXJcIik7XG5cbnZhciBMZXZlbFNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdmFyIGxheWVyID0gTGV2ZWxDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5QQUNLQUdFKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA+PSAzKSB7XG4gICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd0Jhbm5lckFkcyhcImJvdHRvbVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlQWxsKCk7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxTY2VuZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTQtMTkuXG4gKi9cbnZhciBMb2FkaW5nQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0xvYWRpbmdDb250cm9sbGVyXCIpO1xuXG52YXIgTG9hZGluZ1NjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcbiAgICBjdG9yOmZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdmFyIGxheWVyID0gTG9hZGluZ0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKGxheWVyKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBMb2FkaW5nU2NlbmU7IiwidmFyIE1lbnVDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvTWVudUNvbnRyb2xsZXJcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFBsYXllck1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9QbGF5ZXJNYW5cIik7XG52YXIgU2NlbmVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvU2NlbmVNYW5cIik7XG52YXIgU2NlbmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2NlbmVUeXBlXCIpO1xuLy92YXIgQnJpY2tzVmlldyA9IHJlcXVpcmUoXCIuLi92aWV3L0JyaWNrc1ZpZXdcIik7XG5cbndpbmRvdy5pc0ZpcnN0RW50ZXIgPSB0cnVlO1xuXG52YXIgTWVudVNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcblxuICAgICAgICB2YXIgbGF5ZXIgPSBNZW51Q29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQobGF5ZXIpO1xuICAgIH0sXG5cbiAgICBvbkVudGVyOmZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKF8oXCJleGl0X2dhbWVfY29uZmlybVwiKSwgXyhcInllc190aXRsZVwiKSwgXyhcIm5vX3RpdGxlXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sb2dpY01hbi5zY2hlZHVsZUxvY2FsTm90aWZpY2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IuZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faXNCYWNrQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IDMpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93QmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwidG9wXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5pbml0KCk7XG4gICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSgwLCBnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpKTtcbiAgICAgICAgICAgIGlmICghd2luZG93LmlzRmlyc3RFbnRlcikge1xuICAgICAgICAgICAgICAgIGdhbWUuY3Jvc3NQcm9tTWFuLnRyeVRvUG9wdXBDcm9zc1Byb21EbGcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmlzRmlyc3RFbnRlciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnVTY2VuZTsiLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBQYWNrYWdlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1BhY2thZ2VDb250cm9sbGVyXCIpO1xuXG52YXIgUGFja2FnZVNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBsYXllciA9IFBhY2thZ2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhY2thZ2VTY2VuZTsiLCJ2YXIgR3JpZCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvR3JpZFwiKTtcbnZhciBCYWxsID0gcmVxdWlyZShcIi4uL2VudGl0eS9CYWxsXCIpO1xudmFyIEJvYXJkQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0JvYXJkQ29udHJvbGxlclwiKTtcbnZhciBCYWxsUG9vbCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvQmFsbFBvb2xcIik7XG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3V0aWwvVXRpbHNcIik7XG52YXIgR3JpZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9HcmlkVHlwZVwiKTtcbnZhciBCb2FyZCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvQm9hcmRcIik7XG52YXIgU2hhcGVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2hhcGVUeXBlXCIpO1xudmFyIEJvb3N0ID0gcmVxdWlyZShcIi4uL2VudGl0eS9Cb29zdFwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgT2JzdGFjbGUgPSByZXF1aXJlKFwiLi4vZW50aXR5L09ic3RhY2xlXCIpO1xudmFyIFdhbGwgPSByZXF1aXJlKFwiLi4vZW50aXR5L1dhbGxcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgQ29sb3JDb25maWdzID0gW1xuICAgIGNjLmNvbG9yKDI1MiwgMTc4LCAwKSxcbiAgICBjYy5jb2xvcig4MSwgMjI5LCAxMiksXG4gICAgY2MuY29sb3IoMjcsIDIyNiwgMjU1KSxcbiAgICBjYy5jb2xvcigyNTUsIDI1MiwgMjkpLFxuICAgIGNjLmNvbG9yKDI1NSwgNTYsIDU2KSxcbiAgICBjYy5jb2xvcigyNDgsIDcwLCAyNTUpLFxuICAgIGNjLmNvbG9yKDI1NSwgMTI5LCAxNyksXG4gICAgY2MuY29sb3IoNTcsIDEwMywgMjQ5KSxcbiAgICBjYy5jb2xvcig5MCwgMTgxLCAxMTApLFxuXG4gICAgY2MuY29sb3IoMjU1LCA5MCwgMTQxKSxcbiAgICBjYy5jb2xvcigyNDIsIDg2LCA5KSxcbiAgICBjYy5jb2xvcig2NiwgNDYsIDE3NiksXG4gICAgY2MuY29sb3IoMTQ0LCA4NSwgMjIyKSxcbiAgICBjYy5jb2xvcigyMywgMTY3LCAxMDQpLFxuICAgIGNjLmNvbG9yKDE3NiwgNzIsIDIwNiksXG4gICAgY2MuY29sb3IoMTQ3LCAxOTIsIDI2KSxcbiAgICBjYy5jb2xvcig1NSwgNzAsIDIxOSlcbl07XG5cbnZhciBHcmF5Q29sb3IgPSBjYy5jb2xvcig4MiwgODIsIDgyKTtcblxudmFyIGdldENvbG9yID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICByZXR1cm4gQ29sb3JDb25maWdzWyh0eXBlIC0gMSkgJSBDb2xvckNvbmZpZ3MubGVuZ3RoXTtcbn07XG5cbnZhciBHYW1lU3RlcCA9IHtcbiAgICBQUkVfU1RBUlQ6IDEsXG4gICAgU1RBUlQ6IDIsXG4gICAgUkVMSUZFOiAzLFxuICAgIFdBVENIX0FEOiA0LFxuICAgIEVORDogNVxufTtcblxudmFyIEJyaWNrc1ZpZXcgPSBjYy5Ob2RlLmV4dGVuZCh7XG4gICAgU1BBQ0VfU1RFUDogMSAvIDYwLFxuICAgIExJRkVfUE9TSUJJTElUWTogMC4wMDUsXG4gICAgQk9PU1RfUE9TSUJJTElUWTogMC4wNixcbiAgICBNQVhfU1BFRUQ6IDQyMCxcbiAgICBNQVhfTElGRTogNixcbiAgICBCT09TVF9TUEVFRDogODAsXG4gICAgTUFYX0JBTEw6IDEwMDAsXG4gICAgVE9QX0lOTkVSX1dBTEw6IDUwLFxuICAgIE1BWF9TUExJVF9DT1VOVDogMTAwLFxuICAgIFRPUF9BRF9XQUxMOiAxMDAsXG4gICAgLy90aGlzLlRPUF9BRF9XQUxMID0gMTAwO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0xldmVsQ29uZmlnfVxuICAgICAqL1xuICAgIGNvbmZpZzogbnVsbCxcblxuICAgIHJvdzogMCxcbiAgICBjb2w6IDAsXG5cbiAgICBiYWxsTGlzdDogbnVsbCxcblxuICAgIGdhbWVTdGVwOiAtMSxcblxuICAgIGxpZmVDb3VudDogMyxcblxuICAgIGdhbWVDb250cm9sbGVyOiBudWxsLFxuXG4gICAgLy9zdGFydFRpbWU6IDAsXG5cbiAgICBzdG9wZWQ6IGZhbHNlLFxuXG4gICAgbGFzdFRpbWU6IDAsXG5cbiAgICB0b3RhbFRpbWU6IDAsXG4gICAgbGFzdEFkanVzdFRpbWU6IDAsXG5cbiAgICBoYXJkTW9kZTogZmFsc2UsXG5cbiAgICBhY2N1bXVsYXRvcjogMCxcblxuICAgIF9jdXJUb3VjaElkOiAtMSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChjb25maWcsIGdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19JT1MpIHtcbiAgICAgICAgICAgIHRoaXMuTUFYX0JBTEwgPSAxMDAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFyZE1vZGUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuaXNIYXJkTW9kZSgpO1xuICAgICAgICBpZiAodGhpcy5oYXJkTW9kZSkge1xuICAgICAgICAgICAgY29uZmlnID0gY29uZmlnLmdldEhhcmRDZmcoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnLmxpZmVQcm9iYWJpbGl0eSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuTElGRV9QT1NJQklMSVRZICo9IGNvbmZpZy5saWZlUHJvYmFiaWxpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZy5ib29zdFByb2JhYmlsaXR5ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5CT09TVF9QT1NJQklMSVRZICo9IGNvbmZpZy5ib29zdFByb2JhYmlsaXR5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIgPSBnYW1lQ29udHJvbGxlcjtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgICAgIHRoaXMucm93ID0gY29uZmlnLndpZHRoO1xuICAgICAgICB0aGlzLmNvbCA9IGNvbmZpZy5oZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5HUklEX1dJRFRIID0gY29uZmlnLnBpeGVsV2lkdGggLyBjb25maWcud2lkdGggKiAwLjc7XG4gICAgICAgIHRoaXMuR1JJRF9IRUlHSFQgPSBjb25maWcucGl4ZWxIZWlnaHQgLyBjb25maWcuaGVpZ2h0ICogMC43O1xuXG4gICAgICAgIHRoaXMuR0FQX1dJRFRIID0gY29uZmlnLnBpeGVsV2lkdGggLyBjb25maWcud2lkdGggLSB0aGlzLkdSSURfV0lEVEg7XG4gICAgICAgIHRoaXMuR0FQX0hFSUdIVCA9IGNvbmZpZy5waXhlbEhlaWdodCAvIGNvbmZpZy5oZWlnaHQgLSB0aGlzLkdSSURfSEVJR0hUO1xuXG4gICAgICAgIHZhciBtaW5Ccmlja0hlaWdodCA9IDYwMCArIHRoaXMuVE9QX0lOTkVSX1dBTEwgKyB0aGlzLlRPUF9BRF9XQUxMICsgMTA7XG4gICAgICAgIHZhciBtYXhCcmlja0hlaWdodCA9IGNjLndpblNpemUuaGVpZ2h0IC0gbWluQnJpY2tIZWlnaHQ7XG4gICAgICAgIFxuICAgICAgICB0aGlzLkJSSUNLX1kgPSBNYXRoLm1pbihjYy53aW5TaXplLmhlaWdodCAqIDAuMywgbWF4QnJpY2tIZWlnaHQpO1xuXG4gICAgICAgIHRoaXMuQk9BUkRfWSA9IHRoaXMuQlJJQ0tfWSAtIGNjLndpblNpemUuaGVpZ2h0ICogMC4xNjtcblxuICAgICAgICB0aGlzLnNldENvbnRlbnRTaXplKGNjLndpblNpemUpO1xuXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH0sXG5cbiAgICBvbkVudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5UT1VDSF9PTkVfQllfT05FLFxuICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IHRydWUsXG4gICAgICAgICAgICBvblRvdWNoQmVnYW46IHRoaXMub25Ub3VjaEJlZ2FuLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoTW92ZWQ6IHRoaXMub25Ub3VjaE1vdmVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoRW5kZWQ6IHRoaXMub25Ub3VjaEVuZGVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoQ2FuY2VsbGVkOiB0aGlzLm9uVG91Y2hDYW5jZWxsZWQuYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICB0aGlzLnNjaGVkdWxlVXBkYXRlKCk7XG5cbiAgICAgICAgdGhpcy5zcGFjZS5zZXREZWZhdWx0Q29sbGlzaW9uSGFuZGxlcihcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uQmVnaW4uYmluZCh0aGlzKSxcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uUHJlLmJpbmQodGhpcyksXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvblBvc3QuYmluZCh0aGlzKSxcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uU2VwYXJhdGUuYmluZCh0aGlzKVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUFJFX1NUQVJUO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKGNjLmdhbWUuRVZFTlRfSElERSwgdGhpcy5nYW1lT25IaWRlLCB0aGlzKTtcblxuICAgICAgICB0aGlzLnNob3dUb3BCYW5uZXJBZHMoKTtcblxuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuS0VZQk9BUkQsXG4gICAgICAgICAgICBvbktleVJlbGVhc2VkOiBmdW5jdGlvbiAoa2V5Q29kZSwgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gY2MuS0VZLmJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cnlTaG93UGF1c2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIG9uRXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKGNjLmdhbWUuRVZFTlRfSElERSwgdGhpcy5nYW1lT25IaWRlLCB0aGlzKTtcbiAgICAgICAgLy90aGlzLnNwYWNlLnJlbW92ZUNvbGxpc2lvbkhhbmRsZXIoU2hhcGVUeXBlLkJBTEwsXG4gICAgICAgIC8vICAgIFNoYXBlVHlwZS5CUklDSyk7XG4gICAgICAgIHRoaXMudW5zY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB0aGlzLnJlbW92ZVRvcEJhbm5lckFkcygpO1xuICAgICAgICAvL0JhbGxQb29sLmRyYWluQWxsUG9vbHMoKTtcbiAgICAgICAgdGhpcy5zcGFjZSA9IG51bGw7XG4gICAgICAgIHRoaXMuYmFsbExpc3QgPSBudWxsO1xuICAgICAgICB0aGlzLmJvb3N0cyA9IG51bGw7XG4gICAgICAgIHRoaXMub2JzdGFjbGVzID0gbnVsbDtcbiAgICAgICAgdGhpcy53YWxscyA9IG51bGw7XG4gICAgICAgIHRoaXMuYnJpY2tzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgZ2FtZU9uSGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuU1RBUlQpIHtcbiAgICAgICAgICAgIHRoaXMudHJ5U2hvd1BhdXNlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJ5U2hvd1BhdXNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdG9wZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5zaG93UGF1c2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaW5pdFdvcmxkKCk7XG4gICAgICAgIHRoaXMuaW5pdE9ic3RhY2xlcygpO1xuICAgICAgICB0aGlzLmluaXRCcmlja3MoKTtcbiAgICAgICAgdGhpcy5pbml0Qm9hcmQoKTtcblxuICAgICAgICB0aGlzLmJhbGxMaXN0ID0gW107XG4gICAgICAgIHRoaXMuYm9vc3RzID0gW107XG4gICAgfSxcblxuICAgIGluaXRPYnN0YWNsZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vYnN0YWNsZXMgPSBbXTtcbiAgICAgICAgdGhpcy53YWxscyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29uZmlnLm9ic3RhY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIG9ic3RhY2xlQ2ZnID0gdGhpcy5jb25maWcub2JzdGFjbGVzW2ldO1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBvYnN0YWNsZUNmZy53aWR0aDsgKyt4KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBvYnN0YWNsZUNmZy5oZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxDb2wgPSB4ICsgb2JzdGFjbGVDZmcueDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxvY2FsUm93ID0geSArIG9ic3RhY2xlQ2ZnLnk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYnN0YWNsZSA9IEJhbGxQb29sLmdldEZyb21Qb29sKFwib2JzdGFjbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb2JzdGFjbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic3RhY2xlID0gbmV3IE9ic3RhY2xlKEdyYXlDb2xvciwgdGhpcy5HUklEX1dJRFRILCB0aGlzLkdSSURfSEVJR0hUKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic3RhY2xlLnJlc2V0KEdyYXlDb2xvciwgdGhpcy5HUklEX1dJRFRILCB0aGlzLkdSSURfSEVJR0hUKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENoaWxkKG9ic3RhY2xlKTtcbiAgICAgICAgICAgICAgICAgICAgb2JzdGFjbGUuc2V0UG9zaXRpb24odGhpcy5nZXRHcmlkUG9zKGxvY2FsUm93LCBsb2NhbENvbCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9ic3RhY2xlcy5wdXNoKG9ic3RhY2xlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgV0FMTF9GSUxMX1NJWkUgPSBjYy5zaXplKDYsIDYpO1xuICAgICAgICAgICAgdmFyIHdhbGwgPSBuZXcgV2FsbCgpO1xuICAgICAgICAgICAgd2FsbC5zZXRDb250ZW50U2l6ZShjYy5zaXplKFxuICAgICAgICAgICAgICAgIHRoaXMuR1JJRF9XSURUSCAqIG9ic3RhY2xlQ2ZnLndpZHRoICsgdGhpcy5HQVBfV0lEVEggKiAob2JzdGFjbGVDZmcud2lkdGggLSAxKSArIFdBTExfRklMTF9TSVpFLndpZHRoLFxuICAgICAgICAgICAgICAgIHRoaXMuR1JJRF9IRUlHSFQgKiBvYnN0YWNsZUNmZy5oZWlnaHQgKyB0aGlzLkdBUF9IRUlHSFQgKiAob2JzdGFjbGVDZmcuaGVpZ2h0IC0gMSkgKyBXQUxMX0ZJTExfU0laRS5oZWlnaHQpKTtcbiAgICAgICAgICAgIHRoaXMud2FsbHMucHVzaCh3YWxsKTtcbiAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGQod2FsbCk7XG4gICAgICAgICAgICB2YXIgcG9zID0gY2MucEFkZCh0aGlzLmdldEdyaWRQb3Mob2JzdGFjbGVDZmcueSwgb2JzdGFjbGVDZmcueCksXG4gICAgICAgICAgICAgICAgY2MucCgtMC41ICogdGhpcy5HUklEX1dJRFRILCAtMC41ICogdGhpcy5HUklEX0hFSUdIVCkpO1xuICAgICAgICAgICAgcG9zID0gY2MucEFkZChwb3MsIGNjLnAoLVdBTExfRklMTF9TSVpFLndpZHRoICogMC41LCAtV0FMTF9GSUxMX1NJWkUuaGVpZ2h0ICogMC41KSk7XG4gICAgICAgICAgICB3YWxsLmluaXRCb2R5KHRoaXMuc3BhY2UsIHBvcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaW5pdEJyaWNrczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJyaWNrcyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29uZmlnLmJyaWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGJyaWNrQ2ZnID0gdGhpcy5jb25maWcuYnJpY2tzW2ldO1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBicmlja0NmZy53aWR0aDsgKyt4KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBicmlja0NmZy5oZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYnJpY2sgPSB0aGlzLmNyZWF0ZUJyaWNrKHgsIHksIGJyaWNrQ2ZnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5icmlja3MucHVzaChicmljayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNyZWF0ZUJyaWNrOiBmdW5jdGlvbiAoeCwgeSwgYnJpY2tDZmcpIHtcbiAgICAgICAgdmFyIGxvY2FsQ29sID0geCArIGJyaWNrQ2ZnLng7XG4gICAgICAgIHZhciBsb2NhbFJvdyA9IHkgKyBicmlja0NmZy55O1xuICAgICAgICB2YXIgYnJpY2sgPSBCYWxsUG9vbC5nZXRGcm9tUG9vbChcImJyaWNrXCIpO1xuICAgICAgICBpZiAoIWJyaWNrKSB7XG4gICAgICAgICAgICBicmljayA9IG5ldyBHcmlkKGdldENvbG9yKGJyaWNrQ2ZnLnR5cGUpLCB0aGlzLkdSSURfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQsIEdyaWRUeXBlLkJSSUNLKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJyaWNrLnJlc2V0KGdldENvbG9yKGJyaWNrQ2ZnLnR5cGUpLCB0aGlzLkdSSURfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQsIEdyaWRUeXBlLkJSSUNLKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFkZENoaWxkKGJyaWNrKTtcbiAgICAgICAgYnJpY2suaW5pdEJvZHkodGhpcy5zcGFjZSwgdGhpcy5nZXRHcmlkUG9zKGxvY2FsUm93LCBsb2NhbENvbCkpO1xuICAgICAgICByZXR1cm4gYnJpY2s7XG4gICAgfSxcblxuICAgIGluaXRCb2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJvYXJkTm9kZSA9IG5ldyBCb2FyZCh0aGlzLmdldEJhbGxXaWR0aCgpKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLmJvYXJkTm9kZSk7XG4gICAgICAgIHRoaXMuYm9hcmROb2RlLmluaXRCb2R5KHRoaXMuc3BhY2UsIGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSwgdGhpcy5CT0FSRF9ZKSk7XG4gICAgfSxcblxuICAgIGdldEJhbGxXaWR0aDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgodGhpcy5HUklEX1dJRFRILCA4KTtcbiAgICB9LFxuXG4gICAgaW5pdFdvcmxkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuV0FMTF9USElDSyA9IDUwO1xuICAgICAgICB0aGlzLklOTkVSX1dBTEwgPSAyMDtcbiAgICAgICAgLy90aGlzLlRPUF9JTk5FUl9XQUxMID0gNTA7XG4gICAgICAgIHRoaXMuc3BhY2UgPSBuZXcgY3AuU3BhY2UoKTtcbiAgICAgICAgdmFyIHdhbGxzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwic2hhcGVcIjogY2Muc2l6ZShjYy53aW5TaXplLndpZHRoICsgdGhpcy5XQUxMX1RISUNLLCB0aGlzLldBTExfVEhJQ0spLCAvL2JvdHRvbVxuICAgICAgICAgICAgICAgIFwicG9zXCI6IGNwLnYoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSAtIHRoaXMuV0FMTF9USElDSyAqIDAuNSwgLXRoaXMuV0FMTF9USElDSyAqIDAuNSArIHRoaXMuSU5ORVJfV0FMTClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJzaGFwZVwiOiBjYy5zaXplKGNjLndpblNpemUud2lkdGggKyB0aGlzLldBTExfVEhJQ0ssIHRoaXMuV0FMTF9USElDSyksIC8vdG9wXG4gICAgICAgICAgICAgICAgXCJwb3NcIjogY3AudihjYy53aW5TaXplLndpZHRoICogMC41IC0gdGhpcy5XQUxMX1RISUNLICogMC41LCBjYy53aW5TaXplLmhlaWdodCArIHRoaXMuV0FMTF9USElDSyAqIDAuNSAtIHRoaXMuVE9QX0lOTkVSX1dBTEwgLSB0aGlzLlRPUF9BRF9XQUxMKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcInNoYXBlXCI6IGNjLnNpemUodGhpcy5XQUxMX1RISUNLLCBjYy53aW5TaXplLmhlaWdodCArIHRoaXMuV0FMTF9USElDSyksIC8vbGVmdFxuICAgICAgICAgICAgICAgIFwicG9zXCI6IGNwLnYoLXRoaXMuV0FMTF9USElDSyAqIDAuNSArIHRoaXMuSU5ORVJfV0FMTCwgY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjUgLSB0aGlzLldBTExfVEhJQ0sgKiAwLjUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwic2hhcGVcIjogY2Muc2l6ZSh0aGlzLldBTExfVEhJQ0ssIGNjLndpblNpemUuaGVpZ2h0ICsgdGhpcy5XQUxMX1RISUNLKSwgLy9yaWdodFxuICAgICAgICAgICAgICAgIFwicG9zXCI6IGNwLnYoY2Mud2luU2l6ZS53aWR0aCArIHRoaXMuV0FMTF9USElDSyAqIDAuNSAtIHRoaXMuSU5ORVJfV0FMTCwgY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjUgLSB0aGlzLldBTExfVEhJQ0sgKiAwLjUpXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3YWxscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGJvZHkgPSBuZXcgY3AuQm9keShJbmZpbml0eSwgSW5maW5pdHkpO1xuICAgICAgICAgICAgdmFyIHdhbGwgPSB3YWxsc1tpXTtcbiAgICAgICAgICAgIHZhciBzaGFwZSA9IG5ldyBjcC5Cb3hTaGFwZShib2R5LCB3YWxsLnNoYXBlLndpZHRoLCB3YWxsLnNoYXBlLmhlaWdodCk7XG4gICAgICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICAgICAgc2hhcGUuc2V0RnJpY3Rpb24oMCk7XG4gICAgICAgICAgICBib2R5LnNldFBvcyh3YWxsLnBvcyk7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLmFkZFN0YXRpY1NoYXBlKHNoYXBlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdyYXZpdHlcbiAgICAgICAgdGhpcy5zcGFjZS5ncmF2aXR5ID0gY3AudigwLCAwKTtcbiAgICAgICAgdGhpcy5zcGFjZS5zbGVlcFRpbWVUaHJlc2hvbGQgPSAwLjU7XG4gICAgICAgIHRoaXMuc3BhY2UuY29sbGlzaW9uU2xvcCA9IDAuNTtcbiAgICAgICAgdGhpcy5zcGFjZS5pdGVyYXRpb25zID0gNTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5zcGFjZS51c2VTcGF0aWFsSGFzaCh0aGlzLkdSSURfV0lEVEggKyAyLCAxMDAwMCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3RoaXMuaW5pdERlYnVnTW9kZSgpO1xuICAgIH0sXG5cbiAgICBpbml0RGVidWdNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2RlYnVnTm9kZSA9IGNjLlBoeXNpY3NEZWJ1Z05vZGUuY3JlYXRlKHRoaXMuc3BhY2UpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuX2RlYnVnTm9kZSk7XG4gICAgfSxcblxuICAgIGdldEdyaWRQb3M6IGZ1bmN0aW9uIChsb2NhbFJvdywgbG9jYWxDb2wpIHtcbiAgICAgICAgdmFyIGdyaWRTaXplID0gdGhpcy5nZXRHcmlkU2l6ZSgpO1xuICAgICAgICByZXR1cm4gY2MucCgoY2Mud2luU2l6ZS53aWR0aCAtIHRoaXMuY29uZmlnLnBpeGVsV2lkdGgpICogMC41ICsgKGdyaWRTaXplLndpZHRoICsgdGhpcy5HQVBfV0lEVEgpICogKGxvY2FsQ29sICsgMC41KSxcbiAgICAgICAgICAgIChncmlkU2l6ZS5oZWlnaHQgKyB0aGlzLkdBUF9IRUlHSFQpICogKGxvY2FsUm93ICsgMC41KSArIHRoaXMuQlJJQ0tfWSk7XG4gICAgfSxcblxuICAgIGdldEdyaWRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5sYXN0R3JpZFNpemUpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdEdyaWRTaXplID0gY2Muc2l6ZSh0aGlzLkdSSURfV0lEVEgsIHRoaXMuR1JJRF9IRUlHSFQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmxhc3RHcmlkU2l6ZTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RvcGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoICh0aGlzLmdhbWVTdGVwKSB7XG4gICAgICAgICAgICBjYXNlIEdhbWVTdGVwLlBSRV9TVEFSVDpcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBHYW1lU3RlcC5TVEFSVDpcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVRpbWUoZHQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JpZHMoZHQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hpcG11bmsoZHQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQm9vc3QoZHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tHYW1lT3ZlcigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBHYW1lU3RlcC5SRUxJRkU6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci51cGRhdGVMaWZlQ291bnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBbGxCb29zdHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkTm9kZS5zaG93QmFsbCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5QUkVfU1RBUlQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEdhbWVTdGVwLkVORDpcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoaXBtdW5rKGR0KTtcbiAgICAgICAgICAgICAgICAvL3RoaXMudXBkYXRlQm9vc3QoZHQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZVRpbWU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAoIXRoaXMuZWNsaXBzZWRUaW1lKSB7XG4gICAgICAgICAgICB0aGlzLmVjbGlwc2VkVGltZSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lY2xpcHNlZFRpbWUgKz0gZHQgKiAxMDAwO1xuICAgICAgICAvL2lmICghdGhpcy5zdGFydFRpbWUpIHtcbiAgICAgICAgLy8gICAgdGhpcy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAvL31cbiAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIudXBkYXRlVGltZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUJhbGxzOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYmFsbExpc3QubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIHZhciBiYWxsID0gdGhpcy5iYWxsTGlzdFtpXTtcbiAgICAgICAgICAgIGlmIChiYWxsLmdldFBvc2l0aW9uKCkueSA8IHRoaXMuYm9hcmROb2RlLnkgLSA0MCB8fCAhdGhpcy5pc0luVmlldyhiYWxsKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQmFsbChiYWxsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYmFsbC51cGRhdGUoZHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkanVzdEJhbGxTcGVlZDogZnVuY3Rpb24gKGJhbGwpIHtcbiAgICAgICAgdmFyIHZlbCA9IGJhbGwuZ2V0VmVsKCk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IGNjLnBMZW5ndGgodmVsKTtcbiAgICAgICAgLy9jYy5sb2coXCJhZGp1c3RCYWxsU3BlZWQ6XCIgKyBkaXN0YW5jZSk7XG4gICAgICAgIGlmIChkaXN0YW5jZSA8IHRoaXMuTUFYX1NQRUVEICogMC45KSB7XG4gICAgICAgICAgICB2YXIgcmFkaWFuID0gTWF0aC5hdGFuKHZlbC54IC8gdmVsLnkpO1xuICAgICAgICAgICAgYmFsbC5zZXRWZWwoY2MucCh0aGlzLk1BWF9TUEVFRCAqIE1hdGguc2luKHJhZGlhbiksIHRoaXMuTUFYX1NQRUVEICogTWF0aC5jb3MocmFkaWFuKSkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUdyaWRzOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYnJpY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgYnJpY2sgPSB0aGlzLmJyaWNrc1tpXTtcbiAgICAgICAgICAgIGlmIChicmljay5yZW1vdmVhYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVCcmljayhicmljayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlQ2hpcG11bms6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbExpc3QubGVuZ3RoID4gMjApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYWNlLnN0ZXAoMSAvIDYwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyAxMjApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA+IDIwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyAxMjApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyAxODApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL3ZhciBzdGVwID0gdGhpcy5TUEFDRV9TVEVQO1xuICAgICAgICAvL3ZhciBmcmFtZVRpbWUgPSBNYXRoLm1pbihkdCwgMC4yNSk7XG4gICAgICAgIC8vdGhpcy5hY2N1bXVsYXRvciArPSBmcmFtZVRpbWU7XG4gICAgICAgIC8vd2hpbGUgKHRoaXMuYWNjdW11bGF0b3IgPj0gc3RlcCkge1xuICAgICAgICAvLyAgICB0aGlzLnNwYWNlLnN0ZXAoc3RlcCk7XG4gICAgICAgIC8vICAgIHRoaXMuYWNjdW11bGF0b3IgLT0gc3RlcDtcbiAgICAgICAgLy99XG4gICAgICAgIHRoaXMudXBkYXRlQmFsbHMoZHQpO1xuICAgICAgICB0aGlzLmFkanVzdFJhbmRvbVZlbChkdCk7XG4gICAgfSxcblxuICAgIGFkanVzdFJhbmRvbVZlbDogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIHZhciBSQU5ET01fTUFYX0NPVU5UID0gMTA7XG4gICAgICAgIGlmICh0aGlzLnRvdGFsVGltZSAtIHRoaXMubGFzdEFkanVzdFRpbWUgPiA1KSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RBZGp1c3RUaW1lID0gdGhpcy50b3RhbFRpbWU7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWxsTGlzdC5sZW5ndGggPCAxMCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmJhbGxMaXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiYWxsID0gdGhpcy5iYWxsTGlzdFtpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmRvbTEgPSBnYW1lLnV0aWxzLnJhbmdlTmV4dE51bWJlcigtUkFORE9NX01BWF9DT1VOVCAqIDAuNSwgUkFORE9NX01BWF9DT1VOVCAqIDAuNSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5kb20yID0gZ2FtZS51dGlscy5yYW5nZU5leHROdW1iZXIoLVJBTkRPTV9NQVhfQ09VTlQgKiAwLjUsIFJBTkRPTV9NQVhfQ09VTlQgKiAwLjUpO1xuICAgICAgICAgICAgICAgICAgICBiYWxsLnNldFZlbChjYy5wQWRkKGJhbGwuZ2V0VmVsKCksIGNjLnAocmFuZG9tMSwgcmFuZG9tMikpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b3RhbFRpbWUgKz0gZHQ7XG4gICAgfSxcblxuICAgIHVwZGF0ZUJvb3N0OiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYm9vc3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgYm9vc3QgPSB0aGlzLmJvb3N0c1tpXTtcbiAgICAgICAgICAgIGJvb3N0LnkgLT0gZHQgKiB0aGlzLkJPT1NUX1NQRUVEO1xuICAgICAgICAgICAgaWYgKGNjLnJlY3RJbnRlcnNlY3RzUmVjdChib29zdC5nZXRCb3VuZGluZ0JveCgpLCB0aGlzLmJvYXJkTm9kZS5nZXRCb3VuZGluZ0JveCgpKSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoYm9vc3QudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5MSUZFOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkFkZExpZmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5TUExJVDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlU3BsaXRCYWxsQm9vc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VOZXczQmFsbEJvb3N0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5ib29zdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGJvb3N0LnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1c2VTcGxpdEJhbGxCb29zdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRyeVNob290Rmlyc3RCYWxsKCk7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiYm9vc3RfYWRkXCIpO1xuICAgICAgICBmb3IgKHZhciBqID0gdGhpcy5iYWxsTGlzdC5sZW5ndGggLSAxOyBqID49IDA7IC0taikge1xuICAgICAgICAgICAgdmFyIGJhbGwgPSB0aGlzLmJhbGxMaXN0W2pdO1xuICAgICAgICAgICAgdGhpcy5vblNwbGl0QmFsbChiYWxsLmdldFBvc2l0aW9uKCkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVzZU5ldzNCYWxsQm9vc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cnlTaG9vdEZpcnN0QmFsbCgpO1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImJvb3N0X2FkZFwiKTtcbiAgICAgICAgdGhpcy5vblNob290M0JhbGwoKTtcbiAgICB9LFxuXG4gICAgb25BZGRMaWZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGlmZUNvdW50Kys7XG4gICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLnVwZGF0ZUxpZmVDb3VudCgpO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwibGlmZV9hZGRcIik7XG4gICAgfSxcblxuICAgIG9uU3BsaXRCYWxsOiBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgdmFyIHZlbCA9IHRoaXMuTUFYX1NQRUVEO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgICAgICAgICAgdmFyIGFuZ2xlID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDkwKTtcbiAgICAgICAgICAgIHZhciBzeW1ib2wxID0gKGdhbWUudXRpbHMucmFuZG9tTmV4dEludCgyKSA9PT0gMSA/IDEgOiAtMSk7XG4gICAgICAgICAgICB2YXIgc3ltYm9sMiA9IChnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoMikgPT09IDEgPyAxIDogLTEpO1xuICAgICAgICAgICAgdmFyIHggPSAxMCx5ID0gMTA7XG4gICAgICAgICAgICB2YXIgcmFuZG9tUG9zID0gY2MucEFkZChwb3NpdGlvbiwgY2MucCgteCAvIDIgKyB4ICogZ2FtZS51dGlscy5yYW5kb21OZXh0TnVtYmVyKDEpLFxuICAgICAgICAgICAgICAgIC15IC8gMiArIHkgKiBnYW1lLnV0aWxzLnJhbmRvbU5leHROdW1iZXIoMSkpKTtcbiAgICAgICAgICAgIHRoaXMuc2hvb3RCYWxsKHJhbmRvbVBvcywgY2MucChzeW1ib2wxICogdmVsICogTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIGFuZ2xlKSxcbiAgICAgICAgICAgICAgICAgICAgc3ltYm9sMiAqIHZlbCAqIE1hdGguY29zKE1hdGguUEkgLyAxODAgKiBhbmdsZSkpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvblNob290M0JhbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHZlbCA9IHRoaXMuTUFYX1NQRUVEO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgICAgICAgICAgdmFyIGFuZ2xlID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDkwKTtcbiAgICAgICAgICAgIHZhciBzeW1ib2wgPSAoZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDIpID09PSAxID8gMSA6IC0xKTtcbiAgICAgICAgICAgIHRoaXMuc2hvb3RCYWxsKHRoaXMuZ2V0SW5pdEJhbGxQb3MoKSwgY2MucChzeW1ib2wgKiB2ZWwgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogYW5nbGUpLFxuICAgICAgICAgICAgICAgIHZlbCAqIE1hdGguY29zKE1hdGguUEkgLyAxODAgKiBhbmdsZSkpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzd2l0Y2hQYXNzRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwidmljdG9yeVwiKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmhhc05leHRMZXZlbCgpKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFBhc3NEbGcoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkucmVzdW1lR2FtZSgpO1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiYWxsX2NvbXBsZXRlZFwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkxFVkVMKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgNTAwKTtcbiAgICB9LFxuXG4gICAgY2hlY2tHYW1lT3ZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLmJyaWNrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5FTkQ7XG4gICAgICAgICAgICB0aGlzLnNob3dCYW5uZXJBZHMoKTtcbiAgICAgICAgICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nYW1lV2luKHRoaXMuZWNsaXBzZWRUaW1lIC8gMTAwMCk7XG4gICAgICAgICAgICB2YXIgc3RhciA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5jdXJyZW50U3RhcjtcbiAgICAgICAgICAgIGlmIChzdGFyIDwgMyAmJiBHYW1lTWFuLmdldEluc3RhbmNlKCkuY2FuUG9wM1N0YXJUaXBzKCkpIHtcbiAgICAgICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0UG9wM1N0YXJUaXBzKCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKF8oXCJzdGFyXzNfdGlwc1wiKSwgXyhcInJldHJ5X3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnJlc3VtZUdhbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoUGFzc0RsZygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaFBhc3NEbGcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubGlmZUNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlmZUNvdW50LS07XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLlJFTElGRTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5XQVRDSF9BRDtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJ3YXRjaF9hZHNfcmVsaWZlXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJlbGlmZV95ZXNcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwicmVsaWZlX25vXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYud2F0Y2hBZEFuZFJlbGlmZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN3aXRjaFRvRmFpbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoVG9GYWlsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHN3aXRjaFRvUmVsaWZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkucG9wdXBCb29zdFJld2FyZERsZygxLCAxLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmxpZmVDb3VudCA9IDI7XG4gICAgICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUkVMSUZFO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBzd2l0Y2hUb0ZhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnN3aXRjaEZhaWwoKTtcbiAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLkVORDtcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEZhaWxEbGcoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNraXBMZXZlbCgpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGlzSW5WaWV3OiBmdW5jdGlvbiAoYmFsbCkge1xuICAgICAgICB2YXIgd29ybGRQb3MgPSBiYWxsLmdldFBvc2l0aW9uKCk7XG4gICAgICAgIGlmICh3b3JsZFBvcy54IDwgMCB8fCB3b3JsZFBvcy54ID4gY2Mud2luU2l6ZS53aWR0aCB8fCB3b3JsZFBvcy55IDwgMCB8fCB3b3JsZFBvcy55ID4gY2Mud2luU2l6ZS5oZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgdHJ5U2hvb3RGaXJzdEJhbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2FtZVN0ZXAgPT09IEdhbWVTdGVwLlBSRV9TVEFSVCkge1xuICAgICAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLlNUQVJUO1xuICAgICAgICAgICAgdGhpcy5zaG9vdEJhbGwodGhpcy5nZXRJbml0QmFsbFBvcygpLCBjYy5wKDAsIHRoaXMuTUFYX1NQRUVEKSk7XG4gICAgICAgICAgICB0aGlzLmJvYXJkTm9kZS5oaWRlQmFsbCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2N1clRvdWNoSWQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3VyVG91Y2hJZCA9IHRvdWNoLmdldElEKCk7XG4gICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyICYmIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRIZWxwLnZpc2libGUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRIZWxwLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcImZpcnN0X2VudGVyXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdG91Y2hMb2NhdGlvbiA9IHRvdWNoLmdldExvY2F0aW9uKCk7XG4gICAgICAgIHRvdWNoTG9jYXRpb24gPSB0aGlzLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaExvY2F0aW9uKTtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2hQb3MgPSB0b3VjaExvY2F0aW9uO1xuICAgICAgICAvL3RoaXMuYm9hcmROb2RlLnNldFBvc1godGhpcy5sYXN0VG91Y2hQb3MueCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBvblRvdWNoTW92ZWQ6ZnVuY3Rpb24odG91Y2gsIGV2ZW50KSB7XG4gICAgICAgIGlmICh0b3VjaC5nZXRJRCgpICE9PSB0aGlzLl9jdXJUb3VjaElkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvdWNoTG9jYXRpb24gPSB0b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICB0b3VjaExvY2F0aW9uID0gdGhpcy5nZXRQYXJlbnQoKS5jb252ZXJ0VG9Ob2RlU3BhY2UodG91Y2hMb2NhdGlvbik7XG4gICAgICAgIGlmICh0aGlzLmxhc3RUb3VjaFBvcykge1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9ICh0b3VjaExvY2F0aW9uLnggLSB0aGlzLmxhc3RUb3VjaFBvcy54KTtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyhvZmZzZXQpID4gMikge1xuICAgICAgICAgICAgICAgIHZhciBYX09GRlNFVCA9IHRoaXMuSU5ORVJfV0FMTCArIHRoaXMuZ2V0QmFsbFdpZHRoKCkgKiAwLjUgKyAyO1xuICAgICAgICAgICAgICAgIHZhciB4ID0gdGhpcy5ib2FyZE5vZGUueCArIG9mZnNldCAqIDEuNjtcbiAgICAgICAgICAgICAgICBpZiAoeCA8IFhfT0ZGU0VUKSB7XG4gICAgICAgICAgICAgICAgICAgIHggPSBYX09GRlNFVDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHggPiBjYy53aW5TaXplLndpZHRoIC0gWF9PRkZTRVQpIHtcbiAgICAgICAgICAgICAgICAgICAgeCA9IGNjLndpblNpemUud2lkdGggLSBYX09GRlNFVDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZE5vZGUuc2V0UG9zWCh4KTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RUb3VjaFBvcyA9IHRvdWNoTG9jYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIG9uVG91Y2hFbmRlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHRvdWNoLmdldElEKCkgIT09IHRoaXMuX2N1clRvdWNoSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRyeVNob290Rmlyc3RCYWxsKCk7XG4gICAgICAgIHRoaXMubGFzdFNlbGVjdEdyaWQgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RUb3VjaFBvcyA9IG51bGw7XG4gICAgICAgIHRoaXMuX2N1clRvdWNoSWQgPSAtMTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaENhbmNlbGxlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICB9LFxuXG4gICAgY29sbGlzaW9uQmVnaW4gOiBmdW5jdGlvbiAoIGFyYml0ZXIsIHNwYWNlICkge1xuICAgICAgICAvL2NjLmxvZygnY29sbGlzaW9uIGJlZ2luJyk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBjb2xsaXNpb25QcmUgOiBmdW5jdGlvbiAoIGFyYml0ZXIsIHNwYWNlICkge1xuICAgICAgICAvL2NjLmxvZygnY29sbGlzaW9uIHByZScpO1xuICAgICAgICB2YXIgc2hhcGVzID0gYXJiaXRlci5nZXRTaGFwZXMoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaGFwZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBzaGFwZSA9IHNoYXBlc1tpXTtcbiAgICAgICAgICAgIGlmIChzaGFwZS5jb2xsaXNpb25fdHlwZSA9PT0gU2hhcGVUeXBlLkJSSUNLKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvZHkgPSBzaGFwZS5nZXRCb2R5KCk7XG4gICAgICAgICAgICAgICAgaWYgKGJvZHkudXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgYm9keS51c2VyRGF0YS5yZW1vdmVhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUJvb3N0KGJvZHkudXNlckRhdGEuZ2V0UG9zaXRpb24oKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzaGFwZS5jb2xsaXNpb25fdHlwZSA9PT0gU2hhcGVUeXBlLkJBTEwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuU1RBUlQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5S25vY2tBdWRpbygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY29sbGlzaW9uUG9zdCA6IGZ1bmN0aW9uICggYXJiaXRlciwgc3BhY2UgKSB7XG4gICAgICAgIC8vY2MubG9nKCdjb2xsaXNpb24gcG9zdCcpO1xuICAgIH0sXG5cbiAgICBjb2xsaXNpb25TZXBhcmF0ZSA6IGZ1bmN0aW9uICggYXJiaXRlciwgc3BhY2UgKSB7XG4gICAgICAgIC8vY2MubG9nKCdjb2xsaXNpb24gc2VwYXJhdGUnKTtcbiAgICAgICAgdmFyIHNoYXBlcyA9IGFyYml0ZXIuZ2V0U2hhcGVzKCk7XG4gICAgICAgIHZhciBiYWxsU2hhcGUgPSBudWxsO1xuICAgICAgICB2YXIgYm9hcmRTaGFwZSA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hhcGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoc2hhcGVzW2ldLmNvbGxpc2lvbl90eXBlID09PSBTaGFwZVR5cGUuQkFMTCkge1xuICAgICAgICAgICAgICAgIHZhciBib2R5ID0gc2hhcGVzW2ldLmdldEJvZHkoKTtcbiAgICAgICAgICAgICAgICBpZiAoYm9keSAmJiBib2R5LnVzZXJEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0QmFsbFNwZWVkKGJvZHkudXNlckRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBiYWxsU2hhcGUgPSBzaGFwZXNbaV07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNoYXBlc1tpXS5jb2xsaXNpb25fdHlwZSA9PT0gU2hhcGVUeXBlLkJPQVJEKSB7XG4gICAgICAgICAgICAgICAgYm9hcmRTaGFwZSA9IHNoYXBlc1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYmFsbFNoYXBlICYmIGJvYXJkU2hhcGUpIHtcbiAgICAgICAgICAgIGlmIChiYWxsU2hhcGUuYm9keSAmJiBiYWxsU2hhcGUuYm9keS51c2VyRGF0YSAmJiBib2FyZFNoYXBlLmJvZHkgJiYgYm9hcmRTaGFwZS5ib2R5LnVzZXJEYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJhbGwgPSBiYWxsU2hhcGUuYm9keS51c2VyRGF0YTtcbiAgICAgICAgICAgICAgICB2YXIgYm9hcmQgPSBib2FyZFNoYXBlLmJvZHkudXNlckRhdGE7XG4gICAgICAgICAgICAgICAgaWYgKGJhbGwuZ2V0UG9zaXRpb24oKS55IDwgYm9hcmQueSArIGJvYXJkLmhlaWdodCAqIDAuNSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBib2FyZFNoYXBlWDEgPSBiYWxsLmdldFBvc2l0aW9uKCkueCAtIChib2FyZC54IC0gYm9hcmQud2lkdGggLyAyKTtcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGJvYXJkU2hhcGVYMSAvIGJvYXJkU2hhcGUuYm9keS51c2VyRGF0YS53aWR0aCAqIDEwMCAvIDUwIC0gMTtcbiAgICAgICAgICAgICAgICB4ID0gTWF0aC5tYXgoTWF0aC5taW4oMC45LCB4KSwgLTAuOSk7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBNYXRoLnNxcnQoMSAtIHggKiB4KTtcbiAgICAgICAgICAgICAgICBiYWxsLnNldFZlbChjYy5wKHRoaXMuTUFYX1NQRUVEICogeCwgdGhpcy5NQVhfU1BFRUQgKiB5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUtub2NrQXVkaW86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RUaW1lID4gNTApIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJrbm9ja1wiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRJbml0QmFsbFBvczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2MucEFkZCh0aGlzLmJvYXJkTm9kZS5nZXRQb3NpdGlvbigpLCBjYy5wKDAsIDMwKSk7XG4gICAgfSxcblxuICAgIHNob290QmFsbDogZnVuY3Rpb24gKHBvc2l0aW9uLCB2ZWwpIHtcbiAgICAgICAgaWYgKHRoaXMuYmFsbExpc3QubGVuZ3RoID4gdGhpcy5NQVhfQkFMTCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBiYWxsID0gQmFsbFBvb2wuZ2V0RnJvbVBvb2woXCJiYWxsXCIpO1xuICAgICAgICBpZiAoIWJhbGwpIHtcbiAgICAgICAgICAgIGJhbGwgPSBuZXcgQmFsbCh0aGlzLmdldEJhbGxXaWR0aCgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJhbGwucmVzZXQodGhpcy5nZXRCYWxsV2lkdGgoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRDaGlsZChiYWxsKTtcbiAgICAgICAgdGhpcy5iYWxsTGlzdC5wdXNoKGJhbGwpO1xuICAgICAgICBiYWxsLmluaXRCb2R5KHRoaXMuc3BhY2UsIHBvc2l0aW9uKTtcbiAgICAgICAgYmFsbC5zZXRWZWwodmVsKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQmFsbDogZnVuY3Rpb24gKGJhbGwpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5iYWxsTGlzdC5pbmRleE9mKGJhbGwpO1xuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5iYWxsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGJhbGwucmVtb3ZlQm9keSgpO1xuICAgICAgICBCYWxsUG9vbC5wdXRJblBvb2woXCJiYWxsXCIsIGJhbGwpO1xuICAgICAgICBiYWxsLnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQnJpY2s6IGZ1bmN0aW9uIChicmljaykge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmJyaWNrcy5pbmRleE9mKGJyaWNrKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuYnJpY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJpY2sucmVtb3ZlQm9keSgpO1xuICAgICAgICBpZiAoYnJpY2suaXNHaWZ0KSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmRHaWZ0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VtZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEJhbGxQb29sLnB1dEluUG9vbChcImJyaWNrXCIsIGJyaWNrKTtcbiAgICAgICAgfVxuICAgICAgICBicmljay5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgfSxcblxuICAgIGdlbmVyYXRlQm9vc3Q6IGZ1bmN0aW9uIChwb3MpIHtcbiAgICAgICAgdmFyIGJvb3N0VHlwZTtcblxuICAgICAgICB2YXIgaGFzQm9vc3QgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuaGFyZE1vZGUpIHtcbiAgICAgICAgICAgIGhhc0Jvb3N0ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDQwMCkgPCA0MDAgKiB0aGlzLkJPT1NUX1BPU0lCSUxJVFkgLyB0aGlzLmJhbGxMaXN0Lmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhhc0Jvb3N0ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDEwMCkgPCAxMDAgKiB0aGlzLkJPT1NUX1BPU0lCSUxJVFkgLyB0aGlzLmJhbGxMaXN0Lmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChHYW1lTWFuLmdldEluc3RhbmNlKCkubGV2ZWxJZCA8PSAyKSB7XG4gICAgICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5nZW5lcmF0ZUJvb3N0Q291bnQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUJvb3N0Q291bnQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuZ2VuZXJhdGVCb29zdENvdW50IDwgMykge1xuICAgICAgICAgICAgICAgIGhhc0Jvb3N0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlQm9vc3RDb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNCb29zdCkge1xuICAgICAgICAgICAgYm9vc3RUeXBlID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDIpICsgMjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBoYXNMaWZlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKCFoYXNCb29zdCkge1xuICAgICAgICAgICAgaGFzTGlmZSA9IGdhbWUudXRpbHMucmFuZG9tTmV4dE51bWJlcigxMDApIDwgKDEwMCAqIHRoaXMuTElGRV9QT1NJQklMSVRZIC8gdGhpcy5iYWxsTGlzdC5sZW5ndGgpO1xuICAgICAgICAgICAgaWYgKGhhc0xpZmUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGlmZUJvb3N0Q291bnQgPSAwO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib29zdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9vc3RzW2ldLnR5cGUgPT09IEJvb3N0VHlwZS5MSUZFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaWZlQm9vc3RDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpZmVDb3VudCArIGxpZmVCb29zdENvdW50ID49IHRoaXMuTUFYX0xJRkUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFzTGlmZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJvb3N0VHlwZSA9IEJvb3N0VHlwZS5MSUZFO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYXNMaWZlIHx8IGhhc0Jvb3N0KSB7XG4gICAgICAgICAgICB2YXIgYm9vc3QgPSBuZXcgQm9vc3QoYm9vc3RUeXBlKTtcbiAgICAgICAgICAgIGJvb3N0LnNldFBvc2l0aW9uKHBvcyk7XG4gICAgICAgICAgICB0aGlzLmFkZENoaWxkKGJvb3N0KTtcbiAgICAgICAgICAgIC8vYm9vc3QucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbygocG9zLnkgLyAxMDApLCBjYy5wKHBvcy54LCAwKSksIGNjLmNhbGxGdW5jKHRoaXMub25SZW1vdmVCb29zdCwgdGhpcykpKTtcbiAgICAgICAgICAgIHRoaXMuYm9vc3RzLnB1c2goYm9vc3QpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUmVtb3ZlQm9vc3Q6IGZ1bmN0aW9uIChib29zdCkge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmJvb3N0cy5pbmRleE9mKGJvb3N0KTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuYm9vc3RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBib29zdC5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlQWxsQm9vc3RzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib29zdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBib29zdCA9IHRoaXMuYm9vc3RzW2ldO1xuICAgICAgICAgICAgaWYgKGJvb3N0KSB7XG4gICAgICAgICAgICAgICAgYm9vc3QucmVtb3ZlRnJvbVBhcmVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm9vc3RzID0gW107XG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9wZWQgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuc2hvd0Jhbm5lckFkcygpO1xuICAgIH0sXG5cbiAgICByZXN1bWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9wZWQgPSBmYWxzZTtcbiAgICAgICAgLy9nYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgIH0sXG5cbiAgICBzaG93QmFubmVyQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsKCkgPj0gMykge1xuICAgICAgICAvLyAgICBnYW1lLmFkc01hbmFnZXIuc2hvd0Jhbm5lckFkcyhcImJvdHRvbVwiKTtcbiAgICAgICAgLy99XG4gICAgfSxcblxuICAgIHNob3dUb3BCYW5uZXJBZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsKCkgPj0gMykge1xuICAgICAgICAgICAgaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgICAgICAgICAgLy9pZiAxID4gMFxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRSZWdpc3RlckRheSgpID4gZ2FtZS5hZHNNYW5hZ2VyLnRvcEJhbm5lckRheSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd0Jhbm5lckFkcyhcInRvcFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlVG9wQmFubmVyQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgIC8vICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJ0b3BcIik7XG4gICAgICAgIC8vfVxuICAgIH0sXG5cbiAgICB3YXRjaEFkQW5kUmVsaWZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcImZ1aHVvMDFcIiA6IFwiZnVodW8wMVwiLCBmdW5jdGlvbiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIGlmIChyZXdhcmRlZCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoQWRzVG9SZWxpZmVcIik7XG4gICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hUb1JlbGlmZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLnN3aXRjaFRvRmFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCcmlja3NWaWV3OyJdfQ==
